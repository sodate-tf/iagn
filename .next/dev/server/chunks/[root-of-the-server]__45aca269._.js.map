{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Windows/Documents/AIGP/aigp/app/api/calendar/today/route.ts"],"sourcesContent":["// app/api/calendar/today/route.ts\r\nimport { google } from \"googleapis\";\r\nimport { NextResponse } from \"next/server\";\r\n\r\nfunction getEnvOrThrow(name: string) {\r\n  const v = process.env[name];\r\n  if (!v) throw new Error(`${name} não configurado`);\r\n  return v;\r\n}\r\n\r\nexport async function GET(req: Request) {\r\n  try {\r\n    // calendarId vem do query param ?calendarId=... ou do ENV\r\n    const url = new URL(req.url);\r\n    const qCalendarId = url.searchParams.get(\"calendarId\") || undefined;\r\n    const calendarId = qCalendarId || process.env.GOOGLE_CALENDAR_ID;\r\n    if (!calendarId) {\r\n      return NextResponse.json({ success: false, error: \"GOOGLE_CALENDAR_ID ausente\" }, { status: 400 });\r\n    }\r\n\r\n    // Credenciais: prefira variáveis de ambiente (Vercel)\r\n    const clientEmail = process.env.GOOGLE_CLIENT_EMAIL;\r\n    const privateKey = process.env.GOOGLE_PRIVATE_KEY;\r\n\r\n    if (!clientEmail || !privateKey) {\r\n      return NextResponse.json({ success: false, error: \"Credenciais da service account não configuradas\" }, { status: 500 });\r\n    }\r\n\r\n    const auth = new google.auth.GoogleAuth({\r\n      credentials: {\r\n        client_email: clientEmail,\r\n        private_key: privateKey.replace(/\\\\n/g, \"\\n\"),\r\n      },\r\n      scopes: [\"https://www.googleapis.com/auth/calendar.readonly\"],\r\n    });\r\n\r\n    const calendar = google.calendar({ version: \"v3\", auth });\r\n\r\n    // intervalo do dia (no timezone do servidor — se quiser forçar PT-BR, veja nota abaixo)\r\n    const now = new Date();\r\n    const startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 0, 0, 0).toISOString();\r\n    const endOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59, 999).toISOString();\r\n\r\n    const res = await calendar.events.list({\r\n      calendarId,\r\n      timeMin: startOfDay,\r\n      timeMax: endOfDay,\r\n      singleEvents: true,\r\n      orderBy: \"startTime\",\r\n      maxResults: 250,\r\n    });\r\n\r\n    const items = res.data.items || [];\r\n    const events = items.map(e => ({\r\n      id: e.id,\r\n      title: e.summary || \"Sem título\",\r\n      start: e.start?.dateTime || e.start?.date,\r\n      end: e.end?.dateTime || e.end?.date,\r\n      location: e.location || \"\",\r\n    }));\r\n\r\n    return NextResponse.json({ success: true, count: events.length, events });\r\n  } catch (err: any) {\r\n    console.error(\"API /api/calendar/today error:\", err);\r\n    return NextResponse.json({ success: false, error: err.message || String(err) }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,kCAAkC;;;;;AAClC;AACA;;;AAEA,SAAS,cAAc,IAAY;IACjC,MAAM,IAAI,QAAQ,GAAG,CAAC,KAAK;IAC3B,IAAI,CAAC,GAAG,MAAM,IAAI,MAAM,GAAG,KAAK,gBAAgB,CAAC;IACjD,OAAO;AACT;AAEO,eAAe,IAAI,GAAY;IACpC,IAAI;QACF,0DAA0D;QAC1D,MAAM,MAAM,IAAI,IAAI,IAAI,GAAG;QAC3B,MAAM,cAAc,IAAI,YAAY,CAAC,GAAG,CAAC,iBAAiB;QAC1D,MAAM,aAAa,eAAe,QAAQ,GAAG,CAAC,kBAAkB;QAChE,IAAI,CAAC,YAAY;YACf,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAA6B,GAAG;gBAAE,QAAQ;YAAI;QAClG;QAEA,sDAAsD;QACtD,MAAM,cAAc,QAAQ,GAAG,CAAC,mBAAmB;QACnD,MAAM,aAAa,QAAQ,GAAG,CAAC,kBAAkB;QAEjD,IAAI,CAAC,eAAe,CAAC,YAAY;YAC/B,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAAkD,GAAG;gBAAE,QAAQ;YAAI;QACvH;QAEA,MAAM,OAAO,IAAI,+JAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YACtC,aAAa;gBACX,cAAc;gBACd,aAAa,WAAW,OAAO,CAAC,QAAQ;YAC1C;YACA,QAAQ;gBAAC;aAAoD;QAC/D;QAEA,MAAM,WAAW,+JAAM,CAAC,QAAQ,CAAC;YAAE,SAAS;YAAM;QAAK;QAEvD,wFAAwF;QACxF,MAAM,MAAM,IAAI;QAChB,MAAM,aAAa,IAAI,KAAK,IAAI,WAAW,IAAI,IAAI,QAAQ,IAAI,IAAI,OAAO,IAAI,GAAG,GAAG,GAAG,WAAW;QAClG,MAAM,WAAW,IAAI,KAAK,IAAI,WAAW,IAAI,IAAI,QAAQ,IAAI,IAAI,OAAO,IAAI,IAAI,IAAI,IAAI,KAAK,WAAW;QAExG,MAAM,MAAM,MAAM,SAAS,MAAM,CAAC,IAAI,CAAC;YACrC;YACA,SAAS;YACT,SAAS;YACT,cAAc;YACd,SAAS;YACT,YAAY;QACd;QAEA,MAAM,QAAQ,IAAI,IAAI,CAAC,KAAK,IAAI,EAAE;QAClC,MAAM,SAAS,MAAM,GAAG,CAAC,CAAA,IAAK,CAAC;gBAC7B,IAAI,EAAE,EAAE;gBACR,OAAO,EAAE,OAAO,IAAI;gBACpB,OAAO,EAAE,KAAK,EAAE,YAAY,EAAE,KAAK,EAAE;gBACrC,KAAK,EAAE,GAAG,EAAE,YAAY,EAAE,GAAG,EAAE;gBAC/B,UAAU,EAAE,QAAQ,IAAI;YAC1B,CAAC;QAED,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM,OAAO,OAAO,MAAM;YAAE;QAAO;IACzE,EAAE,OAAO,KAAU;QACjB,QAAQ,KAAK,CAAC,kCAAkC;QAChD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAO,OAAO,IAAI,OAAO,IAAI,OAAO;QAAK,GAAG;YAAE,QAAQ;QAAI;IAChG;AACF","debugId":null}}]
}