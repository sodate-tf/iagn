{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 106, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Windows/Documents/AIGP/aigp/services/configService.ts"],"sourcesContent":["import { neon, neonConfig } from \"@neondatabase/serverless\";\r\n\r\nneonConfig.fetchConnectionCache = true;\r\n\r\nif (!process.env.POSTGRES_URL) {\r\n  throw new Error(\"‚ùå Vari√°vel de ambiente POSTGRES_URL n√£o definida.\");\r\n}\r\n\r\nconst sql = neon(process.env.POSTGRES_URL);\r\n\r\n/* =========================================================\r\n   üéõÔ∏è Interface do modelo de configura√ß√µes\r\n   ========================================================= */\r\nexport interface AiSettings {\r\n  id: string;\r\n  agent_name: string;\r\n  ai_model: string;\r\n  calendar_id: string | null;\r\n  focus_keywords: string | null;\r\n  remote_post_url: string | null;\r\n  remote_post_api_key: string | null;\r\n  json_format_template: string | null;\r\n\r\n  // üß† Instru√ß√µes espec√≠ficas de cada agente\r\n  writer_instructions: string | null;\r\n  formatter_instructions: string | null;\r\n  seo_instructions: string | null;\r\n\r\n  // üóÇÔ∏è Arquivos de conhecimento (armazenados como JSON)\r\n  writer_files: string | null;\r\n  formatter_files: string | null;\r\n  seo_files: string | null;\r\n\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\n/* =========================================================\r\n   üîç Buscar configura√ß√µes atuais\r\n   ========================================================= */\r\nexport async function getSettings(): Promise<AiSettings | null> {\r\n  try {\r\n    const result = await sql`\r\n      SELECT * FROM ai_settings\r\n      ORDER BY created_at ASC\r\n      LIMIT 1;\r\n    `;\r\n\r\n    if (!result || result.length === 0) {\r\n      console.warn(\"‚ö†Ô∏è Nenhuma configura√ß√£o encontrada na tabela ai_settings.\");\r\n      return null;\r\n    }\r\n\r\n    const row = result[0];\r\n    return {\r\n      ...row,\r\n      writer_files: row.writer_files ? JSON.stringify(row.writer_files) : \"[]\",\r\n      formatter_files: row.formatter_files ? JSON.stringify(row.formatter_files) : \"[]\",\r\n      seo_files: row.seo_files ? JSON.stringify(row.seo_files) : \"[]\",\r\n    } as AiSettings;\r\n  } catch (error) {\r\n    console.error(\"‚ùå Erro ao buscar configura√ß√µes:\", error);\r\n    throw new Error(\"Falha ao buscar configura√ß√µes da IA.\");\r\n  }\r\n}\r\n\r\n/* =========================================================\r\n   ‚úèÔ∏è Atualizar configura√ß√µes\r\n   ========================================================= */\r\nexport async function updateSettings(data: Partial<AiSettings>): Promise<void> {\r\n  try {\r\n    const result = await sql`SELECT id FROM ai_settings LIMIT 1;`;\r\n    if (!result || result.length === 0)\r\n      throw new Error(\"Nenhuma configura√ß√£o encontrada para atualizar.\");\r\n\r\n    const { id } = result[0];\r\n\r\n    // üîπ Remove campos imut√°veis\r\n    const sanitizedData = { ...data };\r\n    delete (sanitizedData as any).updated_at;\r\n    delete (sanitizedData as any).created_at;\r\n    delete (sanitizedData as any).id;\r\n\r\n    const keys = Object.keys(sanitizedData);\r\n    if (keys.length === 0) return;\r\n\r\n    const setClause = keys.map((key, i) => `${key} = $${i + 1}`).join(\", \");\r\n    const values = Object.values(sanitizedData);\r\n\r\n    const query = `\r\n      UPDATE ai_settings\r\n      SET ${setClause}, updated_at = NOW()\r\n      WHERE id = $${keys.length + 1};\r\n    `;\r\n\r\n    await sql(query, [...values, id]);\r\n    console.log(`üß† Configura√ß√µes atualizadas: ${keys.join(\", \")}`);\r\n  } catch (error) {\r\n    console.error(\"‚ùå Erro ao atualizar configura√ß√µes:\", error);\r\n    throw new Error(\"Falha ao atualizar as configura√ß√µes.\");\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,oKAAU,CAAC,oBAAoB,GAAG;AAElC,IAAI,CAAC,QAAQ,GAAG,CAAC,YAAY,EAAE;IAC7B,MAAM,IAAI,MAAM;AAClB;AAEA,MAAM,MAAM,IAAA,8JAAI,EAAC,QAAQ,GAAG,CAAC,YAAY;AAgClC,eAAe;IACpB,IAAI;QACF,MAAM,SAAS,MAAM,GAAG,CAAC;;;;IAIzB,CAAC;QAED,IAAI,CAAC,UAAU,OAAO,MAAM,KAAK,GAAG;YAClC,QAAQ,IAAI,CAAC;YACb,OAAO;QACT;QAEA,MAAM,MAAM,MAAM,CAAC,EAAE;QACrB,OAAO;YACL,GAAG,GAAG;YACN,cAAc,IAAI,YAAY,GAAG,KAAK,SAAS,CAAC,IAAI,YAAY,IAAI;YACpE,iBAAiB,IAAI,eAAe,GAAG,KAAK,SAAS,CAAC,IAAI,eAAe,IAAI;YAC7E,WAAW,IAAI,SAAS,GAAG,KAAK,SAAS,CAAC,IAAI,SAAS,IAAI;QAC7D;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mCAAmC;QACjD,MAAM,IAAI,MAAM;IAClB;AACF;AAKO,eAAe,eAAe,IAAyB;IAC5D,IAAI;QACF,MAAM,SAAS,MAAM,GAAG,CAAC,mCAAmC,CAAC;QAC7D,IAAI,CAAC,UAAU,OAAO,MAAM,KAAK,GAC/B,MAAM,IAAI,MAAM;QAElB,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM,CAAC,EAAE;QAExB,6BAA6B;QAC7B,MAAM,gBAAgB;YAAE,GAAG,IAAI;QAAC;QAChC,OAAO,AAAC,cAAsB,UAAU;QACxC,OAAO,AAAC,cAAsB,UAAU;QACxC,OAAO,AAAC,cAAsB,EAAE;QAEhC,MAAM,OAAO,OAAO,IAAI,CAAC;QACzB,IAAI,KAAK,MAAM,KAAK,GAAG;QAEvB,MAAM,YAAY,KAAK,GAAG,CAAC,CAAC,KAAK,IAAM,GAAG,IAAI,IAAI,EAAE,IAAI,GAAG,EAAE,IAAI,CAAC;QAClE,MAAM,SAAS,OAAO,MAAM,CAAC;QAE7B,MAAM,QAAQ,CAAC;;UAET,EAAE,UAAU;kBACJ,EAAE,KAAK,MAAM,GAAG,EAAE;IAChC,CAAC;QAED,MAAM,IAAI,OAAO;eAAI;YAAQ;SAAG;QAChC,QAAQ,GAAG,CAAC,CAAC,8BAA8B,EAAE,KAAK,IAAI,CAAC,OAAO;IAChE,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,sCAAsC;QACpD,MAAM,IAAI,MAAM;IAClB;AACF","debugId":null}},
    {"offset": {"line": 177, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Windows/Documents/AIGP/aigp/services/geminiService.ts"],"sourcesContent":["import { GoogleGenAI, Type } from \"@google/genai\";\nimport { getSettings } from \"@/services/configService\";\n\nif (!process.env.GEMINI_API_KEY) {\n  console.error(\"‚ùå [GeminiService] Vari√°vel de ambiente GEMINI_API_KEY n√£o configurada!\");\n} else {\n  console.log(\"‚úÖ [GeminiService] GEMINI_API_KEY detectada com sucesso.\");\n}\n\nconst ai = new GoogleGenAI({ apiKey: process.env.GEMINI_API_KEY as string });\n\n// ====================================================================\n// üìù Fun√ß√£o para obter configura√ß√µes din√¢micas do banco\n// ====================================================================\nasync function loadAgentSettings() {\n  const settings = await getSettings();\n  if (!settings) {\n    throw new Error(\"Configura√ß√µes de IA n√£o encontradas no banco.\");\n  }\n  return settings;\n}\n\n// ====================================================================\n// üïäÔ∏è 1. Cria√ß√£o do artigo jornal√≠stico (texto bruto)\n// ====================================================================\nexport const writeNewsArticle = async (topic: string, language: string, focusKeywords: string): Promise<string> => {\n  console.log(\"üïäÔ∏è [writeNewsArticle] Iniciando gera√ß√£o do artigo‚Ä¶\");\n\n  const settings = await loadAgentSettings();\n  const prompt = settings.writer_instructions + `\nTema: \"${topic}\"  \nIdioma: ${language}  \nPalavras-chave foco: ${focusKeywords}\n\n` + /* o restante da montagem de prompt usando as instru√ß√µes do banco */ ``;\n\n  console.log(`[writeNewsArticle] Tema: ${topic}`);\n  console.log(`[writeNewsArticle] Idioma: ${language}`);\n  console.log(`[writeNewsArticle] Palavras-chave: ${focusKeywords}`);\n  console.log(`[writeNewsArticle] Instru√ß√µes utilizadas:`, settings.writer_instructions);\n\n  try {\n    const response = await ai.models.generateContent({\n      model: settings.ai_model,\n      contents: [{ parts: [{ text: prompt }] }],\n    });\n    console.log(\"‚úÖ [writeNewsArticle] Artigo gerado com sucesso.\");\n    return response.text;\n  } catch (error) {\n    console.error(\"‚ùå [writeNewsArticle] Erro:\", error);\n    throw new Error(\"Falha ao gerar o artigo de not√≠cia pela IA.\");\n  }\n};\n\n// ====================================================================\n// üé® 2. Convers√£o para HTML sem√¢ntico\n// ====================================================================\nexport const formatArticleToHtml = async (articleText: string): Promise<string> => {\n  console.log(\"üé® [formatArticleToHtml] Iniciando formata√ß√£o do artigo‚Ä¶\");\n\n  const settings = await loadAgentSettings();\n  const prompt = settings.formatter_instructions + `\n\nTexto para formatar:\n${articleText}\n\n` + /* restante da montagem do prompt */ ``;\n\n  console.log(\"[formatArticleToHtml] Instru√ß√µes utilizadas:\", settings.formatter_instructions);\n\n  try {\n    const response = await ai.models.generateContent({\n      model: settings.ai_model,\n      contents: [{ parts: [{ text: prompt }] }],\n    });\n    let htmlContent = response.text || \"\";\n    // limpar poss√≠veis wrappers\n    if (htmlContent.startsWith(\"```html\")) htmlContent = htmlContent.slice(7);\n    if (htmlContent.endsWith(\"```\")) htmlContent = htmlContent.slice(0, -3);\n\n    console.log(\"‚úÖ [formatArticleToHtml] HTML gerado com sucesso. Tamanho:\", htmlContent.length);\n    return htmlContent.trim();\n  } catch (error) {\n    console.error(\"‚ùå [formatArticleToHtml] Erro ao gerar HTML:\", error);\n    throw new Error(\"Falha ao formatar o artigo para HTML.\");\n  }\n};\n\n// ====================================================================\n// üîç 3. Extra√ß√£o de metadados SEO\n// ====================================================================\nexport const analyzeSeoAndExtractMetadata = async (\n  articleText: string,\n  focusKeywords: string\n): Promise<{ keywords: string[]; metaDescription: string }> => {\n  console.log(\"üîç [analyzeSeoAndExtractMetadata] Iniciando an√°lise SEO‚Ä¶\");\n\n  const settings = await loadAgentSettings();\n  const prompt = settings.seo_instructions + `\n\nArtigo:\n${articleText}\n\nPalavras-chave foco: ${focusKeywords}\n\nRetorne um JSON com:\n{\n  \"keywords\": [...],\n  \"metaDescription\": \"...\"\n}\n`;\n\n  console.log(\"[analyzeSeoAndExtractMetadata] Instru√ß√µes utilizadas:\", settings.seo_instructions);\n\n  try {\n    const response = await ai.models.generateContent({\n      model: settings.ai_model,\n      contents: [{ parts: [{ text: prompt }] }],\n      config: {\n        responseMimeType: \"application/json\",\n        responseSchema: {\n          type: Type.OBJECT,\n          properties: {\n            keywords: { type: Type.ARRAY, items: { type: Type.STRING } },\n            metaDescription: { type: Type.STRING },\n          },\n        },\n      },\n    });\n\n    const result = JSON.parse(response.text);\n    console.log(\"‚úÖ [analyzeSeoAndExtractMetadata] SEO extra√≠do:\", result);\n    return {\n      keywords: result.keywords || [],\n      metaDescription: result.metaDescription || \"\",\n    };\n  } catch (error) {\n    console.error(\"‚ùå [analyzeSeoAndExtractMetadata] Erro SEO:\", error);\n    return { keywords: [], metaDescription: \"N√£o foi poss√≠vel gerar a meta descri√ß√£o.\" };\n  }\n};\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 339, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Windows/Documents/AIGP/aigp/services/db.ts"],"sourcesContent":["import { neon, neonConfig } from \"@neondatabase/serverless\";\nimport { ArtigoNoticia } from \"../types\";\n\n// üîß Melhora performance e cache de conex√£o no ambiente serverless\nneonConfig.fetchConnectionCache = true;\n\nif (!process.env.POSTGRES_URL) {\n  throw new Error(\"Vari√°vel de ambiente POSTGRES_URL n√£o definida.\");\n}\n\nconst sql = neon(process.env.POSTGRES_URL);\n\n/* =========================================================\n   üîπ Fun√ß√£o auxiliar para mapear o resultado\n   ========================================================= */\nconst mapRowToArticle = (row: any): ArtigoNoticia => ({\n  id: String(row.id),\n  generationDate: row.generation_date,\n  title: row.title,\n  rawContent: row.raw_content,\n  formattedContent: row.formatted_content || \"\",\n  published: row.published,\n  keywords: Array.isArray(row.keywords)\n    ? row.keywords\n    : typeof row.keywords === \"string\"\n    ? row.keywords.split(\",\").map((k: string) => k.trim())\n    : [],\n  metaDescription: row.meta_description || \"\",\n});\n\n/* =========================================================\n   üèóÔ∏è Cria√ß√£o da tabela\n   ========================================================= */\nexport async function setupDatabase() {\n  try {\n    await sql`\n      CREATE TABLE IF NOT EXISTS articles (\n        id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n        generation_date TIMESTAMPTZ NOT NULL,\n        title TEXT NOT NULL,\n        raw_content TEXT NOT NULL,\n        formatted_content TEXT,\n        published BOOLEAN NOT NULL DEFAULT false,\n        keywords TEXT[],\n        meta_description TEXT\n      );\n    `;\n    console.log(\"‚úÖ Tabela 'articles' verificada/criada com sucesso.\");\n  } catch (error) {\n    console.error(\"‚ùå Falha na configura√ß√£o do banco de dados:\", error);\n    throw new Error(\"Falha ao configurar a tabela do banco de dados.\");\n  }\n}\n\n/* =========================================================\n   üíæ Inserir artigo completo\n   ========================================================= */\nexport async function saveArticle(article: Omit<ArtigoNoticia, \"id\">): Promise<ArtigoNoticia> {\n  try {\n    const result = await sql`\n      INSERT INTO articles (\n        generation_date, title, raw_content, formatted_content, published, keywords, meta_description\n      )\n      VALUES (\n        ${article.generationDate},\n        ${article.title},\n        ${article.rawContent},\n        ${article.formattedContent || \"\"},\n        ${article.published ?? false},\n        ${Array.isArray(article.keywords) ? article.keywords : [article.keywords]},\n        ${article.metaDescription || \"\"}\n      )\n      RETURNING *;\n    `;\n\n    const row = Array.isArray(result) ? result[0] : (result as any);\n    console.log(`üíæ Artigo salvo com sucesso (ID: ${row.id})`);\n    return mapRowToArticle(row);\n  } catch (error) {\n    console.error(\"‚ùå Erro ao salvar artigo:\", error);\n    throw new Error(\"Falha ao salvar o artigo.\");\n  }\n}\n\n/* =========================================================\n   ‚úèÔ∏è Salvar rascunho inicial (pr√©-formata√ß√£o)\n   ========================================================= */\nexport async function saveArticleDraft(data: {\n  title: string;\n  content: string;\n  language: string;\n}): Promise<{ id: string }> {\n  try {\n    const result = await sql`\n      INSERT INTO articles (generation_date, title, raw_content, formatted_content, published)\n      VALUES (NOW(), ${data.title}, ${data.content}, '', false)\n      RETURNING id;\n    `;\n\n    const row = Array.isArray(result) ? result[0] : (result as any);\n    console.log(`üìù Rascunho salvo com ID: ${row.id}`);\n    return { id: String(row.id) };\n  } catch (error) {\n    console.error(\"‚ùå Erro ao salvar rascunho:\", error);\n    throw new Error(\"Falha ao salvar o rascunho do artigo.\");\n  }\n}\n\n/* =========================================================\n   üîç Buscar artigo por ID\n   ========================================================= */\nexport async function getArticleById(id: string | number) {\n  try {\n    const result = await sql`SELECT * FROM articles WHERE id = ${id} LIMIT 1;`;\n    const row = Array.isArray(result) ? result[0] : (result as any);\n    if (!row) return null;\n\n    console.log(\"## retorno do select\");\n    console.log(row);\n    return mapRowToArticle(row);\n  } catch (error) {\n    console.error(\"‚ùå Erro ao buscar artigo:\", error);\n    throw new Error(\"Falha ao buscar o artigo por ID.\");\n  }\n}\n\n/* =========================================================\n   ü™Ñ Atualizar artigo gen√©rico\n   ========================================================= */\nexport async function updateArticle(id: string, data: Partial<ArtigoNoticia>): Promise<void> {\n  try {\n    const keys = Object.keys(data);\n    if (keys.length === 0) return;\n\n    // Monta os campos dinamicamente\n    const setClause = keys\n      .map((key, i) => `${key.replace(/([A-Z])/g, \"_$1\").toLowerCase()} = $${i + 1}`)\n      .join(\", \");\n    const values = Object.values(data);\n\n    const query = `\n      UPDATE articles\n      SET ${setClause}\n      WHERE id = $${keys.length + 1};\n    `;\n\n    await sql(query, [...values, id]);\n    console.log(`üìù Artigo ${id} atualizado (${keys.join(\", \")})`);\n  } catch (error) {\n    console.error(\"‚ùå Erro ao atualizar artigo:\", error);\n    throw new Error(\"Falha ao atualizar o artigo.\");\n  }\n}\n\n/* =========================================================\n   üß± Atualizar apenas o HTML\n   ========================================================= */\nexport async function updateArticleHtml(id: string | number, html: string) {\n  try {\n    const result = await sql`\n      UPDATE articles\n      SET formatted_content = ${html}\n      WHERE id = ${id}\n      RETURNING id, title, formatted_content;\n    `;\n\n    // Normaliza para garantir compatibilidade\n    const row = Array.isArray(result) ? result[0] : (result as any);\n    if (!row) throw new Error(`Nenhum artigo retornado ap√≥s o update (ID ${id}).`);\n\n    console.log(`‚úÖ HTML atualizado com sucesso para o artigo ID ${id}.`);\n    return {\n      id: String(row.id),\n      title: row.title,\n      formattedContent: row.formatted_content,\n    };\n  } catch (error) {\n    console.error(\"‚ùå Erro ao atualizar o artigo:\", error);\n    throw new Error(\"Falha ao atualizar o artigo.\");\n  }\n}\n\n/* =========================================================\n   üìã Buscar todos os artigos\n   ========================================================= */\nexport async function getArticles(): Promise<ArtigoNoticia[]> {\n  try {\n    const result = await sql`SELECT * FROM articles ORDER BY generation_date DESC;`;\n    const rows = Array.isArray(result) ? result : (result ? [result] : []);\n    return rows.map(mapRowToArticle);\n  } catch (error) {\n    console.error(\"‚ùå Erro ao buscar artigos:\", error);\n    throw new Error(\"Falha ao buscar os artigos.\");\n  }\n}\n\n/* =========================================================\n   üóëÔ∏è Excluir artigo\n   ========================================================= */\nexport async function deleteArticle(id: string): Promise<void> {\n  try {\n    await sql`DELETE FROM articles WHERE id = ${id};`;\n    console.log(`üóëÔ∏è Artigo ${id} removido com sucesso.`);\n  } catch (error) {\n    console.error(\"‚ùå Erro ao excluir artigo:\", error);\n    throw new Error(\"Falha ao excluir o artigo.\");\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAAA;;AAGA,mEAAmE;AACnE,oKAAU,CAAC,oBAAoB,GAAG;AAElC,IAAI,CAAC,QAAQ,GAAG,CAAC,YAAY,EAAE;IAC7B,MAAM,IAAI,MAAM;AAClB;AAEA,MAAM,MAAM,IAAA,8JAAI,EAAC,QAAQ,GAAG,CAAC,YAAY;AAEzC;;6DAE6D,GAC7D,MAAM,kBAAkB,CAAC,MAA4B,CAAC;QACpD,IAAI,OAAO,IAAI,EAAE;QACjB,gBAAgB,IAAI,eAAe;QACnC,OAAO,IAAI,KAAK;QAChB,YAAY,IAAI,WAAW;QAC3B,kBAAkB,IAAI,iBAAiB,IAAI;QAC3C,WAAW,IAAI,SAAS;QACxB,UAAU,MAAM,OAAO,CAAC,IAAI,QAAQ,IAChC,IAAI,QAAQ,GACZ,OAAO,IAAI,QAAQ,KAAK,WACxB,IAAI,QAAQ,CAAC,KAAK,CAAC,KAAK,GAAG,CAAC,CAAC,IAAc,EAAE,IAAI,MACjD,EAAE;QACN,iBAAiB,IAAI,gBAAgB,IAAI;IAC3C,CAAC;AAKM,eAAe;IACpB,IAAI;QACF,MAAM,GAAG,CAAC;;;;;;;;;;;IAWV,CAAC;QACD,QAAQ,GAAG,CAAC;IACd,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8CAA8C;QAC5D,MAAM,IAAI,MAAM;IAClB;AACF;AAKO,eAAe,YAAY,OAAkC;IAClE,IAAI;QACF,MAAM,SAAS,MAAM,GAAG,CAAC;;;;;QAKrB,EAAE,QAAQ,cAAc,CAAC;QACzB,EAAE,QAAQ,KAAK,CAAC;QAChB,EAAE,QAAQ,UAAU,CAAC;QACrB,EAAE,QAAQ,gBAAgB,IAAI,GAAG;QACjC,EAAE,QAAQ,SAAS,IAAI,MAAM;QAC7B,EAAE,MAAM,OAAO,CAAC,QAAQ,QAAQ,IAAI,QAAQ,QAAQ,GAAG;YAAC,QAAQ,QAAQ;SAAC,CAAC;QAC1E,EAAE,QAAQ,eAAe,IAAI,GAAG;;;IAGpC,CAAC;QAED,MAAM,MAAM,MAAM,OAAO,CAAC,UAAU,MAAM,CAAC,EAAE,GAAI;QACjD,QAAQ,GAAG,CAAC,CAAC,iCAAiC,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;QACzD,OAAO,gBAAgB;IACzB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,MAAM,IAAI,MAAM;IAClB;AACF;AAKO,eAAe,iBAAiB,IAItC;IACC,IAAI;QACF,MAAM,SAAS,MAAM,GAAG,CAAC;;qBAER,EAAE,KAAK,KAAK,CAAC,EAAE,EAAE,KAAK,OAAO,CAAC;;IAE/C,CAAC;QAED,MAAM,MAAM,MAAM,OAAO,CAAC,UAAU,MAAM,CAAC,EAAE,GAAI;QACjD,QAAQ,GAAG,CAAC,CAAC,0BAA0B,EAAE,IAAI,EAAE,EAAE;QACjD,OAAO;YAAE,IAAI,OAAO,IAAI,EAAE;QAAE;IAC9B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,MAAM,IAAI,MAAM;IAClB;AACF;AAKO,eAAe,eAAe,EAAmB;IACtD,IAAI;QACF,MAAM,SAAS,MAAM,GAAG,CAAC,kCAAkC,EAAE,GAAG,SAAS,CAAC;QAC1E,MAAM,MAAM,MAAM,OAAO,CAAC,UAAU,MAAM,CAAC,EAAE,GAAI;QACjD,IAAI,CAAC,KAAK,OAAO;QAEjB,QAAQ,GAAG,CAAC;QACZ,QAAQ,GAAG,CAAC;QACZ,OAAO,gBAAgB;IACzB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,MAAM,IAAI,MAAM;IAClB;AACF;AAKO,eAAe,cAAc,EAAU,EAAE,IAA4B;IAC1E,IAAI;QACF,MAAM,OAAO,OAAO,IAAI,CAAC;QACzB,IAAI,KAAK,MAAM,KAAK,GAAG;QAEvB,gCAAgC;QAChC,MAAM,YAAY,KACf,GAAG,CAAC,CAAC,KAAK,IAAM,GAAG,IAAI,OAAO,CAAC,YAAY,OAAO,WAAW,GAAG,IAAI,EAAE,IAAI,GAAG,EAC7E,IAAI,CAAC;QACR,MAAM,SAAS,OAAO,MAAM,CAAC;QAE7B,MAAM,QAAQ,CAAC;;UAET,EAAE,UAAU;kBACJ,EAAE,KAAK,MAAM,GAAG,EAAE;IAChC,CAAC;QAED,MAAM,IAAI,OAAO;eAAI;YAAQ;SAAG;QAChC,QAAQ,GAAG,CAAC,CAAC,UAAU,EAAE,GAAG,aAAa,EAAE,KAAK,IAAI,CAAC,MAAM,CAAC,CAAC;IAC/D,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,MAAM,IAAI,MAAM;IAClB;AACF;AAKO,eAAe,kBAAkB,EAAmB,EAAE,IAAY;IACvE,IAAI;QACF,MAAM,SAAS,MAAM,GAAG,CAAC;;8BAEC,EAAE,KAAK;iBACpB,EAAE,GAAG;;IAElB,CAAC;QAED,0CAA0C;QAC1C,MAAM,MAAM,MAAM,OAAO,CAAC,UAAU,MAAM,CAAC,EAAE,GAAI;QACjD,IAAI,CAAC,KAAK,MAAM,IAAI,MAAM,CAAC,0CAA0C,EAAE,GAAG,EAAE,CAAC;QAE7E,QAAQ,GAAG,CAAC,CAAC,+CAA+C,EAAE,GAAG,CAAC,CAAC;QACnE,OAAO;YACL,IAAI,OAAO,IAAI,EAAE;YACjB,OAAO,IAAI,KAAK;YAChB,kBAAkB,IAAI,iBAAiB;QACzC;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,MAAM,IAAI,MAAM;IAClB;AACF;AAKO,eAAe;IACpB,IAAI;QACF,MAAM,SAAS,MAAM,GAAG,CAAC,qDAAqD,CAAC;QAC/E,MAAM,OAAO,MAAM,OAAO,CAAC,UAAU,SAAU,SAAS;YAAC;SAAO,GAAG,EAAE;QACrE,OAAO,KAAK,GAAG,CAAC;IAClB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,MAAM,IAAI,MAAM;IAClB;AACF;AAKO,eAAe,cAAc,EAAU;IAC5C,IAAI;QACF,MAAM,GAAG,CAAC,gCAAgC,EAAE,GAAG,CAAC,CAAC;QACjD,QAAQ,GAAG,CAAC,CAAC,WAAW,EAAE,GAAG,sBAAsB,CAAC;IACtD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,MAAM,IAAI,MAAM;IAClB;AACF","debugId":null}},
    {"offset": {"line": 523, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Windows/Documents/AIGP/aigp/app/actions.ts"],"sourcesContent":["\"use server\";\n\nimport { revalidatePath } from \"next/cache\";\nimport * as geminiService from \"../services/geminiService\";\nimport * as dbService from \"../services/db\";\nimport { ArtigoNoticia } from \"../types\";\n\n/* =========================================================\n   üîπ MODO COMPLETO (para compatibilidade retroativa)\n   ========================================================= */\nexport async function generateAndSaveArticleAction(\n  topic: string,\n  language: string,\n  focusKeywords: string\n): Promise<ArtigoNoticia> {\n  try {\n    // üß† Etapa 1: IA Escritora\n    const rawContent = await geminiService.writeNewsArticle(topic, language, focusKeywords);\n\n    // üé® Etapa 2: IA Formatadora\n    const formattedContent = await geminiService.formatArticleToHtml(rawContent);\n\n    // üîç Etapa 3: IA de SEO\n    const { keywords, metaDescription } = await geminiService.analyzeSeoAndExtractMetadata(rawContent, focusKeywords);\n\n    // üíæ Etapa 4: Salvar tudo no banco\n    const articleToSave: Omit<ArtigoNoticia, \"id\"> = {\n      title: topic,\n      rawContent,\n      formattedContent,\n      generationDate: new Date().toISOString(),\n      published: false,\n      keywords,\n      metaDescription,\n    };\n\n    const savedArticle = await dbService.saveArticle(articleToSave);\n\n    // üîÅ Revalida hist√≥rico no dashboard\n    revalidatePath(\"/dashboard/history\");\n\n    return { ...savedArticle, published: true };\n  } catch (error) {\n    console.error(\"‚ùå Erro em generateAndSaveArticleAction:\", error);\n    throw new Error(`Falha ao gerar e salvar o artigo: ${error instanceof Error ? error.message : String(error)}`);\n  }\n}\n\n/* =========================================================\n   üîπ MODO MODULAR (para pipeline dividido)\n   ========================================================= */\n\n/** 1Ô∏è‚É£ Gera o texto base e salva como rascunho */\nexport async function saveArticleDraft(data: {\n  title: string;\n  content: string;\n  language: string;\n  focusKeywords: string;\n  status?: string;\n}) {\n  try {\n    const articleToSave: Omit<ArtigoNoticia, \"id\"> = {\n      title: data.title,\n      rawContent: data.content,\n      formattedContent: \"\",\n      generationDate: new Date().toISOString(),\n      published: false,\n      keywords: [\"\"],\n      metaDescription: \"\",\n    };\n\n    const saved = await dbService.saveArticle(articleToSave);\n    console.log(`‚úÖ Rascunho salvo com ID: ${saved.id}`);\n    revalidatePath(\"/dashboard/history\");\n    return saved;\n  } catch (error) {\n    console.error(\"‚ùå Erro ao salvar rascunho:\", error);\n    throw new Error(\"Falha ao salvar rascunho.\");\n  }\n}\n\n/** 2Ô∏è‚É£ Busca artigo pelo ID */\nexport async function getArticleById(id: string): Promise<ArtigoNoticia | null> {\n  try {\n    const article = await dbService.getArticleById(id);\n    return article;\n  } catch (error) {\n    console.error(\"‚ùå Erro ao buscar artigo:\", error);\n    return null;\n  }\n}\n\n/** 3Ô∏è‚É£ Atualiza HTML formatado */\nexport async function updateArticleHtml(id: string, formattedContent: string) {\n  try {\n    await dbService.updateArticle(id, { formattedContent });\n    console.log(`üé® HTML atualizado com sucesso para o artigo ${id}`);\n    revalidatePath(\"/dashboard/history\");\n  } catch (error) {\n    console.error(\"‚ùå Erro ao atualizar HTML:\", error);\n    throw new Error(\"Falha ao atualizar o HTML do artigo.\");\n  }\n}\n\n/** 4Ô∏è‚É£ Atualiza dados de SEO e marca como publicado */\n\nexport async function updateArticleSeo(\n  id: string,\n  data: { keywords: string[] | string; metaDescription: string; status?: string }\n) {\n  try {\n    // üß† Garante que keywords sempre ser√° um array de strings\n    let keywords: string[];\n\n    if (Array.isArray(data.keywords)) {\n      keywords = data.keywords;\n    } else if (typeof data.keywords === \"string\") {\n      keywords = data.keywords.split(\",\").map((k) => k.trim());\n    } else {\n      keywords = [];\n    }\n\n    const metaDescription = data.metaDescription || \"\";\n\n    await dbService.updateArticle(id, {\n      keywords,\n      metaDescription,\n      published: true,\n      generationDate: new Date().toISOString(),\n    });\n\n    console.log(`üîç SEO atualizado e artigo ${id} publicado com sucesso.`);\n    revalidatePath(\"/dashboard/history\");\n  } catch (error: any) {\n    console.error(\"‚ùå Erro ao atualizar SEO:\", error);\n    throw new Error(\n      error?.message || \"Falha ao atualizar os dados de SEO do artigo.\"\n    );\n  }\n}\n\n\n\n/* =========================================================\n   üîπ LISTAGEM (inalterada)\n   ========================================================= */\nexport async function getArticlesAction(): Promise<ArtigoNoticia[]> {\n  try {\n    await dbService.setupDatabase(); // garante tabela\n    const articles = await dbService.getArticles();\n    return articles;\n  } catch (error) {\n    console.error(\"‚ùå Erro em getArticlesAction:\", error);\n    return [];\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 673, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Windows/Documents/AIGP/aigp/.next-internal/server/app/dashboard/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {generateAndSaveArticleAction as '706f4b7a5ed7f1fae5ee8764b8d255b14b6a91c300'} from 'ACTIONS_MODULE0'\nexport {getArticlesAction as '00121f9c30c5223351207fd8b448259ca46c676c50'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA","debugId":null}}]
}