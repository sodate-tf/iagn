{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Windows/Documents/AIGP/aigp/services/configService.ts"],"sourcesContent":["import { neon, neonConfig } from \"@neondatabase/serverless\";\r\n\r\nneonConfig.fetchConnectionCache = true;\r\n\r\nif (!process.env.POSTGRES_URL) {\r\n  throw new Error(\"‚ùå Vari√°vel de ambiente POSTGRES_URL n√£o definida.\");\r\n}\r\n\r\nconst sql = neon(process.env.POSTGRES_URL);\r\n\r\n/* =========================================================\r\n   üéõÔ∏è Interface do modelo de configura√ß√µes\r\n   ========================================================= */\r\nexport interface AiSettings {\r\n  id: string;\r\n  agent_name: string;\r\n  ai_model: string;\r\n  calendar_id: string | null;\r\n  focus_keywords: string | null;\r\n  remote_post_url: string | null;\r\n  remote_post_api_key: string | null;\r\n  json_format_template: string | null;\r\n\r\n  // üß† Instru√ß√µes espec√≠ficas de cada agente\r\n  writer_instructions: string | null;\r\n  formatter_instructions: string | null;\r\n  seo_instructions: string | null;\r\n\r\n  // üóÇÔ∏è Arquivos de conhecimento (armazenados como JSON)\r\n  writer_files: string | null;\r\n  formatter_files: string | null;\r\n  seo_files: string | null;\r\n\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\n/* =========================================================\r\n   üîç Buscar configura√ß√µes atuais\r\n   ========================================================= */\r\nexport async function getSettings(): Promise<AiSettings | null> {\r\n  try {\r\n    const result = await sql`\r\n      SELECT * FROM ai_settings\r\n      ORDER BY created_at ASC\r\n      LIMIT 1;\r\n    `;\r\n\r\n    if (!result || result.length === 0) {\r\n      console.warn(\"‚ö†Ô∏è Nenhuma configura√ß√£o encontrada na tabela ai_settings.\");\r\n      return null;\r\n    }\r\n\r\n    const row = result[0];\r\n    return {\r\n      ...row,\r\n      writer_files: row.writer_files ? JSON.stringify(row.writer_files) : \"[]\",\r\n      formatter_files: row.formatter_files ? JSON.stringify(row.formatter_files) : \"[]\",\r\n      seo_files: row.seo_files ? JSON.stringify(row.seo_files) : \"[]\",\r\n    } as AiSettings;\r\n  } catch (error) {\r\n    console.error(\"‚ùå Erro ao buscar configura√ß√µes:\", error);\r\n    throw new Error(\"Falha ao buscar configura√ß√µes da IA.\");\r\n  }\r\n}\r\n\r\n/* =========================================================\r\n   ‚úèÔ∏è Atualizar configura√ß√µes\r\n   ========================================================= */\r\nexport async function updateSettings(data: Partial<AiSettings>): Promise<void> {\r\n  try {\r\n    const result = await sql`SELECT id FROM ai_settings LIMIT 1;`;\r\n    if (!result || result.length === 0)\r\n      throw new Error(\"Nenhuma configura√ß√£o encontrada para atualizar.\");\r\n\r\n    const { id } = result[0];\r\n\r\n    // üîπ Remove campos imut√°veis\r\n    const sanitizedData = { ...data };\r\n    delete (sanitizedData as any).updated_at;\r\n    delete (sanitizedData as any).created_at;\r\n    delete (sanitizedData as any).id;\r\n\r\n    const keys = Object.keys(sanitizedData);\r\n    if (keys.length === 0) return;\r\n\r\n    const setClause = keys.map((key, i) => `${key} = $${i + 1}`).join(\", \");\r\n    const values = Object.values(sanitizedData);\r\n\r\n    const query = `\r\n      UPDATE ai_settings\r\n      SET ${setClause}, updated_at = NOW()\r\n      WHERE id = $${keys.length + 1};\r\n    `;\r\n\r\n    await sql(query, [...values, id]);\r\n    console.log(`üß† Configura√ß√µes atualizadas: ${keys.join(\", \")}`);\r\n  } catch (error) {\r\n    console.error(\"‚ùå Erro ao atualizar configura√ß√µes:\", error);\r\n    throw new Error(\"Falha ao atualizar as configura√ß√µes.\");\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,sKAAU,CAAC,oBAAoB,GAAG;AAElC,IAAI,CAAC,QAAQ,GAAG,CAAC,YAAY,EAAE;IAC7B,MAAM,IAAI,MAAM;AAClB;AAEA,MAAM,MAAM,IAAA,gKAAI,EAAC,QAAQ,GAAG,CAAC,YAAY;AAgClC,eAAe;IACpB,IAAI;QACF,MAAM,SAAS,MAAM,GAAG,CAAC;;;;IAIzB,CAAC;QAED,IAAI,CAAC,UAAU,OAAO,MAAM,KAAK,GAAG;YAClC,QAAQ,IAAI,CAAC;YACb,OAAO;QACT;QAEA,MAAM,MAAM,MAAM,CAAC,EAAE;QACrB,OAAO;YACL,GAAG,GAAG;YACN,cAAc,IAAI,YAAY,GAAG,KAAK,SAAS,CAAC,IAAI,YAAY,IAAI;YACpE,iBAAiB,IAAI,eAAe,GAAG,KAAK,SAAS,CAAC,IAAI,eAAe,IAAI;YAC7E,WAAW,IAAI,SAAS,GAAG,KAAK,SAAS,CAAC,IAAI,SAAS,IAAI;QAC7D;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mCAAmC;QACjD,MAAM,IAAI,MAAM;IAClB;AACF;AAKO,eAAe,eAAe,IAAyB;IAC5D,IAAI;QACF,MAAM,SAAS,MAAM,GAAG,CAAC,mCAAmC,CAAC;QAC7D,IAAI,CAAC,UAAU,OAAO,MAAM,KAAK,GAC/B,MAAM,IAAI,MAAM;QAElB,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM,CAAC,EAAE;QAExB,6BAA6B;QAC7B,MAAM,gBAAgB;YAAE,GAAG,IAAI;QAAC;QAChC,OAAO,AAAC,cAAsB,UAAU;QACxC,OAAO,AAAC,cAAsB,UAAU;QACxC,OAAO,AAAC,cAAsB,EAAE;QAEhC,MAAM,OAAO,OAAO,IAAI,CAAC;QACzB,IAAI,KAAK,MAAM,KAAK,GAAG;QAEvB,MAAM,YAAY,KAAK,GAAG,CAAC,CAAC,KAAK,IAAM,GAAG,IAAI,IAAI,EAAE,IAAI,GAAG,EAAE,IAAI,CAAC;QAClE,MAAM,SAAS,OAAO,MAAM,CAAC;QAE7B,MAAM,QAAQ,CAAC;;UAET,EAAE,UAAU;kBACJ,EAAE,KAAK,MAAM,GAAG,EAAE;IAChC,CAAC;QAED,MAAM,IAAI,OAAO;eAAI;YAAQ;SAAG;QAChC,QAAQ,GAAG,CAAC,CAAC,8BAA8B,EAAE,KAAK,IAAI,CAAC,OAAO;IAChE,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,sCAAsC;QACpD,MAAM,IAAI,MAAM;IAClB;AACF","debugId":null}},
    {"offset": {"line": 117, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Windows/Documents/AIGP/aigp/app/api/settings/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\nimport { getSettings, updateSettings } from \"@/services/configService\";\r\n\r\n/* =========================================================\r\n   üß© Verifica conex√£o antes de processar\r\n   ========================================================= */\r\nfunction ensureDatabaseConnection() {\r\n  if (!process.env.POSTGRES_URL) {\r\n    console.error(\"‚ùå ERRO: Vari√°vel POSTGRES_URL n√£o definida.\");\r\n    throw new Error(\r\n      \"Banco de dados n√£o configurado. Defina POSTGRES_URL no arquivo .env.local\"\r\n    );\r\n  }\r\n}\r\n\r\n/* =========================================================\r\n   ‚úÖ GET ‚Äî Busca configura√ß√µes\r\n   ========================================================= */\r\nexport async function GET() {\r\n  try {\r\n    ensureDatabaseConnection();\r\n    const data = await getSettings();\r\n\r\n    if (!data) {\r\n      console.warn(\"‚ö†Ô∏è Nenhuma configura√ß√£o encontrada na tabela ai_settings.\");\r\n      return NextResponse.json(\r\n        { error: \"Nenhuma configura√ß√£o encontrada\" },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    return NextResponse.json(data);\r\n  } catch (error: any) {\r\n    console.error(\"‚ùå [API:GET /settings] Erro:\", error);\r\n    return NextResponse.json(\r\n      { error: error.message || \"Falha ao buscar configura√ß√µes\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n/* =========================================================\r\n   ‚úÖ PUT ‚Äî Atualiza configura√ß√µes\r\n   ========================================================= */\r\nexport async function PUT(req: NextRequest) {\r\n  try {\r\n    ensureDatabaseConnection();\r\n    const body = await req.json();\r\n\r\n    if (!body || Object.keys(body).length === 0) {\r\n      return NextResponse.json(\r\n        { error: \"Corpo da requisi√ß√£o vazio ou inv√°lido.\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    await updateSettings(body);\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      message: \"Configura√ß√µes atualizadas com sucesso.\",\r\n    });\r\n  } catch (error: any) {\r\n    console.error(\"‚ùå [API:PUT /settings] Erro:\", error);\r\n    return NextResponse.json(\r\n      { error: error.message || \"Falha ao atualizar configura√ß√µes\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEA;;6DAE6D,GAC7D,SAAS;IACP,IAAI,CAAC,QAAQ,GAAG,CAAC,YAAY,EAAE;QAC7B,QAAQ,KAAK,CAAC;QACd,MAAM,IAAI,MACR;IAEJ;AACF;AAKO,eAAe;IACpB,IAAI;QACF;QACA,MAAM,OAAO,MAAM,IAAA,0IAAW;QAE9B,IAAI,CAAC,MAAM;YACT,QAAQ,IAAI,CAAC;YACb,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAkC,GAC3C;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO,MAAM,OAAO,IAAI;QAAgC,GAC1D;YAAE,QAAQ;QAAI;IAElB;AACF;AAKO,eAAe,IAAI,GAAgB;IACxC,IAAI;QACF;QACA,MAAM,OAAO,MAAM,IAAI,IAAI;QAE3B,IAAI,CAAC,QAAQ,OAAO,IAAI,CAAC,MAAM,MAAM,KAAK,GAAG;YAC3C,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAyC,GAClD;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,IAAA,6IAAc,EAAC;QAErB,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,SAAS;QACX;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO,MAAM,OAAO,IAAI;QAAmC,GAC7D;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}