module.exports=[74836,(e,t,n)=>{"use strict";let i=["nodebuffer","arraybuffer","fragments"],r="undefined"!=typeof Blob;r&&i.push("blob"),t.exports={BINARY_TYPES:i,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:r,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}},97970,(e,t,n)=>{"use strict";let{EMPTY_BUFFER:i}=e.r(74836),r=Buffer[Symbol.species];function o(e,t,n,i,r){for(let o=0;o<r;o++)n[i+o]=e[o]^t[3&o]}function l(e,t){for(let n=0;n<e.length;n++)e[n]^=t[3&n]}function s(e){let t;return(s.readOnly=!0,Buffer.isBuffer(e))?e:(e instanceof ArrayBuffer?t=new r(e):ArrayBuffer.isView(e)?t=new r(e.buffer,e.byteOffset,e.byteLength):(t=Buffer.from(e),s.readOnly=!1),t)}if(t.exports={concat:function(e,t){if(0===e.length)return i;if(1===e.length)return e[0];let n=Buffer.allocUnsafe(t),o=0;for(let t=0;t<e.length;t++){let i=e[t];n.set(i,o),o+=i.length}return o<t?new r(n.buffer,n.byteOffset,o):n},mask:o,toArrayBuffer:function(e){return e.length===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.length)},toBuffer:s,unmask:l},!process.env.WS_NO_BUFFER_UTIL)try{let e=(()=>{let e=Error("Cannot find module 'bufferutil'");throw e.code="MODULE_NOT_FOUND",e})();t.exports.mask=function(t,n,i,r,l){l<48?o(t,n,i,r,l):e.mask(t,n,i,r,l)},t.exports.unmask=function(t,n){t.length<32?l(t,n):e.unmask(t,n)}}catch(e){}},62048,(e,t,n)=>{"use strict";let i=Symbol("kDone"),r=Symbol("kRun");t.exports=class{constructor(e){this[i]=()=>{this.pending--,this[r]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[r]()}[r](){if(this.pending!==this.concurrency&&this.jobs.length){let e=this.jobs.shift();this.pending++,e(this[i])}}}},80295,(e,t,n)=>{"use strict";let i,r=e.r(6461),o=e.r(97970),l=e.r(62048),{kStatusCode:s}=e.r(74836),a=Buffer[Symbol.species],u=Buffer.from([0,0,255,255]),p=Symbol("permessage-deflate"),d=Symbol("total-length"),c=Symbol("callback"),h=Symbol("buffers"),f=Symbol("error");function m(e){this[h].push(e),this[d]+=e.length}function g(e){(this[d]+=e.length,this[p]._maxPayload<1||this[d]<=this[p]._maxPayload)?this[h].push(e):(this[f]=RangeError("Max payload size exceeded"),this[f].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[f][s]=1009,this.removeListener("data",g),this.reset())}function y(e){(this[p]._inflate=null,this[f])?this[c](this[f]):(e[s]=1007,this[c](e))}t.exports=class{constructor(e,t,n){this._maxPayload=0|n,this._options=e||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,i||(i=new l(void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10))}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let e=this._deflate[c];this._deflate.close(),this._deflate=null,e&&e(Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){let t=this._options,n=e.find(e=>(!1!==t.serverNoContextTakeover||!e.server_no_context_takeover)&&(!e.server_max_window_bits||!1!==t.serverMaxWindowBits&&("number"!=typeof t.serverMaxWindowBits||!(t.serverMaxWindowBits>e.server_max_window_bits)))&&("number"!=typeof t.clientMaxWindowBits||!!e.client_max_window_bits));if(!n)throw Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(n.server_no_context_takeover=!0),t.clientNoContextTakeover&&(n.client_no_context_takeover=!0),"number"==typeof t.serverMaxWindowBits&&(n.server_max_window_bits=t.serverMaxWindowBits),"number"==typeof t.clientMaxWindowBits?n.client_max_window_bits=t.clientMaxWindowBits:(!0===n.client_max_window_bits||!1===t.clientMaxWindowBits)&&delete n.client_max_window_bits,n}acceptAsClient(e){let t=e[0];if(!1===this._options.clientNoContextTakeover&&t.client_no_context_takeover)throw Error('Unexpected parameter "client_no_context_takeover"');if(t.client_max_window_bits){if(!1===this._options.clientMaxWindowBits||"number"==typeof this._options.clientMaxWindowBits&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw Error('Unexpected or invalid parameter "client_max_window_bits"')}else"number"==typeof this._options.clientMaxWindowBits&&(t.client_max_window_bits=this._options.clientMaxWindowBits);return t}normalizeParams(e){return e.forEach(e=>{Object.keys(e).forEach(t=>{let n=e[t];if(n.length>1)throw Error(`Parameter "${t}" must have only a single value`);if(n=n[0],"client_max_window_bits"===t){if(!0!==n){let e=+n;if(!Number.isInteger(e)||e<8||e>15)throw TypeError(`Invalid value for parameter "${t}": ${n}`);n=e}else if(!this._isServer)throw TypeError(`Invalid value for parameter "${t}": ${n}`)}else if("server_max_window_bits"===t){let e=+n;if(!Number.isInteger(e)||e<8||e>15)throw TypeError(`Invalid value for parameter "${t}": ${n}`);n=e}else if("client_no_context_takeover"===t||"server_no_context_takeover"===t){if(!0!==n)throw TypeError(`Invalid value for parameter "${t}": ${n}`)}else throw Error(`Unknown parameter "${t}"`);e[t]=n})}),e}decompress(e,t,n){i.add(i=>{this._decompress(e,t,(e,t)=>{i(),n(e,t)})})}compress(e,t,n){i.add(i=>{this._compress(e,t,(e,t)=>{i(),n(e,t)})})}_decompress(e,t,n){let i=this._isServer?"client":"server";if(!this._inflate){let e=`${i}_max_window_bits`,t="number"!=typeof this.params[e]?r.Z_DEFAULT_WINDOWBITS:this.params[e];this._inflate=r.createInflateRaw({...this._options.zlibInflateOptions,windowBits:t}),this._inflate[p]=this,this._inflate[d]=0,this._inflate[h]=[],this._inflate.on("error",y),this._inflate.on("data",g)}this._inflate[c]=n,this._inflate.write(e),t&&this._inflate.write(u),this._inflate.flush(()=>{let e=this._inflate[f];if(e){this._inflate.close(),this._inflate=null,n(e);return}let r=o.concat(this._inflate[h],this._inflate[d]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[d]=0,this._inflate[h]=[],t&&this.params[`${i}_no_context_takeover`]&&this._inflate.reset()),n(null,r)})}_compress(e,t,n){let i=this._isServer?"server":"client";if(!this._deflate){let e=`${i}_max_window_bits`,t="number"!=typeof this.params[e]?r.Z_DEFAULT_WINDOWBITS:this.params[e];this._deflate=r.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:t}),this._deflate[d]=0,this._deflate[h]=[],this._deflate.on("data",m)}this._deflate[c]=n,this._deflate.write(e),this._deflate.flush(r.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let e=o.concat(this._deflate[h],this._deflate[d]);t&&(e=new a(e.buffer,e.byteOffset,e.length-4)),this._deflate[c]=null,this._deflate[d]=0,this._deflate[h]=[],t&&this.params[`${i}_no_context_takeover`]&&this._deflate.reset(),n(null,e)})}}},58739,(e,t,n)=>{"use strict";let{isUtf8:i}=e.r(874),{hasBlob:r}=e.r(74836);function o(e){let t=e.length,n=0;for(;n<t;)if((128&e[n])==0)n++;else if((224&e[n])==192){if(n+1===t||(192&e[n+1])!=128||(254&e[n])==192)return!1;n+=2}else if((240&e[n])==224){if(n+2>=t||(192&e[n+1])!=128||(192&e[n+2])!=128||224===e[n]&&(224&e[n+1])==128||237===e[n]&&(224&e[n+1])==160)return!1;n+=3}else{if((248&e[n])!=240||n+3>=t||(192&e[n+1])!=128||(192&e[n+2])!=128||(192&e[n+3])!=128||240===e[n]&&(240&e[n+1])==128||244===e[n]&&e[n+1]>143||e[n]>244)return!1;n+=4}return!0}if(t.exports={isBlob:function(e){return r&&"object"==typeof e&&"function"==typeof e.arrayBuffer&&"string"==typeof e.type&&"function"==typeof e.stream&&("Blob"===e[Symbol.toStringTag]||"File"===e[Symbol.toStringTag])},isValidStatusCode:function(e){return e>=1e3&&e<=1014&&1004!==e&&1005!==e&&1006!==e||e>=3e3&&e<=4999},isValidUTF8:o,tokenChars:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0]},i)t.exports.isValidUTF8=function(e){return e.length<24?o(e):i(e)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let e=(()=>{let e=Error("Cannot find module 'utf-8-validate'");throw e.code="MODULE_NOT_FOUND",e})();t.exports.isValidUTF8=function(t){return t.length<32?o(t):e(t)}}catch(e){}},29485,(e,t,n)=>{"use strict";let{Writable:i}=e.r(88947),r=e.r(80295),{BINARY_TYPES:o,EMPTY_BUFFER:l,kStatusCode:s,kWebSocket:a}=e.r(74836),{concat:u,toArrayBuffer:p,unmask:d}=e.r(97970),{isValidStatusCode:c,isValidUTF8:h}=e.r(58739),f=Buffer[Symbol.species];t.exports=class extends i{constructor(e={}){super(),this._allowSynchronousEvents=void 0===e.allowSynchronousEvents||e.allowSynchronousEvents,this._binaryType=e.binaryType||o[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=0|e.maxPayload,this._skipUTF8Validation=!!e.skipUTF8Validation,this[a]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=0}_write(e,t,n){if(8===this._opcode&&0==this._state)return n();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(n)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let t=this._buffers[0];return this._buffers[0]=new f(t.buffer,t.byteOffset+e,t.length-e),new f(t.buffer,t.byteOffset,e)}let t=Buffer.allocUnsafe(e);do{let n=this._buffers[0],i=t.length-e;e>=n.length?t.set(this._buffers.shift(),i):(t.set(new Uint8Array(n.buffer,n.byteOffset,e),i),this._buffers[0]=new f(n.buffer,n.byteOffset+e,n.length-e)),e-=n.length}while(e>0)return t}startLoop(e){this._loop=!0;do switch(this._state){case 0:this.getInfo(e);break;case 1:this.getPayloadLength16(e);break;case 2:this.getPayloadLength64(e);break;case 3:this.getMask();break;case 4:this.getData(e);break;case 5:case 6:this._loop=!1;return}while(this._loop)this._errored||e()}getInfo(e){if(this._bufferedBytes<2){this._loop=!1;return}let t=this.consume(2);if((48&t[0])!=0)return void e(this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3"));let n=(64&t[0])==64;if(n&&!this._extensions[r.extensionName])return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));if(this._fin=(128&t[0])==128,this._opcode=15&t[0],this._payloadLength=127&t[1],0===this._opcode){if(n)return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));if(!this._fragmented)return void e(this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE"));this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented)return void e(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"));this._compressed=n}else{if(!(this._opcode>7)||!(this._opcode<11))return void e(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"));if(!this._fin)return void e(this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN"));if(n)return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));if(this._payloadLength>125||8===this._opcode&&1===this._payloadLength)return void e(this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH"))}if(this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=(128&t[1])==128,this._isServer){if(!this._masked)return void e(this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK"))}else if(this._masked)return void e(this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK"));126===this._payloadLength?this._state=1:127===this._payloadLength?this._state=2:this.haveLength(e)}getPayloadLength16(e){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e)}getPayloadLength64(e){if(this._bufferedBytes<8){this._loop=!1;return}let t=this.consume(8),n=t.readUInt32BE(0);n>2097151?e(this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH")):(this._payloadLength=0x100000000*n+t.readUInt32BE(4),this.haveLength(e))}haveLength(e){this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)?e(this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH")):this._masked?this._state=3:this._state=4}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=4}getData(e){let t=l;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}t=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!=0&&d(t,this._mask)}if(this._opcode>7)return void this.controlMessage(t,e);if(this._compressed){this._state=5,this.decompress(t,e);return}t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage(e)}decompress(e,t){this._extensions[r.extensionName].decompress(e,this._fin,(e,n)=>{if(e)return t(e);if(n.length){if(this._messageLength+=n.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return void t(this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));this._fragments.push(n)}this.dataMessage(t),0===this._state&&this.startLoop(t)})}dataMessage(e){if(!this._fin){this._state=0;return}let t=this._messageLength,n=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){let i;i="nodebuffer"===this._binaryType?u(n,t):"arraybuffer"===this._binaryType?p(u(n,t)):"blob"===this._binaryType?new Blob(n):n,this._allowSynchronousEvents?(this.emit("message",i,!0),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",i,!0),this._state=0,this.startLoop(e)}))}else{let i=u(n,t);if(!this._skipUTF8Validation&&!h(i))return void e(this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8"));5===this._state||this._allowSynchronousEvents?(this.emit("message",i,!1),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",i,!1),this._state=0,this.startLoop(e)}))}}controlMessage(e,t){if(8===this._opcode){if(0===e.length)this._loop=!1,this.emit("conclude",1005,l),this.end();else{let n=e.readUInt16BE(0);if(!c(n))return void t(this.createError(RangeError,`invalid status code ${n}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE"));let i=new f(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!h(i))return void t(this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8"));this._loop=!1,this.emit("conclude",n,i),this.end()}this._state=0;return}this._allowSynchronousEvents?(this.emit(9===this._opcode?"ping":"pong",e),this._state=0):(this._state=6,setImmediate(()=>{this.emit(9===this._opcode?"ping":"pong",e),this._state=0,this.startLoop(t)}))}createError(e,t,n,i,r){this._loop=!1,this._errored=!0;let o=new e(n?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(o,this.createError),o.code=r,o[s]=i,o}}},16735,(e,t,n)=>{"use strict";let i,{Duplex:r}=e.r(88947),{randomFillSync:o}=e.r(54799),l=e.r(80295),{EMPTY_BUFFER:s,kWebSocket:a,NOOP:u}=e.r(74836),{isBlob:p,isValidStatusCode:d}=e.r(58739),{mask:c,toBuffer:h}=e.r(97970),f=Symbol("kByteLength"),m=Buffer.alloc(4),g=8192;class y{constructor(e,t,n){this._extensions=t||{},n&&(this._generateMask=n,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=0,this.onerror=u,this[a]=void 0}static frame(e,t){let n,r,l=!1,s=2,a=!1;t.mask&&(n=t.maskBuffer||m,t.generateMask?t.generateMask(n):(8192===g&&(void 0===i&&(i=Buffer.alloc(8192)),o(i,0,8192),g=0),n[0]=i[g++],n[1]=i[g++],n[2]=i[g++],n[3]=i[g++]),a=(n[0]|n[1]|n[2]|n[3])==0,s=6),"string"==typeof e?r=(!t.mask||a)&&void 0!==t[f]?t[f]:(e=Buffer.from(e)).length:(r=e.length,l=t.mask&&t.readOnly&&!a);let u=r;r>=65536?(s+=8,u=127):r>125&&(s+=2,u=126);let p=Buffer.allocUnsafe(l?r+s:s);return(p[0]=t.fin?128|t.opcode:t.opcode,t.rsv1&&(p[0]|=64),p[1]=u,126===u?p.writeUInt16BE(r,2):127===u&&(p[2]=p[3]=0,p.writeUIntBE(r,4,6)),t.mask)?(p[1]|=128,p[s-4]=n[0],p[s-3]=n[1],p[s-2]=n[2],p[s-1]=n[3],a)?[p,e]:l?(c(e,n,p,s,r),[p]):(c(e,n,e,0,r),[p,e]):[p,e]}close(e,t,n,i){let r;if(void 0===e)r=s;else if("number"==typeof e&&d(e))if(void 0!==t&&t.length){let n=Buffer.byteLength(t);if(n>123)throw RangeError("The message must not be greater than 123 bytes");(r=Buffer.allocUnsafe(2+n)).writeUInt16BE(e,0),"string"==typeof t?r.write(t,2):r.set(t,2)}else(r=Buffer.allocUnsafe(2)).writeUInt16BE(e,0);else throw TypeError("First argument must be a valid error code number");let o={[f]:r.length,fin:!0,generateMask:this._generateMask,mask:n,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};0!==this._state?this.enqueue([this.dispatch,r,!1,o,i]):this.sendFrame(y.frame(r,o),i)}ping(e,t,n){let i,r;if("string"==typeof e?(i=Buffer.byteLength(e),r=!1):p(e)?(i=e.size,r=!1):(i=(e=h(e)).length,r=h.readOnly),i>125)throw RangeError("The data size must not be greater than 125 bytes");let o={[f]:i,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:9,readOnly:r,rsv1:!1};p(e)?0!==this._state?this.enqueue([this.getBlobData,e,!1,o,n]):this.getBlobData(e,!1,o,n):0!==this._state?this.enqueue([this.dispatch,e,!1,o,n]):this.sendFrame(y.frame(e,o),n)}pong(e,t,n){let i,r;if("string"==typeof e?(i=Buffer.byteLength(e),r=!1):p(e)?(i=e.size,r=!1):(i=(e=h(e)).length,r=h.readOnly),i>125)throw RangeError("The data size must not be greater than 125 bytes");let o={[f]:i,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:10,readOnly:r,rsv1:!1};p(e)?0!==this._state?this.enqueue([this.getBlobData,e,!1,o,n]):this.getBlobData(e,!1,o,n):0!==this._state?this.enqueue([this.dispatch,e,!1,o,n]):this.sendFrame(y.frame(e,o),n)}send(e,t,n){let i,r,o=this._extensions[l.extensionName],s=t.binary?2:1,a=t.compress;"string"==typeof e?(i=Buffer.byteLength(e),r=!1):p(e)?(i=e.size,r=!1):(i=(e=h(e)).length,r=h.readOnly),this._firstFragment?(this._firstFragment=!1,a&&o&&o.params[o._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(a=i>=o._threshold),this._compress=a):(a=!1,s=0),t.fin&&(this._firstFragment=!0);let u={[f]:i,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:s,readOnly:r,rsv1:a};p(e)?0!==this._state?this.enqueue([this.getBlobData,e,this._compress,u,n]):this.getBlobData(e,this._compress,u,n):0!==this._state?this.enqueue([this.dispatch,e,this._compress,u,n]):this.dispatch(e,this._compress,u,n)}getBlobData(e,t,n,i){this._bufferedBytes+=n[f],this._state=2,e.arrayBuffer().then(e=>{if(this._socket.destroyed){let e=Error("The socket was closed while the blob was being read");process.nextTick(_,this,e,i);return}this._bufferedBytes-=n[f];let r=h(e);t?this.dispatch(r,t,n,i):(this._state=0,this.sendFrame(y.frame(r,n),i),this.dequeue())}).catch(e=>{process.nextTick(v,this,e,i)})}dispatch(e,t,n,i){if(!t)return void this.sendFrame(y.frame(e,n),i);let r=this._extensions[l.extensionName];this._bufferedBytes+=n[f],this._state=1,r.compress(e,n.fin,(e,t)=>{this._socket.destroyed?_(this,Error("The socket was closed while data was being compressed"),i):(this._bufferedBytes-=n[f],this._state=0,n.readOnly=!1,this.sendFrame(y.frame(t,n),i),this.dequeue())})}dequeue(){for(;0===this._state&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[3][f],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][f],this._queue.push(e)}sendFrame(e,t){2===e.length?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}}function _(e,t,n){"function"==typeof n&&n(t);for(let n=0;n<e._queue.length;n++){let i=e._queue[n],r=i[i.length-1];"function"==typeof r&&r(t)}}function v(e,t,n){_(e,t,n),e.onerror(t)}t.exports=y},70494,(e,t,n)=>{"use strict";let{kForOnEventAttribute:i,kListener:r}=e.r(74836),o=Symbol("kCode"),l=Symbol("kData"),s=Symbol("kError"),a=Symbol("kMessage"),u=Symbol("kReason"),p=Symbol("kTarget"),d=Symbol("kType"),c=Symbol("kWasClean");class h{constructor(e){this[p]=null,this[d]=e}get target(){return this[p]}get type(){return this[d]}}Object.defineProperty(h.prototype,"target",{enumerable:!0}),Object.defineProperty(h.prototype,"type",{enumerable:!0});class f extends h{constructor(e,t={}){super(e),this[o]=void 0===t.code?0:t.code,this[u]=void 0===t.reason?"":t.reason,this[c]=void 0!==t.wasClean&&t.wasClean}get code(){return this[o]}get reason(){return this[u]}get wasClean(){return this[c]}}Object.defineProperty(f.prototype,"code",{enumerable:!0}),Object.defineProperty(f.prototype,"reason",{enumerable:!0}),Object.defineProperty(f.prototype,"wasClean",{enumerable:!0});class m extends h{constructor(e,t={}){super(e),this[s]=void 0===t.error?null:t.error,this[a]=void 0===t.message?"":t.message}get error(){return this[s]}get message(){return this[a]}}Object.defineProperty(m.prototype,"error",{enumerable:!0}),Object.defineProperty(m.prototype,"message",{enumerable:!0});class g extends h{constructor(e,t={}){super(e),this[l]=void 0===t.data?null:t.data}get data(){return this[l]}}function y(e,t,n){"object"==typeof e&&e.handleEvent?e.handleEvent.call(e,n):e.call(t,n)}Object.defineProperty(g.prototype,"data",{enumerable:!0}),t.exports={CloseEvent:f,ErrorEvent:m,Event:h,EventTarget:{addEventListener(e,t,n={}){let o;for(let o of this.listeners(e))if(!n[i]&&o[r]===t&&!o[i])return;if("message"===e)o=function(e,n){let i=new g("message",{data:n?e:e.toString()});i[p]=this,y(t,this,i)};else if("close"===e)o=function(e,n){let i=new f("close",{code:e,reason:n.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});i[p]=this,y(t,this,i)};else if("error"===e)o=function(e){let n=new m("error",{error:e,message:e.message});n[p]=this,y(t,this,n)};else{if("open"!==e)return;o=function(){let e=new h("open");e[p]=this,y(t,this,e)}}o[i]=!!n[i],o[r]=t,n.once?this.once(e,o):this.on(e,o)},removeEventListener(e,t){for(let n of this.listeners(e))if(n[r]===t&&!n[i]){this.removeListener(e,n);break}}},MessageEvent:g}},96903,(e,t,n)=>{"use strict";let{tokenChars:i}=e.r(58739);function r(e,t,n){void 0===e[t]?e[t]=[n]:e[t].push(n)}t.exports={format:function(e){return Object.keys(e).map(t=>{let n=e[t];return Array.isArray(n)||(n=[n]),n.map(e=>[t].concat(Object.keys(e).map(t=>{let n=e[t];return Array.isArray(n)||(n=[n]),n.map(e=>!0===e?t:`${t}=${e}`).join("; ")})).join("; ")).join(", ")}).join(", ")},parse:function(e){let t,n,o=Object.create(null),l=Object.create(null),s=!1,a=!1,u=!1,p=-1,d=-1,c=-1,h=0;for(;h<e.length;h++)if(d=e.charCodeAt(h),void 0===t)if(-1===c&&1===i[d])-1===p&&(p=h);else if(0!==h&&(32===d||9===d))-1===c&&-1!==p&&(c=h);else if(59===d||44===d){if(-1===p)throw SyntaxError(`Unexpected character at index ${h}`);-1===c&&(c=h);let n=e.slice(p,c);44===d?(r(o,n,l),l=Object.create(null)):t=n,p=c=-1}else throw SyntaxError(`Unexpected character at index ${h}`);else if(void 0===n)if(-1===c&&1===i[d])-1===p&&(p=h);else if(32===d||9===d)-1===c&&-1!==p&&(c=h);else if(59===d||44===d){if(-1===p)throw SyntaxError(`Unexpected character at index ${h}`);-1===c&&(c=h),r(l,e.slice(p,c),!0),44===d&&(r(o,t,l),l=Object.create(null),t=void 0),p=c=-1}else if(61===d&&-1!==p&&-1===c)n=e.slice(p,h),p=c=-1;else throw SyntaxError(`Unexpected character at index ${h}`);else if(a){if(1!==i[d])throw SyntaxError(`Unexpected character at index ${h}`);-1===p?p=h:s||(s=!0),a=!1}else if(u)if(1===i[d])-1===p&&(p=h);else if(34===d&&-1!==p)u=!1,c=h;else if(92===d)a=!0;else throw SyntaxError(`Unexpected character at index ${h}`);else if(34===d&&61===e.charCodeAt(h-1))u=!0;else if(-1===c&&1===i[d])-1===p&&(p=h);else if(-1!==p&&(32===d||9===d))-1===c&&(c=h);else if(59===d||44===d){if(-1===p)throw SyntaxError(`Unexpected character at index ${h}`);-1===c&&(c=h);let i=e.slice(p,c);s&&(i=i.replace(/\\/g,""),s=!1),r(l,n,i),44===d&&(r(o,t,l),l=Object.create(null),t=void 0),n=void 0,p=c=-1}else throw SyntaxError(`Unexpected character at index ${h}`);if(-1===p||u||32===d||9===d)throw SyntaxError("Unexpected end of input");-1===c&&(c=h);let f=e.slice(p,c);return void 0===t?r(o,f,l):(void 0===n?r(l,f,!0):s?r(l,n,f.replace(/\\/g,"")):r(l,n,f),r(o,t,l)),o}}},35065,(e,t,n)=>{"use strict";let i=e.r(27699),r=e.r(24836),o=e.r(21517),l=e.r(4446),s=e.r(55004),{randomBytes:a,createHash:u}=e.r(54799),{Duplex:p,Readable:d}=e.r(88947),{URL:c}=e.r(92509),h=e.r(80295),f=e.r(29485),m=e.r(16735),{isBlob:g}=e.r(58739),{BINARY_TYPES:y,EMPTY_BUFFER:_,GUID:v,kForOnEventAttribute:E,kListener:S,kStatusCode:T,kWebSocket:b,NOOP:O}=e.r(74836),{EventTarget:{addEventListener:C,removeEventListener:A}}=e.r(70494),{format:I,parse:x}=e.r(96903),{toBuffer:R}=e.r(97970),N=Symbol("kAborted"),P=[8,13],w=["CONNECTING","OPEN","CLOSING","CLOSED"],M=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;class k extends i{constructor(e,t,n){super(),this._binaryType=y[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=_,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=k.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,null!==e?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,void 0===t?t=[]:Array.isArray(t)||("object"==typeof t&&null!==t?(n=t,t=[]):t=[t]),function e(t,n,i,l){let s,p,d,f,m={allowSynchronousEvents:!0,autoPong:!0,protocolVersion:P[1],maxPayload:0x6400000,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...l,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(t._autoPong=m.autoPong,!P.includes(m.protocolVersion))throw RangeError(`Unsupported protocol version: ${m.protocolVersion} (supported versions: ${P.join(", ")})`);if(n instanceof c)s=n;else try{s=new c(n)}catch(e){throw SyntaxError(`Invalid URL: ${n}`)}"http:"===s.protocol?s.protocol="ws:":"https:"===s.protocol&&(s.protocol="wss:"),t._url=s.href;let g="wss:"===s.protocol,y="ws+unix:"===s.protocol;if("ws:"===s.protocol||g||y?y&&!s.pathname?p="The URL's pathname is empty":s.hash&&(p="The URL contains a fragment identifier"):p='The URL\'s protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"',p){let e=SyntaxError(p);if(0!==t._redirects)return void D(t,e);throw e}let _=g?443:80,E=a(16).toString("base64"),S=g?r.request:o.request,T=new Set;if(m.createConnection=m.createConnection||(g?L:U),m.defaultPort=m.defaultPort||_,m.port=s.port||_,m.host=s.hostname.startsWith("[")?s.hostname.slice(1,-1):s.hostname,m.headers={...m.headers,"Sec-WebSocket-Version":m.protocolVersion,"Sec-WebSocket-Key":E,Connection:"Upgrade",Upgrade:"websocket"},m.path=s.pathname+s.search,m.timeout=m.handshakeTimeout,m.perMessageDeflate&&(d=new h(!0!==m.perMessageDeflate?m.perMessageDeflate:{},!1,m.maxPayload),m.headers["Sec-WebSocket-Extensions"]=I({[h.extensionName]:d.offer()})),i.length){for(let e of i){if("string"!=typeof e||!M.test(e)||T.has(e))throw SyntaxError("An invalid or duplicated subprotocol was specified");T.add(e)}m.headers["Sec-WebSocket-Protocol"]=i.join(",")}if(m.origin&&(m.protocolVersion<13?m.headers["Sec-WebSocket-Origin"]=m.origin:m.headers.Origin=m.origin),(s.username||s.password)&&(m.auth=`${s.username}:${s.password}`),y){let e=m.path.split(":");m.socketPath=e[0],m.path=e[1]}if(m.followRedirects){if(0===t._redirects){t._originalIpc=y,t._originalSecure=g,t._originalHostOrSocketPath=y?m.socketPath:s.host;let e=l&&l.headers;if(l={...l,headers:{}},e)for(let[t,n]of Object.entries(e))l.headers[t.toLowerCase()]=n}else if(0===t.listenerCount("redirect")){let e=y?!!t._originalIpc&&m.socketPath===t._originalHostOrSocketPath:!t._originalIpc&&s.host===t._originalHostOrSocketPath;e&&(!t._originalSecure||g)||(delete m.headers.authorization,delete m.headers.cookie,e||delete m.headers.host,m.auth=void 0)}m.auth&&!l.headers.authorization&&(l.headers.authorization="Basic "+Buffer.from(m.auth).toString("base64")),f=t._req=S(m),t._redirects&&t.emit("redirect",t.url,f)}else f=t._req=S(m);m.timeout&&f.on("timeout",()=>{q(t,f,"Opening handshake has timed out")}),f.on("error",e=>{null===f||f[N]||(f=t._req=null,D(t,e))}),f.on("response",r=>{let o=r.headers.location,s=r.statusCode;if(o&&m.followRedirects&&s>=300&&s<400){let r;if(++t._redirects>m.maxRedirects)return void q(t,f,"Maximum redirects exceeded");f.abort();try{r=new c(o,n)}catch(e){D(t,SyntaxError(`Invalid URL: ${o}`));return}e(t,r,i,l)}else t.emit("unexpected-response",f,r)||q(t,f,`Unexpected server response: ${r.statusCode}`)}),f.on("upgrade",(e,n,i)=>{let r;if(t.emit("upgrade",e),t.readyState!==k.CONNECTING)return;f=t._req=null;let o=e.headers.upgrade;if(void 0===o||"websocket"!==o.toLowerCase())return void q(t,n,"Invalid Upgrade header");let l=u("sha1").update(E+v).digest("base64");if(e.headers["sec-websocket-accept"]!==l)return void q(t,n,"Invalid Sec-WebSocket-Accept header");let s=e.headers["sec-websocket-protocol"];if(void 0!==s?T.size?T.has(s)||(r="Server sent an invalid subprotocol"):r="Server sent a subprotocol but none was requested":T.size&&(r="Server sent no subprotocol"),r)return void q(t,n,r);s&&(t._protocol=s);let a=e.headers["sec-websocket-extensions"];if(void 0!==a){let e;if(!d)return void q(t,n,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");try{e=x(a)}catch(e){q(t,n,"Invalid Sec-WebSocket-Extensions header");return}let i=Object.keys(e);if(1!==i.length||i[0]!==h.extensionName)return void q(t,n,"Server indicated an extension that was not requested");try{d.accept(e[h.extensionName])}catch(e){q(t,n,"Invalid Sec-WebSocket-Extensions header");return}t._extensions[h.extensionName]=d}t.setSocket(n,i,{allowSynchronousEvents:m.allowSynchronousEvents,generateMask:m.generateMask,maxPayload:m.maxPayload,skipUTF8Validation:m.skipUTF8Validation})}),m.finishRequest?m.finishRequest(f,t):f.end()}(this,e,t,n)):(this._autoPong=n.autoPong,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){y.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,t,n){let i=new f({allowSynchronousEvents:n.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:n.maxPayload,skipUTF8Validation:n.skipUTF8Validation}),r=new m(e,this._extensions,n.generateMask);this._receiver=i,this._sender=r,this._socket=e,i[b]=this,r[b]=this,e[b]=this,i.on("conclude",j),i.on("drain",F),i.on("error",B),i.on("message",V),i.on("ping",J),i.on("pong",W),r.onerror=Y,e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",z),e.on("data",X),e.on("end",Z),e.on("error",Q),this._readyState=k.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=k.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[h.extensionName]&&this._extensions[h.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=k.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==k.CLOSED){if(this.readyState===k.CONNECTING)return void q(this,this._req,"WebSocket was closed before the connection was established");if(this.readyState===k.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=k.CLOSING,this._sender.close(e,t,!this._isServer,e=>{!e&&(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),K(this)}}pause(){this.readyState!==k.CONNECTING&&this.readyState!==k.CLOSED&&(this._paused=!0,this._socket.pause())}ping(e,t,n){if(this.readyState===k.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");("function"==typeof e?(n=e,e=t=void 0):"function"==typeof t&&(n=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState!==k.OPEN)?G(this,e,n):(void 0===t&&(t=!this._isServer),this._sender.ping(e||_,t,n))}pong(e,t,n){if(this.readyState===k.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");("function"==typeof e?(n=e,e=t=void 0):"function"==typeof t&&(n=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState!==k.OPEN)?G(this,e,n):(void 0===t&&(t=!this._isServer),this._sender.pong(e||_,t,n))}resume(){this.readyState!==k.CONNECTING&&this.readyState!==k.CLOSED&&(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,t,n){if(this.readyState===k.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof t&&(n=t,t={}),"number"==typeof e&&(e=e.toString()),this.readyState!==k.OPEN)return void G(this,e,n);let i={binary:"string"!=typeof e,mask:!this._isServer,compress:!0,fin:!0,...t};this._extensions[h.extensionName]||(i.compress=!1),this._sender.send(e||_,i,n)}terminate(){if(this.readyState!==k.CLOSED){if(this.readyState===k.CONNECTING)return void q(this,this._req,"WebSocket was closed before the connection was established");this._socket&&(this._readyState=k.CLOSING,this._socket.destroy())}}}function D(e,t){e._readyState=k.CLOSING,e._errorEmitted=!0,e.emit("error",t),e.emitClose()}function U(e){return e.path=e.socketPath,l.connect(e)}function L(e){return e.path=void 0,e.servername||""===e.servername||(e.servername=l.isIP(e.host)?"":e.host),s.connect(e)}function q(e,t,n){e._readyState=k.CLOSING;let i=Error(n);Error.captureStackTrace(i,q),t.setHeader?(t[N]=!0,t.abort(),t.socket&&!t.socket.destroyed&&t.socket.destroy(),process.nextTick(D,e,i)):(t.destroy(i),t.once("error",e.emit.bind(e,"error")),t.once("close",e.emitClose.bind(e)))}function G(e,t,n){if(t){let n=g(t)?t.size:R(t).length;e._socket?e._sender._bufferedBytes+=n:e._bufferedAmount+=n}if(n){let t=Error(`WebSocket is not open: readyState ${e.readyState} (${w[e.readyState]})`);process.nextTick(n,t)}}function j(e,t){let n=this[b];n._closeFrameReceived=!0,n._closeMessage=t,n._closeCode=e,void 0!==n._socket[b]&&(n._socket.removeListener("data",X),process.nextTick($,n._socket),1005===e?n.close():n.close(e,t))}function F(){let e=this[b];e.isPaused||e._socket.resume()}function B(e){let t=this[b];void 0!==t._socket[b]&&(t._socket.removeListener("data",X),process.nextTick($,t._socket),t.close(e[T])),t._errorEmitted||(t._errorEmitted=!0,t.emit("error",e))}function H(){this[b].emitClose()}function V(e,t){this[b].emit("message",e,t)}function J(e){let t=this[b];t._autoPong&&t.pong(e,!this._isServer,O),t.emit("ping",e)}function W(e){this[b].emit("pong",e)}function $(e){e.resume()}function Y(e){let t=this[b];t.readyState!==k.CLOSED&&(t.readyState===k.OPEN&&(t._readyState=k.CLOSING,K(t)),this._socket.end(),t._errorEmitted||(t._errorEmitted=!0,t.emit("error",e)))}function K(e){e._closeTimer=setTimeout(e._socket.destroy.bind(e._socket),3e4)}function z(){let e,t=this[b];this.removeListener("close",z),this.removeListener("data",X),this.removeListener("end",Z),t._readyState=k.CLOSING,this._readableState.endEmitted||t._closeFrameReceived||t._receiver._writableState.errorEmitted||null===(e=t._socket.read())||t._receiver.write(e),t._receiver.end(),this[b]=void 0,clearTimeout(t._closeTimer),t._receiver._writableState.finished||t._receiver._writableState.errorEmitted?t.emitClose():(t._receiver.on("error",H),t._receiver.on("finish",H))}function X(e){this[b]._receiver.write(e)||this.pause()}function Z(){let e=this[b];e._readyState=k.CLOSING,e._receiver.end(),this.end()}function Q(){let e=this[b];this.removeListener("error",Q),this.on("error",O),e&&(e._readyState=k.CLOSING,this.destroy())}Object.defineProperty(k,"CONNECTING",{enumerable:!0,value:w.indexOf("CONNECTING")}),Object.defineProperty(k.prototype,"CONNECTING",{enumerable:!0,value:w.indexOf("CONNECTING")}),Object.defineProperty(k,"OPEN",{enumerable:!0,value:w.indexOf("OPEN")}),Object.defineProperty(k.prototype,"OPEN",{enumerable:!0,value:w.indexOf("OPEN")}),Object.defineProperty(k,"CLOSING",{enumerable:!0,value:w.indexOf("CLOSING")}),Object.defineProperty(k.prototype,"CLOSING",{enumerable:!0,value:w.indexOf("CLOSING")}),Object.defineProperty(k,"CLOSED",{enumerable:!0,value:w.indexOf("CLOSED")}),Object.defineProperty(k.prototype,"CLOSED",{enumerable:!0,value:w.indexOf("CLOSED")}),["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(e=>{Object.defineProperty(k.prototype,e,{enumerable:!0})}),["open","error","close","message"].forEach(e=>{Object.defineProperty(k.prototype,`on${e}`,{enumerable:!0,get(){for(let t of this.listeners(e))if(t[E])return t[S];return null},set(t){for(let t of this.listeners(e))if(t[E]){this.removeListener(e,t);break}"function"==typeof t&&this.addEventListener(e,t,{[E]:!0})}})}),k.prototype.addEventListener=C,k.prototype.removeEventListener=A,t.exports=k},21365,(e,t,n)=>{"use strict";e.r(35065);let{Duplex:i}=e.r(88947);function r(e){e.emit("close")}function o(){!this.destroyed&&this._writableState.finished&&this.destroy()}function l(e){this.removeListener("error",l),this.destroy(),0===this.listenerCount("error")&&this.emit("error",e)}t.exports=function(e,t){let n=!0,s=new i({...t,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return e.on("message",function(t,n){let i=!n&&s._readableState.objectMode?t.toString():t;s.push(i)||e.pause()}),e.once("error",function(e){s.destroyed||(n=!1,s.destroy(e))}),e.once("close",function(){s.destroyed||s.push(null)}),s._destroy=function(t,i){if(e.readyState===e.CLOSED){i(t),process.nextTick(r,s);return}let o=!1;e.once("error",function(e){o=!0,i(e)}),e.once("close",function(){o||i(t),process.nextTick(r,s)}),n&&e.terminate()},s._final=function(t){e.readyState===e.CONNECTING?e.once("open",function(){s._final(t)}):null!==e._socket&&(e._socket._writableState.finished?(t(),s._readableState.endEmitted&&s.destroy()):(e._socket.once("finish",function(){t()}),e.close()))},s._read=function(){e.isPaused&&e.resume()},s._write=function(t,n,i){e.readyState===e.CONNECTING?e.once("open",function(){s._write(t,n,i)}):e.send(t,i)},s.on("end",o),s.on("error",l),s}},42977,(e,t,n)=>{"use strict";let{tokenChars:i}=e.r(58739);t.exports={parse:function(e){let t=new Set,n=-1,r=-1,o=0;for(;o<e.length;o++){let l=e.charCodeAt(o);if(-1===r&&1===i[l])-1===n&&(n=o);else if(0!==o&&(32===l||9===l))-1===r&&-1!==n&&(r=o);else if(44===l){if(-1===n)throw SyntaxError(`Unexpected character at index ${o}`);-1===r&&(r=o);let i=e.slice(n,r);if(t.has(i))throw SyntaxError(`The "${i}" subprotocol is duplicated`);t.add(i),n=r=-1}else throw SyntaxError(`Unexpected character at index ${o}`)}if(-1===n||-1!==r)throw SyntaxError("Unexpected end of input");let l=e.slice(n,o);if(t.has(l))throw SyntaxError(`The "${l}" subprotocol is duplicated`);return t.add(l),t}}},17198,(e,t,n)=>{"use strict";let i=e.r(27699),r=e.r(21517),{Duplex:o}=e.r(88947),{createHash:l}=e.r(54799),s=e.r(96903),a=e.r(80295),u=e.r(42977),p=e.r(35065),{GUID:d,kWebSocket:c}=e.r(74836),h=/^[+/0-9A-Za-z]{22}==$/;function f(e){e._state=2,e.emit("close")}function m(){this.destroy()}function g(e,t,n,i){n=n||r.STATUS_CODES[t],i={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(n),...i},e.once("finish",e.destroy),e.end(`HTTP/1.1 ${t} ${r.STATUS_CODES[t]}\r
`+Object.keys(i).map(e=>`${e}: ${i[e]}`).join("\r\n")+"\r\n\r\n"+n)}function y(e,t,n,i,r,o){if(e.listenerCount("wsClientError")){let i=Error(r);Error.captureStackTrace(i,y),e.emit("wsClientError",i,n,t)}else g(n,i,r,o)}t.exports=class extends i{constructor(e,t){if(super(),null==(e={allowSynchronousEvents:!0,autoPong:!0,maxPayload:0x6400000,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:p,...e}).port&&!e.server&&!e.noServer||null!=e.port&&(e.server||e.noServer)||e.server&&e.noServer)throw TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(null!=e.port?(this._server=r.createServer((e,t)=>{let n=r.STATUS_CODES[426];t.writeHead(426,{"Content-Length":n.length,"Content-Type":"text/plain"}),t.end(n)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server){const e=this.emit.bind(this,"connection");this._removeListeners=function(e,t){for(let n of Object.keys(t))e.on(n,t[n]);return function(){for(let n of Object.keys(t))e.removeListener(n,t[n])}}(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(t,n,i)=>{this.handleUpgrade(t,n,i,e)}})}!0===e.perMessageDeflate&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=0}address(){if(this.options.noServer)throw Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(2===this._state){e&&this.once("close",()=>{e(Error("The server is not running"))}),process.nextTick(f,this);return}if(e&&this.once("close",e),1!==this._state)if(this._state=1,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients&&this.clients.size?this._shouldEmitClose=!0:process.nextTick(f,this);else{let e=this._server;this._removeListeners(),this._removeListeners=this._server=null,e.close(()=>{f(this)})}}shouldHandle(e){if(this.options.path){let t=e.url.indexOf("?");if((-1!==t?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,n,i){t.on("error",m);let r=e.headers["sec-websocket-key"],o=e.headers.upgrade,l=+e.headers["sec-websocket-version"];if("GET"!==e.method)return void y(this,e,t,405,"Invalid HTTP method");if(void 0===o||"websocket"!==o.toLowerCase())return void y(this,e,t,400,"Invalid Upgrade header");if(void 0===r||!h.test(r))return void y(this,e,t,400,"Missing or invalid Sec-WebSocket-Key header");if(13!==l&&8!==l)return void y(this,e,t,400,"Missing or invalid Sec-WebSocket-Version header",{"Sec-WebSocket-Version":"13, 8"});if(!this.shouldHandle(e))return void g(t,400);let p=e.headers["sec-websocket-protocol"],d=new Set;if(void 0!==p)try{d=u.parse(p)}catch(n){y(this,e,t,400,"Invalid Sec-WebSocket-Protocol header");return}let c=e.headers["sec-websocket-extensions"],f={};if(this.options.perMessageDeflate&&void 0!==c){let n=new a(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let e=s.parse(c);e[a.extensionName]&&(n.accept(e[a.extensionName]),f[a.extensionName]=n)}catch(n){y(this,e,t,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let o={origin:e.headers[`${8===l?"sec-websocket-origin":"origin"}`],secure:!!(e.socket.authorized||e.socket.encrypted),req:e};if(2===this.options.verifyClient.length)return void this.options.verifyClient(o,(o,l,s,a)=>{if(!o)return g(t,l||401,s,a);this.completeUpgrade(f,r,d,e,t,n,i)});if(!this.options.verifyClient(o))return g(t,401)}this.completeUpgrade(f,r,d,e,t,n,i)}completeUpgrade(e,t,n,i,r,o,u){if(!r.readable||!r.writable)return r.destroy();if(r[c])throw Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>0)return g(r,503);let p=l("sha1").update(t+d).digest("base64"),h=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${p}`],y=new this.options.WebSocket(null,void 0,this.options);if(n.size){let e=this.options.handleProtocols?this.options.handleProtocols(n,i):n.values().next().value;e&&(h.push(`Sec-WebSocket-Protocol: ${e}`),y._protocol=e)}if(e[a.extensionName]){let t=e[a.extensionName].params,n=s.format({[a.extensionName]:[t]});h.push(`Sec-WebSocket-Extensions: ${n}`),y._extensions=e}this.emit("headers",h,i),r.write(h.concat("\r\n").join("\r\n")),r.removeListener("error",m),y.setSocket(r,o,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(y),y.on("close",()=>{this.clients.delete(y),this._shouldEmitClose&&!this.clients.size&&process.nextTick(f,this)})),u(y,i)}}},22152,e=>{"use strict";let t,n;var i,r,o,l,s,a,u,p,d,c,h,f,m,g,y,_,v,E,S,T,b,O,C,A,I,x,R,N,P,w,M,k,D,U,L,q,G,j,F,B,H,V,J,W,$,Y,K,z,X,Z,Q,ee,et,en,ei,er,eo,el,es,ea,eu,ep,ed,ec,eh,ef,em,eg,ey,e_,ev,eE,eS,eT,eb,eO,eC,eA,eI,ex,eR,eN,eP,ew,eM,ek,eD,eU,eL,eq,eG,ej,eF,eB,eH,eV,eJ,eW,e$,eY,eK=e.i(47909),ez=e.i(74017),eX=e.i(96250),eZ=e.i(59756),eQ=e.i(61916),e0=e.i(14444),e1=e.i(37092),e2=e.i(69741),e3=e.i(16795),e4=e.i(87718),e7=e.i(95169),e9=e.i(47587),e8=e.i(66012),e5=e.i(70101),e6=e.i(26937),te=e.i(10372),tt=e.i(93695);e.i(52474);var tn=e.i(220),ti=e.i(47334),tr=e.i(22734),to=e.i(81111);e.i(21365),e.i(29485),e.i(16735);var tl=e.i(35065);e.i(17198),tl.default;var ts=e.i(24868);class ta{}function tu(e,t){return e.replace(/\{([^}]+)\}/g,(e,n)=>{if(Object.prototype.hasOwnProperty.call(t,n)){let e=t[n];return null!=e?String(e):""}throw Error(`Key '${n}' not found in valueMap.`)})}function tp(e,t,n){for(let i=0;i<t.length-1;i++){let r=t[i];if(r.endsWith("[]")){let o=r.slice(0,-2);if(!(o in e))if(Array.isArray(n))e[o]=Array.from({length:n.length},()=>({}));else throw Error(`Value must be a list given an array path ${r}`);if(Array.isArray(e[o])){let r=e[o];if(Array.isArray(n))for(let e=0;e<r.length;e++)tp(r[e],t.slice(i+1),n[e]);else for(let e of r)tp(e,t.slice(i+1),n)}return}if(r.endsWith("[0]")){let o=r.slice(0,-3);o in e||(e[o]=[{}]),tp(e[o][0],t.slice(i+1),n);return}e[r]&&"object"==typeof e[r]||(e[r]={}),e=e[r]}let i=t[t.length-1],r=e[i];if(void 0!==r){if(!n||"object"==typeof n&&0===Object.keys(n).length||n===r)return;if("object"==typeof r&&"object"==typeof n&&null!==r&&null!==n)Object.assign(r,n);else throw Error(`Cannot set value for an existing key. Key: ${i}`)}else"_self"!==i||"object"!=typeof n||null===n||Array.isArray(n)?e[i]=n:Object.assign(e,n)}function td(e,t,n){try{if(1===t.length&&"_self"===t[0])return e;for(let i=0;i<t.length;i++){if("object"!=typeof e||null===e)return n;let r=t[i];if(r.endsWith("[]")){let o=r.slice(0,-2);if(!(o in e))return n;{let r=e[o];if(!Array.isArray(r))return n;return r.map(e=>td(e,t.slice(i+1),n))}}e=e[r]}return e}catch(e){if(e instanceof TypeError)return n;throw e}}function tc(e){if("string"!=typeof e)throw Error("fromImageBytes must be a string");return e}(i=Q||(Q={})).OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",i.OUTCOME_OK="OUTCOME_OK",i.OUTCOME_FAILED="OUTCOME_FAILED",i.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED",(r=ee||(ee={})).LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",r.PYTHON="PYTHON",(o=et||(et={})).SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",o.SILENT="SILENT",o.WHEN_IDLE="WHEN_IDLE",o.INTERRUPT="INTERRUPT",(l=en||(en={})).TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",l.STRING="STRING",l.NUMBER="NUMBER",l.INTEGER="INTEGER",l.BOOLEAN="BOOLEAN",l.ARRAY="ARRAY",l.OBJECT="OBJECT",l.NULL="NULL",(s=ei||(ei={})).HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",s.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",s.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",s.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",s.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",s.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",s.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",s.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",s.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",s.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",s.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK",(a=er||(er={})).HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",a.SEVERITY="SEVERITY",a.PROBABILITY="PROBABILITY",(u=eo||(eo={})).HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",u.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",u.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",u.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",u.BLOCK_NONE="BLOCK_NONE",u.OFF="OFF",(p=el||(el={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",p.MODE_DYNAMIC="MODE_DYNAMIC",(d=es||(es={})).AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",d.NO_AUTH="NO_AUTH",d.API_KEY_AUTH="API_KEY_AUTH",d.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",d.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",d.OAUTH="OAUTH",d.OIDC_AUTH="OIDC_AUTH",(c=ea||(ea={})).API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",c.SIMPLE_SEARCH="SIMPLE_SEARCH",c.ELASTIC_SEARCH="ELASTIC_SEARCH",(h=eu||(eu={})).URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",h.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",h.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",h.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",h.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE",(f=ep||(ep={})).FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",f.STOP="STOP",f.MAX_TOKENS="MAX_TOKENS",f.SAFETY="SAFETY",f.RECITATION="RECITATION",f.LANGUAGE="LANGUAGE",f.OTHER="OTHER",f.BLOCKLIST="BLOCKLIST",f.PROHIBITED_CONTENT="PROHIBITED_CONTENT",f.SPII="SPII",f.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",f.IMAGE_SAFETY="IMAGE_SAFETY",f.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",f.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",f.NO_IMAGE="NO_IMAGE",(m=ed||(ed={})).HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",m.NEGLIGIBLE="NEGLIGIBLE",m.LOW="LOW",m.MEDIUM="MEDIUM",m.HIGH="HIGH",(g=ec||(ec={})).HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",g.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",g.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",g.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",g.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH",(y=eh||(eh={})).BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",y.SAFETY="SAFETY",y.OTHER="OTHER",y.BLOCKLIST="BLOCKLIST",y.PROHIBITED_CONTENT="PROHIBITED_CONTENT",y.IMAGE_SAFETY="IMAGE_SAFETY",y.MODEL_ARMOR="MODEL_ARMOR",y.JAILBREAK="JAILBREAK",(_=ef||(ef={})).TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",_.ON_DEMAND="ON_DEMAND",_.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT",(v=em||(em={})).MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",v.TEXT="TEXT",v.IMAGE="IMAGE",v.AUDIO="AUDIO",(E=eg||(eg={})).MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",E.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",E.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",E.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",(S=ey||(ey={})).JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",S.JOB_STATE_QUEUED="JOB_STATE_QUEUED",S.JOB_STATE_PENDING="JOB_STATE_PENDING",S.JOB_STATE_RUNNING="JOB_STATE_RUNNING",S.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",S.JOB_STATE_FAILED="JOB_STATE_FAILED",S.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",S.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",S.JOB_STATE_PAUSED="JOB_STATE_PAUSED",S.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",S.JOB_STATE_UPDATING="JOB_STATE_UPDATING",S.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED",(T=e_||(e_={})).TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",T.TUNING_MODE_FULL="TUNING_MODE_FULL",T.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER",(b=ev||(ev={})).ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",b.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",b.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",b.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",b.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",b.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",b.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO",(O=eE||(eE={})).TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",O.TUNING_TASK_I2V="TUNING_TASK_I2V",O.TUNING_TASK_T2V="TUNING_TASK_T2V",(C=eS||(eS={})).FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",C.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",C.BALANCED="BALANCED",C.PRIORITIZE_COST="PRIORITIZE_COST",(A=eT||(eT={})).UNSPECIFIED="UNSPECIFIED",A.BLOCKING="BLOCKING",A.NON_BLOCKING="NON_BLOCKING",(I=eb||(eb={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",I.MODE_DYNAMIC="MODE_DYNAMIC",(x=eO||(eO={})).ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",x.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER",(R=eC||(eC={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",R.AUTO="AUTO",R.ANY="ANY",R.NONE="NONE",R.VALIDATED="VALIDATED",(N=eA||(eA={})).BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",N.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",N.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",N.BLOCK_NONE="BLOCK_NONE",(P=eI||(eI={})).DONT_ALLOW="DONT_ALLOW",P.ALLOW_ADULT="ALLOW_ADULT",P.ALLOW_ALL="ALLOW_ALL",(w=ex||(ex={})).auto="auto",w.en="en",w.ja="ja",w.ko="ko",w.hi="hi",w.zh="zh",w.pt="pt",w.es="es",(M=eR||(eR={})).MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",M.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",M.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",M.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",M.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC",(k=eN||(eN={})).CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",k.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",k.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",k.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH",(D=eP||(eP={})).SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",D.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",D.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",D.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT",(U=ew||(ew={})).EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",U.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",U.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",U.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",U.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",U.EDIT_MODE_STYLE="EDIT_MODE_STYLE",U.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",U.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE",(L=eM||(eM={})).FOREGROUND="FOREGROUND",L.BACKGROUND="BACKGROUND",L.PROMPT="PROMPT",L.SEMANTIC="SEMANTIC",L.INTERACTIVE="INTERACTIVE",(q=ek||(ek={})).ASSET="ASSET",q.STYLE="STYLE",(G=eD||(eD={})).INSERT="INSERT",G.REMOVE="REMOVE",G.REMOVE_STATIC="REMOVE_STATIC",G.OUTPAINT="OUTPAINT",(j=eU||(eU={})).OPTIMIZED="OPTIMIZED",j.LOSSLESS="LOSSLESS",(F=eL||(eL={})).STATE_UNSPECIFIED="STATE_UNSPECIFIED",F.PROCESSING="PROCESSING",F.ACTIVE="ACTIVE",F.FAILED="FAILED",(B=eq||(eq={})).SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",B.UPLOADED="UPLOADED",B.GENERATED="GENERATED",(H=eG||(eG={})).TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",H.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",H.RESPONSE_REJECTED="RESPONSE_REJECTED",H.NEED_MORE_INPUT="NEED_MORE_INPUT",(V=ej||(ej={})).MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",V.TEXT="TEXT",V.IMAGE="IMAGE",V.VIDEO="VIDEO",V.AUDIO="AUDIO",V.DOCUMENT="DOCUMENT",(J=eF||(eF={})).START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",J.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",J.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW",(W=eB||(eB={})).END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",W.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",W.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW",($=eH||(eH={})).ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",$.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",$.NO_INTERRUPTION="NO_INTERRUPTION",(Y=eV||(eV={})).TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",Y.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",Y.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT",(K=eJ||(eJ={})).SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",K.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",K.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",K.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",K.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",K.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",K.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",K.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",K.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",K.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",K.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",K.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",K.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR",(z=eW||(eW={})).MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",z.QUALITY="QUALITY",z.DIVERSITY="DIVERSITY",z.VOCALIZATION="VOCALIZATION",(X=e$||(e$={})).PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",X.PLAY="PLAY",X.PAUSE="PAUSE",X.STOP="STOP",X.RESET_CONTEXT="RESET_CONTEXT";class th{constructor(e){const t={};for(const n of e.headers.entries())t[n[0]]=n[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}}class tf{get text(){var e,t,n,i,r,o,l,s;if((null==(i=null==(n=null==(t=null==(e=this.candidates)?void 0:e[0])?void 0:t.content)?void 0:n.parts)?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let a="",u=!1,p=[];for(let e of null!=(s=null==(l=null==(o=null==(r=this.candidates)?void 0:r[0])?void 0:o.content)?void 0:l.parts)?s:[]){for(let[t,n]of Object.entries(e))"text"!==t&&"thought"!==t&&(null!==n||void 0!==n)&&p.push(t);if("string"==typeof e.text){if("boolean"==typeof e.thought&&e.thought)continue;u=!0,a+=e.text}}return p.length>0&&console.warn(`there are non-text parts ${p} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),u?a:void 0}get data(){var e,t,n,i,r,o,l,s;if((null==(i=null==(n=null==(t=null==(e=this.candidates)?void 0:e[0])?void 0:t.content)?void 0:n.parts)?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let a="",u=[];for(let e of null!=(s=null==(l=null==(o=null==(r=this.candidates)?void 0:r[0])?void 0:o.content)?void 0:l.parts)?s:[]){for(let[t,n]of Object.entries(e))"inlineData"!==t&&(null!==n||void 0!==n)&&u.push(t);e.inlineData&&"string"==typeof e.inlineData.data&&(a+=atob(e.inlineData.data))}return u.length>0&&console.warn(`there are non-data parts ${u} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),a.length>0?btoa(a):void 0}get functionCalls(){var e,t,n,i,r,o,l,s;if((null==(i=null==(n=null==(t=null==(e=this.candidates)?void 0:e[0])?void 0:t.content)?void 0:n.parts)?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");let a=null==(s=null==(l=null==(o=null==(r=this.candidates)?void 0:r[0])?void 0:o.content)?void 0:l.parts)?void 0:s.filter(e=>e.functionCall).map(e=>e.functionCall).filter(e=>void 0!==e);if((null==a?void 0:a.length)!==0)return a}get executableCode(){var e,t,n,i,r,o,l,s,a;if((null==(i=null==(n=null==(t=null==(e=this.candidates)?void 0:e[0])?void 0:t.content)?void 0:n.parts)?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");let u=null==(s=null==(l=null==(o=null==(r=this.candidates)?void 0:r[0])?void 0:o.content)?void 0:l.parts)?void 0:s.filter(e=>e.executableCode).map(e=>e.executableCode).filter(e=>void 0!==e);if((null==u?void 0:u.length)!==0)return null==(a=null==u?void 0:u[0])?void 0:a.code}get codeExecutionResult(){var e,t,n,i,r,o,l,s,a;if((null==(i=null==(n=null==(t=null==(e=this.candidates)?void 0:e[0])?void 0:t.content)?void 0:n.parts)?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");let u=null==(s=null==(l=null==(o=null==(r=this.candidates)?void 0:r[0])?void 0:o.content)?void 0:l.parts)?void 0:s.filter(e=>e.codeExecutionResult).map(e=>e.codeExecutionResult).filter(e=>void 0!==e);if((null==u?void 0:u.length)!==0)return null==(a=null==u?void 0:u[0])?void 0:a.output}}class tm{}class tg{}class ty{}class t_{}class tv{}class tE{}class tS{}class tT{}class tb{}class tO{}class tC{_fromAPIResponse({apiResponse:e,isVertexAI:t}){let n,i=new tC;if(t){let t,i,r,o,l,s;t={},null!=(i=td(e,["name"]))&&tp(t,["name"],i),null!=(r=td(e,["metadata"]))&&tp(t,["metadata"],r),null!=(o=td(e,["done"]))&&tp(t,["done"],o),null!=(l=td(e,["error"]))&&tp(t,["error"],l),null!=(s=td(e,["response"]))&&tp(t,["response"],function(e){let t={},n=td(e,["videos"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,r,o,l,s;return n={},null!=(i=td(e,["_self"]))&&tp(n,["video"],(r={},null!=(o=td(t=i,["gcsUri"]))&&tp(r,["uri"],o),null!=(l=td(t,["bytesBase64Encoded"]))&&tp(r,["videoBytes"],tc(l)),null!=(s=td(t,["mimeType"]))&&tp(r,["mimeType"],s),r)),n})),tp(t,["generatedVideos"],e)}let i=td(e,["raiMediaFilteredCount"]);null!=i&&tp(t,["raiMediaFilteredCount"],i);let r=td(e,["raiMediaFilteredReasons"]);return null!=r&&tp(t,["raiMediaFilteredReasons"],r),t}(s)),n=t}else{let t,i,r,o,l,s;t={},null!=(i=td(e,["name"]))&&tp(t,["name"],i),null!=(r=td(e,["metadata"]))&&tp(t,["metadata"],r),null!=(o=td(e,["done"]))&&tp(t,["done"],o),null!=(l=td(e,["error"]))&&tp(t,["error"],l),null!=(s=td(e,["response","generateVideoResponse"]))&&tp(t,["response"],function(e){let t={},n=td(e,["generatedSamples"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,r,o,l,s;return n={},null!=(i=td(e,["video"]))&&tp(n,["video"],(r={},null!=(o=td(t=i,["uri"]))&&tp(r,["uri"],o),null!=(l=td(t,["encodedVideo"]))&&tp(r,["videoBytes"],tc(l)),null!=(s=td(t,["encoding"]))&&tp(r,["mimeType"],s),r)),n})),tp(t,["generatedVideos"],e)}let i=td(e,["raiMediaFilteredCount"]);null!=i&&tp(t,["raiMediaFilteredCount"],i);let r=td(e,["raiMediaFilteredReasons"]);return null!=r&&tp(t,["raiMediaFilteredReasons"],r),t}(s)),n=t}return Object.assign(i,n),i}}class tA{}class tI{}class tx{}class tR{}class tN{}class tP{}class tw{}class tM{get text(){var e,t,n;let i="",r=!1,o=[];for(let l of null!=(n=null==(t=null==(e=this.serverContent)?void 0:e.modelTurn)?void 0:t.parts)?n:[]){for(let[e,t]of Object.entries(l))"text"!==e&&"thought"!==e&&null!==t&&o.push(e);if("string"==typeof l.text){if("boolean"==typeof l.thought&&l.thought)continue;r=!0,i+=l.text}}return o.length>0&&console.warn(`there are non-text parts ${o} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),r?i:void 0}get data(){var e,t,n;let i="",r=[];for(let o of null!=(n=null==(t=null==(e=this.serverContent)?void 0:e.modelTurn)?void 0:t.parts)?n:[]){for(let[e,t]of Object.entries(o))"inlineData"!==e&&null!==t&&r.push(e);o.inlineData&&"string"==typeof o.inlineData.data&&(i+=atob(o.inlineData.data))}return r.length>0&&console.warn(`there are non-data parts ${r} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),i.length>0?btoa(i):void 0}}class tk{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}function tD(e,t){if(!t||"string"!=typeof t)throw Error("model is required and must be a string");if(e.isVertexAI())if(t.startsWith("publishers/")||t.startsWith("projects/")||t.startsWith("models/"))return t;else{if(!(t.indexOf("/")>=0))return`publishers/google/models/${t}`;let e=t.split("/",2);return`publishers/${e[0]}/models/${e[1]}`}return t.startsWith("models/")||t.startsWith("tunedModels/")?t:`models/${t}`}function tU(e,t){let n=tD(e,t);return n?n.startsWith("publishers/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/${n}`:n.startsWith("models/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/publishers/google/${n}`:n:""}function tL(e){return Array.isArray(e)?e.map(e=>tq(e)):[tq(e)]}function tq(e){if("object"==typeof e&&null!==e)return e;throw Error(`Could not parse input as Blob. Unsupported blob type: ${typeof e}`)}function tG(e){let t=tq(e);if(t.mimeType&&t.mimeType.startsWith("image/"))return t;throw Error(`Unsupported mime type: ${t.mimeType}`)}function tj(e){let t=tq(e);if(t.mimeType&&t.mimeType.startsWith("audio/"))return t;throw Error(`Unsupported mime type: ${t.mimeType}`)}function tF(e){if(null==e)throw Error("PartUnion is required");if("object"==typeof e)return e;if("string"==typeof e)return{text:e};throw Error(`Unsupported part type: ${typeof e}`)}function tB(e){if(null==e||Array.isArray(e)&&0===e.length)throw Error("PartListUnion is required");return Array.isArray(e)?e.map(e=>tF(e)):[tF(e)]}function tH(e){return null!=e&&"object"==typeof e&&"parts"in e&&Array.isArray(e.parts)}function tV(e){return null!=e&&"object"==typeof e&&"functionCall"in e}function tJ(e){return null!=e&&"object"==typeof e&&"functionResponse"in e}function tW(e){if(null==e)throw Error("ContentUnion is required");return tH(e)?e:{role:"user",parts:tB(e)}}function t$(e,t){if(!t)return[];if(e.isVertexAI()&&Array.isArray(t))return t.flatMap(e=>{let t=tW(e);return t.parts&&t.parts.length>0&&void 0!==t.parts[0].text?[t.parts[0].text]:[]});if(e.isVertexAI()){let e=tW(t);return e.parts&&e.parts.length>0&&void 0!==e.parts[0].text?[e.parts[0].text]:[]}return Array.isArray(t)?t.map(e=>tW(e)):[tW(t)]}function tY(e){if(null==e||Array.isArray(e)&&0===e.length)throw Error("contents are required");if(!Array.isArray(e)){if(tV(e)||tJ(e))throw Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[tW(e)]}let t=[],n=[],i=tH(e[0]);for(let r of e){let e=tH(r);if(e!=i)throw Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(e)t.push(r);else if(tV(r)||tJ(r))throw Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");else n.push(r)}return i||t.push({role:"user",parts:tB(n)}),t}function tK(e){let t={},n=["items"],i=["anyOf"],r=["properties"];if(e.type&&e.anyOf)throw Error("type and anyOf cannot be both populated.");let o=e.anyOf;for(let[l,s]of(null!=o&&2==o.length&&("null"===o[0].type?(t.nullable=!0,e=o[1]):"null"===o[1].type&&(t.nullable=!0,e=o[0])),e.type instanceof Array&&function(e,t){e.includes("null")&&(t.nullable=!0);let n=e.filter(e=>"null"!==e);if(1===n.length)t.type=Object.values(en).includes(n[0].toUpperCase())?n[0].toUpperCase():en.TYPE_UNSPECIFIED;else for(let e of(t.anyOf=[],n))t.anyOf.push({type:Object.values(en).includes(e.toUpperCase())?e.toUpperCase():en.TYPE_UNSPECIFIED})}(e.type,t),Object.entries(e)))if(null!=s)if("type"==l){if("null"===s)throw Error("type: null can not be the only possible type for the field.");if(s instanceof Array)continue;t.type=Object.values(en).includes(s.toUpperCase())?s.toUpperCase():en.TYPE_UNSPECIFIED}else if(n.includes(l))t[l]=tK(s);else if(i.includes(l)){let e=[];for(let n of s){if("null"==n.type){t.nullable=!0;continue}e.push(tK(n))}t[l]=e}else if(r.includes(l)){let e={};for(let[t,n]of Object.entries(s))e[t]=tK(n);t[l]=e}else{if("additionalProperties"===l)continue;t[l]=s}return t}function tz(e){if("object"==typeof e)return e;if("string"==typeof e)return{voiceConfig:{prebuiltVoiceConfig:{voiceName:e}}};throw Error(`Unsupported speechConfig type: ${typeof e}`)}function tX(e){if("multiSpeakerVoiceConfig"in e)throw Error("multiSpeakerVoiceConfig is not supported in the live API.");return e}function tZ(e){if(e.functionDeclarations)for(let t of e.functionDeclarations)t.parameters&&(Object.keys(t.parameters).includes("$schema")?t.parametersJsonSchema||(t.parametersJsonSchema=t.parameters,delete t.parameters):t.parameters=tK(t.parameters)),t.response&&(Object.keys(t.response).includes("$schema")?t.responseJsonSchema||(t.responseJsonSchema=t.response,delete t.response):t.response=tK(t.response));return e}function tQ(e){if(null==e)throw Error("tools is required");if(!Array.isArray(e))throw Error("tools is required and must be an array of Tools");let t=[];for(let n of e)t.push(n);return t}function t0(e,t){if("string"!=typeof t)throw Error("name must be a string");return function(e,t,n,i=1){let r=!t.startsWith(`${n}/`)&&t.split("/").length===i;if(e.isVertexAI())if(t.startsWith("projects/"))return t;else if(t.startsWith("locations/"))return`projects/${e.getProject()}/${t}`;else if(t.startsWith(`${n}/`))return`projects/${e.getProject()}/locations/${e.getLocation()}/${t}`;else if(r)return`projects/${e.getProject()}/locations/${e.getLocation()}/${n}/${t}`;else return t;return r?`${n}/${t}`:t}(e,t,"cachedContents")}function t1(e){switch(e){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return e}}function t2(e){return null!=e&&"object"==typeof e&&"video"in e}function t3(e){return null!=e&&"object"==typeof e&&"uri"in e}function t4(e){var t;let n;if(null!=e&&"object"==typeof e&&"name"in e&&(n=e.name),!t3(e)||void 0!==(n=e.uri)){if(!t2(e)||void 0!==(n=null==(t=e.video)?void 0:t.uri)){if("string"==typeof e&&(n=e),void 0===n)throw Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){let e=n.split("files/")[1].match(/[a-z0-9]+/);if(null===e)throw Error(`Could not extract file name from URI ${n}`);n=e[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}}function t7(e,t){return e.isVertexAI()?t?"publishers/google/models":"models":t?"models":"tunedModels"}function t9(e){for(let i of["models","tunedModels","publisherModels"]){var t,n;if(t=e,n=i,null!==t&&"object"==typeof t&&n in t)return e[i]}return[]}function t8(e,t){let n;if("string"==typeof t)if(e.isVertexAI())if(t.startsWith("gs://"))n={format:"jsonl",gcsUri:[t]};else if(t.startsWith("bq://"))n={format:"bigquery",bigqueryUri:t};else throw Error(`Unsupported string source for Vertex AI: ${t}`);else if(t.startsWith("files/"))n={fileName:t};else throw Error(`Unsupported string source for Gemini API: ${t}`);else if(Array.isArray(t)){if(e.isVertexAI())throw Error("InlinedRequest[] is not supported in Vertex AI.");n={inlinedRequests:t}}else n=t;let i=[n.gcsUri,n.bigqueryUri].filter(Boolean).length,r=[n.inlinedRequests,n.fileName].filter(Boolean).length;if(e.isVertexAI()){if(r>0||1!==i)throw Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(i>0||1!==r)throw Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return n}function t5(e){if("object"!=typeof e||null===e)return{};let t=e.inlinedResponses;if("object"!=typeof t||null===t)return e;let n=t.inlinedResponses;if(!Array.isArray(n)||0===n.length)return e;let i=!1;for(let e of n){if("object"!=typeof e||null===e)continue;let t=e.response;if("object"==typeof t&&null!==t&&void 0!==t.embedding){i=!0;break}}return i&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),e}function t6(e,t){if(!e.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw Error(`Invalid batch job name: ${t}.`)}function ne(e){if("BATCH_STATE_UNSPECIFIED"===e)return"JOB_STATE_UNSPECIFIED";if("BATCH_STATE_PENDING"===e)return"JOB_STATE_PENDING";if("BATCH_STATE_RUNNING"===e)return"JOB_STATE_RUNNING";if("BATCH_STATE_SUCCEEDED"===e)return"JOB_STATE_SUCCEEDED";if("BATCH_STATE_FAILED"===e)return"JOB_STATE_FAILED";else if("BATCH_STATE_CANCELLED"===e)return"JOB_STATE_CANCELLED";else if("BATCH_STATE_EXPIRED"===e)return"JOB_STATE_EXPIRED";else return e}function nt(e){let t={},n=td(e,["name"]);null!=n&&tp(t,["name"],n);let i=td(e,["metadata","displayName"]);null!=i&&tp(t,["displayName"],i);let r=td(e,["metadata","state"]);null!=r&&tp(t,["state"],ne(r));let o=td(e,["metadata","createTime"]);null!=o&&tp(t,["createTime"],o);let l=td(e,["metadata","endTime"]);null!=l&&tp(t,["endTime"],l);let s=td(e,["metadata","updateTime"]);null!=s&&tp(t,["updateTime"],s);let a=td(e,["metadata","model"]);null!=a&&tp(t,["model"],a);let u=td(e,["metadata","output"]);return null!=u&&tp(t,["dest"],function(e){let t={},n=td(e,["responsesFile"]);null!=n&&tp(t,["fileName"],n);let i=td(e,["inlinedResponses","inlinedResponses"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,r;return n={},null!=(i=td(t=e,["response"]))&&tp(n,["response"],function(e){let t={},n=td(e,["sdkHttpResponse"]);null!=n&&tp(t,["sdkHttpResponse"],n);let i=td(e,["candidates"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=td(e,["content"]);null!=n&&tp(t,["content"],n);let i=td(e,["citationMetadata"]);null!=i&&tp(t,["citationMetadata"],function(e){let t={},n=td(e,["citationSources"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),tp(t,["citations"],e)}return t}(i));let r=td(e,["tokenCount"]);null!=r&&tp(t,["tokenCount"],r);let o=td(e,["finishReason"]);null!=o&&tp(t,["finishReason"],o);let l=td(e,["urlContextMetadata"]);null!=l&&tp(t,["urlContextMetadata"],l);let s=td(e,["avgLogprobs"]);null!=s&&tp(t,["avgLogprobs"],s);let a=td(e,["groundingMetadata"]);null!=a&&tp(t,["groundingMetadata"],a);let u=td(e,["index"]);null!=u&&tp(t,["index"],u);let p=td(e,["logprobsResult"]);null!=p&&tp(t,["logprobsResult"],p);let d=td(e,["safetyRatings"]);if(null!=d){let e=d;Array.isArray(e)&&(e=e.map(e=>e)),tp(t,["safetyRatings"],e)}return t})(e))),tp(t,["candidates"],e)}let r=td(e,["modelVersion"]);null!=r&&tp(t,["modelVersion"],r);let o=td(e,["promptFeedback"]);null!=o&&tp(t,["promptFeedback"],o);let l=td(e,["responseId"]);null!=l&&tp(t,["responseId"],l);let s=td(e,["usageMetadata"]);return null!=s&&tp(t,["usageMetadata"],s),t}(i)),null!=(r=td(t,["error"]))&&tp(n,["error"],r),n})),tp(t,["inlinedResponses"],e)}let r=td(e,["inlinedEmbedContentResponses","inlinedResponses"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),tp(t,["inlinedEmbedContentResponses"],e)}return t}(t5(u))),t}function nn(e){var t,n;let i,r,o,l,s,a,u,p,d={},c=td(e,["name"]);null!=c&&tp(d,["name"],c);let h=td(e,["displayName"]);null!=h&&tp(d,["displayName"],h);let f=td(e,["state"]);null!=f&&tp(d,["state"],ne(f));let m=td(e,["error"]);null!=m&&tp(d,["error"],m);let g=td(e,["createTime"]);null!=g&&tp(d,["createTime"],g);let y=td(e,["startTime"]);null!=y&&tp(d,["startTime"],y);let _=td(e,["endTime"]);null!=_&&tp(d,["endTime"],_);let v=td(e,["updateTime"]);null!=v&&tp(d,["updateTime"],v);let E=td(e,["model"]);null!=E&&tp(d,["model"],E);let S=td(e,["inputConfig"]);null!=S&&tp(d,["src"],(i={},null!=(r=td(n=S,["instancesFormat"]))&&tp(i,["format"],r),null!=(o=td(n,["gcsSource","uris"]))&&tp(i,["gcsUri"],o),null!=(l=td(n,["bigquerySource","inputUri"]))&&tp(i,["bigqueryUri"],l),i));let T=td(e,["outputConfig"]);return null!=T&&tp(d,["dest"],(t=t5(T),s={},null!=(a=td(t,["predictionsFormat"]))&&tp(s,["format"],a),null!=(u=td(t,["gcsDestination","outputUriPrefix"]))&&tp(s,["gcsUri"],u),null!=(p=td(t,["bigqueryDestination","outputUri"]))&&tp(s,["bigqueryUri"],p),s)),d}function ni(e){let t={},n=td(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,r,o,l,s,a,u,p,d,c;return n={},null!=(i=td(t=e,["videoMetadata"]))&&tp(n,["videoMetadata"],i),null!=(r=td(t,["thought"]))&&tp(n,["thought"],r),null!=(o=td(t,["inlineData"]))&&tp(n,["inlineData"],function(e){let t={};if(void 0!==td(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=td(e,["data"]);null!=n&&tp(t,["data"],n);let i=td(e,["mimeType"]);return null!=i&&tp(t,["mimeType"],i),t}(o)),null!=(l=td(t,["fileData"]))&&tp(n,["fileData"],function(e){let t={};if(void 0!==td(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=td(e,["fileUri"]);null!=n&&tp(t,["fileUri"],n);let i=td(e,["mimeType"]);return null!=i&&tp(t,["mimeType"],i),t}(l)),null!=(s=td(t,["thoughtSignature"]))&&tp(n,["thoughtSignature"],s),null!=(a=td(t,["functionCall"]))&&tp(n,["functionCall"],a),null!=(u=td(t,["codeExecutionResult"]))&&tp(n,["codeExecutionResult"],u),null!=(p=td(t,["executableCode"]))&&tp(n,["executableCode"],p),null!=(d=td(t,["functionResponse"]))&&tp(n,["functionResponse"],d),null!=(c=td(t,["text"]))&&tp(n,["text"],c),n})),tp(t,["parts"],e)}let i=td(e,["role"]);return null!=i&&tp(t,["role"],i),t}function nr(e,t){let n={},i=td(t,["model"]);null!=i&&tp(n,["_url","model"],tD(e,i));let r=td(t,["src"]);null!=r&&tp(n,["batch","inputConfig"],function(e,t){let n={};if(void 0!==td(t,["format"]))throw Error("format parameter is not supported in Gemini API.");if(void 0!==td(t,["gcsUri"]))throw Error("gcsUri parameter is not supported in Gemini API.");if(void 0!==td(t,["bigqueryUri"]))throw Error("bigqueryUri parameter is not supported in Gemini API.");let i=td(t,["fileName"]);null!=i&&tp(n,["fileName"],i);let r=td(t,["inlinedRequests"]);if(null!=r){let t=r;Array.isArray(t)&&(t=t.map(t=>(function(e,t){let n={},i=td(t,["model"]);null!=i&&tp(n,["request","model"],tD(e,i));let r=td(t,["contents"]);if(null!=r){let e=tY(r);Array.isArray(e)&&(e=e.map(e=>ni(e))),tp(n,["request","contents"],e)}let o=td(t,["metadata"]);null!=o&&tp(n,["metadata"],o);let l=td(t,["config"]);return null!=l&&tp(n,["request","generationConfig"],function(e,t,n){let i={},r=td(t,["systemInstruction"]);void 0!==n&&null!=r&&tp(n,["systemInstruction"],ni(tW(r)));let o=td(t,["temperature"]);null!=o&&tp(i,["temperature"],o);let l=td(t,["topP"]);null!=l&&tp(i,["topP"],l);let s=td(t,["topK"]);null!=s&&tp(i,["topK"],s);let a=td(t,["candidateCount"]);null!=a&&tp(i,["candidateCount"],a);let u=td(t,["maxOutputTokens"]);null!=u&&tp(i,["maxOutputTokens"],u);let p=td(t,["stopSequences"]);null!=p&&tp(i,["stopSequences"],p);let d=td(t,["responseLogprobs"]);null!=d&&tp(i,["responseLogprobs"],d);let c=td(t,["logprobs"]);null!=c&&tp(i,["logprobs"],c);let h=td(t,["presencePenalty"]);null!=h&&tp(i,["presencePenalty"],h);let f=td(t,["frequencyPenalty"]);null!=f&&tp(i,["frequencyPenalty"],f);let m=td(t,["seed"]);null!=m&&tp(i,["seed"],m);let g=td(t,["responseMimeType"]);null!=g&&tp(i,["responseMimeType"],g);let y=td(t,["responseSchema"]);null!=y&&tp(i,["responseSchema"],tK(y));let _=td(t,["responseJsonSchema"]);if(null!=_&&tp(i,["responseJsonSchema"],_),void 0!==td(t,["routingConfig"]))throw Error("routingConfig parameter is not supported in Gemini API.");if(void 0!==td(t,["modelSelectionConfig"]))throw Error("modelSelectionConfig parameter is not supported in Gemini API.");let v=td(t,["safetySettings"]);if(void 0!==n&&null!=v){let e=v;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==td(e,["method"]))throw Error("method parameter is not supported in Gemini API.");let n=td(e,["category"]);null!=n&&tp(t,["category"],n);let i=td(e,["threshold"]);return null!=i&&tp(t,["threshold"],i),t})(e))),tp(n,["safetySettings"],e)}let E=td(t,["tools"]);if(void 0!==n&&null!=E){let e=tQ(E);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=td(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),tp(t,["functionDeclarations"],e)}if(void 0!==td(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let i=td(e,["googleSearch"]);null!=i&&tp(t,["googleSearch"],function(e){let t={},n=td(e,["timeRangeFilter"]);if(null!=n&&tp(t,["timeRangeFilter"],n),void 0!==td(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");return t}(i));let r=td(e,["googleSearchRetrieval"]);if(null!=r&&tp(t,["googleSearchRetrieval"],r),void 0!==td(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let o=td(e,["googleMaps"]);null!=o&&tp(t,["googleMaps"],function(e){let t={};if(void 0!==td(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let n=td(e,["enableWidget"]);return null!=n&&tp(t,["enableWidget"],n),t}(o));let l=td(e,["urlContext"]);null!=l&&tp(t,["urlContext"],l);let s=td(e,["computerUse"]);null!=s&&tp(t,["computerUse"],s);let a=td(e,["codeExecution"]);return null!=a&&tp(t,["codeExecution"],a),t})(tZ(e)))),tp(n,["tools"],e)}let S=td(t,["toolConfig"]);if(void 0!==n&&null!=S&&tp(n,["toolConfig"],S),void 0!==td(t,["labels"]))throw Error("labels parameter is not supported in Gemini API.");let T=td(t,["cachedContent"]);void 0!==n&&null!=T&&tp(n,["cachedContent"],t0(e,T));let b=td(t,["responseModalities"]);null!=b&&tp(i,["responseModalities"],b);let O=td(t,["mediaResolution"]);null!=O&&tp(i,["mediaResolution"],O);let C=td(t,["speechConfig"]);if(null!=C&&tp(i,["speechConfig"],tz(C)),void 0!==td(t,["audioTimestamp"]))throw Error("audioTimestamp parameter is not supported in Gemini API.");let A=td(t,["thinkingConfig"]);null!=A&&tp(i,["thinkingConfig"],A);let I=td(t,["imageConfig"]);return null!=I&&tp(i,["imageConfig"],I),i}(e,l,td(n,["request"],{}))),n})(e,t))),tp(n,["requests","requests"],t)}return n}(e,t8(e,r)));let o=td(t,["config"]);return null!=o&&function(e,t){let n=td(e,["displayName"]);if(void 0!==t&&null!=n&&tp(t,["batch","displayName"],n),void 0!==td(e,["dest"]))throw Error("dest parameter is not supported in Gemini API.")}(o,n),n}(Z=eY||(eY={})).PAGED_ITEM_BATCH_JOBS="batchJobs",Z.PAGED_ITEM_MODELS="models",Z.PAGED_ITEM_TUNING_JOBS="tuningJobs",Z.PAGED_ITEM_FILES="files",Z.PAGED_ITEM_CACHED_CONTENTS="cachedContents";class no{constructor(e,t,n,i){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,n,i)}init(e,t,n){var i,r;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=null==t?void 0:t.sdkHttpResponse,this.idxInternal=0;let o={config:{}};(o=n&&0!==Object.keys(n).length?"object"==typeof n?Object.assign({},n):n:{config:{}}).config&&(o.config.pageToken=t.nextPageToken),this.paramsInternal=o,this.pageInternalSize=null!=(r=null==(i=o.config)?void 0:i.pageSize)?r:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(!this.hasNextPage())return{value:void 0,done:!0};else await this.nextPage();let e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw Error("No more pages to fetch.");let e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return(null==(e=this.params.config)?void 0:e.pageToken)!==void 0}}class nl extends ta{constructor(e){super(),this.apiClient=e,this.create=async e=>(this.apiClient.isVertexAI()&&(e.config=this.formatDestination(e.src,e.config)),this.createInternal(e)),this.createEmbeddings=async e=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(e)},this.list=async(e={})=>new no(eY.PAGED_ITEM_BATCH_JOBS,e=>this.listInternal(e),await this.listInternal(e),e)}createInlinedGenerateContentRequest(e){let t=nr(this.apiClient,e),n=tu("{model}:batchGenerateContent",t._url),i=t.batch.inputConfig.requests,r=i.requests,o=[];for(let e of r){let t=Object.assign({},e);if(t.systemInstruction){let e=t.systemInstruction;delete t.systemInstruction;let n=t.request;n.systemInstruction=e,t.request=n}o.push(t)}return i.requests=o,delete t.config,delete t._url,delete t._query,{path:n,body:t}}getGcsUri(e){return"string"==typeof e?e.startsWith("gs://")?e:void 0:!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0?e.gcsUri[0]:void 0}getBigqueryUri(e){return"string"==typeof e?e.startsWith("bq://")?e:void 0:Array.isArray(e)?void 0:e.bigqueryUri}formatDestination(e,t){let n=t?Object.assign({},t):{},i=Date.now().toString();if(n.displayName||(n.displayName=`genaiBatchJob_${i}`),void 0===n.dest){let t=this.getGcsUri(e),r=this.getBigqueryUri(e);if(t)t.endsWith(".jsonl")?n.dest=`${t.slice(0,-6)}/dest`:n.dest=`${t}_dest_${i}`;else if(r)n.dest=`${r}_dest_${i}`;else throw Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return n}async createInternal(e){var t,n,i,r,o;let l="",s={};if(this.apiClient.isVertexAI()){let i,r,a,u,p,d,c=(o=this.apiClient,i={},null!=(r=td(e,["model"]))&&tp(i,["model"],tD(o,r)),null!=(a=td(e,["src"]))&&tp(i,["inputConfig"],function(e){let t={},n=td(e,["format"]);null!=n&&tp(t,["instancesFormat"],n);let i=td(e,["gcsUri"]);null!=i&&tp(t,["gcsSource","uris"],i);let r=td(e,["bigqueryUri"]);if(null!=r&&tp(t,["bigquerySource","inputUri"],r),void 0!==td(e,["fileName"]))throw Error("fileName parameter is not supported in Vertex AI.");if(void 0!==td(e,["inlinedRequests"]))throw Error("inlinedRequests parameter is not supported in Vertex AI.");return t}(t8(o,a))),null!=(u=td(e,["config"]))&&(p=td(u,["displayName"]),void 0!==i&&null!=p&&tp(i,["displayName"],p),d=td(u,["dest"]),void 0!==i&&null!=d&&tp(i,["outputConfig"],function(e){let t={},n=td(e,["format"]);null!=n&&tp(t,["predictionsFormat"],n);let i=td(e,["gcsUri"]);null!=i&&tp(t,["gcsDestination","outputUriPrefix"],i);let r=td(e,["bigqueryUri"]);if(null!=r&&tp(t,["bigqueryDestination","outputUri"],r),void 0!==td(e,["fileName"]))throw Error("fileName parameter is not supported in Vertex AI.");if(void 0!==td(e,["inlinedResponses"]))throw Error("inlinedResponses parameter is not supported in Vertex AI.");if(void 0!==td(e,["inlinedEmbedContentResponses"]))throw Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return t}(function(e){if("string"!=typeof e)return e;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw Error(`Unsupported destination: ${e}`)}(d)))),i);return l=tu("batchPredictionJobs",c._url),s=c._query,delete c._url,delete c._query,this.apiClient.request({path:l,queryParams:s,body:JSON.stringify(c),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>nn(e))}{let t=nr(this.apiClient,e);return l=tu("{model}:batchGenerateContent",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:l,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json()).then(e=>nt(e))}}async createEmbeddingsInternal(e){var t,n,i,r,o;let l="",s={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let a,u,p,d,c,h,f,m,g=(i=this.apiClient,d={},null!=(c=td(e,["model"]))&&tp(d,["_url","model"],tD(i,c)),null!=(h=td(e,["src"]))&&tp(d,["batch","inputConfig"],(r=i,a={},null!=(u=td(o=h,["fileName"]))&&tp(a,["file_name"],u),null!=(p=td(o,["inlinedRequests"]))&&tp(a,["requests"],function(e,t){let n={},i=td(t,["contents"]);if(null!=i){let t=t$(e,i);Array.isArray(t)&&(t=t.map(e=>e)),tp(n,["requests[]","request","content"],t)}let r=td(t,["config"]);return null!=r&&(tp(n,["_self"],function(e,t){let n=td(e,["taskType"]);void 0!==t&&null!=n&&tp(t,["requests[]","taskType"],n);let i=td(e,["title"]);void 0!==t&&null!=i&&tp(t,["requests[]","title"],i);let r=td(e,["outputDimensionality"]);if(void 0!==t&&null!=r&&tp(t,["requests[]","outputDimensionality"],r),void 0!==td(e,["mimeType"]))throw Error("mimeType parameter is not supported in Gemini API.");if(void 0!==td(e,["autoTruncate"]))throw Error("autoTruncate parameter is not supported in Gemini API.");return{}}(r,n)),!function(e,t){for(let[n,i]of Object.entries(t)){let t=n.split("."),r=i.split("."),o=new Set,l=-1;for(let e=0;e<t.length;e++)if("*"===t[e]){l=e;break}if(-1!==l&&r.length>l)for(let e=l;e<r.length;e++){let t=r[e];"*"===t||t.endsWith("[]")||t.endsWith("[0]")||o.add(t)}!function e(t,n,i,r,o){if(r>=n.length||"object"!=typeof t||null===t)return;let l=n[r];if(l.endsWith("[]")){let s=l.slice(0,-2);if(s in t&&Array.isArray(t[s]))for(let l of t[s])e(l,n,i,r+1,o)}else if("*"===l){if("object"==typeof t&&null!==t&&!Array.isArray(t)){let e=Object.keys(t).filter(e=>!e.startsWith("_")&&!o.has(e)),n={};for(let i of e)n[i]=t[i];for(let[e,o]of Object.entries(n)){let n=[];for(let t of i.slice(r))"*"===t?n.push(e):n.push(t);tp(t,n,o)}for(let n of e)delete t[n]}}else l in t&&e(t[l],n,i,r+1,o)}(e,t,r,0,o)}}(n,{"requests[].*":"requests[].request.*"})),n}(r,p)),a)),null!=(f=td(e,["config"]))&&(m=td(f,["displayName"]),void 0!==d&&null!=m&&tp(d,["batch","displayName"],m)),d);return l=tu("{model}:asyncBatchEmbedContent",g._url),s=g._query,delete g._url,delete g._query,this.apiClient.request({path:l,queryParams:s,body:JSON.stringify(g),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>nt(e))}}async get(e){var t,n,i,r,o,l;let s="",a={};if(this.apiClient.isVertexAI()){let i,r,l=(o=this.apiClient,i={},null!=(r=td(e,["name"]))&&tp(i,["_url","name"],t6(o,r)),i);return s=tu("batchPredictionJobs/{name}",l._url),a=l._query,delete l._url,delete l._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(l),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>nn(e))}{let t,n,o=(l=this.apiClient,t={},null!=(n=td(e,["name"]))&&tp(t,["_url","name"],t6(l,n)),t);return s=tu("batches/{name}",o._url),a=o._query,delete o._url,delete o._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json()).then(e=>nt(e))}}async cancel(e){var t,n,i,r,o,l;let s="",a={};if(this.apiClient.isVertexAI()){let i,r,l=(o=this.apiClient,i={},null!=(r=td(e,["name"]))&&tp(i,["_url","name"],t6(o,r)),i);s=tu("batchPredictionJobs/{name}:cancel",l._url),a=l._query,delete l._url,delete l._query,await this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal})}else{let t,n,o=(l=this.apiClient,t={},null!=(n=td(e,["name"]))&&tp(t,["_url","name"],t6(l,n)),t);s=tu("batches/{name}:cancel",o._url),a=o._query,delete o._url,delete o._query,await this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal})}}async listInternal(e){var t,n,i,r;let o="",l={};if(this.apiClient.isVertexAI()){let i,r,s,a,u,p=(i={},null!=(r=td(e,["config"]))&&(s=td(r,["pageSize"]),void 0!==i&&null!=s&&tp(i,["_query","pageSize"],s),a=td(r,["pageToken"]),void 0!==i&&null!=a&&tp(i,["_query","pageToken"],a),u=td(r,["filter"]),void 0!==i&&null!=u&&tp(i,["_query","filter"],u)),i);return o=tu("batchPredictionJobs",p._url),l=p._query,delete p._url,delete p._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(p),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=td(e,["sdkHttpResponse"]);null!=n&&tp(t,["sdkHttpResponse"],n);let i=td(e,["nextPageToken"]);null!=i&&tp(t,["nextPageToken"],i);let r=td(e,["batchPredictionJobs"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>nn(e))),tp(t,["batchJobs"],e)}return t}(e),n=new tw;return Object.assign(n,t),n})}{let t,n,s=(t={},null!=(n=td(e,["config"]))&&function(e,t){let n=td(e,["pageSize"]);void 0!==t&&null!=n&&tp(t,["_query","pageSize"],n);let i=td(e,["pageToken"]);if(void 0!==t&&null!=i&&tp(t,["_query","pageToken"],i),void 0!==td(e,["filter"]))throw Error("filter parameter is not supported in Gemini API.")}(n,t),t);return o=tu("batches",s._url),l=s._query,delete s._url,delete s._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=td(e,["sdkHttpResponse"]);null!=n&&tp(t,["sdkHttpResponse"],n);let i=td(e,["nextPageToken"]);null!=i&&tp(t,["nextPageToken"],i);let r=td(e,["operations"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>nt(e))),tp(t,["batchJobs"],e)}return t}(e),n=new tw;return Object.assign(n,t),n})}}async delete(e){var t,n,i,r,o,l;let s="",a={};if(this.apiClient.isVertexAI()){let i,r,l=(o=this.apiClient,i={},null!=(r=td(e,["name"]))&&tp(i,["_url","name"],t6(o,r)),i);return s=tu("batchPredictionJobs/{name}",l._url),a=l._query,delete l._url,delete l._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(l),httpMethod:"DELETE",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i,r,o;return t={},null!=(n=td(e,["sdkHttpResponse"]))&&tp(t,["sdkHttpResponse"],n),null!=(i=td(e,["name"]))&&tp(t,["name"],i),null!=(r=td(e,["done"]))&&tp(t,["done"],r),null!=(o=td(e,["error"]))&&tp(t,["error"],o),t})}{let t,n,o=(l=this.apiClient,t={},null!=(n=td(e,["name"]))&&tp(t,["_url","name"],t6(l,n)),t);return s=tu("batches/{name}",o._url),a=o._query,delete o._url,delete o._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i,r,o;return t={},null!=(n=td(e,["sdkHttpResponse"]))&&tp(t,["sdkHttpResponse"],n),null!=(i=td(e,["name"]))&&tp(t,["name"],i),null!=(r=td(e,["done"]))&&tp(t,["done"],r),null!=(o=td(e,["error"]))&&tp(t,["error"],o),t})}}}function ns(e){let t={},n=td(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,r,o,l,s,a,u,p,d,c;return n={},null!=(i=td(t=e,["videoMetadata"]))&&tp(n,["videoMetadata"],i),null!=(r=td(t,["thought"]))&&tp(n,["thought"],r),null!=(o=td(t,["inlineData"]))&&tp(n,["inlineData"],function(e){let t={};if(void 0!==td(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=td(e,["data"]);null!=n&&tp(t,["data"],n);let i=td(e,["mimeType"]);return null!=i&&tp(t,["mimeType"],i),t}(o)),null!=(l=td(t,["fileData"]))&&tp(n,["fileData"],function(e){let t={};if(void 0!==td(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=td(e,["fileUri"]);null!=n&&tp(t,["fileUri"],n);let i=td(e,["mimeType"]);return null!=i&&tp(t,["mimeType"],i),t}(l)),null!=(s=td(t,["thoughtSignature"]))&&tp(n,["thoughtSignature"],s),null!=(a=td(t,["functionCall"]))&&tp(n,["functionCall"],a),null!=(u=td(t,["codeExecutionResult"]))&&tp(n,["codeExecutionResult"],u),null!=(p=td(t,["executableCode"]))&&tp(n,["executableCode"],p),null!=(d=td(t,["functionResponse"]))&&tp(n,["functionResponse"],d),null!=(c=td(t,["text"]))&&tp(n,["text"],c),n})),tp(t,["parts"],e)}let i=td(e,["role"]);return null!=i&&tp(t,["role"],i),t}class na extends ta{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new no(eY.PAGED_ITEM_CACHED_CONTENTS,e=>this.listInternal(e),await this.listInternal(e),e)}async create(e){var t,n,i,r,o,l;let s="",a={};if(this.apiClient.isVertexAI()){let i,r,l,u=(o=this.apiClient,i={},null!=(r=td(e,["model"]))&&tp(i,["model"],tU(o,r)),null!=(l=td(e,["config"]))&&function(e,t){let n=td(e,["ttl"]);void 0!==t&&null!=n&&tp(t,["ttl"],n);let i=td(e,["expireTime"]);void 0!==t&&null!=i&&tp(t,["expireTime"],i);let r=td(e,["displayName"]);void 0!==t&&null!=r&&tp(t,["displayName"],r);let o=td(e,["contents"]);if(void 0!==t&&null!=o){let e=tY(o);Array.isArray(e)&&(e=e.map(e=>e)),tp(t,["contents"],e)}let l=td(e,["systemInstruction"]);void 0!==t&&null!=l&&tp(t,["systemInstruction"],tW(l));let s=td(e,["tools"]);if(void 0!==t&&null!=s){let e=s;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=td(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==td(e,["behavior"]))throw Error("behavior parameter is not supported in Vertex AI.");let n=td(e,["description"]);null!=n&&tp(t,["description"],n);let i=td(e,["name"]);null!=i&&tp(t,["name"],i);let r=td(e,["parameters"]);null!=r&&tp(t,["parameters"],r);let o=td(e,["parametersJsonSchema"]);null!=o&&tp(t,["parametersJsonSchema"],o);let l=td(e,["response"]);null!=l&&tp(t,["response"],l);let s=td(e,["responseJsonSchema"]);return null!=s&&tp(t,["responseJsonSchema"],s),t})(e))),tp(t,["functionDeclarations"],e)}let i=td(e,["retrieval"]);null!=i&&tp(t,["retrieval"],i);let r=td(e,["googleSearch"]);null!=r&&tp(t,["googleSearch"],r);let o=td(e,["googleSearchRetrieval"]);null!=o&&tp(t,["googleSearchRetrieval"],o);let l=td(e,["enterpriseWebSearch"]);null!=l&&tp(t,["enterpriseWebSearch"],l);let s=td(e,["googleMaps"]);null!=s&&tp(t,["googleMaps"],s);let a=td(e,["urlContext"]);null!=a&&tp(t,["urlContext"],a);let u=td(e,["computerUse"]);null!=u&&tp(t,["computerUse"],u);let p=td(e,["codeExecution"]);return null!=p&&tp(t,["codeExecution"],p),t})(e))),tp(t,["tools"],e)}let a=td(e,["toolConfig"]);void 0!==t&&null!=a&&tp(t,["toolConfig"],a);let u=td(e,["kmsKeyName"]);void 0!==t&&null!=u&&tp(t,["encryption_spec","kmsKeyName"],u)}(l,i),i);return s=tu("cachedContents",u._url),a=u._query,delete u._url,delete u._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}{let t,n,o,u=(l=this.apiClient,t={},null!=(n=td(e,["model"]))&&tp(t,["model"],tU(l,n)),null!=(o=td(e,["config"]))&&function(e,t){let n=td(e,["ttl"]);void 0!==t&&null!=n&&tp(t,["ttl"],n);let i=td(e,["expireTime"]);void 0!==t&&null!=i&&tp(t,["expireTime"],i);let r=td(e,["displayName"]);void 0!==t&&null!=r&&tp(t,["displayName"],r);let o=td(e,["contents"]);if(void 0!==t&&null!=o){let e=tY(o);Array.isArray(e)&&(e=e.map(e=>ns(e))),tp(t,["contents"],e)}let l=td(e,["systemInstruction"]);void 0!==t&&null!=l&&tp(t,["systemInstruction"],ns(tW(l)));let s=td(e,["tools"]);if(void 0!==t&&null!=s){let e=s;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=td(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),tp(t,["functionDeclarations"],e)}if(void 0!==td(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let i=td(e,["googleSearch"]);null!=i&&tp(t,["googleSearch"],function(e){let t={},n=td(e,["timeRangeFilter"]);if(null!=n&&tp(t,["timeRangeFilter"],n),void 0!==td(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");return t}(i));let r=td(e,["googleSearchRetrieval"]);if(null!=r&&tp(t,["googleSearchRetrieval"],r),void 0!==td(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let o=td(e,["googleMaps"]);null!=o&&tp(t,["googleMaps"],function(e){let t={};if(void 0!==td(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let n=td(e,["enableWidget"]);return null!=n&&tp(t,["enableWidget"],n),t}(o));let l=td(e,["urlContext"]);null!=l&&tp(t,["urlContext"],l);let s=td(e,["computerUse"]);null!=s&&tp(t,["computerUse"],s);let a=td(e,["codeExecution"]);return null!=a&&tp(t,["codeExecution"],a),t})(e))),tp(t,["tools"],e)}let a=td(e,["toolConfig"]);if(void 0!==t&&null!=a&&tp(t,["toolConfig"],a),void 0!==td(e,["kmsKeyName"]))throw Error("kmsKeyName parameter is not supported in Gemini API.")}(o,t),t);return s=tu("cachedContents",u._url),a=u._query,delete u._url,delete u._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json()).then(e=>e)}}async get(e){var t,n,i,r,o,l;let s="",a={};if(this.apiClient.isVertexAI()){let i,r,l=(o=this.apiClient,i={},null!=(r=td(e,["name"]))&&tp(i,["_url","name"],t0(o,r)),i);return s=tu("{name}",l._url),a=l._query,delete l._url,delete l._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(l),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}{let t,n,o=(l=this.apiClient,t={},null!=(n=td(e,["name"]))&&tp(t,["_url","name"],t0(l,n)),t);return s=tu("{name}",o._url),a=o._query,delete o._url,delete o._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json()).then(e=>e)}}async delete(e){var t,n,i,r,o,l;let s="",a={};if(this.apiClient.isVertexAI()){let i,r,l=(o=this.apiClient,i={},null!=(r=td(e,["name"]))&&tp(i,["_url","name"],t0(o,r)),i);return s=tu("{name}",l._url),a=l._query,delete l._url,delete l._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(l),httpMethod:"DELETE",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i=(t={},null!=(n=td(e,["sdkHttpResponse"]))&&tp(t,["sdkHttpResponse"],n),t),r=new tI;return Object.assign(r,i),r})}{let t,n,o=(l=this.apiClient,t={},null!=(n=td(e,["name"]))&&tp(t,["_url","name"],t0(l,n)),t);return s=tu("{name}",o._url),a=o._query,delete o._url,delete o._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i=(t={},null!=(n=td(e,["sdkHttpResponse"]))&&tp(t,["sdkHttpResponse"],n),t),r=new tI;return Object.assign(r,i),r})}}async update(e){var t,n,i,r,o,l;let s="",a={};if(this.apiClient.isVertexAI()){let i,r,l,u,p,d=(o=this.apiClient,i={},null!=(r=td(e,["name"]))&&tp(i,["_url","name"],t0(o,r)),null!=(l=td(e,["config"]))&&(u=td(l,["ttl"]),void 0!==i&&null!=u&&tp(i,["ttl"],u),p=td(l,["expireTime"]),void 0!==i&&null!=p&&tp(i,["expireTime"],p)),i);return s=tu("{name}",d._url),a=d._query,delete d._url,delete d._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}{let t,n,o,u,p,d=(l=this.apiClient,t={},null!=(n=td(e,["name"]))&&tp(t,["_url","name"],t0(l,n)),null!=(o=td(e,["config"]))&&(u=td(o,["ttl"]),void 0!==t&&null!=u&&tp(t,["ttl"],u),p=td(o,["expireTime"]),void 0!==t&&null!=p&&tp(t,["expireTime"],p)),t);return s=tu("{name}",d._url),a=d._query,delete d._url,delete d._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json()).then(e=>e)}}async listInternal(e){var t,n,i,r;let o="",l={};if(this.apiClient.isVertexAI()){let i,r,s,a,u=(i={},null!=(r=td(e,["config"]))&&(s=td(r,["pageSize"]),void 0!==i&&null!=s&&tp(i,["_query","pageSize"],s),a=td(r,["pageToken"]),void 0!==i&&null!=a&&tp(i,["_query","pageToken"],a)),i);return o=tu("cachedContents",u._url),l=u._query,delete u._url,delete u._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=td(e,["sdkHttpResponse"]);null!=n&&tp(t,["sdkHttpResponse"],n);let i=td(e,["nextPageToken"]);null!=i&&tp(t,["nextPageToken"],i);let r=td(e,["cachedContents"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),tp(t,["cachedContents"],e)}return t}(e),n=new tx;return Object.assign(n,t),n})}{let t,n,s,a,u=(t={},null!=(n=td(e,["config"]))&&(s=td(n,["pageSize"]),void 0!==t&&null!=s&&tp(t,["_query","pageSize"],s),a=td(n,["pageToken"]),void 0!==t&&null!=a&&tp(t,["_query","pageToken"],a)),t);return o=tu("cachedContents",u._url),l=u._query,delete u._url,delete u._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=td(e,["sdkHttpResponse"]);null!=n&&tp(t,["sdkHttpResponse"],n);let i=td(e,["nextPageToken"]);null!=i&&tp(t,["nextPageToken"],i);let r=td(e,["cachedContents"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),tp(t,["cachedContents"],e)}return t}(e),n=new tx;return Object.assign(n,t),n})}}}function nu(e){return this instanceof nu?(this.v=e,this):new nu(e)}function np(e,t,n){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var i,r=n.apply(e,t||[]),o=[];return i=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),l("next"),l("throw"),l("return",function(e){return function(t){return Promise.resolve(t).then(e,u)}}),i[Symbol.asyncIterator]=function(){return this},i;function l(e,t){r[e]&&(i[e]=function(t){return new Promise(function(n,i){o.push([e,t,n,i])>1||s(e,t)})},t&&(i[e]=t(i[e])))}function s(e,t){try{var n;(n=r[e](t)).value instanceof nu?Promise.resolve(n.value.v).then(a,u):p(o[0][2],n)}catch(e){p(o[0][3],e)}}function a(e){s("next",e)}function u(e){s("throw",e)}function p(e,t){e(t),o.shift(),o.length&&s(o[0][0],o[0][1])}}function nd(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=e[n]&&function(t){return new Promise(function(i,r){var o,l,s;o=i,l=r,s=(t=e[n](t)).done,Promise.resolve(t.value).then(function(e){o({value:e,done:s})},l)})}}}function nc(e){if(void 0===e.parts||0===e.parts.length)return!1;for(let t of e.parts)if(void 0===t||0===Object.keys(t).length)return!1;return!0}function nh(e){if(void 0===e||0===e.length)return[];let t=[],n=e.length,i=0;for(;i<n;)if("user"===e[i].role)t.push(e[i]),i++;else{let r=[],o=!0;for(;i<n&&"model"===e[i].role;)r.push(e[i]),o&&!nc(e[i])&&(o=!1),i++;o?t.push(...r):t.pop()}return t}"function"==typeof SuppressedError&&SuppressedError;class nf{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new nm(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class nm{constructor(e,t,n,i={},r=[]){this.apiClient=e,this.modelsModule=t,this.model=n,this.config=i,this.history=r,this.sendPromise=Promise.resolve(),function(e){if(0!==e.length){for(let t of e)if("user"!==t.role&&"model"!==t.role)throw Error(`Role must be user or model, but got ${t.role}.`)}}(r)}async sendMessage(e){var t;await this.sendPromise;let n=tW(e.message),i=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(n),config:null!=(t=e.config)?t:this.config});return this.sendPromise=(async()=>{var e,t,r;let o=await i,l=null==(t=null==(e=o.candidates)?void 0:e[0])?void 0:t.content,s=o.automaticFunctionCallingHistory,a=this.getHistory(!0).length,u=[];null!=s&&(u=null!=(r=s.slice(a))?r:[]),this.recordHistory(n,l?[l]:[],u)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),i}async sendMessageStream(e){var t;await this.sendPromise;let n=tW(e.message),i=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(n),config:null!=(t=e.config)?t:this.config});this.sendPromise=i.then(()=>void 0).catch(()=>void 0);let r=await i;return this.processStreamResponse(r,n)}getHistory(e=!1){return structuredClone(e?nh(this.history):this.history)}processStreamResponse(e,t){var n,i;return np(this,arguments,function*(){var r,o,l,s;let a=[];try{for(var u,p=!0,d=nd(e);!(r=(u=yield nu(d.next())).done);p=!0){if(s=u.value,p=!1,function(e){var t;if(void 0==e.candidates||0===e.candidates.length)return!1;let n=null==(t=e.candidates[0])?void 0:t.content;return void 0!==n&&nc(n)}(s)){let e=null==(i=null==(n=s.candidates)?void 0:n[0])?void 0:i.content;void 0!==e&&a.push(e)}yield yield nu(s)}}catch(e){o={error:e}}finally{try{!p&&!r&&(l=d.return)&&(yield nu(l.call(d)))}finally{if(o)throw o.error}}this.recordHistory(t,a)})}recordHistory(e,t,n){let i=[];t.length>0&&t.every(e=>void 0!==e.role)?i=t:i.push({role:"model",parts:[]}),n&&n.length>0?this.history.push(...nh(n)):this.history.push(e),this.history.push(...i)}}class ng extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,ng.prototype)}}class ny extends ta{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new no(eY.PAGED_ITEM_FILES,e=>this.listInternal(e),await this.listInternal(e),e)}async upload(e){if(this.apiClient.isVertexAI())throw Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(e=>e)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,n;let i="",r={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o,l,s,a,u=(o={},null!=(l=td(e,["config"]))&&(s=td(l,["pageSize"]),void 0!==o&&null!=s&&tp(o,["_query","pageSize"],s),a=td(l,["pageToken"]),void 0!==o&&null!=a&&tp(o,["_query","pageToken"],a)),o);return i=tu("files",u._url),r=u._query,delete u._url,delete u._query,this.apiClient.request({path:i,queryParams:r,body:JSON.stringify(u),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=td(e,["sdkHttpResponse"]);null!=n&&tp(t,["sdkHttpResponse"],n);let i=td(e,["nextPageToken"]);null!=i&&tp(t,["nextPageToken"],i);let r=td(e,["files"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),tp(t,["files"],e)}return t}(e),n=new tR;return Object.assign(n,t),n})}}async createInternal(e){var t,n;let i="",r={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o,l,s=(o={},null!=(l=td(e,["file"]))&&tp(o,["file"],l),o);return i=tu("upload/v1beta/files",s._url),r=s._query,delete s._url,delete s._query,this.apiClient.request({path:i,queryParams:r,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t,n,i=(t={},null!=(n=td(e,["sdkHttpResponse"]))&&tp(t,["sdkHttpResponse"],n),t),r=new tN;return Object.assign(r,i),r})}}async get(e){var t,n;let i="",r={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o,l,s=(o={},null!=(l=td(e,["name"]))&&tp(o,["_url","file"],t4(l)),o);return i=tu("files/{file}",s._url),r=s._query,delete s._url,delete s._query,this.apiClient.request({path:i,queryParams:r,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}}async delete(e){var t,n;let i="",r={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o,l,s=(o={},null!=(l=td(e,["name"]))&&tp(o,["_url","file"],t4(l)),o);return i=tu("files/{file}",s._url),r=s._query,delete s._url,delete s._query,this.apiClient.request({path:i,queryParams:r,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i=(t={},null!=(n=td(e,["sdkHttpResponse"]))&&tp(t,["sdkHttpResponse"],n),t),r=new tP;return Object.assign(r,i),r})}}}function n_(e){let t={};if(void 0!==td(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=td(e,["data"]);null!=n&&tp(t,["data"],n);let i=td(e,["mimeType"]);return null!=i&&tp(t,["mimeType"],i),t}function nv(e){let t={},n=td(e,["voiceConfig"]);if(null!=n&&tp(t,["voiceConfig"],n),void 0!==td(e,["multiSpeakerVoiceConfig"]))throw Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");let i=td(e,["languageCode"]);return null!=i&&tp(t,["languageCode"],i),t}function nE(e){let t={},n=td(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,r,o,l,s,a,u,p,d,c;return n={},null!=(i=td(t=e,["videoMetadata"]))&&tp(n,["videoMetadata"],i),null!=(r=td(t,["thought"]))&&tp(n,["thought"],r),null!=(o=td(t,["inlineData"]))&&tp(n,["inlineData"],function(e){let t={};if(void 0!==td(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=td(e,["data"]);null!=n&&tp(t,["data"],n);let i=td(e,["mimeType"]);return null!=i&&tp(t,["mimeType"],i),t}(o)),null!=(l=td(t,["fileData"]))&&tp(n,["fileData"],function(e){let t={};if(void 0!==td(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=td(e,["fileUri"]);null!=n&&tp(t,["fileUri"],n);let i=td(e,["mimeType"]);return null!=i&&tp(t,["mimeType"],i),t}(l)),null!=(s=td(t,["thoughtSignature"]))&&tp(n,["thoughtSignature"],s),null!=(a=td(t,["functionCall"]))&&tp(n,["functionCall"],a),null!=(u=td(t,["codeExecutionResult"]))&&tp(n,["codeExecutionResult"],u),null!=(p=td(t,["executableCode"]))&&tp(n,["executableCode"],p),null!=(d=td(t,["functionResponse"]))&&tp(n,["functionResponse"],d),null!=(c=td(t,["text"]))&&tp(n,["text"],c),n})),tp(t,["parts"],e)}let i=td(e,["role"]);return null!=i&&tp(t,["role"],i),t}function nS(e,t){let n={},i=td(t,["model"]);null!=i&&tp(n,["_url","model"],tD(e,i));let r=td(t,["contents"]);if(null!=r){let e=tY(r);Array.isArray(e)&&(e=e.map(e=>nE(e))),tp(n,["contents"],e)}let o=td(t,["config"]);return null!=o&&tp(n,["generationConfig"],function(e,t,n){let i={},r=td(t,["systemInstruction"]);void 0!==n&&null!=r&&tp(n,["systemInstruction"],nE(tW(r)));let o=td(t,["temperature"]);null!=o&&tp(i,["temperature"],o);let l=td(t,["topP"]);null!=l&&tp(i,["topP"],l);let s=td(t,["topK"]);null!=s&&tp(i,["topK"],s);let a=td(t,["candidateCount"]);null!=a&&tp(i,["candidateCount"],a);let u=td(t,["maxOutputTokens"]);null!=u&&tp(i,["maxOutputTokens"],u);let p=td(t,["stopSequences"]);null!=p&&tp(i,["stopSequences"],p);let d=td(t,["responseLogprobs"]);null!=d&&tp(i,["responseLogprobs"],d);let c=td(t,["logprobs"]);null!=c&&tp(i,["logprobs"],c);let h=td(t,["presencePenalty"]);null!=h&&tp(i,["presencePenalty"],h);let f=td(t,["frequencyPenalty"]);null!=f&&tp(i,["frequencyPenalty"],f);let m=td(t,["seed"]);null!=m&&tp(i,["seed"],m);let g=td(t,["responseMimeType"]);null!=g&&tp(i,["responseMimeType"],g);let y=td(t,["responseSchema"]);null!=y&&tp(i,["responseSchema"],tK(y));let _=td(t,["responseJsonSchema"]);if(null!=_&&tp(i,["responseJsonSchema"],_),void 0!==td(t,["routingConfig"]))throw Error("routingConfig parameter is not supported in Gemini API.");if(void 0!==td(t,["modelSelectionConfig"]))throw Error("modelSelectionConfig parameter is not supported in Gemini API.");let v=td(t,["safetySettings"]);if(void 0!==n&&null!=v){let e=v;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==td(e,["method"]))throw Error("method parameter is not supported in Gemini API.");let n=td(e,["category"]);null!=n&&tp(t,["category"],n);let i=td(e,["threshold"]);return null!=i&&tp(t,["threshold"],i),t})(e))),tp(n,["safetySettings"],e)}let E=td(t,["tools"]);if(void 0!==n&&null!=E){let e=tQ(E);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=td(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),tp(t,["functionDeclarations"],e)}if(void 0!==td(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let i=td(e,["googleSearch"]);null!=i&&tp(t,["googleSearch"],function(e){let t={},n=td(e,["timeRangeFilter"]);if(null!=n&&tp(t,["timeRangeFilter"],n),void 0!==td(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");return t}(i));let r=td(e,["googleSearchRetrieval"]);if(null!=r&&tp(t,["googleSearchRetrieval"],r),void 0!==td(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let o=td(e,["googleMaps"]);null!=o&&tp(t,["googleMaps"],function(e){let t={};if(void 0!==td(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let n=td(e,["enableWidget"]);return null!=n&&tp(t,["enableWidget"],n),t}(o));let l=td(e,["urlContext"]);null!=l&&tp(t,["urlContext"],l);let s=td(e,["computerUse"]);null!=s&&tp(t,["computerUse"],s);let a=td(e,["codeExecution"]);return null!=a&&tp(t,["codeExecution"],a),t})(tZ(e)))),tp(n,["tools"],e)}let S=td(t,["toolConfig"]);if(void 0!==n&&null!=S&&tp(n,["toolConfig"],S),void 0!==td(t,["labels"]))throw Error("labels parameter is not supported in Gemini API.");let T=td(t,["cachedContent"]);void 0!==n&&null!=T&&tp(n,["cachedContent"],t0(e,T));let b=td(t,["responseModalities"]);null!=b&&tp(i,["responseModalities"],b);let O=td(t,["mediaResolution"]);null!=O&&tp(i,["mediaResolution"],O);let C=td(t,["speechConfig"]);if(null!=C&&tp(i,["speechConfig"],tz(C)),void 0!==td(t,["audioTimestamp"]))throw Error("audioTimestamp parameter is not supported in Gemini API.");let A=td(t,["thinkingConfig"]);null!=A&&tp(i,["thinkingConfig"],A);let I=td(t,["imageConfig"]);return null!=I&&tp(i,["imageConfig"],I),i}(e,o,n)),n}function nT(e,t){let n={},i=td(t,["model"]);null!=i&&tp(n,["_url","model"],tD(e,i));let r=td(t,["contents"]);if(null!=r){let e=tY(r);Array.isArray(e)&&(e=e.map(e=>e)),tp(n,["contents"],e)}let o=td(t,["config"]);return null!=o&&tp(n,["generationConfig"],function(e,t,n){let i={},r=td(t,["systemInstruction"]);void 0!==n&&null!=r&&tp(n,["systemInstruction"],tW(r));let o=td(t,["temperature"]);null!=o&&tp(i,["temperature"],o);let l=td(t,["topP"]);null!=l&&tp(i,["topP"],l);let s=td(t,["topK"]);null!=s&&tp(i,["topK"],s);let a=td(t,["candidateCount"]);null!=a&&tp(i,["candidateCount"],a);let u=td(t,["maxOutputTokens"]);null!=u&&tp(i,["maxOutputTokens"],u);let p=td(t,["stopSequences"]);null!=p&&tp(i,["stopSequences"],p);let d=td(t,["responseLogprobs"]);null!=d&&tp(i,["responseLogprobs"],d);let c=td(t,["logprobs"]);null!=c&&tp(i,["logprobs"],c);let h=td(t,["presencePenalty"]);null!=h&&tp(i,["presencePenalty"],h);let f=td(t,["frequencyPenalty"]);null!=f&&tp(i,["frequencyPenalty"],f);let m=td(t,["seed"]);null!=m&&tp(i,["seed"],m);let g=td(t,["responseMimeType"]);null!=g&&tp(i,["responseMimeType"],g);let y=td(t,["responseSchema"]);null!=y&&tp(i,["responseSchema"],tK(y));let _=td(t,["responseJsonSchema"]);null!=_&&tp(i,["responseJsonSchema"],_);let v=td(t,["routingConfig"]);null!=v&&tp(i,["routingConfig"],v);let E=td(t,["modelSelectionConfig"]);null!=E&&tp(i,["modelConfig"],E);let S=td(t,["safetySettings"]);if(void 0!==n&&null!=S){let e=S;Array.isArray(e)&&(e=e.map(e=>e)),tp(n,["safetySettings"],e)}let T=td(t,["tools"]);if(void 0!==n&&null!=T){let e=tQ(T);Array.isArray(e)&&(e=e.map(e=>nk(tZ(e)))),tp(n,["tools"],e)}let b=td(t,["toolConfig"]);void 0!==n&&null!=b&&tp(n,["toolConfig"],b);let O=td(t,["labels"]);void 0!==n&&null!=O&&tp(n,["labels"],O);let C=td(t,["cachedContent"]);void 0!==n&&null!=C&&tp(n,["cachedContent"],t0(e,C));let A=td(t,["responseModalities"]);null!=A&&tp(i,["responseModalities"],A);let I=td(t,["mediaResolution"]);null!=I&&tp(i,["mediaResolution"],I);let x=td(t,["speechConfig"]);null!=x&&tp(i,["speechConfig"],nM(tz(x)));let R=td(t,["audioTimestamp"]);null!=R&&tp(i,["audioTimestamp"],R);let N=td(t,["thinkingConfig"]);null!=N&&tp(i,["thinkingConfig"],N);let P=td(t,["imageConfig"]);return null!=P&&tp(i,["imageConfig"],P),i}(e,o,n)),n}function nb(e){let t={},n=td(e,["sdkHttpResponse"]);null!=n&&tp(t,["sdkHttpResponse"],n);let i=td(e,["candidates"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=td(e,["content"]);null!=n&&tp(t,["content"],n);let i=td(e,["citationMetadata"]);null!=i&&tp(t,["citationMetadata"],function(e){let t={},n=td(e,["citationSources"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),tp(t,["citations"],e)}return t}(i));let r=td(e,["tokenCount"]);null!=r&&tp(t,["tokenCount"],r);let o=td(e,["finishReason"]);null!=o&&tp(t,["finishReason"],o);let l=td(e,["urlContextMetadata"]);null!=l&&tp(t,["urlContextMetadata"],l);let s=td(e,["avgLogprobs"]);null!=s&&tp(t,["avgLogprobs"],s);let a=td(e,["groundingMetadata"]);null!=a&&tp(t,["groundingMetadata"],a);let u=td(e,["index"]);null!=u&&tp(t,["index"],u);let p=td(e,["logprobsResult"]);null!=p&&tp(t,["logprobsResult"],p);let d=td(e,["safetyRatings"]);if(null!=d){let e=d;Array.isArray(e)&&(e=e.map(e=>e)),tp(t,["safetyRatings"],e)}return t})(e))),tp(t,["candidates"],e)}let r=td(e,["modelVersion"]);null!=r&&tp(t,["modelVersion"],r);let o=td(e,["promptFeedback"]);null!=o&&tp(t,["promptFeedback"],o);let l=td(e,["responseId"]);null!=l&&tp(t,["responseId"],l);let s=td(e,["usageMetadata"]);return null!=s&&tp(t,["usageMetadata"],s),t}function nO(e){let t={},n=td(e,["sdkHttpResponse"]);null!=n&&tp(t,["sdkHttpResponse"],n);let i=td(e,["candidates"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),tp(t,["candidates"],e)}let r=td(e,["createTime"]);null!=r&&tp(t,["createTime"],r);let o=td(e,["modelVersion"]);null!=o&&tp(t,["modelVersion"],o);let l=td(e,["promptFeedback"]);null!=l&&tp(t,["promptFeedback"],l);let s=td(e,["responseId"]);null!=s&&tp(t,["responseId"],s);let a=td(e,["usageMetadata"]);return null!=a&&tp(t,["usageMetadata"],a),t}function nC(e){let t={},n=td(e,["_self"]);null!=n&&tp(t,["image"],nA(n));let i=td(e,["raiFilteredReason"]);null!=i&&tp(t,["raiFilteredReason"],i);let r=td(e,["_self"]);null!=r&&tp(t,["safetyAttributes"],nw(r));let o=td(e,["prompt"]);return null!=o&&tp(t,["enhancedPrompt"],o),t}function nA(e){let t={},n=td(e,["gcsUri"]);null!=n&&tp(t,["gcsUri"],n);let i=td(e,["bytesBase64Encoded"]);null!=i&&tp(t,["imageBytes"],tc(i));let r=td(e,["mimeType"]);return null!=r&&tp(t,["mimeType"],r),t}function nI(e){let t={};if(void 0!==td(e,["gcsUri"]))throw Error("gcsUri parameter is not supported in Gemini API.");let n=td(e,["imageBytes"]);null!=n&&tp(t,["bytesBase64Encoded"],tc(n));let i=td(e,["mimeType"]);return null!=i&&tp(t,["mimeType"],i),t}function nx(e){let t={},n=td(e,["gcsUri"]);null!=n&&tp(t,["gcsUri"],n);let i=td(e,["imageBytes"]);null!=i&&tp(t,["bytesBase64Encoded"],tc(i));let r=td(e,["mimeType"]);return null!=r&&tp(t,["mimeType"],r),t}function nR(e){var t;let n,i,r,o,l={},s=td(e,["name"]);null!=s&&tp(l,["name"],s);let a=td(e,["displayName"]);null!=a&&tp(l,["displayName"],a);let u=td(e,["description"]);null!=u&&tp(l,["description"],u);let p=td(e,["version"]);null!=p&&tp(l,["version"],p);let d=td(e,["_self"]);null!=d&&tp(l,["tunedModelInfo"],(n={},null!=(i=td(t=d,["baseModel"]))&&tp(n,["baseModel"],i),null!=(r=td(t,["createTime"]))&&tp(n,["createTime"],r),null!=(o=td(t,["updateTime"]))&&tp(n,["updateTime"],o),n));let c=td(e,["inputTokenLimit"]);null!=c&&tp(l,["inputTokenLimit"],c);let h=td(e,["outputTokenLimit"]);null!=h&&tp(l,["outputTokenLimit"],h);let f=td(e,["supportedGenerationMethods"]);return null!=f&&tp(l,["supportedActions"],f),l}function nN(e){var t;let n,i,r,o,l={},s=td(e,["name"]);null!=s&&tp(l,["name"],s);let a=td(e,["displayName"]);null!=a&&tp(l,["displayName"],a);let u=td(e,["description"]);null!=u&&tp(l,["description"],u);let p=td(e,["versionId"]);null!=p&&tp(l,["version"],p);let d=td(e,["deployedModels"]);if(null!=d){let e=d;Array.isArray(e)&&(e=e.map(e=>{let t,n,i;return t={},null!=(n=td(e,["endpoint"]))&&tp(t,["name"],n),null!=(i=td(e,["deployedModelId"]))&&tp(t,["deployedModelId"],i),t})),tp(l,["endpoints"],e)}let c=td(e,["labels"]);null!=c&&tp(l,["labels"],c);let h=td(e,["_self"]);null!=h&&tp(l,["tunedModelInfo"],(n={},null!=(i=td(t=h,["labels","google-vertex-llm-tuning-base-model-id"]))&&tp(n,["baseModel"],i),null!=(r=td(t,["createTime"]))&&tp(n,["createTime"],r),null!=(o=td(t,["updateTime"]))&&tp(n,["updateTime"],o),n));let f=td(e,["defaultCheckpointId"]);null!=f&&tp(l,["defaultCheckpointId"],f);let m=td(e,["checkpoints"]);if(null!=m){let e=m;Array.isArray(e)&&(e=e.map(e=>e)),tp(l,["checkpoints"],e)}return l}function nP(e){let t={},n=td(e,["safetyAttributes","categories"]);null!=n&&tp(t,["categories"],n);let i=td(e,["safetyAttributes","scores"]);null!=i&&tp(t,["scores"],i);let r=td(e,["contentType"]);return null!=r&&tp(t,["contentType"],r),t}function nw(e){let t={},n=td(e,["safetyAttributes","categories"]);null!=n&&tp(t,["categories"],n);let i=td(e,["safetyAttributes","scores"]);null!=i&&tp(t,["scores"],i);let r=td(e,["contentType"]);return null!=r&&tp(t,["contentType"],r),t}function nM(e){let t={},n=td(e,["voiceConfig"]);if(null!=n&&tp(t,["voiceConfig"],n),void 0!==td(e,["multiSpeakerVoiceConfig"]))throw Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");let i=td(e,["languageCode"]);return null!=i&&tp(t,["languageCode"],i),t}function nk(e){let t={},n=td(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==td(e,["behavior"]))throw Error("behavior parameter is not supported in Vertex AI.");let n=td(e,["description"]);null!=n&&tp(t,["description"],n);let i=td(e,["name"]);null!=i&&tp(t,["name"],i);let r=td(e,["parameters"]);null!=r&&tp(t,["parameters"],r);let o=td(e,["parametersJsonSchema"]);null!=o&&tp(t,["parametersJsonSchema"],o);let l=td(e,["response"]);null!=l&&tp(t,["response"],l);let s=td(e,["responseJsonSchema"]);return null!=s&&tp(t,["responseJsonSchema"],s),t})(e))),tp(t,["functionDeclarations"],e)}let i=td(e,["retrieval"]);null!=i&&tp(t,["retrieval"],i);let r=td(e,["googleSearch"]);null!=r&&tp(t,["googleSearch"],r);let o=td(e,["googleSearchRetrieval"]);null!=o&&tp(t,["googleSearchRetrieval"],o);let l=td(e,["enterpriseWebSearch"]);null!=l&&tp(t,["enterpriseWebSearch"],l);let s=td(e,["googleMaps"]);null!=s&&tp(t,["googleMaps"],s);let a=td(e,["urlContext"]);null!=a&&tp(t,["urlContext"],a);let u=td(e,["computerUse"]);null!=u&&tp(t,["computerUse"],u);let p=td(e,["codeExecution"]);return null!=p&&tp(t,["codeExecution"],p),t}function nD(e){let t={},n=td(e,["uri"]);null!=n&&tp(t,["uri"],n);let i=td(e,["videoBytes"]);null!=i&&tp(t,["encodedVideo"],tc(i));let r=td(e,["mimeType"]);return null!=r&&tp(t,["encoding"],r),t}function nU(e){let t={},n=td(e,["uri"]);null!=n&&tp(t,["gcsUri"],n);let i=td(e,["videoBytes"]);null!=i&&tp(t,["bytesBase64Encoded"],tc(i));let r=td(e,["mimeType"]);return null!=r&&tp(t,["mimeType"],r),t}let nL="x-goog-api-client",nq=/^\s*data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class nG{constructor(e){var t,n;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const i={};this.clientOptions.vertexai?(i.apiVersion=null!=(t=this.clientOptions.apiVersion)?t:"v1beta1",i.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(i.apiVersion=null!=(n=this.clientOptions.apiVersion)?n:"v1beta",i.baseUrl="https://generativelanguage.googleapis.com/"),i.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=i,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(i,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&"global"!==this.clientOptions.location?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return null!=(e=this.clientOptions.vertexai)&&e}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.apiVersion)return this.clientOptions.httpOptions.apiVersion;throw Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.baseUrl)return this.clientOptions.httpOptions.baseUrl;throw Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.headers)return this.clientOptions.httpOptions.headers;throw Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||void 0===e.baseUrl||void 0===e.apiVersion)throw Error("HTTP options are not correctly set.");let t=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&""!==e.apiVersion&&t.push(e.apiVersion),t.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){let e=new URL(this.getBaseUrl());return e.protocol="http:"==e.protocol?"ws":"wss",e.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw Error("HTTP options are not correctly set.")}constructUrl(e,t,n){let i=[this.getRequestUrlInternal(t)];return n&&i.push(this.getBaseResourcePath()),""!==e&&i.push(e),new URL(`${i.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||"GET"===e.httpMethod&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let n=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,t,n);if(e.queryParams)for(let[t,n]of Object.entries(e.queryParams))i.searchParams.append(t,String(n));let r={};if("GET"===e.httpMethod){if(e.body&&"{}"!==e.body)throw Error("Request body should be empty for GET request, but got non empty request body")}else r.body=e.body;return r=await this.includeExtraHttpOptionsToRequestInit(r,t,i.toString(),e.abortSignal),this.unaryApiCall(i,r,e.httpMethod)}patchHttpOptions(e,t){let n=JSON.parse(JSON.stringify(e));for(let[e,i]of Object.entries(t))"object"==typeof i?n[e]=Object.assign(Object.assign({},n[e]),i):void 0!==i&&(n[e]=i);return n}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let n=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,t,n);i.searchParams.has("alt")&&"sse"===i.searchParams.get("alt")||i.searchParams.set("alt","sse");let r={};return r.body=e.body,r=await this.includeExtraHttpOptionsToRequestInit(r,t,i.toString(),e.abortSignal),this.streamApiCall(i,r,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,n,i){if(t&&t.timeout||i){let n=new AbortController,r=n.signal;if(t.timeout&&(null==t?void 0:t.timeout)>0){let e=setTimeout(()=>n.abort(),t.timeout);e&&"function"==typeof e.unref&&e.unref()}i&&i.addEventListener("abort",()=>{n.abort()}),e.signal=r}return t&&null!==t.extraBody&&function(e,t){if(!t||0===Object.keys(t).length)return;if(e.body instanceof Blob)return console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");let n={};if("string"==typeof e.body&&e.body.length>0)try{let t=JSON.parse(e.body);if("object"!=typeof t||null===t||Array.isArray(t))return void console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");n=t}catch(e){console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}e.body=JSON.stringify(function e(t,n){let i=Object.assign({},t);for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)){let r=n[t],o=i[t];r&&"object"==typeof r&&!Array.isArray(r)&&o&&"object"==typeof o&&!Array.isArray(o)?i[t]=e(o,r):(o&&r&&typeof o!=typeof r&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${t}". Original type: ${typeof o}, New type: ${typeof r}. Overwriting.`),i[t]=r)}return i}(n,t))}(e,t.extraBody),e.headers=await this.getHeadersInternal(t,n),e}async unaryApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async e=>(await nj(e),new th(e))).catch(e=>{if(e instanceof Error)throw e;throw Error(JSON.stringify(e))})}async streamApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async e=>(await nj(e),this.processStreamResponse(e))).catch(e=>{if(e instanceof Error)throw e;throw Error(JSON.stringify(e))})}processStreamResponse(e){var t;return np(this,arguments,function*(){let n=null==(t=null==e?void 0:e.body)?void 0:t.getReader(),i=new TextDecoder("utf-8");if(!n)throw Error("Response body is empty");try{let t="";for(;;){let{done:r,value:o}=yield nu(n.read());if(r){if(t.trim().length>0)throw Error("Incomplete JSON segment at the end");break}let l=i.decode(o,{stream:!0});try{let e=JSON.parse(l);if("error"in e){let t=JSON.parse(JSON.stringify(e.error)),n=t.status,i=t.code,r=`got status: ${n}. ${JSON.stringify(e)}`;if(i>=400&&i<600)throw new ng({message:r,status:i})}}catch(e){if("ApiError"===e.name)throw e}let s=(t+=l).match(nq);for(;s;){let n=s[1];try{let i=new Response(n,{headers:null==e?void 0:e.headers,status:null==e?void 0:e.status,statusText:null==e?void 0:e.statusText});yield yield nu(new th(i)),s=(t=t.slice(s[0].length)).match(nq)}catch(e){throw Error(`exception parsing stream chunk ${n}. ${e}`)}}}}finally{n.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(e=>{throw Error(`exception ${e} sending request`)})}getDefaultHeaders(){let e={},t="google-genai-sdk/1.27.0 "+this.clientOptions.userAgentExtra;return e["User-Agent"]=t,e[nL]=t,e["Content-Type"]="application/json",e}async getHeadersInternal(e,t){let n=new Headers;if(e&&e.headers){for(let[t,i]of Object.entries(e.headers))n.append(t,i);e.timeout&&e.timeout>0&&n.append("X-Server-Timeout",String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(n,t),n}async uploadFile(e,t){var n;let i={};null!=t&&(i.mimeType=t.mimeType,i.name=t.name,i.displayName=t.displayName),i.name&&!i.name.startsWith("files/")&&(i.name=`files/${i.name}`);let r=this.clientOptions.uploader,o=await r.stat(e);i.sizeBytes=String(o.size);let l=null!=(n=null==t?void 0:t.mimeType)?n:o.type;if(void 0===l||""===l)throw Error("Can not determine mimeType. Please provide mimeType in the config.");i.mimeType=l;let s=await this.fetchUploadUrl(i,t);return r.upload(e,s,this)}async downloadFile(e){let t=this.clientOptions.downloader;await t.download(e,this)}async fetchUploadUrl(e,t){var n;let i={};i=(null==t?void 0:t.httpOptions)?t.httpOptions:{apiVersion:"",headers:{"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${e.sizeBytes}`,"X-Goog-Upload-Header-Content-Type":`${e.mimeType}`}};let r={file:e},o=await this.request({path:tu("upload/v1beta/files",r._url),body:JSON.stringify(r),httpMethod:"POST",httpOptions:i});if(!o||!(null==o?void 0:o.headers))throw Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");let l=null==(n=null==o?void 0:o.headers)?void 0:n["x-goog-upload-url"];if(void 0===l)throw Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return l}}async function nj(e){var t;if(void 0===e)throw Error("response is undefined");if(!e.ok){let n=e.status,i=JSON.stringify((null==(t=e.headers.get("content-type"))?void 0:t.includes("application/json"))?await e.json():{error:{message:await e.text(),code:e.status,status:e.statusText}});if(n>=400&&n<600)throw new ng({message:i,status:n});throw Error(i)}}function nF(e){for(let n of e){var t;if(null!==(t=n)&&"object"==typeof t&&t instanceof nH||"object"==typeof n&&"inputSchema"in n)return!0}return!1}function nB(e){var t;let n=null!=(t=e[nL])?t:"";e[nL]=(n+" mcp_used/unknown").trimStart()}class nH{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new nH(e,t)}async initialize(){var e,t,n,i;if(this.mcpTools.length>0)return;let r={},o=[];for(let u of this.mcpClients)try{for(var l,s=!0,a=(t=void 0,nd(function(e,t=100){return np(this,arguments,function*(){let n,i=0;for(;i<t;){let t=yield nu(e.listTools({cursor:n}));for(let e of t.tools)yield yield nu(e),i++;if(!t.nextCursor)break;n=t.nextCursor}})}(u)));!(e=(l=await a.next()).done);s=!0){i=l.value,s=!1,o.push(i);let e=i.name;if(r[e])throw Error(`Duplicate function name ${e} found in MCP tools. Please ensure function names are unique.`);r[e]=u}}catch(e){t={error:e}}finally{try{!s&&!e&&(n=a.return)&&await n.call(a)}finally{if(t)throw t.error}}this.mcpTools=o,this.functionNameToMcpClient=r}async tool(){return await this.initialize(),function(e,t={}){let n=[],i=new Set;for(let r of e){let e=r.name;if(i.has(e))throw Error(`Duplicate function name ${e} found in MCP tools. Please ensure function names are unique.`);i.add(e);let o=function(e,t={}){let n={name:e.name,description:e.description,parametersJsonSchema:e.inputSchema};return e.outputSchema&&(n.responseJsonSchema=e.outputSchema),t.behavior&&(n.behavior=t.behavior),{functionDeclarations:[n]}}(r,t);o.functionDeclarations&&n.push(...o.functionDeclarations)}return{functionDeclarations:n}}(this.mcpTools,this.config)}async callTool(e){await this.initialize();let t=[];for(let n of e)if(n.name in this.functionNameToMcpClient){let e,i=this.functionNameToMcpClient[n.name];this.config.timeout&&(e={timeout:this.config.timeout});let r=await i.callTool({name:n.name,arguments:n.args},void 0,e);t.push({functionResponse:{name:n.name,response:r.isError?{error:r}:r}})}return t}}async function nV(e,t,n){let i=new tk;Object.assign(i,n.data instanceof Blob?JSON.parse(await n.data.text()):JSON.parse(n.data)),t(i)}class nJ{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n}async connect(e){var t,n;let i;if(this.apiClient.isVertexAI())throw Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");let r=this.apiClient.getWebsocketBaseUrl(),o=this.apiClient.getApiVersion(),l=function(e){let t=new Headers;for(let[n,i]of Object.entries(e))t.append(n,i);return t}(this.apiClient.getDefaultHeaders()),s=this.apiClient.getApiKey(),a=`${r}/ws/google.ai.generativelanguage.${o}.GenerativeService.BidiGenerateMusic?key=${s}`,u=()=>{},p=new Promise(e=>{u=e}),d=e.callbacks,c=this.apiClient,h={onopen:function(){u({})},onmessage:e=>{nV(c,d.onmessage,e)},onerror:null!=(t=null==d?void 0:d.onerror)?t:function(e){},onclose:null!=(n=null==d?void 0:d.onclose)?n:function(e){}},f=this.webSocketFactory.create(a,(i={},l.forEach((e,t)=>{i[t]=e}),i),h);f.connect(),await p;let m=tD(this.apiClient,e.model);return f.send(JSON.stringify({setup:{model:m}})),new nW(f,this.apiClient)}}class nW{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||0===Object.keys(e.weightedPrompts).length)throw Error("Weighted prompts must be set and contain at least one entry.");let t=function(e){let t={},n=td(e,["weightedPrompts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),tp(t,["weightedPrompts"],e)}return t}(e);this.conn.send(JSON.stringify({clientContent:t}))}async setMusicGenerationConfig(e){let t,n;e.musicGenerationConfig||(e.musicGenerationConfig={});let i=(t={},null!=(n=td(e,["musicGenerationConfig"]))&&tp(t,["musicGenerationConfig"],n),t);this.conn.send(JSON.stringify(i))}sendPlaybackControl(e){this.conn.send(JSON.stringify({playbackControl:e}))}play(){this.sendPlaybackControl(e$.PLAY)}pause(){this.sendPlaybackControl(e$.PAUSE)}stop(){this.sendPlaybackControl(e$.STOP)}resetContext(){this.sendPlaybackControl(e$.RESET_CONTEXT)}close(){this.conn.close()}}async function n$(e,t,n){let i=new tM,r=JSON.parse(n.data instanceof Blob?await n.data.text():n.data instanceof ArrayBuffer?new TextDecoder().decode(n.data):n.data);if(e.isVertexAI()){let e,t,n,o,l,s,a,u;Object.assign(i,(e={},null!=(t=td(r,["setupComplete"]))&&tp(e,["setupComplete"],t),null!=(n=td(r,["serverContent"]))&&tp(e,["serverContent"],n),null!=(o=td(r,["toolCall"]))&&tp(e,["toolCall"],o),null!=(l=td(r,["toolCallCancellation"]))&&tp(e,["toolCallCancellation"],l),null!=(s=td(r,["usageMetadata"]))&&tp(e,["usageMetadata"],function(e){let t={},n=td(e,["promptTokenCount"]);null!=n&&tp(t,["promptTokenCount"],n);let i=td(e,["cachedContentTokenCount"]);null!=i&&tp(t,["cachedContentTokenCount"],i);let r=td(e,["candidatesTokenCount"]);null!=r&&tp(t,["responseTokenCount"],r);let o=td(e,["toolUsePromptTokenCount"]);null!=o&&tp(t,["toolUsePromptTokenCount"],o);let l=td(e,["thoughtsTokenCount"]);null!=l&&tp(t,["thoughtsTokenCount"],l);let s=td(e,["totalTokenCount"]);null!=s&&tp(t,["totalTokenCount"],s);let a=td(e,["promptTokensDetails"]);if(null!=a){let e=a;Array.isArray(e)&&(e=e.map(e=>e)),tp(t,["promptTokensDetails"],e)}let u=td(e,["cacheTokensDetails"]);if(null!=u){let e=u;Array.isArray(e)&&(e=e.map(e=>e)),tp(t,["cacheTokensDetails"],e)}let p=td(e,["candidatesTokensDetails"]);if(null!=p){let e=p;Array.isArray(e)&&(e=e.map(e=>e)),tp(t,["responseTokensDetails"],e)}let d=td(e,["toolUsePromptTokensDetails"]);if(null!=d){let e=d;Array.isArray(e)&&(e=e.map(e=>e)),tp(t,["toolUsePromptTokensDetails"],e)}let c=td(e,["trafficType"]);return null!=c&&tp(t,["trafficType"],c),t}(s)),null!=(a=td(r,["goAway"]))&&tp(e,["goAway"],a),null!=(u=td(r,["sessionResumptionUpdate"]))&&tp(e,["sessionResumptionUpdate"],u),e))}else Object.assign(i,r);t(i)}class nY{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n,this.music=new nJ(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,n,i,r,o,l,s,a;let u,p;if(e.config&&e.config.httpOptions)throw Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");let d=this.apiClient.getWebsocketBaseUrl(),c=this.apiClient.getApiVersion(),h=this.apiClient.getHeaders();e.config&&e.config.tools&&nF(e.config.tools)&&nB(h);let f=function(e){let t=new Headers;for(let[n,i]of Object.entries(e))t.append(n,i);return t}(h);if(this.apiClient.isVertexAI())u=`${d}/ws/google.cloud.aiplatform.${c}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(f,u);else{let e=this.apiClient.getApiKey(),t="BidiGenerateContent",n="key";(null==e?void 0:e.startsWith("auth_tokens/"))&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),"v1alpha"!==c&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),t="BidiGenerateContentConstrained",n="access_token"),u=`${d}/ws/google.ai.generativelanguage.${c}.GenerativeService.${t}?${n}=${e}`}let m=()=>{},g=new Promise(e=>{m=e}),y=e.callbacks,_=this.apiClient,v={onopen:function(){var e;null==(e=null==y?void 0:y.onopen)||e.call(y),m({})},onmessage:e=>{n$(_,y.onmessage,e)},onerror:null!=(t=null==y?void 0:y.onerror)?t:function(e){},onclose:null!=(n=null==y?void 0:y.onclose)?n:function(e){}},E=this.webSocketFactory.create(u,(p={},f.forEach((e,t)=>{p[t]=e}),p),v);E.connect(),await g;let S=tD(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&S.startsWith("publishers/")){let e=this.apiClient.getProject(),t=this.apiClient.getLocation();S=`projects/${e}/locations/${t}/`+S}let T={};this.apiClient.isVertexAI()&&(null==(i=e.config)?void 0:i.responseModalities)===void 0&&(void 0===e.config?e.config={responseModalities:[em.AUDIO]}:e.config.responseModalities=[em.AUDIO]),(null==(r=e.config)?void 0:r.generationConfig)&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");let b=null!=(l=null==(o=e.config)?void 0:o.tools)?l:[],O=[];for(let e of b)this.isCallableTool(e)?O.push(await e.tool()):O.push(e);O.length>0&&(e.config.tools=O);let C={model:S,config:e.config,callbacks:e.callbacks};if(this.apiClient.isVertexAI()){let e,t,n;s=this.apiClient,e={},null!=(t=td(C,["model"]))&&tp(e,["setup","model"],tD(s,t)),null!=(n=td(C,["config"]))&&tp(e,["config"],function(e,t){let n=td(e,["generationConfig"]);void 0!==t&&null!=n&&tp(t,["setup","generationConfig"],function(e){let t={},n=td(e,["modelSelectionConfig"]);null!=n&&tp(t,["modelConfig"],n);let i=td(e,["audioTimestamp"]);null!=i&&tp(t,["audioTimestamp"],i);let r=td(e,["candidateCount"]);null!=r&&tp(t,["candidateCount"],r);let o=td(e,["enableAffectiveDialog"]);null!=o&&tp(t,["enableAffectiveDialog"],o);let l=td(e,["frequencyPenalty"]);null!=l&&tp(t,["frequencyPenalty"],l);let s=td(e,["logprobs"]);null!=s&&tp(t,["logprobs"],s);let a=td(e,["maxOutputTokens"]);null!=a&&tp(t,["maxOutputTokens"],a);let u=td(e,["mediaResolution"]);null!=u&&tp(t,["mediaResolution"],u);let p=td(e,["presencePenalty"]);null!=p&&tp(t,["presencePenalty"],p);let d=td(e,["responseJsonSchema"]);null!=d&&tp(t,["responseJsonSchema"],d);let c=td(e,["responseLogprobs"]);null!=c&&tp(t,["responseLogprobs"],c);let h=td(e,["responseMimeType"]);null!=h&&tp(t,["responseMimeType"],h);let f=td(e,["responseModalities"]);null!=f&&tp(t,["responseModalities"],f);let m=td(e,["responseSchema"]);null!=m&&tp(t,["responseSchema"],m);let g=td(e,["routingConfig"]);null!=g&&tp(t,["routingConfig"],g);let y=td(e,["seed"]);null!=y&&tp(t,["seed"],y);let _=td(e,["speechConfig"]);null!=_&&tp(t,["speechConfig"],nv(_));let v=td(e,["stopSequences"]);null!=v&&tp(t,["stopSequences"],v);let E=td(e,["temperature"]);null!=E&&tp(t,["temperature"],E);let S=td(e,["thinkingConfig"]);null!=S&&tp(t,["thinkingConfig"],S);let T=td(e,["topK"]);null!=T&&tp(t,["topK"],T);let b=td(e,["topP"]);if(null!=b&&tp(t,["topP"],b),void 0!==td(e,["enableEnhancedCivicAnswers"]))throw Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}(n));let i=td(e,["responseModalities"]);void 0!==t&&null!=i&&tp(t,["setup","generationConfig","responseModalities"],i);let r=td(e,["temperature"]);void 0!==t&&null!=r&&tp(t,["setup","generationConfig","temperature"],r);let o=td(e,["topP"]);void 0!==t&&null!=o&&tp(t,["setup","generationConfig","topP"],o);let l=td(e,["topK"]);void 0!==t&&null!=l&&tp(t,["setup","generationConfig","topK"],l);let s=td(e,["maxOutputTokens"]);void 0!==t&&null!=s&&tp(t,["setup","generationConfig","maxOutputTokens"],s);let a=td(e,["mediaResolution"]);void 0!==t&&null!=a&&tp(t,["setup","generationConfig","mediaResolution"],a);let u=td(e,["seed"]);void 0!==t&&null!=u&&tp(t,["setup","generationConfig","seed"],u);let p=td(e,["speechConfig"]);void 0!==t&&null!=p&&tp(t,["setup","generationConfig","speechConfig"],nv(tX(p)));let d=td(e,["thinkingConfig"]);void 0!==t&&null!=d&&tp(t,["setup","generationConfig","thinkingConfig"],d);let c=td(e,["enableAffectiveDialog"]);void 0!==t&&null!=c&&tp(t,["setup","generationConfig","enableAffectiveDialog"],c);let h=td(e,["systemInstruction"]);void 0!==t&&null!=h&&tp(t,["setup","systemInstruction"],tW(h));let f=td(e,["tools"]);if(void 0!==t&&null!=f){let e=tQ(f);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=td(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==td(e,["behavior"]))throw Error("behavior parameter is not supported in Vertex AI.");let n=td(e,["description"]);null!=n&&tp(t,["description"],n);let i=td(e,["name"]);null!=i&&tp(t,["name"],i);let r=td(e,["parameters"]);null!=r&&tp(t,["parameters"],r);let o=td(e,["parametersJsonSchema"]);null!=o&&tp(t,["parametersJsonSchema"],o);let l=td(e,["response"]);null!=l&&tp(t,["response"],l);let s=td(e,["responseJsonSchema"]);return null!=s&&tp(t,["responseJsonSchema"],s),t})(e))),tp(t,["functionDeclarations"],e)}let i=td(e,["retrieval"]);null!=i&&tp(t,["retrieval"],i);let r=td(e,["googleSearch"]);null!=r&&tp(t,["googleSearch"],r);let o=td(e,["googleSearchRetrieval"]);null!=o&&tp(t,["googleSearchRetrieval"],o);let l=td(e,["enterpriseWebSearch"]);null!=l&&tp(t,["enterpriseWebSearch"],l);let s=td(e,["googleMaps"]);null!=s&&tp(t,["googleMaps"],s);let a=td(e,["urlContext"]);null!=a&&tp(t,["urlContext"],a);let u=td(e,["computerUse"]);null!=u&&tp(t,["computerUse"],u);let p=td(e,["codeExecution"]);return null!=p&&tp(t,["codeExecution"],p),t})(tZ(e)))),tp(t,["setup","tools"],e)}let m=td(e,["sessionResumption"]);void 0!==t&&null!=m&&tp(t,["setup","sessionResumption"],m);let g=td(e,["inputAudioTranscription"]);void 0!==t&&null!=g&&tp(t,["setup","inputAudioTranscription"],g);let y=td(e,["outputAudioTranscription"]);void 0!==t&&null!=y&&tp(t,["setup","outputAudioTranscription"],y);let _=td(e,["realtimeInputConfig"]);void 0!==t&&null!=_&&tp(t,["setup","realtimeInputConfig"],_);let v=td(e,["contextWindowCompression"]);void 0!==t&&null!=v&&tp(t,["setup","contextWindowCompression"],v);let E=td(e,["proactivity"]);return void 0!==t&&null!=E&&tp(t,["setup","proactivity"],E),{}}(n,e)),T=e}else{let e,t,n;a=this.apiClient,e={},null!=(t=td(C,["model"]))&&tp(e,["setup","model"],tD(a,t)),null!=(n=td(C,["config"]))&&tp(e,["config"],function(e,t){let n=td(e,["generationConfig"]);void 0!==t&&null!=n&&tp(t,["setup","generationConfig"],n);let i=td(e,["responseModalities"]);void 0!==t&&null!=i&&tp(t,["setup","generationConfig","responseModalities"],i);let r=td(e,["temperature"]);void 0!==t&&null!=r&&tp(t,["setup","generationConfig","temperature"],r);let o=td(e,["topP"]);void 0!==t&&null!=o&&tp(t,["setup","generationConfig","topP"],o);let l=td(e,["topK"]);void 0!==t&&null!=l&&tp(t,["setup","generationConfig","topK"],l);let s=td(e,["maxOutputTokens"]);void 0!==t&&null!=s&&tp(t,["setup","generationConfig","maxOutputTokens"],s);let a=td(e,["mediaResolution"]);void 0!==t&&null!=a&&tp(t,["setup","generationConfig","mediaResolution"],a);let u=td(e,["seed"]);void 0!==t&&null!=u&&tp(t,["setup","generationConfig","seed"],u);let p=td(e,["speechConfig"]);void 0!==t&&null!=p&&tp(t,["setup","generationConfig","speechConfig"],tX(p));let d=td(e,["thinkingConfig"]);void 0!==t&&null!=d&&tp(t,["setup","generationConfig","thinkingConfig"],d);let c=td(e,["enableAffectiveDialog"]);void 0!==t&&null!=c&&tp(t,["setup","generationConfig","enableAffectiveDialog"],c);let h=td(e,["systemInstruction"]);void 0!==t&&null!=h&&tp(t,["setup","systemInstruction"],function(e){let t={},n=td(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,r,o,l,s,a,u,p,d,c;return n={},null!=(i=td(t=e,["videoMetadata"]))&&tp(n,["videoMetadata"],i),null!=(r=td(t,["thought"]))&&tp(n,["thought"],r),null!=(o=td(t,["inlineData"]))&&tp(n,["inlineData"],n_(o)),null!=(l=td(t,["fileData"]))&&tp(n,["fileData"],function(e){let t={};if(void 0!==td(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=td(e,["fileUri"]);null!=n&&tp(t,["fileUri"],n);let i=td(e,["mimeType"]);return null!=i&&tp(t,["mimeType"],i),t}(l)),null!=(s=td(t,["thoughtSignature"]))&&tp(n,["thoughtSignature"],s),null!=(a=td(t,["functionCall"]))&&tp(n,["functionCall"],a),null!=(u=td(t,["codeExecutionResult"]))&&tp(n,["codeExecutionResult"],u),null!=(p=td(t,["executableCode"]))&&tp(n,["executableCode"],p),null!=(d=td(t,["functionResponse"]))&&tp(n,["functionResponse"],d),null!=(c=td(t,["text"]))&&tp(n,["text"],c),n})),tp(t,["parts"],e)}let i=td(e,["role"]);return null!=i&&tp(t,["role"],i),t}(tW(h)));let f=td(e,["tools"]);if(void 0!==t&&null!=f){let e=tQ(f);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=td(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),tp(t,["functionDeclarations"],e)}if(void 0!==td(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let i=td(e,["googleSearch"]);null!=i&&tp(t,["googleSearch"],function(e){let t={},n=td(e,["timeRangeFilter"]);if(null!=n&&tp(t,["timeRangeFilter"],n),void 0!==td(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");return t}(i));let r=td(e,["googleSearchRetrieval"]);if(null!=r&&tp(t,["googleSearchRetrieval"],r),void 0!==td(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let o=td(e,["googleMaps"]);null!=o&&tp(t,["googleMaps"],function(e){let t={};if(void 0!==td(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let n=td(e,["enableWidget"]);return null!=n&&tp(t,["enableWidget"],n),t}(o));let l=td(e,["urlContext"]);null!=l&&tp(t,["urlContext"],l);let s=td(e,["computerUse"]);null!=s&&tp(t,["computerUse"],s);let a=td(e,["codeExecution"]);return null!=a&&tp(t,["codeExecution"],a),t})(tZ(e)))),tp(t,["setup","tools"],e)}let m=td(e,["sessionResumption"]);void 0!==t&&null!=m&&tp(t,["setup","sessionResumption"],function(e){let t={},n=td(e,["handle"]);if(null!=n&&tp(t,["handle"],n),void 0!==td(e,["transparent"]))throw Error("transparent parameter is not supported in Gemini API.");return t}(m));let g=td(e,["inputAudioTranscription"]);void 0!==t&&null!=g&&tp(t,["setup","inputAudioTranscription"],g);let y=td(e,["outputAudioTranscription"]);void 0!==t&&null!=y&&tp(t,["setup","outputAudioTranscription"],y);let _=td(e,["realtimeInputConfig"]);void 0!==t&&null!=_&&tp(t,["setup","realtimeInputConfig"],_);let v=td(e,["contextWindowCompression"]);void 0!==t&&null!=v&&tp(t,["setup","contextWindowCompression"],v);let E=td(e,["proactivity"]);return void 0!==t&&null!=E&&tp(t,["setup","proactivity"],E),{}}(n,e)),T=e}return delete T.config,E.send(JSON.stringify(T)),new nz(E,this.apiClient)}isCallableTool(e){return"callTool"in e&&"function"==typeof e.callTool}}let nK={turnComplete:!0};class nz{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(null!==t.turns&&void 0!==t.turns){let n=[];try{n=tY(t.turns),e.isVertexAI()||(n=n.map(e=>nE(e)))}catch(e){throw Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:n,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let n=[];if(null==t.functionResponses||0===(n=Array.isArray(t.functionResponses)?t.functionResponses:[t.functionResponses]).length)throw Error("functionResponses is required.");for(let t of n){if("object"!=typeof t||null===t||!("name"in t)||!("response"in t))throw Error(`Could not parse function response, type '${typeof t}'.`);if(!e.isVertexAI()&&!("id"in t))throw Error("FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.")}return{toolResponse:{functionResponses:n}}}sendClientContent(e){e=Object.assign(Object.assign({},nK),e);let t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};t=this.apiClient.isVertexAI()?{realtimeInput:function(e){let t={},n=td(e,["media"]);if(null!=n){let e=tL(n);Array.isArray(e)&&(e=e.map(e=>e)),tp(t,["mediaChunks"],e)}let i=td(e,["audio"]);null!=i&&tp(t,["audio"],tj(i));let r=td(e,["audioStreamEnd"]);null!=r&&tp(t,["audioStreamEnd"],r);let o=td(e,["video"]);null!=o&&tp(t,["video"],tG(o));let l=td(e,["text"]);null!=l&&tp(t,["text"],l);let s=td(e,["activityStart"]);null!=s&&tp(t,["activityStart"],s);let a=td(e,["activityEnd"]);return null!=a&&tp(t,["activityEnd"],a),t}(e)}:{realtimeInput:function(e){let t={},n=td(e,["media"]);if(null!=n){let e=tL(n);Array.isArray(e)&&(e=e.map(e=>n_(e))),tp(t,["mediaChunks"],e)}let i=td(e,["audio"]);null!=i&&tp(t,["audio"],n_(tj(i)));let r=td(e,["audioStreamEnd"]);null!=r&&tp(t,["audioStreamEnd"],r);let o=td(e,["video"]);null!=o&&tp(t,["video"],n_(tG(o)));let l=td(e,["text"]);null!=l&&tp(t,["text"],l);let s=td(e,["activityStart"]);null!=s&&tp(t,["activityStart"],s);let a=td(e,["activityEnd"]);return null!=a&&tp(t,["activityEnd"],a),t}(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(null==e.functionResponses)throw Error("Tool response parameters are required.");let t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}}function nX(e){var t,n,i;if(null==(t=null==e?void 0:e.automaticFunctionCalling)?void 0:t.disable)return!0;let r=!1;for(let t of null!=(n=null==e?void 0:e.tools)?n:[])if(nZ(t)){r=!0;break}if(!r)return!0;let o=null==(i=null==e?void 0:e.automaticFunctionCalling)?void 0:i.maximumRemoteCalls;return(!(!o||!(o<0)&&Number.isInteger(o))||0==o)&&(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",o),!0)}function nZ(e){return"callTool"in e&&"function"==typeof e.callTool}function nQ(e){var t;return!(null==(t=null==e?void 0:e.automaticFunctionCalling)?void 0:t.ignoreCallHistory)}class n0 extends ta{constructor(e){super(),this.apiClient=e,this.generateContent=async e=>{var t,n,i,r,o,l,s,a,u,p,d;let c,h,f=await this.processParamsMaybeAddMcpUsage(e);if(this.maybeMoveToResponseJsonSchem(e),!(null!=(a=null==(s=null==(l=e.config)?void 0:l.tools)?void 0:s.some(e=>nZ(e)))&&a)||nX(e.config))return await this.generateContentInternal(f);if(null!=(d=null==(p=null==(u=e.config)?void 0:u.tools)?void 0:p.some(e=>!nZ(e)))&&d)throw Error("Automatic function calling with CallableTools and Tools is not yet supported.");let m=tY(f.contents),g=null!=(i=null==(n=null==(t=f.config)?void 0:t.automaticFunctionCalling)?void 0:n.maximumRemoteCalls)?i:10,y=0;for(;y<g&&(c=await this.generateContentInternal(f)).functionCalls&&0!==c.functionCalls.length;){let t=c.candidates[0].content,n=[];for(let t of null!=(o=null==(r=e.config)?void 0:r.tools)?o:[])if(nZ(t)){let e=await t.callTool(c.functionCalls);n.push(...e)}y++,h={role:"user",parts:n},f.contents=tY(f.contents),f.contents.push(t),f.contents.push(h),nQ(f.config)&&(m.push(t),m.push(h))}return nQ(f.config)&&(c.automaticFunctionCallingHistory=m),c},this.generateContentStream=async e=>{if(this.maybeMoveToResponseJsonSchem(e),!nX(e.config))return await this.processAfcStream(e);{let t=await this.processParamsMaybeAddMcpUsage(e);return await this.generateContentStreamInternal(t)}},this.generateImages=async e=>await this.generateImagesInternal(e).then(e=>{var t;let n,i=[];if(null==e?void 0:e.generatedImages)for(let r of e.generatedImages)r&&(null==r?void 0:r.safetyAttributes)&&(null==(t=null==r?void 0:r.safetyAttributes)?void 0:t.contentType)==="Positive Prompt"?n=null==r?void 0:r.safetyAttributes:i.push(r);return n?{generatedImages:i,positivePromptSafetyAttributes:n,sdkHttpResponse:e.sdkHttpResponse}:{generatedImages:i,sdkHttpResponse:e.sdkHttpResponse}}),this.list=async e=>{var t;let n={config:Object.assign(Object.assign({},{queryBase:!0}),null==e?void 0:e.config)};if(this.apiClient.isVertexAI()&&!n.config.queryBase)if(null==(t=n.config)?void 0:t.filter)throw Error("Filtering tuned models list for Vertex AI is not currently supported");else n.config.filter="labels.tune-type:*";return new no(eY.PAGED_ITEM_MODELS,e=>this.listInternal(e),await this.listInternal(n),n)},this.editImage=async e=>{let t={model:e.model,prompt:e.prompt,referenceImages:[],config:e.config};return e.referenceImages&&e.referenceImages&&(t.referenceImages=e.referenceImages.map(e=>e.toReferenceImageAPI())),await this.editImageInternal(t)},this.upscaleImage=async e=>{let t={numberOfImages:1,mode:"upscale"};e.config&&(t=Object.assign(Object.assign({},t),e.config));let n={model:e.model,image:e.image,upscaleFactor:e.upscaleFactor,config:t};return await this.upscaleImageInternal(n)},this.generateVideos=async e=>{var t,n,i,r,o,l;if((e.prompt||e.image||e.video)&&e.source)throw Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return!this.apiClient.isVertexAI()&&((null==(t=e.video)?void 0:t.uri)&&(null==(n=e.video)?void 0:n.videoBytes)?e.video={uri:e.video.uri,mimeType:e.video.mimeType}:(null==(r=null==(i=e.source)?void 0:i.video)?void 0:r.uri)&&(null==(l=null==(o=e.source)?void 0:o.video)?void 0:l.videoBytes)&&(e.source.video={uri:e.source.video.uri,mimeType:e.source.video.mimeType})),await this.generateVideosInternal(e)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&!e.config.responseJsonSchema&&Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema)}async processParamsMaybeAddMcpUsage(e){var t,n,i;let r=null==(t=e.config)?void 0:t.tools;if(!r)return e;let o=await Promise.all(r.map(async e=>nZ(e)?await e.tool():e)),l={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:o})};if(l.config.tools=o,e.config&&e.config.tools&&nF(e.config.tools)){let t=Object.assign({},null!=(i=null==(n=e.config.httpOptions)?void 0:n.headers)?i:{});0===Object.keys(t).length&&(t=this.apiClient.getDefaultHeaders()),nB(t),l.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:t})}return l}async initAfcToolsMap(e){var t,n,i;let r=new Map;for(let o of null!=(n=null==(t=e.config)?void 0:t.tools)?n:[])if(nZ(o))for(let e of null!=(i=(await o.tool()).functionDeclarations)?i:[]){if(!e.name)throw Error("Function declaration name is required.");if(r.has(e.name))throw Error(`Duplicate tool declaration name: ${e.name}`);r.set(e.name,o)}return r}async processAfcStream(e){var t,n,i;let r=null!=(i=null==(n=null==(t=e.config)?void 0:t.automaticFunctionCalling)?void 0:n.maximumRemoteCalls)?i:10,o=!1,l=0;return function(e,t,n){var i,s;return np(this,arguments,function*(){for(var a,u,p,d;l<r;){o&&(l++,o=!1);let m=yield nu(e.processParamsMaybeAddMcpUsage(n)),g=yield nu(e.generateContentStreamInternal(m)),y=[],_=[];try{for(var c,h=!0,f=(u=void 0,nd(g));!(a=(c=yield nu(f.next())).done);h=!0)if(d=c.value,h=!1,yield yield nu(d),d.candidates&&(null==(i=d.candidates[0])?void 0:i.content)){for(let e of(_.push(d.candidates[0].content),null!=(s=d.candidates[0].content.parts)?s:[]))if(l<r&&e.functionCall){if(!e.functionCall.name)throw Error("Function call name was not returned by the model.");if(t.has(e.functionCall.name)){let n=yield nu(t.get(e.functionCall.name).callTool([e.functionCall]));y.push(...n)}else throw Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${t.keys()}, mising tool: ${e.functionCall.name}`)}}}catch(e){u={error:e}}finally{try{!h&&!a&&(p=f.return)&&(yield nu(p.call(f)))}finally{if(u)throw u.error}}if(y.length>0){o=!0;let e=new tf;e.candidates=[{content:{role:"user",parts:y}}],yield yield nu(e);let t=[];t.push(..._),t.push({role:"user",parts:y});let i=tY(n.contents).concat(t);n.contents=i}else break}})}(this,await this.initAfcToolsMap(e),e)}async generateContentInternal(e){var t,n,i,r;let o="",l={};if(this.apiClient.isVertexAI()){let i=nT(this.apiClient,e);return o=tu("{model}:generateContent",i._url),l=i._query,delete i._url,delete i._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(i),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=nO(e),n=new tf;return Object.assign(n,t),n})}{let t=nS(this.apiClient,e);return o=tu("{model}:generateContent",t._url),l=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=nb(e),n=new tf;return Object.assign(n,t),n})}}async generateContentStreamInternal(e){var t,n,i,r;let o="",l={};if(this.apiClient.isVertexAI()){let i=nT(this.apiClient,e);return o=tu("{model}:streamGenerateContent?alt=sse",i._url),l=i._query,delete i._url,delete i._query,this.apiClient.requestStream({path:o,queryParams:l,body:JSON.stringify(i),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(function(e){return np(this,arguments,function*(){var t,n,i,r;try{for(var o,l=!0,s=nd(e);!(t=(o=yield nu(s.next())).done);l=!0){r=o.value,l=!1;let e=nO((yield nu(r.json())));e.sdkHttpResponse={headers:r.headers};let t=new tf;Object.assign(t,e),yield yield nu(t)}}catch(e){n={error:e}}finally{try{!l&&!t&&(i=s.return)&&(yield nu(i.call(s)))}finally{if(n)throw n.error}}})})}{let t=nS(this.apiClient,e);return o=tu("{model}:streamGenerateContent?alt=sse",t._url),l=t._query,delete t._url,delete t._query,this.apiClient.requestStream({path:o,queryParams:l,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(function(e){return np(this,arguments,function*(){var t,n,i,r;try{for(var o,l=!0,s=nd(e);!(t=(o=yield nu(s.next())).done);l=!0){r=o.value,l=!1;let e=nb((yield nu(r.json())));e.sdkHttpResponse={headers:r.headers};let t=new tf;Object.assign(t,e),yield yield nu(t)}}catch(e){n={error:e}}finally{try{!l&&!t&&(i=s.return)&&(yield nu(i.call(s)))}finally{if(n)throw n.error}}})})}}async embedContent(e){var t,n,i,r;let o="",l={};if(this.apiClient.isVertexAI()){let i=function(e,t){let n,i,r,o,l,s={},a=td(t,["model"]);null!=a&&tp(s,["_url","model"],tD(e,a));let u=td(t,["contents"]);if(null!=u){let t=t$(e,u);Array.isArray(t)&&(t=t.map(e=>e)),tp(s,["instances[]","content"],t)}let p=td(t,["config"]);return null!=p&&(n=td(p,["taskType"]),void 0!==s&&null!=n&&tp(s,["instances[]","task_type"],n),i=td(p,["title"]),void 0!==s&&null!=i&&tp(s,["instances[]","title"],i),r=td(p,["outputDimensionality"]),void 0!==s&&null!=r&&tp(s,["parameters","outputDimensionality"],r),o=td(p,["mimeType"]),void 0!==s&&null!=o&&tp(s,["instances[]","mimeType"],o),l=td(p,["autoTruncate"]),void 0!==s&&null!=l&&tp(s,["parameters","autoTruncate"],l)),s}(this.apiClient,e);return o=tu("{model}:predict",i._url),l=i._query,delete i._url,delete i._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(i),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=td(e,["sdkHttpResponse"]);null!=n&&tp(t,["sdkHttpResponse"],n);let i=td(e,["predictions[]","embeddings"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,r,o,l,s;return n={},null!=(i=td(e,["values"]))&&tp(n,["values"],i),null!=(r=td(e,["statistics"]))&&tp(n,["statistics"],(o={},null!=(l=td(t=r,["truncated"]))&&tp(o,["truncated"],l),null!=(s=td(t,["token_count"]))&&tp(o,["tokenCount"],s),o)),n})),tp(t,["embeddings"],e)}let r=td(e,["metadata"]);return null!=r&&tp(t,["metadata"],r),t}(e),n=new tm;return Object.assign(n,t),n})}{let t=function(e,t){let n={},i=td(t,["model"]);null!=i&&tp(n,["_url","model"],tD(e,i));let r=td(t,["contents"]);if(null!=r){let t=t$(e,r);Array.isArray(t)&&(t=t.map(e=>e)),tp(n,["requests[]","content"],t)}let o=td(t,["config"]);null!=o&&function(e,t){let n=td(e,["taskType"]);void 0!==t&&null!=n&&tp(t,["requests[]","taskType"],n);let i=td(e,["title"]);void 0!==t&&null!=i&&tp(t,["requests[]","title"],i);let r=td(e,["outputDimensionality"]);if(void 0!==t&&null!=r&&tp(t,["requests[]","outputDimensionality"],r),void 0!==td(e,["mimeType"]))throw Error("mimeType parameter is not supported in Gemini API.");if(void 0!==td(e,["autoTruncate"]))throw Error("autoTruncate parameter is not supported in Gemini API.")}(o,n);let l=td(t,["model"]);return void 0!==l&&tp(n,["requests[]","model"],tD(e,l)),n}(this.apiClient,e);return o=tu("{model}:batchEmbedContents",t._url),l=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=td(e,["sdkHttpResponse"]);null!=n&&tp(t,["sdkHttpResponse"],n);let i=td(e,["embeddings"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),tp(t,["embeddings"],e)}let r=td(e,["metadata"]);return null!=r&&tp(t,["metadata"],r),t}(e),n=new tm;return Object.assign(n,t),n})}}async generateImagesInternal(e){var t,n,i,r,o,l;let s="",a={};if(this.apiClient.isVertexAI()){let i,r,l,u,p,d,c,h,f,m,g,y,_,v,E,S,T,b,O,C,A,I=(o=this.apiClient,i={},null!=(r=td(e,["model"]))&&tp(i,["_url","model"],tD(o,r)),null!=(l=td(e,["prompt"]))&&tp(i,["instances[0]","prompt"],l),null!=(u=td(e,["config"]))&&(p=td(u,["outputGcsUri"]),void 0!==i&&null!=p&&tp(i,["parameters","storageUri"],p),d=td(u,["negativePrompt"]),void 0!==i&&null!=d&&tp(i,["parameters","negativePrompt"],d),c=td(u,["numberOfImages"]),void 0!==i&&null!=c&&tp(i,["parameters","sampleCount"],c),h=td(u,["aspectRatio"]),void 0!==i&&null!=h&&tp(i,["parameters","aspectRatio"],h),f=td(u,["guidanceScale"]),void 0!==i&&null!=f&&tp(i,["parameters","guidanceScale"],f),m=td(u,["seed"]),void 0!==i&&null!=m&&tp(i,["parameters","seed"],m),g=td(u,["safetyFilterLevel"]),void 0!==i&&null!=g&&tp(i,["parameters","safetySetting"],g),y=td(u,["personGeneration"]),void 0!==i&&null!=y&&tp(i,["parameters","personGeneration"],y),_=td(u,["includeSafetyAttributes"]),void 0!==i&&null!=_&&tp(i,["parameters","includeSafetyAttributes"],_),v=td(u,["includeRaiReason"]),void 0!==i&&null!=v&&tp(i,["parameters","includeRaiReason"],v),E=td(u,["language"]),void 0!==i&&null!=E&&tp(i,["parameters","language"],E),S=td(u,["outputMimeType"]),void 0!==i&&null!=S&&tp(i,["parameters","outputOptions","mimeType"],S),T=td(u,["outputCompressionQuality"]),void 0!==i&&null!=T&&tp(i,["parameters","outputOptions","compressionQuality"],T),b=td(u,["addWatermark"]),void 0!==i&&null!=b&&tp(i,["parameters","addWatermark"],b),O=td(u,["labels"]),void 0!==i&&null!=O&&tp(i,["labels"],O),C=td(u,["imageSize"]),void 0!==i&&null!=C&&tp(i,["parameters","sampleImageSize"],C),A=td(u,["enhancePrompt"]),void 0!==i&&null!=A&&tp(i,["parameters","enhancePrompt"],A)),i);return s=tu("{model}:predict",I._url),a=I._query,delete I._url,delete I._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(I),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=td(e,["sdkHttpResponse"]);null!=n&&tp(t,["sdkHttpResponse"],n);let i=td(e,["predictions"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>nC(e))),tp(t,["generatedImages"],e)}let r=td(e,["positivePromptSafetyAttributes"]);return null!=r&&tp(t,["positivePromptSafetyAttributes"],nw(r)),t}(e),n=new tg;return Object.assign(n,t),n})}{let t,n,o,u,p=(l=this.apiClient,t={},null!=(n=td(e,["model"]))&&tp(t,["_url","model"],tD(l,n)),null!=(o=td(e,["prompt"]))&&tp(t,["instances[0]","prompt"],o),null!=(u=td(e,["config"]))&&function(e,t){if(void 0!==td(e,["outputGcsUri"]))throw Error("outputGcsUri parameter is not supported in Gemini API.");if(void 0!==td(e,["negativePrompt"]))throw Error("negativePrompt parameter is not supported in Gemini API.");let n=td(e,["numberOfImages"]);void 0!==t&&null!=n&&tp(t,["parameters","sampleCount"],n);let i=td(e,["aspectRatio"]);void 0!==t&&null!=i&&tp(t,["parameters","aspectRatio"],i);let r=td(e,["guidanceScale"]);if(void 0!==t&&null!=r&&tp(t,["parameters","guidanceScale"],r),void 0!==td(e,["seed"]))throw Error("seed parameter is not supported in Gemini API.");let o=td(e,["safetyFilterLevel"]);void 0!==t&&null!=o&&tp(t,["parameters","safetySetting"],o);let l=td(e,["personGeneration"]);void 0!==t&&null!=l&&tp(t,["parameters","personGeneration"],l);let s=td(e,["includeSafetyAttributes"]);void 0!==t&&null!=s&&tp(t,["parameters","includeSafetyAttributes"],s);let a=td(e,["includeRaiReason"]);void 0!==t&&null!=a&&tp(t,["parameters","includeRaiReason"],a);let u=td(e,["language"]);void 0!==t&&null!=u&&tp(t,["parameters","language"],u);let p=td(e,["outputMimeType"]);void 0!==t&&null!=p&&tp(t,["parameters","outputOptions","mimeType"],p);let d=td(e,["outputCompressionQuality"]);if(void 0!==t&&null!=d&&tp(t,["parameters","outputOptions","compressionQuality"],d),void 0!==td(e,["addWatermark"]))throw Error("addWatermark parameter is not supported in Gemini API.");if(void 0!==td(e,["labels"]))throw Error("labels parameter is not supported in Gemini API.");let c=td(e,["imageSize"]);if(void 0!==t&&null!=c&&tp(t,["parameters","sampleImageSize"],c),void 0!==td(e,["enhancePrompt"]))throw Error("enhancePrompt parameter is not supported in Gemini API.")}(u,t),t);return s=tu("{model}:predict",p._url),a=p._query,delete p._url,delete p._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(p),httpMethod:"POST",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=td(e,["sdkHttpResponse"]);null!=n&&tp(t,["sdkHttpResponse"],n);let i=td(e,["predictions"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>{var t,n;let i,r,o,l,s,a,u;return i={},null!=(r=td(t=e,["_self"]))&&tp(i,["image"],(o={},null!=(l=td(n=r,["bytesBase64Encoded"]))&&tp(o,["imageBytes"],tc(l)),null!=(s=td(n,["mimeType"]))&&tp(o,["mimeType"],s),o)),null!=(a=td(t,["raiFilteredReason"]))&&tp(i,["raiFilteredReason"],a),null!=(u=td(t,["_self"]))&&tp(i,["safetyAttributes"],nP(u)),i})),tp(t,["generatedImages"],e)}let r=td(e,["positivePromptSafetyAttributes"]);return null!=r&&tp(t,["positivePromptSafetyAttributes"],nP(r)),t}(e),n=new tg;return Object.assign(n,t),n})}}async editImageInternal(e){var t,n;let i="",r={};if(this.apiClient.isVertexAI()){let o=function(e,t){let n,i,r,o,l,s,a,u,p,d,c,h,f,m,g,y,_,v={},E=td(t,["model"]);null!=E&&tp(v,["_url","model"],tD(e,E));let S=td(t,["prompt"]);null!=S&&tp(v,["instances[0]","prompt"],S);let T=td(t,["referenceImages"]);if(null!=T){let e=T;Array.isArray(e)&&(e=e.map(e=>(function(e){let t,n,i,r,o,l,s,a={},u=td(e,["referenceImage"]);null!=u&&tp(a,["referenceImage"],nx(u));let p=td(e,["referenceId"]);null!=p&&tp(a,["referenceId"],p);let d=td(e,["referenceType"]);null!=d&&tp(a,["referenceType"],d);let c=td(e,["maskImageConfig"]);null!=c&&tp(a,["maskImageConfig"],(t={},null!=(n=td(c,["maskMode"]))&&tp(t,["maskMode"],n),null!=(i=td(c,["segmentationClasses"]))&&tp(t,["maskClasses"],i),null!=(r=td(c,["maskDilation"]))&&tp(t,["dilation"],r),t));let h=td(e,["controlImageConfig"]);null!=h&&tp(a,["controlImageConfig"],(o={},null!=(l=td(h,["controlType"]))&&tp(o,["controlType"],l),null!=(s=td(h,["enableControlImageComputation"]))&&tp(o,["computeControl"],s),o));let f=td(e,["styleImageConfig"]);null!=f&&tp(a,["styleImageConfig"],f);let m=td(e,["subjectImageConfig"]);return null!=m&&tp(a,["subjectImageConfig"],m),a})(e))),tp(v,["instances[0]","referenceImages"],e)}let b=td(t,["config"]);return null!=b&&(n=td(b,["outputGcsUri"]),void 0!==v&&null!=n&&tp(v,["parameters","storageUri"],n),i=td(b,["negativePrompt"]),void 0!==v&&null!=i&&tp(v,["parameters","negativePrompt"],i),r=td(b,["numberOfImages"]),void 0!==v&&null!=r&&tp(v,["parameters","sampleCount"],r),o=td(b,["aspectRatio"]),void 0!==v&&null!=o&&tp(v,["parameters","aspectRatio"],o),l=td(b,["guidanceScale"]),void 0!==v&&null!=l&&tp(v,["parameters","guidanceScale"],l),s=td(b,["seed"]),void 0!==v&&null!=s&&tp(v,["parameters","seed"],s),a=td(b,["safetyFilterLevel"]),void 0!==v&&null!=a&&tp(v,["parameters","safetySetting"],a),u=td(b,["personGeneration"]),void 0!==v&&null!=u&&tp(v,["parameters","personGeneration"],u),p=td(b,["includeSafetyAttributes"]),void 0!==v&&null!=p&&tp(v,["parameters","includeSafetyAttributes"],p),d=td(b,["includeRaiReason"]),void 0!==v&&null!=d&&tp(v,["parameters","includeRaiReason"],d),c=td(b,["language"]),void 0!==v&&null!=c&&tp(v,["parameters","language"],c),h=td(b,["outputMimeType"]),void 0!==v&&null!=h&&tp(v,["parameters","outputOptions","mimeType"],h),f=td(b,["outputCompressionQuality"]),void 0!==v&&null!=f&&tp(v,["parameters","outputOptions","compressionQuality"],f),m=td(b,["addWatermark"]),void 0!==v&&null!=m&&tp(v,["parameters","addWatermark"],m),g=td(b,["labels"]),void 0!==v&&null!=g&&tp(v,["labels"],g),y=td(b,["editMode"]),void 0!==v&&null!=y&&tp(v,["parameters","editMode"],y),_=td(b,["baseSteps"]),void 0!==v&&null!=_&&tp(v,["parameters","editConfig","baseSteps"],_)),v}(this.apiClient,e);return i=tu("{model}:predict",o._url),r=o._query,delete o._url,delete o._query,this.apiClient.request({path:i,queryParams:r,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=td(e,["sdkHttpResponse"]);null!=n&&tp(t,["sdkHttpResponse"],n);let i=td(e,["predictions"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>nC(e))),tp(t,["generatedImages"],e)}return t}(e),n=new ty;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,n,i;let r="",o={};if(this.apiClient.isVertexAI()){let l,s,a,u,p,d,c,h,f,m,g,y,_,v,E=(i=this.apiClient,l={},null!=(s=td(e,["model"]))&&tp(l,["_url","model"],tD(i,s)),null!=(a=td(e,["image"]))&&tp(l,["instances[0]","image"],nx(a)),null!=(u=td(e,["upscaleFactor"]))&&tp(l,["parameters","upscaleConfig","upscaleFactor"],u),null!=(p=td(e,["config"]))&&(d=td(p,["outputGcsUri"]),void 0!==l&&null!=d&&tp(l,["parameters","storageUri"],d),c=td(p,["includeRaiReason"]),void 0!==l&&null!=c&&tp(l,["parameters","includeRaiReason"],c),h=td(p,["outputMimeType"]),void 0!==l&&null!=h&&tp(l,["parameters","outputOptions","mimeType"],h),f=td(p,["outputCompressionQuality"]),void 0!==l&&null!=f&&tp(l,["parameters","outputOptions","compressionQuality"],f),m=td(p,["enhanceInputImage"]),void 0!==l&&null!=m&&tp(l,["parameters","upscaleConfig","enhanceInputImage"],m),g=td(p,["imagePreservationFactor"]),void 0!==l&&null!=g&&tp(l,["parameters","upscaleConfig","imagePreservationFactor"],g),y=td(p,["labels"]),void 0!==l&&null!=y&&tp(l,["labels"],y),_=td(p,["numberOfImages"]),void 0!==l&&null!=_&&tp(l,["parameters","sampleCount"],_),v=td(p,["mode"]),void 0!==l&&null!=v&&tp(l,["parameters","mode"],v)),l);return r=tu("{model}:predict",E._url),o=E._query,delete E._url,delete E._query,this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(E),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=td(e,["sdkHttpResponse"]);null!=n&&tp(t,["sdkHttpResponse"],n);let i=td(e,["predictions"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>nC(e))),tp(t,["generatedImages"],e)}return t}(e),n=new t_;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,n,i;let r="",o={};if(this.apiClient.isVertexAI()){let l,s,a,u,p,d,c,h,f,m,g,y,_,v,E,S=(i=this.apiClient,l={},null!=(s=td(e,["model"]))&&tp(l,["_url","model"],tD(i,s)),null!=(a=td(e,["source"]))&&function(e,t){let n=td(e,["prompt"]);void 0!==t&&null!=n&&tp(t,["instances[0]","prompt"],n);let i=td(e,["personImage"]);void 0!==t&&null!=i&&tp(t,["instances[0]","personImage","image"],nx(i));let r=td(e,["productImages"]);if(void 0!==t&&null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>{let t,n;return t={},null!=(n=td(e,["productImage"]))&&tp(t,["image"],nx(n)),t})),tp(t,["instances[0]","productImages"],e)}}(a,l),null!=(u=td(e,["config"]))&&(p=td(u,["numberOfImages"]),void 0!==l&&null!=p&&tp(l,["parameters","sampleCount"],p),d=td(u,["baseSteps"]),void 0!==l&&null!=d&&tp(l,["parameters","editConfig","baseSteps"],d),c=td(u,["outputGcsUri"]),void 0!==l&&null!=c&&tp(l,["parameters","storageUri"],c),h=td(u,["seed"]),void 0!==l&&null!=h&&tp(l,["parameters","seed"],h),f=td(u,["safetyFilterLevel"]),void 0!==l&&null!=f&&tp(l,["parameters","safetySetting"],f),m=td(u,["personGeneration"]),void 0!==l&&null!=m&&tp(l,["parameters","personGeneration"],m),g=td(u,["addWatermark"]),void 0!==l&&null!=g&&tp(l,["parameters","addWatermark"],g),y=td(u,["outputMimeType"]),void 0!==l&&null!=y&&tp(l,["parameters","outputOptions","mimeType"],y),_=td(u,["outputCompressionQuality"]),void 0!==l&&null!=_&&tp(l,["parameters","outputOptions","compressionQuality"],_),v=td(u,["enhancePrompt"]),void 0!==l&&null!=v&&tp(l,["parameters","enhancePrompt"],v),E=td(u,["labels"]),void 0!==l&&null!=E&&tp(l,["labels"],E)),l);return r=tu("{model}:predict",S._url),o=S._query,delete S._url,delete S._query,this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(S),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},n=td(e,["predictions"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>nC(e))),tp(t,["generatedImages"],e)}return t}(e),n=new tv;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var t,n,i,r,o;let l="",s={};if(this.apiClient.isVertexAI()){let a,u,p,d,c,h,f,m,g,y,_,v,E,S,T,b=(i=this.apiClient,h={},null!=(f=td(e,["model"]))&&tp(h,["_url","model"],tD(i,f)),null!=(m=td(e,["source"]))&&(r=m,o=h,p=td(r,["prompt"]),void 0!==o&&null!=p&&tp(o,["instances[0]","prompt"],p),d=td(r,["image"]),void 0!==o&&null!=d&&tp(o,["instances[0]","image"],nx(d)),c=td(r,["scribbleImage"]),void 0!==o&&null!=c&&tp(o,["instances[0]","scribble"],(a={},null!=(u=td(c,["image"]))&&tp(a,["image"],nx(u)),a))),null!=(g=td(e,["config"]))&&(y=td(g,["mode"]),void 0!==h&&null!=y&&tp(h,["parameters","mode"],y),_=td(g,["maxPredictions"]),void 0!==h&&null!=_&&tp(h,["parameters","maxPredictions"],_),v=td(g,["confidenceThreshold"]),void 0!==h&&null!=v&&tp(h,["parameters","confidenceThreshold"],v),E=td(g,["maskDilation"]),void 0!==h&&null!=E&&tp(h,["parameters","maskDilation"],E),S=td(g,["binaryColorThreshold"]),void 0!==h&&null!=S&&tp(h,["parameters","binaryColorThreshold"],S),T=td(g,["labels"]),void 0!==h&&null!=T&&tp(h,["labels"],T)),h);return l=tu("{model}:predict",b._url),s=b._query,delete b._url,delete b._query,this.apiClient.request({path:l,queryParams:s,body:JSON.stringify(b),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},n=td(e,["predictions"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=td(e,["_self"]);null!=n&&tp(t,["mask"],nA(n));let i=td(e,["labels"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),tp(t,["labels"],e)}return t})(e))),tp(t,["generatedMasks"],e)}return t}(e),n=new tE;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async get(e){var t,n,i,r,o,l;let s="",a={};if(this.apiClient.isVertexAI()){let i,r,l=(o=this.apiClient,i={},null!=(r=td(e,["model"]))&&tp(i,["_url","name"],tD(o,r)),i);return s=tu("{name}",l._url),a=l._query,delete l._url,delete l._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(l),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>nN(e))}{let t,n,o=(l=this.apiClient,t={},null!=(n=td(e,["model"]))&&tp(t,["_url","name"],tD(l,n)),t);return s=tu("{name}",o._url),a=o._query,delete o._url,delete o._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json()).then(e=>nR(e))}}async listInternal(e){var t,n,i,r,o,l;let s="",a={};if(this.apiClient.isVertexAI()){let i,r,l,u,p,d,c=(o=this.apiClient,i={},null!=(r=td(e,["config"]))&&(l=td(r,["pageSize"]),void 0!==i&&null!=l&&tp(i,["_query","pageSize"],l),u=td(r,["pageToken"]),void 0!==i&&null!=u&&tp(i,["_query","pageToken"],u),p=td(r,["filter"]),void 0!==i&&null!=p&&tp(i,["_query","filter"],p),d=td(r,["queryBase"]),void 0!==i&&null!=d&&tp(i,["_url","models_url"],t7(o,d))),i);return s=tu("{models_url}",c._url),a=c._query,delete c._url,delete c._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(c),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=td(e,["sdkHttpResponse"]);null!=n&&tp(t,["sdkHttpResponse"],n);let i=td(e,["nextPageToken"]);null!=i&&tp(t,["nextPageToken"],i);let r=td(e,["_self"]);if(null!=r){let e=t9(r);Array.isArray(e)&&(e=e.map(e=>nN(e))),tp(t,["models"],e)}return t}(e),n=new tS;return Object.assign(n,t),n})}{let t,n,o,u,p,d,c=(l=this.apiClient,t={},null!=(n=td(e,["config"]))&&(o=td(n,["pageSize"]),void 0!==t&&null!=o&&tp(t,["_query","pageSize"],o),u=td(n,["pageToken"]),void 0!==t&&null!=u&&tp(t,["_query","pageToken"],u),p=td(n,["filter"]),void 0!==t&&null!=p&&tp(t,["_query","filter"],p),d=td(n,["queryBase"]),void 0!==t&&null!=d&&tp(t,["_url","models_url"],t7(l,d))),t);return s=tu("{models_url}",c._url),a=c._query,delete c._url,delete c._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(c),httpMethod:"GET",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=td(e,["sdkHttpResponse"]);null!=n&&tp(t,["sdkHttpResponse"],n);let i=td(e,["nextPageToken"]);null!=i&&tp(t,["nextPageToken"],i);let r=td(e,["_self"]);if(null!=r){let e=t9(r);Array.isArray(e)&&(e=e.map(e=>nR(e))),tp(t,["models"],e)}return t}(e),n=new tS;return Object.assign(n,t),n})}}async update(e){var t,n,i,r,o,l;let s="",a={};if(this.apiClient.isVertexAI()){let i,r,l,u,p,d,c=(o=this.apiClient,i={},null!=(r=td(e,["model"]))&&tp(i,["_url","model"],tD(o,r)),null!=(l=td(e,["config"]))&&(u=td(l,["displayName"]),void 0!==i&&null!=u&&tp(i,["displayName"],u),p=td(l,["description"]),void 0!==i&&null!=p&&tp(i,["description"],p),d=td(l,["defaultCheckpointId"]),void 0!==i&&null!=d&&tp(i,["defaultCheckpointId"],d)),i);return s=tu("{model}",c._url),a=c._query,delete c._url,delete c._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>nN(e))}{let t,n,o,u,p,d,c=(l=this.apiClient,t={},null!=(n=td(e,["model"]))&&tp(t,["_url","name"],tD(l,n)),null!=(o=td(e,["config"]))&&(u=td(o,["displayName"]),void 0!==t&&null!=u&&tp(t,["displayName"],u),p=td(o,["description"]),void 0!==t&&null!=p&&tp(t,["description"],p),d=td(o,["defaultCheckpointId"]),void 0!==t&&null!=d&&tp(t,["defaultCheckpointId"],d)),t);return s=tu("{name}",c._url),a=c._query,delete c._url,delete c._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json()).then(e=>nR(e))}}async delete(e){var t,n,i,r,o,l;let s="",a={};if(this.apiClient.isVertexAI()){let i,r,l=(o=this.apiClient,i={},null!=(r=td(e,["model"]))&&tp(i,["_url","name"],tD(o,r)),i);return s=tu("{name}",l._url),a=l._query,delete l._url,delete l._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(l),httpMethod:"DELETE",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i=(t={},null!=(n=td(e,["sdkHttpResponse"]))&&tp(t,["sdkHttpResponse"],n),t),r=new tT;return Object.assign(r,i),r})}{let t,n,o=(l=this.apiClient,t={},null!=(n=td(e,["model"]))&&tp(t,["_url","name"],tD(l,n)),t);return s=tu("{name}",o._url),a=o._query,delete o._url,delete o._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i=(t={},null!=(n=td(e,["sdkHttpResponse"]))&&tp(t,["sdkHttpResponse"],n),t),r=new tT;return Object.assign(r,i),r})}}async countTokens(e){var t,n,i,r;let o="",l={};if(this.apiClient.isVertexAI()){let i=function(e,t){let n={},i=td(t,["model"]);null!=i&&tp(n,["_url","model"],tD(e,i));let r=td(t,["contents"]);if(null!=r){let e=tY(r);Array.isArray(e)&&(e=e.map(e=>e)),tp(n,["contents"],e)}let o=td(t,["config"]);return null!=o&&function(e,t){let n=td(e,["systemInstruction"]);void 0!==t&&null!=n&&tp(t,["systemInstruction"],tW(n));let i=td(e,["tools"]);if(void 0!==t&&null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>nk(e))),tp(t,["tools"],e)}let r=td(e,["generationConfig"]);void 0!==t&&null!=r&&tp(t,["generationConfig"],function(e){let t={},n=td(e,["modelSelectionConfig"]);null!=n&&tp(t,["modelConfig"],n);let i=td(e,["audioTimestamp"]);null!=i&&tp(t,["audioTimestamp"],i);let r=td(e,["candidateCount"]);null!=r&&tp(t,["candidateCount"],r);let o=td(e,["enableAffectiveDialog"]);null!=o&&tp(t,["enableAffectiveDialog"],o);let l=td(e,["frequencyPenalty"]);null!=l&&tp(t,["frequencyPenalty"],l);let s=td(e,["logprobs"]);null!=s&&tp(t,["logprobs"],s);let a=td(e,["maxOutputTokens"]);null!=a&&tp(t,["maxOutputTokens"],a);let u=td(e,["mediaResolution"]);null!=u&&tp(t,["mediaResolution"],u);let p=td(e,["presencePenalty"]);null!=p&&tp(t,["presencePenalty"],p);let d=td(e,["responseJsonSchema"]);null!=d&&tp(t,["responseJsonSchema"],d);let c=td(e,["responseLogprobs"]);null!=c&&tp(t,["responseLogprobs"],c);let h=td(e,["responseMimeType"]);null!=h&&tp(t,["responseMimeType"],h);let f=td(e,["responseModalities"]);null!=f&&tp(t,["responseModalities"],f);let m=td(e,["responseSchema"]);null!=m&&tp(t,["responseSchema"],m);let g=td(e,["routingConfig"]);null!=g&&tp(t,["routingConfig"],g);let y=td(e,["seed"]);null!=y&&tp(t,["seed"],y);let _=td(e,["speechConfig"]);null!=_&&tp(t,["speechConfig"],nM(_));let v=td(e,["stopSequences"]);null!=v&&tp(t,["stopSequences"],v);let E=td(e,["temperature"]);null!=E&&tp(t,["temperature"],E);let S=td(e,["thinkingConfig"]);null!=S&&tp(t,["thinkingConfig"],S);let T=td(e,["topK"]);null!=T&&tp(t,["topK"],T);let b=td(e,["topP"]);if(null!=b&&tp(t,["topP"],b),void 0!==td(e,["enableEnhancedCivicAnswers"]))throw Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}(r))}(o,n),n}(this.apiClient,e);return o=tu("{model}:countTokens",i._url),l=i._query,delete i._url,delete i._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(i),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i,r=(t={},null!=(n=td(e,["sdkHttpResponse"]))&&tp(t,["sdkHttpResponse"],n),null!=(i=td(e,["totalTokens"]))&&tp(t,["totalTokens"],i),t),o=new tb;return Object.assign(o,r),o})}{let t=function(e,t){let n={},i=td(t,["model"]);null!=i&&tp(n,["_url","model"],tD(e,i));let r=td(t,["contents"]);if(null!=r){let e=tY(r);Array.isArray(e)&&(e=e.map(e=>nE(e))),tp(n,["contents"],e)}let o=td(t,["config"]);return null!=o&&function(e){if(void 0!==td(e,["systemInstruction"]))throw Error("systemInstruction parameter is not supported in Gemini API.");if(void 0!==td(e,["tools"]))throw Error("tools parameter is not supported in Gemini API.");if(void 0!==td(e,["generationConfig"]))throw Error("generationConfig parameter is not supported in Gemini API.")}(o),n}(this.apiClient,e);return o=tu("{model}:countTokens",t._url),l=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i,r,o=(t={},null!=(n=td(e,["sdkHttpResponse"]))&&tp(t,["sdkHttpResponse"],n),null!=(i=td(e,["totalTokens"]))&&tp(t,["totalTokens"],i),null!=(r=td(e,["cachedContentTokenCount"]))&&tp(t,["cachedContentTokenCount"],r),t),l=new tb;return Object.assign(l,o),l})}}async computeTokens(e){var t,n;let i="",r={};if(this.apiClient.isVertexAI()){let o=function(e,t){let n={},i=td(t,["model"]);null!=i&&tp(n,["_url","model"],tD(e,i));let r=td(t,["contents"]);if(null!=r){let e=tY(r);Array.isArray(e)&&(e=e.map(e=>e)),tp(n,["contents"],e)}return n}(this.apiClient,e);return i=tu("{model}:computeTokens",o._url),r=o._query,delete o._url,delete o._query,this.apiClient.request({path:i,queryParams:r,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=td(e,["sdkHttpResponse"]);null!=n&&tp(t,["sdkHttpResponse"],n);let i=td(e,["tokensInfo"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),tp(t,["tokensInfo"],e)}return t}(e),n=new tO;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,n,i,r,o,l,s,a,u,p;let d="",c={};if(this.apiClient.isVertexAI()){let i,r,l,u,p,h,f,m,g,y,_=(o=this.apiClient,u={},null!=(p=td(e,["model"]))&&tp(u,["_url","model"],tD(o,p)),null!=(h=td(e,["prompt"]))&&tp(u,["instances[0]","prompt"],h),null!=(f=td(e,["image"]))&&tp(u,["instances[0]","image"],nx(f)),null!=(m=td(e,["video"]))&&tp(u,["instances[0]","video"],nU(m)),null!=(g=td(e,["source"]))&&(s=g,a=u,i=td(s,["prompt"]),void 0!==a&&null!=i&&tp(a,["instances[0]","prompt"],i),r=td(s,["image"]),void 0!==a&&null!=r&&tp(a,["instances[0]","image"],nx(r)),l=td(s,["video"]),void 0!==a&&null!=l&&tp(a,["instances[0]","video"],nU(l))),null!=(y=td(e,["config"]))&&function(e,t){var n;let i,r,o,l=td(e,["numberOfVideos"]);void 0!==t&&null!=l&&tp(t,["parameters","sampleCount"],l);let s=td(e,["outputGcsUri"]);void 0!==t&&null!=s&&tp(t,["parameters","storageUri"],s);let a=td(e,["fps"]);void 0!==t&&null!=a&&tp(t,["parameters","fps"],a);let u=td(e,["durationSeconds"]);void 0!==t&&null!=u&&tp(t,["parameters","durationSeconds"],u);let p=td(e,["seed"]);void 0!==t&&null!=p&&tp(t,["parameters","seed"],p);let d=td(e,["aspectRatio"]);void 0!==t&&null!=d&&tp(t,["parameters","aspectRatio"],d);let c=td(e,["resolution"]);void 0!==t&&null!=c&&tp(t,["parameters","resolution"],c);let h=td(e,["personGeneration"]);void 0!==t&&null!=h&&tp(t,["parameters","personGeneration"],h);let f=td(e,["pubsubTopic"]);void 0!==t&&null!=f&&tp(t,["parameters","pubsubTopic"],f);let m=td(e,["negativePrompt"]);void 0!==t&&null!=m&&tp(t,["parameters","negativePrompt"],m);let g=td(e,["enhancePrompt"]);void 0!==t&&null!=g&&tp(t,["parameters","enhancePrompt"],g);let y=td(e,["generateAudio"]);void 0!==t&&null!=y&&tp(t,["parameters","generateAudio"],y);let _=td(e,["lastFrame"]);void 0!==t&&null!=_&&tp(t,["instances[0]","lastFrame"],nx(_));let v=td(e,["referenceImages"]);if(void 0!==t&&null!=v){let e=v;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,r;return n={},null!=(i=td(t=e,["image"]))&&tp(n,["image"],nx(i)),null!=(r=td(t,["referenceType"]))&&tp(n,["referenceType"],r),n})),tp(t,["instances[0]","referenceImages"],e)}let E=td(e,["mask"]);void 0!==t&&null!=E&&tp(t,["instances[0]","mask"],(i={},null!=(r=td(n=E,["image"]))&&tp(i,["_self"],nx(r)),null!=(o=td(n,["maskMode"]))&&tp(i,["maskMode"],o),i));let S=td(e,["compressionQuality"]);void 0!==t&&null!=S&&tp(t,["parameters","compressionQuality"],S)}(y,u),u);return d=tu("{model}:predictLongRunning",_._url),c=_._query,delete _._url,delete _._query,this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(_),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t,n,i,r,o,l,s=(t={},null!=(n=td(e,["name"]))&&tp(t,["name"],n),null!=(i=td(e,["metadata"]))&&tp(t,["metadata"],i),null!=(r=td(e,["done"]))&&tp(t,["done"],r),null!=(o=td(e,["error"]))&&tp(t,["error"],o),null!=(l=td(e,["response"]))&&tp(t,["response"],function(e){let t={},n=td(e,["videos"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,r,o,l,s;return n={},null!=(i=td(e,["_self"]))&&tp(n,["video"],(r={},null!=(o=td(t=i,["gcsUri"]))&&tp(r,["uri"],o),null!=(l=td(t,["bytesBase64Encoded"]))&&tp(r,["videoBytes"],tc(l)),null!=(s=td(t,["mimeType"]))&&tp(r,["mimeType"],s),r)),n})),tp(t,["generatedVideos"],e)}let i=td(e,["raiMediaFilteredCount"]);null!=i&&tp(t,["raiMediaFilteredCount"],i);let r=td(e,["raiMediaFilteredReasons"]);return null!=r&&tp(t,["raiMediaFilteredReasons"],r),t}(l)),t),a=new tC;return Object.assign(a,s),a})}{let t,n,o,s,a,h,f,m,g,y,_=(l=this.apiClient,s={},null!=(a=td(e,["model"]))&&tp(s,["_url","model"],tD(l,a)),null!=(h=td(e,["prompt"]))&&tp(s,["instances[0]","prompt"],h),null!=(f=td(e,["image"]))&&tp(s,["instances[0]","image"],nI(f)),null!=(m=td(e,["video"]))&&tp(s,["instances[0]","video"],nD(m)),null!=(g=td(e,["source"]))&&(u=g,p=s,t=td(u,["prompt"]),void 0!==p&&null!=t&&tp(p,["instances[0]","prompt"],t),n=td(u,["image"]),void 0!==p&&null!=n&&tp(p,["instances[0]","image"],nI(n)),o=td(u,["video"]),void 0!==p&&null!=o&&tp(p,["instances[0]","video"],nD(o))),null!=(y=td(e,["config"]))&&function(e,t){let n=td(e,["numberOfVideos"]);if(void 0!==t&&null!=n&&tp(t,["parameters","sampleCount"],n),void 0!==td(e,["outputGcsUri"]))throw Error("outputGcsUri parameter is not supported in Gemini API.");if(void 0!==td(e,["fps"]))throw Error("fps parameter is not supported in Gemini API.");let i=td(e,["durationSeconds"]);if(void 0!==t&&null!=i&&tp(t,["parameters","durationSeconds"],i),void 0!==td(e,["seed"]))throw Error("seed parameter is not supported in Gemini API.");let r=td(e,["aspectRatio"]);void 0!==t&&null!=r&&tp(t,["parameters","aspectRatio"],r);let o=td(e,["resolution"]);void 0!==t&&null!=o&&tp(t,["parameters","resolution"],o);let l=td(e,["personGeneration"]);if(void 0!==t&&null!=l&&tp(t,["parameters","personGeneration"],l),void 0!==td(e,["pubsubTopic"]))throw Error("pubsubTopic parameter is not supported in Gemini API.");let s=td(e,["negativePrompt"]);void 0!==t&&null!=s&&tp(t,["parameters","negativePrompt"],s);let a=td(e,["enhancePrompt"]);if(void 0!==t&&null!=a&&tp(t,["parameters","enhancePrompt"],a),void 0!==td(e,["generateAudio"]))throw Error("generateAudio parameter is not supported in Gemini API.");let u=td(e,["lastFrame"]);void 0!==t&&null!=u&&tp(t,["instances[0]","lastFrame"],nI(u));let p=td(e,["referenceImages"]);if(void 0!==t&&null!=p){let e=p;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,r;return n={},null!=(i=td(t=e,["image"]))&&tp(n,["image"],nI(i)),null!=(r=td(t,["referenceType"]))&&tp(n,["referenceType"],r),n})),tp(t,["instances[0]","referenceImages"],e)}if(void 0!==td(e,["mask"]))throw Error("mask parameter is not supported in Gemini API.");if(void 0!==td(e,["compressionQuality"]))throw Error("compressionQuality parameter is not supported in Gemini API.")}(y,s),s);return d=tu("{model}:predictLongRunning",_._url),c=_._query,delete _._url,delete _._query,this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(_),httpMethod:"POST",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json()).then(e=>{let t,n,i,r,o,l,s=(t={},null!=(n=td(e,["name"]))&&tp(t,["name"],n),null!=(i=td(e,["metadata"]))&&tp(t,["metadata"],i),null!=(r=td(e,["done"]))&&tp(t,["done"],r),null!=(o=td(e,["error"]))&&tp(t,["error"],o),null!=(l=td(e,["response","generateVideoResponse"]))&&tp(t,["response"],function(e){let t={},n=td(e,["generatedSamples"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,r,o,l,s;return n={},null!=(i=td(e,["video"]))&&tp(n,["video"],(r={},null!=(o=td(t=i,["uri"]))&&tp(r,["uri"],o),null!=(l=td(t,["encodedVideo"]))&&tp(r,["videoBytes"],tc(l)),null!=(s=td(t,["encoding"]))&&tp(r,["mimeType"],s),r)),n})),tp(t,["generatedVideos"],e)}let i=td(e,["raiMediaFilteredCount"]);null!=i&&tp(t,["raiMediaFilteredCount"],i);let r=td(e,["raiMediaFilteredReasons"]);return null!=r&&tp(t,["raiMediaFilteredReasons"],r),t}(l)),t),a=new tC;return Object.assign(a,s),a})}}}class n1 extends ta{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){let t=e.operation,n=e.config;if(void 0===t.name||""===t.name)throw Error("Operation name is required.");if(this.apiClient.isVertexAI()){let e,i=t.name.split("/operations/")[0];n&&"httpOptions"in n&&(e=n.httpOptions);let r=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:i,config:{httpOptions:e}});return t._fromAPIResponse({apiResponse:r,isVertexAI:!0})}{let e=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:e,isVertexAI:!1})}}async get(e){let t=e.operation,n=e.config;if(void 0===t.name||""===t.name)throw Error("Operation name is required.");if(this.apiClient.isVertexAI()){let e,i=t.name.split("/operations/")[0];n&&"httpOptions"in n&&(e=n.httpOptions);let r=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:i,config:{httpOptions:e}});return t._fromAPIResponse({apiResponse:r,isVertexAI:!0})}{let e=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:e,isVertexAI:!1})}}async getVideosOperationInternal(e){var t,n,i,r;let o="",l={};if(this.apiClient.isVertexAI()){let i,r,s=(i={},null!=(r=td(e,["operationName"]))&&tp(i,["_url","operationName"],r),i);return o=tu("{operationName}",s._url),l=s._query,delete s._url,delete s._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json())}{let t,n,s=(t={},null!=(n=td(e,["operationName"]))&&tp(t,["_url","operationName"],n),t);return o=tu("{operationName}",s._url),l=s._query,delete s._url,delete s._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json())}}async fetchPredictVideosOperationInternal(e){var t,n;let i="",r={};if(this.apiClient.isVertexAI()){let o,l,s,a=(o={},null!=(l=td(e,["operationName"]))&&tp(o,["operationName"],l),null!=(s=td(e,["resourceName"]))&&tp(o,["_url","resourceName"],s),o);return i=tu("{resourceName}:fetchPredictOperation",a._url),r=a._query,delete a._url,delete a._query,this.apiClient.request({path:i,queryParams:r,body:JSON.stringify(a),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json())}throw Error("This method is only supported by the Vertex AI.")}}class n2 extends ta{constructor(e){super(),this.apiClient=e}async create(e){var t,n,i,r,o;let l="",s={};if(this.apiClient.isVertexAI())throw Error("The client.tokens.create method is only supported by the Gemini Developer API.");{let a,u,p,d,c,h,f,m,g,y,_=(i=this.apiClient,d={},null!=(c=td(e,["config"]))&&tp(d,["config"],(h=td(c,["expireTime"]),void 0!==d&&null!=h&&tp(d,["expireTime"],h),f=td(c,["newSessionExpireTime"]),void 0!==d&&null!=f&&tp(d,["newSessionExpireTime"],f),m=td(c,["uses"]),void 0!==d&&null!=m&&tp(d,["uses"],m),g=td(c,["liveConnectConstraints"]),void 0!==d&&null!=g&&tp(d,["bidiGenerateContentSetup"],(r=i,a={},null!=(u=td(o=g,["model"]))&&tp(a,["setup","model"],tD(r,u)),null!=(p=td(o,["config"]))&&tp(a,["config"],function(e,t){let n=td(e,["generationConfig"]);void 0!==t&&null!=n&&tp(t,["setup","generationConfig"],n);let i=td(e,["responseModalities"]);void 0!==t&&null!=i&&tp(t,["setup","generationConfig","responseModalities"],i);let r=td(e,["temperature"]);void 0!==t&&null!=r&&tp(t,["setup","generationConfig","temperature"],r);let o=td(e,["topP"]);void 0!==t&&null!=o&&tp(t,["setup","generationConfig","topP"],o);let l=td(e,["topK"]);void 0!==t&&null!=l&&tp(t,["setup","generationConfig","topK"],l);let s=td(e,["maxOutputTokens"]);void 0!==t&&null!=s&&tp(t,["setup","generationConfig","maxOutputTokens"],s);let a=td(e,["mediaResolution"]);void 0!==t&&null!=a&&tp(t,["setup","generationConfig","mediaResolution"],a);let u=td(e,["seed"]);void 0!==t&&null!=u&&tp(t,["setup","generationConfig","seed"],u);let p=td(e,["speechConfig"]);void 0!==t&&null!=p&&tp(t,["setup","generationConfig","speechConfig"],tX(p));let d=td(e,["thinkingConfig"]);void 0!==t&&null!=d&&tp(t,["setup","generationConfig","thinkingConfig"],d);let c=td(e,["enableAffectiveDialog"]);void 0!==t&&null!=c&&tp(t,["setup","generationConfig","enableAffectiveDialog"],c);let h=td(e,["systemInstruction"]);void 0!==t&&null!=h&&tp(t,["setup","systemInstruction"],function(e){let t={},n=td(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,r,o,l,s,a,u,p,d,c;return n={},null!=(i=td(t=e,["videoMetadata"]))&&tp(n,["videoMetadata"],i),null!=(r=td(t,["thought"]))&&tp(n,["thought"],r),null!=(o=td(t,["inlineData"]))&&tp(n,["inlineData"],function(e){let t={};if(void 0!==td(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=td(e,["data"]);null!=n&&tp(t,["data"],n);let i=td(e,["mimeType"]);return null!=i&&tp(t,["mimeType"],i),t}(o)),null!=(l=td(t,["fileData"]))&&tp(n,["fileData"],function(e){let t={};if(void 0!==td(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=td(e,["fileUri"]);null!=n&&tp(t,["fileUri"],n);let i=td(e,["mimeType"]);return null!=i&&tp(t,["mimeType"],i),t}(l)),null!=(s=td(t,["thoughtSignature"]))&&tp(n,["thoughtSignature"],s),null!=(a=td(t,["functionCall"]))&&tp(n,["functionCall"],a),null!=(u=td(t,["codeExecutionResult"]))&&tp(n,["codeExecutionResult"],u),null!=(p=td(t,["executableCode"]))&&tp(n,["executableCode"],p),null!=(d=td(t,["functionResponse"]))&&tp(n,["functionResponse"],d),null!=(c=td(t,["text"]))&&tp(n,["text"],c),n})),tp(t,["parts"],e)}let i=td(e,["role"]);return null!=i&&tp(t,["role"],i),t}(tW(h)));let f=td(e,["tools"]);if(void 0!==t&&null!=f){let e=tQ(f);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=td(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),tp(t,["functionDeclarations"],e)}if(void 0!==td(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let i=td(e,["googleSearch"]);null!=i&&tp(t,["googleSearch"],function(e){let t={},n=td(e,["timeRangeFilter"]);if(null!=n&&tp(t,["timeRangeFilter"],n),void 0!==td(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");return t}(i));let r=td(e,["googleSearchRetrieval"]);if(null!=r&&tp(t,["googleSearchRetrieval"],r),void 0!==td(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let o=td(e,["googleMaps"]);null!=o&&tp(t,["googleMaps"],function(e){let t={};if(void 0!==td(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let n=td(e,["enableWidget"]);return null!=n&&tp(t,["enableWidget"],n),t}(o));let l=td(e,["urlContext"]);null!=l&&tp(t,["urlContext"],l);let s=td(e,["computerUse"]);null!=s&&tp(t,["computerUse"],s);let a=td(e,["codeExecution"]);return null!=a&&tp(t,["codeExecution"],a),t})(tZ(e)))),tp(t,["setup","tools"],e)}let m=td(e,["sessionResumption"]);void 0!==t&&null!=m&&tp(t,["setup","sessionResumption"],function(e){let t={},n=td(e,["handle"]);if(null!=n&&tp(t,["handle"],n),void 0!==td(e,["transparent"]))throw Error("transparent parameter is not supported in Gemini API.");return t}(m));let g=td(e,["inputAudioTranscription"]);void 0!==t&&null!=g&&tp(t,["setup","inputAudioTranscription"],g);let y=td(e,["outputAudioTranscription"]);void 0!==t&&null!=y&&tp(t,["setup","outputAudioTranscription"],y);let _=td(e,["realtimeInputConfig"]);void 0!==t&&null!=_&&tp(t,["setup","realtimeInputConfig"],_);let v=td(e,["contextWindowCompression"]);void 0!==t&&null!=v&&tp(t,["setup","contextWindowCompression"],v);let E=td(e,["proactivity"]);return void 0!==t&&null!=E&&tp(t,["setup","proactivity"],E),{}}(p,a)),a)),y=td(c,["lockAdditionalFields"]),void 0!==d&&null!=y&&tp(d,["fieldMask"],y),{})),d);l=tu("auth_tokens",_._url),s=_._query,delete _.config,delete _._url,delete _._query;let v=function(e,t){let n=null,i=e.bidiGenerateContentSetup;if("object"==typeof i&&null!==i&&"setup"in i){let t=i.setup;"object"==typeof t&&null!==t?(e.bidiGenerateContentSetup=t,n=t):delete e.bidiGenerateContentSetup}else void 0!==i&&delete e.bidiGenerateContentSetup;let r=e.fieldMask;if(n){let i=function(e){let t=[];for(let n in e)if(Object.prototype.hasOwnProperty.call(e,n)){let i=e[n];if("object"==typeof i&&null!=i&&Object.keys(i).length>0){let e=Object.keys(i).map(e=>`${n}.${e}`);t.push(...e)}else t.push(n)}return t.join(",")}(n);if(Array.isArray(null==t?void 0:t.lockAdditionalFields)&&(null==t?void 0:t.lockAdditionalFields.length)===0)i?e.fieldMask=i:delete e.fieldMask;else if((null==t?void 0:t.lockAdditionalFields)&&t.lockAdditionalFields.length>0&&null!==r&&Array.isArray(r)&&r.length>0){let t=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"],n=[];r.length>0&&(n=r.map(e=>t.includes(e)?`generationConfig.${e}`:e));let o=[];i&&o.push(i),n.length>0&&o.push(...n),o.length>0?e.fieldMask=o.join(","):delete e.fieldMask}else delete e.fieldMask}else null!==r&&Array.isArray(r)&&r.length>0?e.fieldMask=r.join(","):delete e.fieldMask;return e}(_,e.config);return this.apiClient.request({path:l,queryParams:s,body:JSON.stringify(v),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}}}let n3="x-goog-api-key",n4="https://www.googleapis.com/auth/cloud-platform";class n7{constructor(e){if(void 0!==e.apiKey){this.apiKey=e.apiKey;return}const t=function(e){let t;if(!e)return{scopes:[n4]};if((t=e).scopes){if("string"==typeof t.scopes&&t.scopes!==n4||Array.isArray(t.scopes)&&0>t.scopes.indexOf(n4))throw Error(`Invalid auth scopes. Scopes must include: ${n4}`)}else t.scopes=[n4];return t}(e.googleAuthOptions);this.googleAuth=new ti.GoogleAuth(t)}async addAuthHeaders(e,t){if(void 0!==this.apiKey){if(this.apiKey.startsWith("auth_tokens/"))throw Error("Ephemeral tokens are only supported by the live API.");this.addKeyHeader(e);return}return this.addGoogleAuthHeaders(e,t)}addKeyHeader(e){if(null===e.get(n3)){if(void 0===this.apiKey)throw Error("Trying to set API key header but apiKey is not set");e.append(n3,this.apiKey)}}async addGoogleAuthHeaders(e,t){if(void 0===this.googleAuth)throw Error("Trying to set google-auth headers but googleAuth is unset");for(let[n,i]of(await this.googleAuth.getRequestHeaders(t)))null===e.get(n)&&e.append(n,i)}}class n9{async download(e,t){if(e.downloadPath){let n=await n8(e,t);if(n instanceof th){let t=(0,tr.createWriteStream)(e.downloadPath);to.Readable.fromWeb(n.responseInternal.body).pipe(t)}else(0,tr.writeFile)(e.downloadPath,n,{encoding:"base64"},t=>{if(t)throw Error(`Failed to write file to ${e.downloadPath}: ${t}`)})}}}async function n8(e,t){var n,i,r;let o=t4(e.file);if(void 0!==o)return await t.request({path:`files/${o}:download`,httpMethod:"GET",queryParams:{alt:"media"},httpOptions:null==(n=e.config)?void 0:n.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal});if(t2(e.file)){let t=null==(r=e.file.video)?void 0:r.videoBytes;if("string"==typeof t)return t;throw Error("Failed to download generated video, Uri or videoBytes not found.")}if(t3(e.file)){let t=e.file.videoBytes;if("string"==typeof t)return t;throw Error("Failed to download video, Uri or videoBytes not found.")}throw Error("Unsupported file type")}class n5{create(e,t,n){return new n6(e,t,n)}}class n6{constructor(e,t,n){this.url=e,this.headers=t,this.callbacks=n}connect(){this.ws=new tl.default(this.url,{headers:this.headers}),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(void 0===this.ws)throw Error("WebSocket is not connected");this.ws.send(e)}close(){if(void 0===this.ws)throw Error("WebSocket is not connected");this.ws.close()}}function ie(e,t){let n,i,r,o={},l=td(e,["sdkHttpResponse"]);null!=l&&tp(o,["sdkHttpResponse"],l);let s=td(e,["name"]);null!=s&&tp(o,["name"],s);let a=td(e,["state"]);null!=a&&tp(o,["state"],t1(a));let u=td(e,["createTime"]);null!=u&&tp(o,["createTime"],u);let p=td(e,["tuningTask","startTime"]);null!=p&&tp(o,["startTime"],p);let d=td(e,["tuningTask","completeTime"]);null!=d&&tp(o,["endTime"],d);let c=td(e,["updateTime"]);null!=c&&tp(o,["updateTime"],c);let h=td(e,["description"]);null!=h&&tp(o,["description"],h);let f=td(e,["baseModel"]);null!=f&&tp(o,["baseModel"],f);let m=td(e,["_self"]);return null!=m&&tp(o,["tunedModel"],(n={},null!=(i=td(m,["name"]))&&tp(n,["model"],i),null!=(r=td(m,["name"]))&&tp(n,["endpoint"],r),n)),o}function it(e,t){let n={},i=td(e,["sdkHttpResponse"]);null!=i&&tp(n,["sdkHttpResponse"],i);let r=td(e,["name"]);null!=r&&tp(n,["name"],r);let o=td(e,["state"]);null!=o&&tp(n,["state"],t1(o));let l=td(e,["createTime"]);null!=l&&tp(n,["createTime"],l);let s=td(e,["startTime"]);null!=s&&tp(n,["startTime"],s);let a=td(e,["endTime"]);null!=a&&tp(n,["endTime"],a);let u=td(e,["updateTime"]);null!=u&&tp(n,["updateTime"],u);let p=td(e,["error"]);null!=p&&tp(n,["error"],p);let d=td(e,["description"]);null!=d&&tp(n,["description"],d);let c=td(e,["baseModel"]);null!=c&&tp(n,["baseModel"],c);let h=td(e,["tunedModel"]);null!=h&&tp(n,["tunedModel"],h);let f=td(e,["preTunedModel"]);null!=f&&tp(n,["preTunedModel"],f);let m=td(e,["supervisedTuningSpec"]);null!=m&&tp(n,["supervisedTuningSpec"],m);let g=td(e,["tuningDataStats"]);null!=g&&tp(n,["tuningDataStats"],g);let y=td(e,["encryptionSpec"]);null!=y&&tp(n,["encryptionSpec"],y);let _=td(e,["partnerModelTuningSpec"]);null!=_&&tp(n,["partnerModelTuningSpec"],_);let v=td(e,["customBaseModel"]);null!=v&&tp(n,["customBaseModel"],v);let E=td(e,["experiment"]);null!=E&&tp(n,["experiment"],E);let S=td(e,["labels"]);null!=S&&tp(n,["labels"],S);let T=td(e,["outputUri"]);null!=T&&tp(n,["outputUri"],T);let b=td(e,["pipelineJob"]);null!=b&&tp(n,["pipelineJob"],b);let O=td(e,["serviceAccount"]);null!=O&&tp(n,["serviceAccount"],O);let C=td(e,["tunedModelDisplayName"]);null!=C&&tp(n,["tunedModelDisplayName"],C);let A=td(e,["veoTuningSpec"]);return null!=A&&tp(n,["veoTuningSpec"],A),n}class ii extends ta{constructor(e){super(),this.apiClient=e,this.get=async e=>await this.getInternal(e),this.list=async(e={})=>new no(eY.PAGED_ITEM_TUNING_JOBS,e=>this.listInternal(e),await this.listInternal(e),e),this.tune=async e=>{var t;if(this.apiClient.isVertexAI())if(e.baseModel.startsWith("projects/")){let n={tunedModelName:e.baseModel};(null==(t=e.config)?void 0:t.preTunedModelCheckpointId)&&(n.checkpointId=e.config.preTunedModelCheckpointId);let i=Object.assign(Object.assign({},e),{preTunedModel:n});return i.baseModel=void 0,await this.tuneInternal(i)}else{let t=Object.assign({},e);return await this.tuneInternal(t)}{let t=Object.assign({},e),n=await this.tuneMldevInternal(t),i="";return void 0!==n.metadata&&void 0!==n.metadata.tunedModel?i=n.metadata.tunedModel:void 0!==n.name&&n.name.includes("/operations/")&&(i=n.name.split("/operations/")[0]),{name:i,state:ey.JOB_STATE_QUEUED}}}}async getInternal(e){var t,n,i,r;let o="",l={};if(this.apiClient.isVertexAI()){let i,r,s=(i={},null!=(r=td(e,["name"]))&&tp(i,["_url","name"],r),i);return o=tu("{name}",s._url),l=s._query,delete s._url,delete s._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>it(e))}{let t,n,s=(t={},null!=(n=td(e,["name"]))&&tp(t,["_url","name"],n),t);return o=tu("{name}",s._url),l=s._query,delete s._url,delete s._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>ie(e))}}async listInternal(e){var t,n,i,r;let o="",l={};if(this.apiClient.isVertexAI()){let i,r,s,a,u,p=(i={},null!=(r=td(e,["config"]))&&(s=td(r,["pageSize"]),void 0!==i&&null!=s&&tp(i,["_query","pageSize"],s),a=td(r,["pageToken"]),void 0!==i&&null!=a&&tp(i,["_query","pageToken"],a),u=td(r,["filter"]),void 0!==i&&null!=u&&tp(i,["_query","filter"],u)),i);return o=tu("tuningJobs",p._url),l=p._query,delete p._url,delete p._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(p),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e,t){let n={},i=td(e,["sdkHttpResponse"]);null!=i&&tp(n,["sdkHttpResponse"],i);let r=td(e,["nextPageToken"]);null!=r&&tp(n,["nextPageToken"],r);let o=td(e,["tuningJobs"]);if(null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>it(e))),tp(n,["tuningJobs"],e)}return n}(e),n=new tA;return Object.assign(n,t),n})}{let t,n,s,a,u,p=(t={},null!=(n=td(e,["config"]))&&(s=td(n,["pageSize"]),void 0!==t&&null!=s&&tp(t,["_query","pageSize"],s),a=td(n,["pageToken"]),void 0!==t&&null!=a&&tp(t,["_query","pageToken"],a),u=td(n,["filter"]),void 0!==t&&null!=u&&tp(t,["_query","filter"],u)),t);return o=tu("tunedModels",p._url),l=p._query,delete p._url,delete p._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(p),httpMethod:"GET",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e,t){let n={},i=td(e,["sdkHttpResponse"]);null!=i&&tp(n,["sdkHttpResponse"],i);let r=td(e,["nextPageToken"]);null!=r&&tp(n,["nextPageToken"],r);let o=td(e,["tunedModels"]);if(null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>ie(e))),tp(n,["tuningJobs"],e)}return n}(e),n=new tA;return Object.assign(n,t),n})}}async cancel(e){var t,n,i,r;let o="",l={};if(this.apiClient.isVertexAI()){let i,r,s=(i={},null!=(r=td(e,["name"]))&&tp(i,["_url","name"],r),i);o=tu("{name}:cancel",s._url),l=s._query,delete s._url,delete s._query,await this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal})}else{let t,n,s=(t={},null!=(n=td(e,["name"]))&&tp(t,["_url","name"],n),t);o=tu("{name}:cancel",s._url),l=s._query,delete s._url,delete s._query,await this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal})}}async tuneInternal(e){var t,n;let i="",r={};if(this.apiClient.isVertexAI()){let o,l,s,a,u,p=(o={},null!=(l=td(e,["baseModel"]))&&tp(o,["baseModel"],l),null!=(s=td(e,["preTunedModel"]))&&tp(o,["preTunedModel"],s),null!=(a=td(e,["trainingDataset"]))&&function(e,t,n){let i=td(e,["gcsUri"]);void 0!==t&&null!=i&&tp(t,["supervisedTuningSpec","trainingDatasetUri"],i);let r=td(e,["vertexDatasetResource"]);if(void 0!==t&&null!=r&&tp(t,["supervisedTuningSpec","trainingDatasetUri"],r),void 0!==td(e,["examples"]))throw Error("examples parameter is not supported in Vertex AI.")}(a,o),null!=(u=td(e,["config"]))&&function(e,t,n){var i;let r,o,l,s=td(e,["validationDataset"]);void 0!==t&&null!=s&&tp(t,["supervisedTuningSpec"],(r={},null!=(o=td(i=s,["gcsUri"]))&&tp(r,["validationDatasetUri"],o),null!=(l=td(i,["vertexDatasetResource"]))&&tp(r,["validationDatasetUri"],l),r));let a=td(e,["tunedModelDisplayName"]);void 0!==t&&null!=a&&tp(t,["tunedModelDisplayName"],a);let u=td(e,["description"]);void 0!==t&&null!=u&&tp(t,["description"],u);let p=td(e,["epochCount"]);void 0!==t&&null!=p&&tp(t,["supervisedTuningSpec","hyperParameters","epochCount"],p);let d=td(e,["learningRateMultiplier"]);void 0!==t&&null!=d&&tp(t,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],d);let c=td(e,["exportLastCheckpointOnly"]);void 0!==t&&null!=c&&tp(t,["supervisedTuningSpec","exportLastCheckpointOnly"],c);let h=td(e,["adapterSize"]);if(void 0!==t&&null!=h&&tp(t,["supervisedTuningSpec","hyperParameters","adapterSize"],h),void 0!==td(e,["batchSize"]))throw Error("batchSize parameter is not supported in Vertex AI.");if(void 0!==td(e,["learningRate"]))throw Error("learningRate parameter is not supported in Vertex AI.");let f=td(e,["labels"]);void 0!==t&&null!=f&&tp(t,["labels"],f)}(u,o),o);return i=tu("tuningJobs",p._url),r=p._query,delete p._url,delete p._query,this.apiClient.request({path:i,queryParams:r,body:JSON.stringify(p),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>it(e))}throw Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,n;let i="",r={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o,l,s,a,u,p=(o={},null!=(l=td(e,["baseModel"]))&&tp(o,["baseModel"],l),null!=(s=td(e,["preTunedModel"]))&&tp(o,["preTunedModel"],s),null!=(a=td(e,["trainingDataset"]))&&tp(o,["tuningTask","trainingData"],function(e,t){let n={};if(void 0!==td(e,["gcsUri"]))throw Error("gcsUri parameter is not supported in Gemini API.");if(void 0!==td(e,["vertexDatasetResource"]))throw Error("vertexDatasetResource parameter is not supported in Gemini API.");let i=td(e,["examples"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),tp(n,["examples","examples"],e)}return n}(a)),null!=(u=td(e,["config"]))&&function(e,t,n){if(void 0!==td(e,["validationDataset"]))throw Error("validationDataset parameter is not supported in Gemini API.");let i=td(e,["tunedModelDisplayName"]);if(void 0!==t&&null!=i&&tp(t,["displayName"],i),void 0!==td(e,["description"]))throw Error("description parameter is not supported in Gemini API.");let r=td(e,["epochCount"]);void 0!==t&&null!=r&&tp(t,["tuningTask","hyperparameters","epochCount"],r);let o=td(e,["learningRateMultiplier"]);if(null!=o&&tp({},["tuningTask","hyperparameters","learningRateMultiplier"],o),void 0!==td(e,["exportLastCheckpointOnly"]))throw Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(void 0!==td(e,["preTunedModelCheckpointId"]))throw Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(void 0!==td(e,["adapterSize"]))throw Error("adapterSize parameter is not supported in Gemini API.");let l=td(e,["batchSize"]);void 0!==t&&null!=l&&tp(t,["tuningTask","hyperparameters","batchSize"],l);let s=td(e,["learningRate"]);if(void 0!==t&&null!=s&&tp(t,["tuningTask","hyperparameters","learningRate"],s),void 0!==td(e,["labels"]))throw Error("labels parameter is not supported in Gemini API.")}(u,o),o);return i=tu("tunedModels",p._url),r=p._query,delete p._url,delete p._query,this.apiClient.request({path:i,queryParams:r,body:JSON.stringify(p),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i,r,o,l;return t={},null!=(n=td(e,["sdkHttpResponse"]))&&tp(t,["sdkHttpResponse"],n),null!=(i=td(e,["name"]))&&tp(t,["name"],i),null!=(r=td(e,["metadata"]))&&tp(t,["metadata"],r),null!=(o=td(e,["done"]))&&tp(t,["done"],o),null!=(l=td(e,["error"]))&&tp(t,["error"],l),t})}}}let ir="x-goog-upload-status";async function io(e,t,n){var i,r,o;let l=0,s=0,a=new th(new Response),u="upload";for(l=e.size;s<l;){let o=Math.min(8388608,l-s),p=e.slice(s,s+o);s+o>=l&&(u+=", finalize");let d=0,c=1e3;for(;d<3&&(null==(i=null==(a=await n.request({path:"",body:p,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:t,headers:{"X-Goog-Upload-Command":u,"X-Goog-Upload-Offset":String(s),"Content-Length":String(o)}}}))?void 0:a.headers)||!i[ir]);)d++,await is(c),c*=2;if(s+=o,(null==(r=null==a?void 0:a.headers)?void 0:r[ir])!=="active")break;if(l<=s)throw Error("All content has been uploaded, but the upload status is not finalized.")}let p=await (null==a?void 0:a.json());if((null==(o=null==a?void 0:a.headers)?void 0:o[ir])!=="final")throw Error("Failed to upload file: Upload status is not finalized.");return p.file}async function il(e){return{size:e.size,type:e.type}}function is(e){return new Promise(t=>setTimeout(t,e))}class ia{async stat(e){let t={size:0,type:void 0};return"string"==typeof e?(t.size=(await ts.stat(e)).size,t.type=this.inferMimeType(e),t):await il(e)}async upload(e,t,n){return"string"==typeof e?await this.uploadFileFromPath(e,t,n):io(e,t,n)}inferMimeType(e){return({aac:"audio/aac",abw:"application/x-abiword",arc:"application/x-freearc",avi:"video/x-msvideo",azw:"application/vnd.amazon.ebook",bin:"application/octet-stream",bmp:"image/bmp",bz:"application/x-bzip",bz2:"application/x-bzip2",csh:"application/x-csh",css:"text/css",csv:"text/csv",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",gz:"application/gzip",gif:"image/gif",htm:"text/html",html:"text/html",ico:"image/vnd.microsoft.icon",ics:"text/calendar",jar:"application/java-archive",jpeg:"image/jpeg",jpg:"image/jpeg",js:"text/javascript",json:"application/json",jsonld:"application/ld+json",kml:"application/vnd.google-earth.kml+xml",kmz:"application/vnd.google-earth.kmz+xml",mjs:"text/javascript",mp3:"audio/mpeg",mp4:"video/mp4",mpeg:"video/mpeg",mpkg:"application/vnd.apple.installer+xml",odt:"application/vnd.oasis.opendocument.text",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",opus:"audio/opus",otf:"font/otf",png:"image/png",pdf:"application/pdf",php:"application/x-httpd-php",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",rar:"application/vnd.rar",rtf:"application/rtf",sh:"application/x-sh",svg:"image/svg+xml",swf:"application/x-shockwave-flash",tar:"application/x-tar",tif:"image/tiff",tiff:"image/tiff",ts:"video/mp2t",ttf:"font/ttf",txt:"text/plain",vsd:"application/vnd.visio",wav:"audio/wav",weba:"audio/webm",webm:"video/webm",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xml:"application/xml",xul:"application/vnd.mozilla.xul+xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2","7z":"application/x-7z-compressed"})[e.slice(e.lastIndexOf(".")+1).toLowerCase()]}async uploadFileFromPath(e,t,n){var i,r,o;let l,s=0,a=0,u=new th(new Response),p="upload";try{if(!(l=await ts.open(e,"r")))throw Error("Failed to open file");for(s=(await l.stat()).size;a<s;){let e=Math.min(8388608,s-a);a+e>=s&&(p+=", finalize");let o=new Uint8Array(e),{bytesRead:d}=await l.read(o,0,e,a);if(d!==e)throw Error(`Failed to read ${e} bytes from file at offset ${a}. bytes actually read: ${d}`);let c=new Blob([o]),h=0,f=1e3;for(;h<3&&(null==(i=null==(u=await n.request({path:"",body:c,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:t,headers:{"X-Goog-Upload-Command":p,"X-Goog-Upload-Offset":String(a),"Content-Length":String(d)}}}))?void 0:u.headers)||!i[ir]);)h++,await is(f),f*=2;if(a+=d,(null==(r=null==u?void 0:u.headers)?void 0:r[ir])!=="active")break;if(s<=a)throw Error("All content has been uploaded, but the upload status is not finalized.")}let d=await (null==u?void 0:u.json());if((null==(o=null==u?void 0:u.headers)?void 0:o[ir])!=="final")throw Error("Failed to upload file: Upload status is not finalized.");return d.file}finally{l&&await l.close()}}}function iu(e){var t,n,i;return null!=(i=null==(n=null==(t=null==process?void 0:process.env)?void 0:t[e])?void 0:n.trim())?i:void 0}process.env.GEMINI_API_KEY?console.log("✅ [GeminiService] GEMINI_API_KEY detectada com sucesso."):console.error("❌ [GeminiService] Variável de ambiente GEMINI_API_KEY não configurada!");let ip=new class{constructor(e){var i,r,o,l,s,a;if((e.project||e.location)&&e.apiKey)throw Error("Project/location and API key are mutually exclusive in the client initializer.");this.vertexai=null!=(r=null!=(i=e.vertexai)?i:function(e){var t;return void 0!==(t=iu(e))&&"true"===t.toLowerCase()}("GOOGLE_GENAI_USE_VERTEXAI"))&&r;const u=function(){let e=iu("GOOGLE_API_KEY"),t=iu("GEMINI_API_KEY");return e&&t&&console.warn("Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY."),e||t||void 0}(),p=iu("GOOGLE_CLOUD_PROJECT"),d=iu("GOOGLE_CLOUD_LOCATION");this.apiKey=null!=(o=e.apiKey)?o:u,this.project=null!=(l=e.project)?l:p,this.location=null!=(s=e.location)?s:d,e.vertexai&&((null==(a=e.googleAuthOptions)?void 0:a.credentials)&&(console.debug("The user provided Google Cloud credentials will take precedence over the API key from the environment variable."),this.apiKey=void 0),(p||d)&&e.apiKey?(console.debug("The user provided Vertex AI API key will take precedence over the project/location from the environment variables."),this.project=void 0,this.location=void 0):(e.project||e.location)&&u?(console.debug("The user provided project/location will take precedence over the API key from the environment variables."),this.apiKey=void 0):(p||d)&&u&&(console.debug("The project/location from the environment variables will take precedence over the API key from the environment variables."),this.apiKey=void 0));const c=function(e,i,r,o){return(null==e?void 0:e.baseUrl)?e.baseUrl:i?null!=n?n:r:null!=t?t:o}(e.httpOptions,e.vertexai,iu("GOOGLE_VERTEX_BASE_URL"),iu("GOOGLE_GEMINI_BASE_URL"));c&&(e.httpOptions?e.httpOptions.baseUrl=c:e.httpOptions={baseUrl:c}),this.apiVersion=e.apiVersion;const h=new n7({apiKey:this.apiKey,googleAuthOptions:e.googleAuthOptions});this.apiClient=new nG({auth:h,project:this.project,location:this.location,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:"gl-node/"+process.version,uploader:new ia,downloader:new n9}),this.models=new n0(this.apiClient),this.live=new nY(this.apiClient,h,new n5),this.batches=new nl(this.apiClient),this.chats=new nf(this.models,this.apiClient),this.caches=new na(this.apiClient),this.files=new ny(this.apiClient),this.operations=new n1(this.apiClient),this.authTokens=new n2(this.apiClient),this.tunings=new ii(this.apiClient)}}({apiKey:process.env.GEMINI_API_KEY});process.env.REMOTE_POST_URL,process.env.REMOTE_POST_API_KEY;let id=async(e,t,n)=>{console.log("🕊️ [writeNewsArticle] Iniciando geração do artigo..."),console.log(`[writeNewsArticle] Tema: ${e}`),console.log(`[writeNewsArticle] Idioma: ${t}`),console.log(`[writeNewsArticle] Palavras-chave: ${n}`);try{let i=`
Voc\xea \xe9 um jornalista cat\xf3lico de aproximadamente 25 anos, com um dom especial para contar hist\xf3rias inspiradoras sobre os Santos da Igreja Cat\xf3lica. 
Voc\xea escreve para o Blog Tio Ben — um blog cat\xf3lico jovem e envolvente, que busca evangelizar e inspirar seus leitores atrav\xe9s da vida dos Santos. 

Seu estilo \xe9 leve, natural e empolgante — como um amigo que sabe muito sobre a f\xe9 e compartilha hist\xf3rias de forma calorosa e verdadeira. 
N\xe3o use g\xedrias ou express\xf5es populares demais, mas evite tamb\xe9m a linguagem excessivamente formal. 
Seu texto deve soar aut\xeantico, humano e profundamente cat\xf3lico. 

🔎 **Fontes e Verdade Doutrinal:**
- Suas refer\xeancias principais s\xe3o documentos e fontes oficiais da Igreja Cat\xf3lica, especialmente o site do Vaticano (vatican.va), o Missal Romano e o Diret\xf3rio dos Santos.
- Nunca invente fatos. Se n\xe3o houver informa\xe7\xe3o sobre algum aspecto, apenas omita. 
- Toda a narrativa deve estar em plena comunh\xe3o com o Magist\xe9rio e a Tradi\xe7\xe3o da Igreja.

🪔 **Estrutura do Artigo (SEO e Conte\xfado):**
O artigo deve ter:
1. **T\xedtulo** criativo e inspirador.
2. **Subt\xedtulo** curto e cativante.
3. **Se\xe7\xe3o do Dia de Celebra\xe7\xe3o** — contendo a **Liturgia do Dia** (1\xaa Leitura, 2\xaa Leitura — se houver —, Salmo e Evangelho).
4. **Introdu\xe7\xe3o envolvente**, que desperte a curiosidade do leitor e o conecte espiritualmente com o Santo.
5. **Corpo do texto** dividido em se\xe7\xf5es com subt\xedtulos claros:
   - 🌍 *Origem e nascimento*: onde e quando nasceu, contexto hist\xf3rico.
   - ✝️ *Caminho de f\xe9 e miss\xe3o*: principais fatos da vida, voca\xe7\xe3o, virtudes.
   - 🙏 *Milagres e testemunhos*: fatos reconhecidos pela Igreja ou pela tradi\xe7\xe3o.
   - 📅 *Dia de celebra\xe7\xe3o*: data lit\xfargica e sentido espiritual.
   - 🕊️ *Padroeiro e devo\xe7\xf5es*: se for padroeiro de algo, explique com clareza.
   - 📖 *Ora\xe7\xe3o ao Santo* (caso exista oficialmente na tradi\xe7\xe3o).
   - 💡 *Li\xe7\xe3o de vida*: o que sua hist\xf3ria ensina para os crist\xe3os de hoje, especialmente os jovens.
6. **Conclus\xe3o inspiradora**, que motive o leitor a buscar uma vida mais santa e pr\xf3xima de Deus.

✨ **Recursos estil\xedsticos:**
- Use **emojis** com modera\xe7\xe3o para dar leveza e simpatia ao texto (ex: 🙏, ✝️, 🌹, 📖, 💡, 🕊️).
- Use **listas e t\xf3picos** quando fizer sentido.
- Destaque palavras-chave importantes com **negrito**.
- Os subt\xedtulos devem ser marcados com '##' (Markdown) para SEO e clareza visual.
- O texto deve ter uma **densidade equilibrada de palavras-chave** e uma **meta description natural**.

🧠 **SEO e Palavras-chave:**
Durante a escrita, tente incorporar de forma natural e relevante as seguintes palavras-chave: ${n}. 
N\xe3o force a inclus\xe3o se n\xe3o parecer natural; priorize a fluidez e o sentido espiritual do texto.

📰 **Instru\xe7\xe3o de Escrita:**
Escreva um artigo cativante e detalhado sobre "${e}". 
O artigo deve ter um t\xedtulo claro, uma introdu\xe7\xe3o envolvente, subt\xedtulos tem\xe1ticos, corpo bem estruturado e uma conclus\xe3o edificante. 
O tom deve ser inspirador e pr\xf3ximo, adequado para jovens cat\xf3licos que buscam crescer na f\xe9. 
O idioma do artigo deve ser: ${t}.
`;console.log("✍️ [writeNewsArticle] Enviando prompt para o modelo gemini-2.5-pro...");let r=await ip.models.generateContent({model:"gemini-2.5-pro",contents:[{parts:[{text:i}]}]});return console.log("✅ [writeNewsArticle] Artigo gerado com sucesso."),r.text}catch(e){throw console.error("❌ [writeNewsArticle] Erro:",e),Error("Falha ao gerar o artigo de notícia pela IA.")}},ic=async e=>{console.log("🎨 [formatArticleToHtml] Iniciando formatação do artigo..."),console.log("[formatArticleToHtml] Tamanho do texto recebido:",e.length);try{let t=`
Voc\xea \xe9 um assistente editorial e web designer cat\xf3lico especializado em formata\xe7\xe3o de artigos para o Blog Tio Ben. 
Seu papel \xe9 receber um texto em linguagem natural — uma mat\xe9ria sobre a vida de um santo — e convert\xea-la em um artigo HTML completo, elegante e semanticamente otimizado para SEO e responsividade.

O texto da mat\xe9ria chega no seguinte par\xe2metro:  
${e}

⚜️ **Contexto:**
O artigo original foi escrito por outro agente (um jornalista cat\xf3lico) e j\xe1 segue as tradi\xe7\xf5es da Igreja e o tom espiritual do Blog Tio Ben. 
Sua tarefa N\xc3O \xe9 reescrever o conte\xfado, mas format\xe1-lo em HTML conforme o modelo abaixo, adaptando t\xedtulos, subt\xedtulos e se\xe7\xf5es com estrutura sem\xe2ntica e estiliza\xe7\xe3o coerente com TailwindCSS, conforme o padr\xe3o do site.

---

🧱 **ESTRUTURA BASE (modelo obrigat\xf3rio):**
O HTML deve sempre seguir este esqueleto principal:

<article class="post-santo max-w-3xl mx-auto p-4 sm lg bg-white font-sans text-gray-800 leading-relaxed min-h-screen">

  <!-- 🔍 Bloco SEO: Data da Celebra\xe7\xe3o e Link para Liturgia -->
  <section id="data-celebracao" class="mb-8 p-4 bg-indigo-50 border border-indigo-100 rounded-lg">
    <h1 class="text-3xl font-extrabold text-indigo-700 mb-2">[Nome do Santo] – [Data de Celebra\xe7\xe3o]</h1>
    <p class="text-gray-700 text-base mb-3">
      No dia <time datetime="[aaaa-mm-dd]">[data por extenso]</time>, a Igreja celebra 
      <strong class="text-indigo-600">[Nome do Santo]</strong>. 
      [Breve resumo sobre o santo e o significado do dia.]
      Acompanhe tamb\xe9m a 
      <a href="https://www.iatioben.com.br/liturgia-diaria/[dd-mm-yyyy]" 
         class="text-indigo-600 font-semibold hover:underline" 
         target="_blank" 
         rel="noopener noreferrer">
        Liturgia Di\xe1ria de [data]
      </a>.
    </p>
  </section>

  <header class="mb-10 border-b border-indigo-200 pb-4">
    <h2 class="text-3xl sm font-extrabold text-indigo-700 mb-2 leading-tight">[T\xedtulo principal do artigo]</h2>
    <p class="introducao text-lg text-gray-600 italic">[Par\xe1grafo introdut\xf3rio]</p>
  </header>

  <!-- Se\xe7\xf5es tem\xe1ticas -->
  <section id="[slug-secao]" aria-labelledby="[titulo-secao]" class="mb-10 pt-4 border-b border-gray-100 pb-6">
    <h3 id="[titulo-secao]" class="dia-liturgia text-2xl font-bold text-gray-900 mb-3 sm">
      <span class="text-indigo-500 mr-2">[emoji]</span> [T\xedtulo da se\xe7\xe3o]
    </h3>
    <p class="mb-4">[Par\xe1grafo 1]</p>
    <p class="mb-4">[Par\xe1grafo 2]</p>
  </section>

  <!-- Se\xe7\xf5es finais -->
  <section id="resumo-seo" aria-labelledby="titulo-resumo" class="resumo-post p-5 border border-indigo-100 rounded-lg mb-10 bg-indigo-50">
    <h3 id="titulo-resumo" class="text-xl font-bold text-indigo-700 mb-3">✨ Ficha T\xe9cnica (SEO)</h3>
    <ul class="lista-resumo space-y-2 text-sm">
      <li><strong class="font-semibold text-gray-700">Tema central:</strong> [resumo do tema]</li>
      <li><strong class="font-semibold text-gray-700">Foco:</strong> [descri\xe7\xe3o resumida do foco]</li>
    </ul>
  </section>

  <footer class="rodape-post mt-10 pt-6 border-t border-gray-200">
    <h3 class="chamada-acao text-xl font-bold text-gray-900 mb-3">🔗 Conecte F\xe9 e Humanismo</h3>
    <p class="text-gray-600">
      Inspire-se em <strong class="text-indigo-600">[Nome do Santo]</strong> e viva sua f\xe9 com coragem, esperan\xe7a e amor.
    </p>
  </footer>
</article>

---

🧩 **INSTRU\xc7\xd5ES DE CONVERS\xc3O E FORMATA\xc7\xc3O:**

1. Use o conte\xfado recebido em \`${e}\` para preencher todas as se\xe7\xf5es do modelo.
2. Identifique automaticamente introdu\xe7\xe3o, corpo e conclus\xe3o e distribua em se\xe7\xf5es coerentes.
3. Utilize **emojis tem\xe1ticos cat\xf3licos** nos t\xedtulos (👶🕊️📖💡🌟❤️🙏📅).
4. Gere **IDs sem\xe2nticos** para cada se\xe7\xe3o (ex: infancia-formacao, milagres, legado, oracao, li\xe7\xe3o-de-vida etc.).
5. As classes Tailwind devem ser **mantidas exatamente como no modelo.**
6. O HTML deve ser **responsivo, mobile first e semanticamente estruturado.**
7. Todos os links externos devem usar **target="_blank" e rel="noopener noreferrer".**
8. Formate datas com o atributo \`datetime="yyyy-mm-dd"\`.
9. Destaque termos importantes com **<strong>** e **<em>**.
10. Crie uma se\xe7\xe3o **"Ficha T\xe9cnica (SEO)"** ao final com resumo e foco do texto.

---

🔗 **LINKS DE CONTEXTO INTELIGENTES (IA Tio Ben):**
Durante a formata\xe7\xe3o, **identifique express\xf5es, nomes ou fatos que possam despertar curiosidade** e converta-os em links que direcionem para a pesquisa na IA Tio Ben.  
Use o formato:

<a href="https://www.iatioben.com.br/?texto=[texto%20codificado]" 
   class="text-indigo-600 hover:underline font-medium" 
   target="_blank" 
   rel="noopener noreferrer">
   [express\xe3o clic\xe1vel]
</a>

Exemplo:  
Transforme “Conc\xedlio Vaticano II” em  
<a href="https://www.iatioben.com.br/?texto=Conc\xedlio%20Vaticano%20II" ...>Conc\xedlio Vaticano II</a>

Crie **entre 3 e 5 links** desse tipo por artigo, de forma natural e fluida, sem quebrar o contexto.

---

⚙️ **Boas pr\xe1ticas de SEO:**
- T\xedtulo principal \xfanico e envolvente (\`<h1>\`).  
- Subt\xedtulos hier\xe1rquicos (\`<h2>\`, \`<h3>\`).  
- Tags sem\xe2nticas corretas (\`<strong>\`, \`<em>\`, \`<time>\`, \`<a>\`).  
- Estrutura HTML limpa e validada.  
- Par\xe1grafos curtos e escane\xe1veis.  
- Palavras-chave mantidas naturalmente.

---

🧭 **Instru\xe7\xe3o final:**
Receba o conte\xfado no par\xe2metro \`${e}\` e retorne **somente o HTML final completo e formatado** no padr\xe3o acima, pronto para publica\xe7\xe3o no site www.iatioben.com.br.  
N\xe3o adicione explica\xe7\xf5es nem coment\xe1rios — apenas gere o HTML final.
`,n=(await ip.models.generateContent({model:"gemini-2.5-flash",contents:[{parts:[{text:t}]}]})).text||"";return n.startsWith("```html")&&(n=n.slice(7)),n.endsWith("```")&&(n=n.slice(0,-3)),console.log("✅ [formatArticleToHtml] HTML gerado com sucesso. Tamanho:",n.length),n.trim()}catch(e){throw console.error("❌ [formatArticleToHtml] Erro ao gerar HTML:",e),Error("Falha ao formatar o artigo para HTML.")}},ih=async(e,t)=>{console.log("🔍 [analyzeSeoAndExtractMetadata] Iniciando análise SEO...");try{let n=`
Voc\xea \xe9 um editor cat\xf3lico do Blog Tio Ben, respons\xe1vel por revisar artigos espirituais sobre a vida dos Santos e otimizar seu conte\xfado para SEO — sem jamais perder o tom humano, devocional e inspirador do texto original.

🕊️ Sua miss\xe3o \xe9 analisar o artigo abaixo e gerar um **objeto JSON** com duas chaves:
- "keywords": uma lista com 5 a 10 palavras-chave que melhor representam o artigo e sua espiritualidade, valorizando temas cat\xf3licos e express\xf5es de f\xe9.
- "metaDescription": uma breve descri\xe7\xe3o (m\xe1x. 160 caracteres) que resuma a ess\xeancia do artigo de forma cativante, fiel \xe0 mensagem e ao estilo do texto, como se fosse o resumo que aparece no Google.  
  Ela deve soar natural, acolhedora e levemente po\xe9tica — como uma frase que desperta f\xe9 e curiosidade, sem parecer comercial.

🪔 Dicas de estilo:
- Mantenha o mesmo tom usado no artigo: devocional, alegre, pr\xf3ximo e cheio de esperan\xe7a.
- Prefira frases que transmitam luz, f\xe9, virtude e exemplo de vida.
- N\xe3o use linguagem t\xe9cnica ou publicit\xe1ria.
- Inspire o leitor a clicar, mas sem perder a rever\xeancia e autenticidade.

Palavras-chave foco do blog: ${t}

📰 Artigo a analisar:
---
${e}
---

Retorne **somente o JSON** no formato:
{
  "keywords": ["palavra1", "palavra2", ...],
  "metaDescription": "texto descritivo cativante"
}
`,i=await ip.models.generateContent({model:"gemini-2.5-flash",contents:[{parts:[{text:n}]}],config:{responseMimeType:"application/json",responseSchema:{type:en.OBJECT,properties:{keywords:{type:en.ARRAY,items:{type:en.STRING}},metaDescription:{type:en.STRING}}}}}),r=JSON.parse(i.text);return console.log("✅ [analyzeSeoAndExtractMetadata] SEO extraído:",r),{keywords:r.keywords||[],metaDescription:r.metaDescription||""}}catch(e){return console.error("❌ [analyzeSeoAndExtractMetadata] Erro SEO:",e),{keywords:[],metaDescription:"Não foi possível gerar a meta descrição."}}};var im=e.i(89171);let ig=process.env.REMOTE_POST_API_KEY,iy=process.env.REMOTE_POST_URL;async function i_(e){console.log("🚀 [generate-and-publish] Chamada recebida");try{if(e.headers.get("x-api-key")!==ig)return console.warn("🚫 [generate-and-publish] Acesso não autorizado"),im.NextResponse.json({success:!1,message:"Acesso não autorizado"},{status:401});let{topic:t,language:n="pt-BR",focusKeywords:i=""}=await e.json();if(!t)return console.warn("⚠️ [generate-and-publish] Campo 'topic' ausente no body"),im.NextResponse.json({success:!1,message:"O campo 'topic' é obrigatório."},{status:400});console.log("🧩 [generate-and-publish] Iniciando pipeline para:",t);let r=await id(t,n,i);console.log("📝 [generate-and-publish] Artigo gerado com sucesso. Tamanho:",r.length);let o=await ic(r);console.log("🎨 [generate-and-publish] HTML formatado com sucesso. Tamanho:",o.length);let{keywords:l,metaDescription:s}=await ih(r,i);console.log("🔍 [generate-and-publish] SEO extraído com sucesso.");let a=t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,""),u={title:t,slug:a,content:o,categoryId:"ba7adc02-de35-4405-b3f3-7391947d6281",categoryName:"Santos",keywords:l.join(", "),metaDescription:s,publishDate:new Date().toISOString(),isActive:!0};console.log("📦 [generate-and-publish] Payload preparado:",u),console.log(`🌍 [generate-and-publish] Enviando para ${iy} ...`);let p=await fetch(iy,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":ig},body:JSON.stringify(u)}),d=await p.json();if(!p.ok)return console.error("❌ [generate-and-publish] Falha ao publicar remotamente:",d),im.NextResponse.json({success:!1,message:"Erro ao publicar remotamente",details:d},{status:500});return console.log("✅ [generate-and-publish] Publicado com sucesso no site remoto."),im.NextResponse.json({success:!0,message:"Post gerado e publicado com sucesso!",payload:u,remoteResponse:d})}catch(e){return console.error("❌ [generate-and-publish] Erro geral:",e),im.NextResponse.json({success:!1,message:"Erro interno ao gerar ou publicar post.",error:e.message},{status:500})}}e.s(["POST",()=>i_],41754);var iv=e.i(41754);let iE=new eK.AppRouteRouteModule({definition:{kind:ez.RouteKind.APP_ROUTE,page:"/api/calendar/today/generate-and-publish/route",pathname:"/api/calendar/today/generate-and-publish",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/calendar/today/generate-and-publish/route.ts",nextConfigOutput:"",userland:iv}),{workAsyncStorage:iS,workUnitAsyncStorage:iT,serverHooks:ib}=iE;function iO(){return(0,eX.patchFetch)({workAsyncStorage:iS,workUnitAsyncStorage:iT})}async function iC(e,t,n){iE.isDev&&(0,eZ.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let i="/api/calendar/today/generate-and-publish/route";i=i.replace(/\/index$/,"")||"/";let r=await iE.prepare(e,t,{srcPage:i,multiZoneDraftMode:!1});if(!r)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:o,params:l,nextConfig:s,parsedUrl:a,isDraftMode:u,prerenderManifest:p,routerServerContext:d,isOnDemandRevalidate:c,revalidateOnlyGenerated:h,resolvedPathname:f,clientReferenceManifest:m,serverActionsManifest:g}=r,y=(0,e2.normalizeAppPath)(i),_=!!(p.dynamicRoutes[y]||p.routes[f]),v=async()=>((null==d?void 0:d.render404)?await d.render404(e,t,a,!1):t.end("This page could not be found"),null);if(_&&!u){let e=!!p.routes[f],t=p.dynamicRoutes[y];if(t&&!1===t.fallback&&!e){if(s.experimental.adapterPath)return await v();throw new tt.NoFallbackError}}let E=null;!_||iE.isDev||u||(E="/index"===(E=f)?"/":E);let S=!0===iE.isDev||!_,T=_&&!S;g&&m&&(0,e0.setReferenceManifestsSingleton)({page:i,clientReferenceManifest:m,serverActionsManifest:g,serverModuleMap:(0,e1.createServerModuleMap)({serverActionsManifest:g})});let b=e.method||"GET",O=(0,eQ.getTracer)(),C=O.getActiveScopeSpan(),A={params:l,prerenderManifest:p,renderOpts:{experimental:{authInterrupts:!!s.experimental.authInterrupts},cacheComponents:!!s.cacheComponents,supportsDynamicResponse:S,incrementalCache:(0,eZ.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:s.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,n,i)=>iE.onRequestError(e,t,i,d)},sharedContext:{buildId:o}},I=new e3.NodeNextRequest(e),x=new e3.NodeNextResponse(t),R=e4.NextRequestAdapter.fromNodeNextRequest(I,(0,e4.signalFromNodeResponse)(t));try{let r=async e=>iE.handle(R,A).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let n=O.getRootSpanAttributes();if(!n)return;if(n.get("next.span_type")!==e7.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${n.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=n.get("next.route");if(r){let t=`${b} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${b} ${i}`)}),o=!!(0,eZ.getRequestMeta)(e,"minimalMode"),l=async l=>{var a,f;let m=async({previousCacheEntry:s})=>{try{if(!o&&c&&h&&!s)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await r(l);e.fetchMetrics=A.renderOpts.fetchMetrics;let a=A.renderOpts.pendingWaitUntil;a&&n.waitUntil&&(n.waitUntil(a),a=void 0);let u=A.renderOpts.collectedTags;if(!_)return await (0,e8.sendResponse)(I,x,i,A.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,e5.toNodeOutgoingHttpHeaders)(i.headers);u&&(t[te.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let n=void 0!==A.renderOpts.collectedRevalidate&&!(A.renderOpts.collectedRevalidate>=te.INFINITE_CACHE)&&A.renderOpts.collectedRevalidate,r=void 0===A.renderOpts.collectedExpire||A.renderOpts.collectedExpire>=te.INFINITE_CACHE?void 0:A.renderOpts.collectedExpire;return{value:{kind:tn.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:n,expire:r}}}}catch(t){throw(null==s?void 0:s.isStale)&&await iE.onRequestError(e,t,{routerKind:"App Router",routePath:i,routeType:"route",revalidateReason:(0,e9.getRevalidateReason)({isStaticGeneration:T,isOnDemandRevalidate:c})},d),t}},g=await iE.handleResponse({req:e,nextConfig:s,cacheKey:E,routeKind:ez.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:p,isRoutePPREnabled:!1,isOnDemandRevalidate:c,revalidateOnlyGenerated:h,responseGenerator:m,waitUntil:n.waitUntil,isMinimalMode:o});if(!_)return null;if((null==g||null==(a=g.value)?void 0:a.kind)!==tn.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==g||null==(f=g.value)?void 0:f.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",c?"REVALIDATED":g.isMiss?"MISS":g.isStale?"STALE":"HIT"),u&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let y=(0,e5.fromNodeOutgoingHttpHeaders)(g.value.headers);return o&&_||y.delete(te.NEXT_CACHE_TAGS_HEADER),!g.cacheControl||t.getHeader("Cache-Control")||y.get("Cache-Control")||y.set("Cache-Control",(0,e6.getCacheControlHeader)(g.cacheControl)),await (0,e8.sendResponse)(I,x,new Response(g.value.body,{headers:y,status:g.value.status||200})),null};C?await l(C):await O.withPropagatedContext(e.headers,()=>O.trace(e7.BaseServerSpan.handleRequest,{spanName:`${b} ${i}`,kind:eQ.SpanKind.SERVER,attributes:{"http.method":b,"http.target":e.url}},l))}catch(t){if(t instanceof tt.NoFallbackError||await iE.onRequestError(e,t,{routerKind:"App Router",routePath:y,routeType:"route",revalidateReason:(0,e9.getRevalidateReason)({isStaticGeneration:T,isOnDemandRevalidate:c})}),_)throw t;return await (0,e8.sendResponse)(I,x,new Response(null,{status:500})),null}}e.s(["handler",()=>iC,"patchFetch",()=>iO,"routeModule",()=>iE,"serverHooks",()=>ib,"workAsyncStorage",()=>iS,"workUnitAsyncStorage",()=>iT],22152)}];

//# sourceMappingURL=node_modules_56d058fe._.js.map