module.exports=[97953,(e,t,n)=>{"use strict";t.exports=e.r(42315).vendored["react-rsc"].ReactServerDOMTurbopackServer},45015,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"registerServerReference",{enumerable:!0,get:function(){return r.registerServerReference}});let r=e.r(97953)},64839,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,i,s,o,a,l,u,c,d,p,h,f,m={AppRenderSpan:function(){return T},AppRouteRouteHandlersSpan:function(){return w},BaseServerSpan:function(){return _},LoadComponentsSpan:function(){return y},LogSpanAllowList:function(){return P},MiddlewareSpan:function(){return I},NextNodeServerSpan:function(){return E},NextServerSpan:function(){return v},NextVanillaSpanAllowlist:function(){return R},NodeSpan:function(){return A},RenderSpan:function(){return S},ResolveMetadataSpan:function(){return C},RouterSpan:function(){return O},StartServerSpan:function(){return b}};for(var g in m)Object.defineProperty(n,g,{enumerable:!0,get:m[g]});var _=((r=_||{}).handleRequest="BaseServer.handleRequest",r.run="BaseServer.run",r.pipe="BaseServer.pipe",r.getStaticHTML="BaseServer.getStaticHTML",r.render="BaseServer.render",r.renderToResponseWithComponents="BaseServer.renderToResponseWithComponents",r.renderToResponse="BaseServer.renderToResponse",r.renderToHTML="BaseServer.renderToHTML",r.renderError="BaseServer.renderError",r.renderErrorToResponse="BaseServer.renderErrorToResponse",r.renderErrorToHTML="BaseServer.renderErrorToHTML",r.render404="BaseServer.render404",r),y=((i=y||{}).loadDefaultErrorComponents="LoadComponents.loadDefaultErrorComponents",i.loadComponents="LoadComponents.loadComponents",i),v=((s=v||{}).getRequestHandler="NextServer.getRequestHandler",s.getRequestHandlerWithMetadata="NextServer.getRequestHandlerWithMetadata",s.getServer="NextServer.getServer",s.getServerRequestHandler="NextServer.getServerRequestHandler",s.createServer="createServer.createServer",s),E=((o=E||{}).compression="NextNodeServer.compression",o.getBuildId="NextNodeServer.getBuildId",o.createComponentTree="NextNodeServer.createComponentTree",o.clientComponentLoading="NextNodeServer.clientComponentLoading",o.getLayoutOrPageModule="NextNodeServer.getLayoutOrPageModule",o.generateStaticRoutes="NextNodeServer.generateStaticRoutes",o.generateFsStaticRoutes="NextNodeServer.generateFsStaticRoutes",o.generatePublicRoutes="NextNodeServer.generatePublicRoutes",o.generateImageRoutes="NextNodeServer.generateImageRoutes.route",o.sendRenderResult="NextNodeServer.sendRenderResult",o.proxyRequest="NextNodeServer.proxyRequest",o.runApi="NextNodeServer.runApi",o.render="NextNodeServer.render",o.renderHTML="NextNodeServer.renderHTML",o.imageOptimizer="NextNodeServer.imageOptimizer",o.getPagePath="NextNodeServer.getPagePath",o.getRoutesManifest="NextNodeServer.getRoutesManifest",o.findPageComponents="NextNodeServer.findPageComponents",o.getFontManifest="NextNodeServer.getFontManifest",o.getServerComponentManifest="NextNodeServer.getServerComponentManifest",o.getRequestHandler="NextNodeServer.getRequestHandler",o.renderToHTML="NextNodeServer.renderToHTML",o.renderError="NextNodeServer.renderError",o.renderErrorToHTML="NextNodeServer.renderErrorToHTML",o.render404="NextNodeServer.render404",o.startResponse="NextNodeServer.startResponse",o.route="route",o.onProxyReq="onProxyReq",o.apiResolver="apiResolver",o.internalFetch="internalFetch",o),b=((a=b||{}).startServer="startServer.startServer",a),S=((l=S||{}).getServerSideProps="Render.getServerSideProps",l.getStaticProps="Render.getStaticProps",l.renderToString="Render.renderToString",l.renderDocument="Render.renderDocument",l.createBodyResult="Render.createBodyResult",l),T=((u=T||{}).renderToString="AppRender.renderToString",u.renderToReadableStream="AppRender.renderToReadableStream",u.getBodyResult="AppRender.getBodyResult",u.fetch="AppRender.fetch",u),O=((c=O||{}).executeRoute="Router.executeRoute",c),A=((d=A||{}).runHandler="Node.runHandler",d),w=((p=w||{}).runHandler="AppRouteRouteHandlers.runHandler",p),C=((h=C||{}).generateMetadata="ResolveMetadata.generateMetadata",h.generateViewport="ResolveMetadata.generateViewport",h),I=((f=I||{}).execute="Middleware.execute",f);let R=["Middleware.execute","BaseServer.handleRequest","Render.getServerSideProps","Render.getStaticProps","AppRender.fetch","AppRender.getBodyResult","Render.renderDocument","Node.runHandler","AppRouteRouteHandlers.runHandler","ResolveMetadata.generateMetadata","ResolveMetadata.generateViewport","NextNodeServer.createComponentTree","NextNodeServer.findPageComponents","NextNodeServer.getLayoutOrPageModule","NextNodeServer.startResponse","NextNodeServer.clientComponentLoading"],P=["NextNodeServer.findPageComponents","NextNodeServer.createComponentTree","NextNodeServer.clientComponentLoading"]},31846,(e,t,n)=>{"use strict";function r(e){return null!==e&&"object"==typeof e&&"then"in e&&"function"==typeof e.then}Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"isThenable",{enumerable:!0,get:function(){return r}})},36851,(e,t,n)=>{"use strict";let r,i;Object.defineProperty(n,"__esModule",{value:!0});var s={BubbledError:function(){return m},SpanKind:function(){return h},SpanStatusCode:function(){return p},getTracer:function(){return S},isBubbledError:function(){return g}};for(var o in s)Object.defineProperty(n,o,{enumerable:!0,get:s[o]});let a=e.r(64839),l=e.r(31846);try{r=e.r(70406)}catch(t){r=e.r(17413)}let{context:u,propagation:c,trace:d,SpanStatusCode:p,SpanKind:h,ROOT_CONTEXT:f}=r;class m extends Error{constructor(e,t){super(),this.bubble=e,this.result=t}}function g(e){return"object"==typeof e&&null!==e&&e instanceof m}let _=(e,t)=>{g(t)&&t.bubble?e.setAttribute("next.bubble",!0):(t&&(e.recordException(t),e.setAttribute("error.type",t.name)),e.setStatus({code:p.ERROR,message:null==t?void 0:t.message})),e.end()},y=new Map,v=r.createContextKey("next.rootSpanId"),E=0,b={set(e,t,n){e.push({key:t,value:n})}},S=(i=new class e{getTracerInstance(){return d.getTracer("next.js","0.0.1")}getContext(){return u}getTracePropagationData(){let e=u.active(),t=[];return c.inject(e,t,b),t}getActiveScopeSpan(){return d.getSpan(null==u?void 0:u.active())}withPropagatedContext(e,t,n){let r=u.active();if(d.getSpanContext(r))return t();let i=c.extract(r,e,n);return u.with(i,t)}trace(...e){var t;let[n,r,i]=e,{fn:s,options:o}="function"==typeof r?{fn:r,options:{}}:{fn:i,options:{...r}},c=o.spanName??n;if(!a.NextVanillaSpanAllowlist.includes(n)&&"1"!==process.env.NEXT_OTEL_VERBOSE||o.hideSpan)return s();let p=this.getSpanContext((null==o?void 0:o.parentSpan)??this.getActiveScopeSpan()),h=!1;p?(null==(t=d.getSpanContext(p))?void 0:t.isRemote)&&(h=!0):(p=(null==u?void 0:u.active())??f,h=!0);let m=E++;return o.attributes={"next.span_name":c,"next.span_type":n,...o.attributes},u.with(p.setValue(v,m),()=>this.getTracerInstance().startActiveSpan(c,o,e=>{let t="performance"in globalThis&&"measure"in performance?globalThis.performance.now():void 0,r=()=>{y.delete(m),t&&process.env.NEXT_OTEL_PERFORMANCE_PREFIX&&a.LogSpanAllowList.includes(n||"")&&performance.measure(`${process.env.NEXT_OTEL_PERFORMANCE_PREFIX}:next-${(n.split(".").pop()||"").replace(/[A-Z]/g,e=>"-"+e.toLowerCase())}`,{start:t,end:performance.now()})};h&&y.set(m,new Map(Object.entries(o.attributes??{})));try{if(s.length>1)return s(e,t=>_(e,t));let t=s(e);if((0,l.isThenable)(t))return t.then(t=>(e.end(),t)).catch(t=>{throw _(e,t),t}).finally(r);return e.end(),r(),t}catch(t){throw _(e,t),r(),t}}))}wrap(...e){let t=this,[n,r,i]=3===e.length?e:[e[0],{},e[1]];return a.NextVanillaSpanAllowlist.includes(n)||"1"===process.env.NEXT_OTEL_VERBOSE?function(){let e=r;"function"==typeof e&&"function"==typeof i&&(e=e.apply(this,arguments));let s=arguments.length-1,o=arguments[s];if("function"!=typeof o)return t.trace(n,e,()=>i.apply(this,arguments));{let r=t.getContext().bind(u.active(),o);return t.trace(n,e,(e,t)=>(arguments[s]=function(e){return null==t||t(e),r.apply(this,arguments)},i.apply(this,arguments)))}}:i}startSpan(...e){let[t,n]=e,r=this.getSpanContext((null==n?void 0:n.parentSpan)??this.getActiveScopeSpan());return this.getTracerInstance().startSpan(t,n,r)}getSpanContext(e){return e?d.setSpan(u.active(),e):void 0}getRootSpanAttributes(){let e=u.active().getValue(v);return y.get(e)}setRootSpanAttribute(e,t){let n=u.active().getValue(v),r=y.get(n);r&&!r.has(e)&&r.set(e,t)}},()=>i)},66953,(e,t,n)=>{"use strict";let r;Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"cloneResponse",{enumerable:!0,get:function(){return s}});let i=()=>{};function s(e){if(!e.body)return[e,e];let[t,n]=e.body.tee(),i=new Response(t,{status:e.status,statusText:e.statusText,headers:e.headers});Object.defineProperty(i,"url",{value:e.url,configurable:!0,enumerable:!0,writable:!1}),r&&i.body&&r.register(i,new WeakRef(i.body));let s=new Response(n,{status:e.status,statusText:e.statusText,headers:e.headers});return Object.defineProperty(s,"url",{value:e.url,configurable:!0,enumerable:!0,writable:!1}),[i,s]}globalThis.FinalizationRegistry&&(r=new FinalizationRegistry(e=>{let t=e.deref();t&&!t.locked&&t.cancel("Response object has been garbage collected").then(i)}))},42966,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"createDedupeFetch",{enumerable:!0,get:function(){return l}});let r=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=o(void 0);if(n&&n.has(e))return n.get(e);var r={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var a=i?Object.getOwnPropertyDescriptor(e,s):null;a&&(a.get||a.set)?Object.defineProperty(r,s,a):r[s]=e[s]}return r.default=e,n&&n.set(e,r),r}(e.r(47540)),i=e.r(66953),s=e.r(76414);function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(o=function(e){return e?n:t})(e)}let a=new Set(["traceparent","tracestate"]);function l(e){let t=r.cache(e=>[]);return function(n,r){let o,l;if(r&&r.signal)return e(n,r);if("string"!=typeof n||r){let t,i="string"==typeof n||n instanceof URL?new Request(n,r):n;if("GET"!==i.method&&"HEAD"!==i.method||i.keepalive)return e(n,r);t=Array.from(i.headers.entries()).filter(([e])=>!a.has(e.toLowerCase())),l=JSON.stringify([i.method,t,i.mode,i.redirect,i.credentials,i.referrer,i.referrerPolicy,i.integrity]),o=i.url}else l='["GET",[],null,"follow",null,null,null,null]',o=n;let u=t(o);for(let e=0,t=u.length;e<t;e+=1){let[t,n]=u[e];if(t===l)return n.then(()=>{let t=u[e][2];if(!t)throw Object.defineProperty(new s.InvariantError("No cached response"),"__NEXT_ERROR_CODE",{value:"E579",enumerable:!1,configurable:!0});let[n,r]=(0,i.cloneResponse)(t);return u[e][2]=r,n})}let c=e(n,r),d=[l,c,null];return u.push(d),c.then(e=>{let[t,n]=(0,i.cloneResponse)(e);return d[2]=n,t})}}},86082,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,i,s={CachedRouteKind:function(){return a},IncrementalCacheKind:function(){return l}};for(var o in s)Object.defineProperty(n,o,{enumerable:!0,get:s[o]});var a=((r={}).APP_PAGE="APP_PAGE",r.APP_ROUTE="APP_ROUTE",r.PAGES="PAGES",r.FETCH="FETCH",r.REDIRECT="REDIRECT",r.IMAGE="IMAGE",r),l=((i={}).APP_PAGE="APP_PAGE",i.APP_ROUTE="APP_ROUTE",i.PAGES="PAGES",i.FETCH="FETCH",i.IMAGE="IMAGE",i)},98725,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"DetachedPromise",{enumerable:!0,get:function(){return r}});class r{constructor(){let e,t;this.promise=new Promise((n,r)=>{e=n,t=r}),this.resolve=e,this.reject=t}}},46518,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"Batcher",{enumerable:!0,get:function(){return i}});let r=e.r(98725);class i{constructor(e,t=e=>e()){this.cacheKeyFn=e,this.schedulerFn=t,this.pending=new Map}static create(e){return new i(null==e?void 0:e.cacheKeyFn,null==e?void 0:e.schedulerFn)}async batch(e,t){let n=this.cacheKeyFn?await this.cacheKeyFn(e):e;if(null===n)return t({resolve:e=>Promise.resolve(e),key:e});let i=this.pending.get(n);if(i)return i;let{promise:s,resolve:o,reject:a}=new r.DetachedPromise;return this.pending.set(n,s),this.schedulerFn(async()=>{try{let n=await t({resolve:o,key:e});o(n)}catch(e){a(e)}finally{this.pending.delete(n)}}),s}}},46177,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"ENCODED_TAGS",{enumerable:!0,get:function(){return r}});let r={OPENING:{HTML:new Uint8Array([60,104,116,109,108]),BODY:new Uint8Array([60,98,111,100,121])},CLOSED:{HEAD:new Uint8Array([60,47,104,101,97,100,62]),BODY:new Uint8Array([60,47,98,111,100,121,62]),HTML:new Uint8Array([60,47,104,116,109,108,62]),BODY_AND_HTML:new Uint8Array([60,47,98,111,100,121,62,60,47,104,116,109,108,62])},META:{ICON_MARK:new Uint8Array([60,109,101,116,97,32,110,97,109,101,61,34,194,171,110,120,116,45,105,99,111,110,194,187,34])}}},45144,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={indexOfUint8Array:function(){return s},isEquivalentUint8Arrays:function(){return o},removeFromUint8Array:function(){return a}};for(var i in r)Object.defineProperty(n,i,{enumerable:!0,get:r[i]});function s(e,t){if(0===t.length)return 0;if(0===e.length||t.length>e.length)return -1;for(let n=0;n<=e.length-t.length;n++){let r=!0;for(let i=0;i<t.length;i++)if(e[n+i]!==t[i]){r=!1;break}if(r)return n}return -1}function o(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function a(e,t){let n=s(e,t);if(0===n)return e.subarray(t.length);if(!(n>-1))return e;{let r=new Uint8Array(e.length-t.length);return r.set(e.slice(0,n)),r.set(e.slice(n+t.length),n),r}}},40724,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"MISSING_ROOT_TAGS_ERROR",{enumerable:!0,get:function(){return r}});let r="NEXT_MISSING_ROOT_TAGS";("function"==typeof n.default||"object"==typeof n.default&&null!==n.default)&&void 0===n.default.__esModule&&(Object.defineProperty(n.default,"__esModule",{value:!0}),Object.assign(n.default,n),t.exports=n.default)},8946,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={DOC_PREFETCH_RANGE_HEADER_VALUE:function(){return o},doesExportedHtmlMatchBuildId:function(){return u},insertBuildIdComment:function(){return l}};for(var i in r)Object.defineProperty(n,i,{enumerable:!0,get:r[i]});let s="<!DOCTYPE html>",o="bytes=0-63";function a(e){return e.slice(0,24).replace(/-/g,"_")}function l(e,t){return t.includes("-->")||!e.startsWith(s)?e:e.replace(s,s+"<!--"+a(t)+"-->")}function u(e,t){return e.startsWith(s+"<!--"+a(t)+"-->")}},64851,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={ACTION_HEADER:function(){return o},FLIGHT_HEADERS:function(){return f},NEXT_ACTION_NOT_FOUND_HEADER:function(){return b},NEXT_DID_POSTPONE_HEADER:function(){return _},NEXT_HMR_REFRESH_HASH_COOKIE:function(){return d},NEXT_HMR_REFRESH_HEADER:function(){return c},NEXT_HTML_REQUEST_ID_HEADER:function(){return T},NEXT_IS_PRERENDER_HEADER:function(){return E},NEXT_REQUEST_ID_HEADER:function(){return S},NEXT_REWRITTEN_PATH_HEADER:function(){return y},NEXT_REWRITTEN_QUERY_HEADER:function(){return v},NEXT_ROUTER_PREFETCH_HEADER:function(){return l},NEXT_ROUTER_SEGMENT_PREFETCH_HEADER:function(){return u},NEXT_ROUTER_STALE_TIME_HEADER:function(){return g},NEXT_ROUTER_STATE_TREE_HEADER:function(){return a},NEXT_RSC_UNION_QUERY:function(){return m},NEXT_URL:function(){return p},RSC_CONTENT_TYPE_HEADER:function(){return h},RSC_HEADER:function(){return s}};for(var i in r)Object.defineProperty(n,i,{enumerable:!0,get:r[i]});let s="rsc",o="next-action",a="next-router-state-tree",l="next-router-prefetch",u="next-router-segment-prefetch",c="next-hmr-refresh",d="__next_hmr_refresh_hash__",p="next-url",h="text/x-component",f=[s,a,l,c,u],m="_rsc",g="x-nextjs-stale-time",_="x-nextjs-postponed",y="x-nextjs-rewritten-path",v="x-nextjs-rewritten-query",E="x-nextjs-prerender",b="x-nextjs-action-not-found",S="x-nextjs-request-id",T="x-nextjs-html-request-id";("function"==typeof n.default||"object"==typeof n.default&&null!==n.default)&&void 0===n.default.__esModule&&(Object.defineProperty(n.default,"__esModule",{value:!0}),Object.assign(n.default,n),t.exports=n.default)},67510,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={djb2Hash:function(){return s},hexHash:function(){return o}};for(var i in r)Object.defineProperty(n,i,{enumerable:!0,get:r[i]});function s(e){let t=5381;for(let n=0;n<e.length;n++)t=(t<<5)+t+e.charCodeAt(n)|0;return t>>>0}function o(e){return s(e).toString(36).slice(0,5)}},60091,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"computeCacheBustingSearchParam",{enumerable:!0,get:function(){return i}});let r=e.r(67510);function i(e,t,n,i){return(void 0===e||"0"===e)&&void 0===t&&void 0===n&&void 0===i?"":(0,r.hexHash)([e||"0",t||"0",n||"0",i||"0"].join(","))}},56682,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={chainStreams:function(){return _},continueDynamicHTMLResume:function(){return D},continueDynamicPrerender:function(){return x},continueFizzStream:function(){return N},continueStaticFallbackPrerender:function(){return M},continueStaticPrerender:function(){return k},createBufferedTransformStream:function(){return S},createDocumentClosingStream:function(){return L},createRootLayoutValidatorStream:function(){return P},renderToInitialFizzStream:function(){return O},streamFromBuffer:function(){return v},streamFromString:function(){return y},streamToBuffer:function(){return E},streamToString:function(){return b}};for(var i in r)Object.defineProperty(n,i,{enumerable:!0,get:r[i]});let s=e.r(36851),o=e.r(64839),a=e.r(98725),l=e.r(38244),u=e.r(46177),c=e.r(45144),d=e.r(40724),p=e.r(8946),h=e.r(64851),f=e.r(60091);function m(){}let g=new TextEncoder;function _(...e){if(0===e.length)return new ReadableStream({start(e){e.close()}});if(1===e.length)return e[0];let{readable:t,writable:n}=new TransformStream,r=e[0].pipeTo(n,{preventClose:!0}),i=1;for(;i<e.length-1;i++){let t=e[i];r=r.then(()=>t.pipeTo(n,{preventClose:!0}))}let s=e[i];return(r=r.then(()=>s.pipeTo(n))).catch(m),t}function y(e){return new ReadableStream({start(t){t.enqueue(g.encode(e)),t.close()}})}function v(e){return new ReadableStream({start(t){t.enqueue(e),t.close()}})}async function E(e){let t=e.getReader(),n=[];for(;;){let{done:e,value:r}=await t.read();if(e)break;n.push(r)}return Buffer.concat(n)}async function b(e,t){let n=new TextDecoder("utf-8",{fatal:!0}),r="";for await(let i of e){if(null==t?void 0:t.aborted)return r;r+=n.decode(i,{stream:!0})}return r+n.decode()}function S(e={}){let t,{maxBufferByteLength:n=1/0}=e,r=[],i=0,s=e=>{try{if(0===r.length)return;let t=new Uint8Array(i),n=0;for(let e=0;e<r.length;e++){let i=r[e];t.set(i,n),n+=i.byteLength}r.length=0,i=0,e.enqueue(t)}catch{}};return new TransformStream({transform(e,o){r.push(e),(i+=e.byteLength)>=n?s(o):(e=>{if(t)return;let n=new a.DetachedPromise;t=n,(0,l.scheduleImmediate)(()=>{try{s(e)}finally{t=void 0,n.resolve()}})})(o)},flush:()=>null==t?void 0:t.promise})}function T(e,t){let n=!1;return new TransformStream({transform(r,i){if(e&&!n){n=!0;let e=new TextDecoder("utf-8",{fatal:!0}).decode(r,{stream:!0}),s=(0,p.insertBuildIdComment)(e,t);i.enqueue(g.encode(s));return}i.enqueue(r)}})}function O({ReactDOMServer:e,element:t,streamOptions:n}){return(0,s.getTracer)().trace(o.AppRenderSpan.renderToReadableStream,async()=>e.renderToReadableStream(t,n))}function A(e){let t=-1,n=!1;return new TransformStream({async transform(r,i){let s=-1,o=-1;if(t++,n)return void i.enqueue(r);let a=0;if(-1===s){if(-1===(s=(0,c.indexOfUint8Array)(r,u.ENCODED_TAGS.META.ICON_MARK)))return void i.enqueue(r);47===r[s+(a=u.ENCODED_TAGS.META.ICON_MARK.length)]?a+=2:a++}if(0===t){if(o=(0,c.indexOfUint8Array)(r,u.ENCODED_TAGS.CLOSED.HEAD),-1!==s){if(s<o){let e=new Uint8Array(r.length-a);e.set(r.subarray(0,s)),e.set(r.subarray(s+a),s),r=e}else{let t=await e(),n=g.encode(t),i=n.length,o=new Uint8Array(r.length-a+i);o.set(r.subarray(0,s)),o.set(n,s),o.set(r.subarray(s+a),s+i),r=o}n=!0}}else{let t=await e(),i=g.encode(t),o=i.length,l=new Uint8Array(r.length-a+o);l.set(r.subarray(0,s)),l.set(i,s),l.set(r.subarray(s+a),s+o),r=l,n=!0}i.enqueue(r)}})}function w(e){let t=!1,n=!1;return new TransformStream({async transform(r,i){n=!0;let s=await e();if(t){if(s){let e=g.encode(s);i.enqueue(e)}i.enqueue(r)}else{let e=(0,c.indexOfUint8Array)(r,u.ENCODED_TAGS.CLOSED.HEAD);if(-1!==e){if(s){let t=g.encode(s),n=new Uint8Array(r.length+t.length);n.set(r.slice(0,e)),n.set(t,e),n.set(r.slice(e),e+t.length),i.enqueue(n)}else i.enqueue(r);t=!0}else s&&i.enqueue(g.encode(s)),i.enqueue(r),t=!0}},async flush(t){if(n){let n=await e();n&&t.enqueue(g.encode(n))}}})}function C(e,t){let n=!1,r=null,i=!1;function s(e){return r||(r=o(e)),r}async function o(r){let s=e.getReader();t&&await (0,l.atLeastOneTask)();try{for(;;){let{done:e,value:o}=await s.read();if(e){i=!0;return}t||n||await (0,l.atLeastOneTask)(),r.enqueue(o)}}catch(e){r.error(e)}}return new TransformStream({start(e){t||s(e)},transform(e,n){n.enqueue(e),t&&s(n)},flush(e){if(n=!0,!i)return s(e)}})}let I="</body></html>";function R(){let e=!1;return new TransformStream({transform(t,n){if(e)return n.enqueue(t);let r=(0,c.indexOfUint8Array)(t,u.ENCODED_TAGS.CLOSED.BODY_AND_HTML);if(r>-1){if(e=!0,t.length===u.ENCODED_TAGS.CLOSED.BODY_AND_HTML.length)return;let i=t.slice(0,r);if(n.enqueue(i),t.length>u.ENCODED_TAGS.CLOSED.BODY_AND_HTML.length+r){let e=t.slice(r+u.ENCODED_TAGS.CLOSED.BODY_AND_HTML.length);n.enqueue(e)}}else n.enqueue(t)},flush(e){e.enqueue(u.ENCODED_TAGS.CLOSED.BODY_AND_HTML)}})}function P(){let e=!1,t=!1;return new TransformStream({async transform(n,r){!e&&(0,c.indexOfUint8Array)(n,u.ENCODED_TAGS.OPENING.HTML)>-1&&(e=!0),!t&&(0,c.indexOfUint8Array)(n,u.ENCODED_TAGS.OPENING.BODY)>-1&&(t=!0),r.enqueue(n)},flush(n){let r=[];e||r.push("html"),t||r.push("body"),r.length&&n.enqueue(g.encode(`<html id="__next_error__">
            <template
              data-next-error-message="Missing ${r.map(e=>`<${e}>`).join(r.length>1?" and ":"")} tags in the root layout.
Read more at https://nextjs.org/docs/messages/missing-root-layout-tags"
              data-next-error-digest="${d.MISSING_ROOT_TAGS_ERROR}"
              data-next-error-stack=""
            ></template>
          `))}})}async function N(e,{suffix:t,inlinedDataStream:n,isStaticGeneration:r,isBuildTimePrerendering:i,buildId:s,getServerInsertedHTML:o,getServerInsertedMetadata:u,validateRootLayout:c}){let d,p,h=t?t.split(I,1)[0]:null;r&&await e.allReady;var f=[S(),T(i,s),A(u),null!=h&&h.length>0?(p=!1,new TransformStream({transform(e,t){if(t.enqueue(e),!p){let e;p=!0,d=e=new a.DetachedPromise,(0,l.scheduleImmediate)(()=>{try{t.enqueue(g.encode(h))}catch{}finally{d=void 0,e.resolve()}})}},flush(e){if(d)return d.promise;p||e.enqueue(g.encode(h))}})):null,n?C(n,!0):null,c?P():null,R(),w(o)];let m=e;for(let e of f)e&&(m=m.pipeThrough(e));return m}async function x(e,{getServerInsertedHTML:t,getServerInsertedMetadata:n}){return e.pipeThrough(S()).pipeThrough(new TransformStream({transform(e,t){(0,c.isEquivalentUint8Arrays)(e,u.ENCODED_TAGS.CLOSED.BODY_AND_HTML)||(0,c.isEquivalentUint8Arrays)(e,u.ENCODED_TAGS.CLOSED.BODY)||(0,c.isEquivalentUint8Arrays)(e,u.ENCODED_TAGS.CLOSED.HTML)||(e=(0,c.removeFromUint8Array)(e,u.ENCODED_TAGS.CLOSED.BODY),e=(0,c.removeFromUint8Array)(e,u.ENCODED_TAGS.CLOSED.HTML),t.enqueue(e))}})).pipeThrough(w(t)).pipeThrough(A(n))}async function k(e,{inlinedDataStream:t,getServerInsertedHTML:n,getServerInsertedMetadata:r,isBuildTimePrerendering:i,buildId:s}){return e.pipeThrough(S()).pipeThrough(T(i,s)).pipeThrough(w(n)).pipeThrough(A(r)).pipeThrough(C(t,!0)).pipeThrough(R())}async function M(e,{inlinedDataStream:t,getServerInsertedHTML:n,getServerInsertedMetadata:r,isBuildTimePrerendering:i,buildId:s}){let o,a,l,d;return e.pipeThrough(S()).pipeThrough(T(i,s)).pipeThrough(w(n)).pipeThrough((o=(0,f.computeCacheBustingSearchParam)("1","/_full",void 0,void 0),a=`${h.NEXT_RSC_UNION_QUERY}=${o}`,l=`<script>__NEXT_CLIENT_RESUME=fetch(location.pathname+'?${a}',{credentials:'same-origin',headers:{'${h.RSC_HEADER}': '1','${h.NEXT_ROUTER_PREFETCH_HEADER}': '1','${h.NEXT_ROUTER_SEGMENT_PREFETCH_HEADER}': '/_full'}})</script>`,d=!1,new TransformStream({transform(e,t){if(d)return void t.enqueue(e);let n=(0,c.indexOfUint8Array)(e,u.ENCODED_TAGS.CLOSED.HEAD);if(-1===n)return void t.enqueue(e);let r=g.encode(l),i=new Uint8Array(e.length+r.length);i.set(e.slice(0,n)),i.set(r,n),i.set(e.slice(n),n+r.length),t.enqueue(i),d=!0}}))).pipeThrough(A(r)).pipeThrough(C(t,!0)).pipeThrough(R())}async function D(e,{delayDataUntilFirstHtmlChunk:t,inlinedDataStream:n,getServerInsertedHTML:r,getServerInsertedMetadata:i}){return e.pipeThrough(S()).pipeThrough(w(r)).pipeThrough(A(i)).pipeThrough(C(n,t)).pipeThrough(R())}function L(){return y(I)}},13472,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={NEXT_REQUEST_META:function(){return s},addRequestMeta:function(){return l},getRequestMeta:function(){return o},removeRequestMeta:function(){return u},setRequestMeta:function(){return a}};for(var i in r)Object.defineProperty(n,i,{enumerable:!0,get:r[i]});let s=Symbol.for("NextInternalRequestMeta");function o(e,t){let n=e[s]||{};return"string"==typeof t?n[t]:n}function a(e,t){return e[s]=t,t}function l(e,t,n){let r=o(e);return r[t]=n,a(e,r)}function u(e,t){let n=o(e);return delete n[t],a(e,n)}},20557,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={isNodeNextRequest:function(){return a},isNodeNextResponse:function(){return l},isWebNextRequest:function(){return s},isWebNextResponse:function(){return o}};for(var i in r)Object.defineProperty(n,i,{enumerable:!0,get:r[i]});let s=e=>!1,o=e=>!1,a=e=>!0,l=e=>!0},4649,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={NextRequestAdapter:function(){return h},ResponseAborted:function(){return c},ResponseAbortedName:function(){return u},createAbortController:function(){return d},signalFromNodeResponse:function(){return p}};for(var i in r)Object.defineProperty(n,i,{enumerable:!0,get:r[i]});let s=e.r(13472),o=e.r(80333),a=e.r(29666),l=e.r(20557),u="ResponseAborted";class c extends Error{constructor(...e){super(...e),this.name=u}}function d(e){let t=new AbortController;return e.once("close",()=>{e.writableFinished||t.abort(new c)}),t}function p(e){let{errored:t,destroyed:n}=e;if(t||n)return AbortSignal.abort(t??new c);let{signal:r}=d(e);return r}class h{static fromBaseNextRequest(e,t){if((0,l.isNodeNextRequest)(e))return h.fromNodeNextRequest(e,t);throw Object.defineProperty(Error("Invariant: Unsupported NextRequest type"),"__NEXT_ERROR_CODE",{value:"E345",enumerable:!1,configurable:!0})}static fromNodeNextRequest(e,t){let n,r=null;if("GET"!==e.method&&"HEAD"!==e.method&&e.body&&(r=e.body),e.url.startsWith("http"))n=new URL(e.url);else{let t=(0,s.getRequestMeta)(e,"initURL");n=t&&t.startsWith("http")?new URL(e.url,t):new URL(e.url,"http://n")}return new a.NextRequest(n,{method:e.method,headers:(0,o.fromNodeOutgoingHttpHeaders)(e.headers),duplex:"half",signal:t,...t.aborted?{}:{body:r}})}static fromWebNextRequest(e){let t=null;return"GET"!==e.method&&"HEAD"!==e.method&&(t=e.body),new a.NextRequest(e.url,{method:e.method,headers:(0,o.fromNodeOutgoingHttpHeaders)(e.headers),duplex:"half",signal:e.request.signal,...e.request.signal.aborted?{}:{body:t}})}}},61136,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={getClientComponentLoaderMetrics:function(){return u},wrapClientComponentLoader:function(){return l}};for(var i in r)Object.defineProperty(n,i,{enumerable:!0,get:r[i]});let s=0,o=0,a=0;function l(e){return"performance"in globalThis?{require:(...t)=>{let n=performance.now();0===s&&(s=n);try{return a+=1,e.__next_app__.require(...t)}finally{o+=performance.now()-n}},loadChunk:(...t)=>{let n=performance.now(),r=e.__next_app__.loadChunk(...t);return r.finally(()=>{o+=performance.now()-n}),r}}:e.__next_app__}function u(e={}){let t=0===s?void 0:{clientComponentLoadStart:s,clientComponentLoadTimes:o,clientComponentLoadCount:a};return e.reset&&(s=0,o=0,a=0),t}},78544,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={isAbortError:function(){return c},pipeToNodeResponse:function(){return d}};for(var i in r)Object.defineProperty(n,i,{enumerable:!0,get:r[i]});let s=e.r(4649),o=e.r(98725),a=e.r(36851),l=e.r(64839),u=e.r(61136);function c(e){return(null==e?void 0:e.name)==="AbortError"||(null==e?void 0:e.name)===s.ResponseAbortedName}async function d(e,t,n){try{let{errored:r,destroyed:i}=t;if(r||i)return;let c=(0,s.createAbortController)(t),d=function(e,t){let n=!1,r=new o.DetachedPromise;function i(){r.resolve()}e.on("drain",i),e.once("close",()=>{e.off("drain",i),r.resolve()});let s=new o.DetachedPromise;return e.once("finish",()=>{s.resolve()}),new WritableStream({write:async t=>{if(!n){if(n=!0,"performance"in globalThis&&process.env.NEXT_OTEL_PERFORMANCE_PREFIX){let e=(0,u.getClientComponentLoaderMetrics)();e&&performance.measure(`${process.env.NEXT_OTEL_PERFORMANCE_PREFIX}:next-client-component-loading`,{start:e.clientComponentLoadStart,end:e.clientComponentLoadStart+e.clientComponentLoadTimes})}e.flushHeaders(),(0,a.getTracer)().trace(l.NextNodeServerSpan.startResponse,{spanName:"start response"},()=>void 0)}try{let n=e.write(t);"flush"in e&&"function"==typeof e.flush&&e.flush(),n||(await r.promise,r=new o.DetachedPromise)}catch(t){throw e.end(),Object.defineProperty(Error("failed to write chunk to response",{cause:t}),"__NEXT_ERROR_CODE",{value:"E321",enumerable:!1,configurable:!0})}},abort:t=>{e.writableFinished||e.destroy(t)},close:async()=>{if(t&&await t,!e.writableFinished)return e.end(),s.promise}})}(t,n);await e.pipeTo(d,{signal:c.signal})}catch(e){if(c(e))return;throw Object.defineProperty(Error("failed to pipe response",{cause:e}),"__NEXT_ERROR_CODE",{value:"E180",enumerable:!1,configurable:!0})}}},82490,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"default",{enumerable:!0,get:function(){return o}});let r=e.r(56682),i=e.r(78544),s=e.r(76414);class o{static #e=this.EMPTY=new o(null,{metadata:{},contentType:null});static fromStatic(e,t){return new o(e,{metadata:{},contentType:t})}constructor(e,{contentType:t,waitUntil:n,metadata:r}){this.response=e,this.contentType=t,this.metadata=r,this.waitUntil=n}assignMetadata(e){Object.assign(this.metadata,e)}get isNull(){return null===this.response}get isDynamic(){return"string"!=typeof this.response}toUnchunkedString(e=!1){if(null===this.response)return"";if("string"!=typeof this.response){if(!e)throw Object.defineProperty(new s.InvariantError("dynamic responses cannot be unchunked. This is a bug in Next.js"),"__NEXT_ERROR_CODE",{value:"E732",enumerable:!1,configurable:!0});return(0,r.streamToString)(this.readable)}return this.response}get readable(){return null===this.response?new ReadableStream({start(e){e.close()}}):"string"==typeof this.response?(0,r.streamFromString)(this.response):Buffer.isBuffer(this.response)?(0,r.streamFromBuffer)(this.response):Array.isArray(this.response)?(0,r.chainStreams)(...this.response):this.response}coerce(){return null===this.response?[]:"string"==typeof this.response?[(0,r.streamFromString)(this.response)]:Array.isArray(this.response)?this.response:Buffer.isBuffer(this.response)?[(0,r.streamFromBuffer)(this.response)]:[this.response]}unshift(e){this.response=this.coerce(),this.response.unshift(e)}push(e){this.response=this.coerce(),this.response.push(e)}async pipeTo(e){try{await this.readable.pipeTo(e,{preventClose:!0}),this.waitUntil&&await this.waitUntil,await e.close()}catch(t){if((0,i.isAbortError)(t))return void await e.abort(t);throw t}}async pipeToNodeResponse(e){await (0,i.pipeToNodeResponse)(this.readable,e,this.waitUntil)}}},2222,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"RouteKind",{enumerable:!0,get:function(){return i}});var r,i=((r={}).PAGES="PAGES",r.PAGES_API="PAGES_API",r.APP_PAGE="APP_PAGE",r.APP_ROUTE="APP_ROUTE",r.IMAGE="IMAGE",r)},22536,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,i={fromResponseCacheEntry:function(){return c},routeKindToIncrementalCacheKind:function(){return p},toResponseCacheEntry:function(){return d}};for(var s in i)Object.defineProperty(n,s,{enumerable:!0,get:i[s]});let o=e.r(86082),a=(r=e.r(82490))&&r.__esModule?r:{default:r},l=e.r(2222),u=e.r(91401);async function c(e){var t,n;return{...e,value:(null==(t=e.value)?void 0:t.kind)===o.CachedRouteKind.PAGES?{kind:o.CachedRouteKind.PAGES,html:await e.value.html.toUnchunkedString(!0),pageData:e.value.pageData,headers:e.value.headers,status:e.value.status}:(null==(n=e.value)?void 0:n.kind)===o.CachedRouteKind.APP_PAGE?{kind:o.CachedRouteKind.APP_PAGE,html:await e.value.html.toUnchunkedString(!0),postponed:e.value.postponed,rscData:e.value.rscData,headers:e.value.headers,status:e.value.status,segmentData:e.value.segmentData}:e.value}}async function d(e){var t,n;return e?{isMiss:e.isMiss,isStale:e.isStale,cacheControl:e.cacheControl,value:(null==(t=e.value)?void 0:t.kind)===o.CachedRouteKind.PAGES?{kind:o.CachedRouteKind.PAGES,html:a.default.fromStatic(e.value.html,u.HTML_CONTENT_TYPE_HEADER),pageData:e.value.pageData,headers:e.value.headers,status:e.value.status}:(null==(n=e.value)?void 0:n.kind)===o.CachedRouteKind.APP_PAGE?{kind:o.CachedRouteKind.APP_PAGE,html:a.default.fromStatic(e.value.html,u.HTML_CONTENT_TYPE_HEADER),rscData:e.value.rscData,headers:e.value.headers,status:e.value.status,postponed:e.value.postponed,segmentData:e.value.segmentData}:e.value}:null}function p(e){switch(e){case l.RouteKind.PAGES:return o.IncrementalCacheKind.PAGES;case l.RouteKind.APP_PAGE:return o.IncrementalCacheKind.APP_PAGE;case l.RouteKind.IMAGE:return o.IncrementalCacheKind.IMAGE;case l.RouteKind.APP_ROUTE:return o.IncrementalCacheKind.APP_ROUTE;case l.RouteKind.PAGES_API:throw Object.defineProperty(Error(`Unexpected route kind ${e}`),"__NEXT_ERROR_CODE",{value:"E64",enumerable:!1,configurable:!0});default:return e}}},88119,(e,t,n)=>{"use strict";var r,i;Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"default",{enumerable:!0,get:function(){return l}});let s=e.r(46518),o=e.r(38244),a=e.r(22536);r=e.r(86082),i=n,Object.keys(r).forEach(function(e){"default"===e||Object.prototype.hasOwnProperty.call(i,e)||Object.defineProperty(i,e,{enumerable:!0,get:function(){return r[e]}})});class l{constructor(e){this.getBatcher=s.Batcher.create({cacheKeyFn:({key:e,isOnDemandRevalidate:t})=>`${e}-${t?"1":"0"}`,schedulerFn:o.scheduleOnNextTick}),this.revalidateBatcher=s.Batcher.create({schedulerFn:o.scheduleOnNextTick}),this.minimal_mode=e}async get(e,t,n){var r;if(!e)return t({hasResolved:!1,previousCacheEntry:null});if(this.minimal_mode&&(null==(r=this.previousCacheItem)?void 0:r.key)===e&&this.previousCacheItem.expiresAt>Date.now())return(0,a.toResponseCacheEntry)(this.previousCacheItem.entry);let{incrementalCache:i,isOnDemandRevalidate:s=!1,isFallback:o=!1,isRoutePPREnabled:l=!1,isPrefetch:u=!1,waitUntil:c,routeKind:d}=n,p=await this.getBatcher.batch({key:e,isOnDemandRevalidate:s},({resolve:n})=>{let r=this.handleGet(e,t,{incrementalCache:i,isOnDemandRevalidate:s,isFallback:o,isRoutePPREnabled:l,isPrefetch:u,routeKind:d},n);return c&&c(r),r});return(0,a.toResponseCacheEntry)(p)}async handleGet(e,t,n,r){let i=null,s=!1;try{if((i=this.minimal_mode?null:await n.incrementalCache.get(e,{kind:(0,a.routeKindToIncrementalCacheKind)(n.routeKind),isRoutePPREnabled:n.isRoutePPREnabled,isFallback:n.isFallback}))&&!n.isOnDemandRevalidate&&(r(i),s=!0,!i.isStale||n.isPrefetch))return i;let o=await this.revalidate(e,n.incrementalCache,n.isRoutePPREnabled,n.isFallback,t,i,null!==i&&!n.isOnDemandRevalidate);if(!o)return this.minimal_mode&&(this.previousCacheItem=void 0),null;return n.isOnDemandRevalidate,o}catch(e){if(s)return console.error(e),null;throw e}}async revalidate(e,t,n,r,i,s,o,a){return this.revalidateBatcher.batch(e,()=>{let l=this.handleRevalidate(e,t,n,r,i,s,o);return a&&a(l),l})}async handleRevalidate(e,t,n,r,i,s,o){try{let l=await i({hasResolved:o,previousCacheEntry:s,isRevalidating:!0});if(!l)return null;let u=await (0,a.fromResponseCacheEntry)({...l,isMiss:!s});return u.cacheControl&&(this.minimal_mode?this.previousCacheItem={key:e,entry:u,expiresAt:Date.now()+1e3}:await t.set(e,u.value,{cacheControl:u.cacheControl,isRoutePPREnabled:n,isFallback:r})),u}catch(i){if(null==s?void 0:s.cacheControl){let i=Math.min(Math.max(s.cacheControl.revalidate||3,3),30),o=void 0===s.cacheControl.expire?void 0:Math.max(i+3,s.cacheControl.expire);await t.set(e,s.value,{cacheControl:{revalidate:i,expire:o},isRoutePPREnabled:n,isFallback:r})}throw i}}}},16899,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={NEXT_PATCH_SYMBOL:function(){return f},createPatchedFetcher:function(){return E},patchFetch:function(){return b},validateRevalidate:function(){return m},validateTags:function(){return g}};for(var i in r)Object.defineProperty(n,i,{enumerable:!0,get:r[i]});let s=e.r(64839),o=e.r(36851),a=e.r(91401),l=e.r(68665),u=e.r(4642),c=e.r(42966),d=e.r(32319),p=e.r(88119),h=e.r(66953);e.r(18185);let f=Symbol.for("next-patch");function m(e,t){try{let n;if(!1===e)n=a.INFINITE_CACHE;else if("number"==typeof e&&!isNaN(e)&&e>-1)n=e;else if(void 0!==e)throw Object.defineProperty(Error(`Invalid revalidate value "${e}" on "${t}", must be a non-negative number or false`),"__NEXT_ERROR_CODE",{value:"E179",enumerable:!1,configurable:!0});return n}catch(e){if(e instanceof Error&&e.message.includes("Invalid revalidate"))throw e;return}}function g(e,t){let n=[],r=[];for(let i=0;i<e.length;i++){let s=e[i];if("string"!=typeof s?r.push({tag:s,reason:"invalid type, must be a string"}):s.length>a.NEXT_CACHE_TAG_MAX_LENGTH?r.push({tag:s,reason:`exceeded max length of ${a.NEXT_CACHE_TAG_MAX_LENGTH}`}):n.push(s),n.length>a.NEXT_CACHE_TAG_MAX_ITEMS){console.warn(`Warning: exceeded max tag count for ${t}, dropped tags:`,e.slice(i).join(", "));break}}if(r.length>0)for(let{tag:e,reason:n}of(console.warn(`Warning: invalid tags passed to ${t}: `),r))console.log(`tag: "${e}" ${n}`);return n}function _(e,t){e.shouldTrackFetchMetrics&&(e.fetchMetrics??=[],e.fetchMetrics.push({...t,end:performance.timeOrigin+performance.now(),idx:e.nextFetchId||0}))}async function y(e,t,n,r,i,s){let o=await e.arrayBuffer(),a={headers:Object.fromEntries(e.headers.entries()),body:Buffer.from(o).toString("base64"),status:e.status,url:e.url};return n&&await r.set(t,{kind:p.CachedRouteKind.FETCH,data:a,revalidate:i},n),await s(),new Response(o,{headers:e.headers,status:e.status,statusText:e.statusText})}async function v(e,t,n,r,i,s,o,a,l){let[u,c]=(0,h.cloneResponse)(t),d=u.arrayBuffer().then(async e=>{let t=Buffer.from(e),a={headers:Object.fromEntries(u.headers.entries()),body:t.toString("base64"),status:u.status,url:u.url};null==s||s.set(n,a),r&&await i.set(n,{kind:p.CachedRouteKind.FETCH,data:a,revalidate:o},r)}).catch(e=>console.warn("Failed to set fetch cache",a,e)).finally(l),f=`cache-set-${n}`;return e.pendingRevalidates??={},f in e.pendingRevalidates&&await e.pendingRevalidates[f],e.pendingRevalidates[f]=d.finally(()=>{var t;(null==(t=e.pendingRevalidates)?void 0:t[f])&&delete e.pendingRevalidates[f]}),c}function E(e,{workAsyncStorage:t,workUnitAsyncStorage:n}){let r=async function(r,i){var c,f;let E;try{(E=new URL(r instanceof Request?r.url:r)).username="",E.password=""}catch{E=void 0}let b=(null==E?void 0:E.href)??"",T=(null==i||null==(c=i.method)?void 0:c.toUpperCase())||"GET",O=(null==i||null==(f=i.next)?void 0:f.internal)===!0,A="1"===process.env.NEXT_OTEL_FETCH_DISABLED,w=O?void 0:performance.timeOrigin+performance.now(),C=t.getStore(),I=n.getStore(),R=I?(0,d.getCacheSignal)(I):null;R&&R.beginRead();let P=(0,o.getTracer)().trace(O?s.NextNodeServerSpan.internalFetch:s.AppRenderSpan.fetch,{hideSpan:A,kind:o.SpanKind.CLIENT,spanName:["fetch",T,b].filter(Boolean).join(" "),attributes:{"http.url":b,"http.method":T,"net.peer.name":null==E?void 0:E.hostname,"net.peer.port":(null==E?void 0:E.port)||void 0}},async()=>{var t;let n,s,o,c,d,f;if(O||!C||C.isDraftMode)return e(r,i);let E=r&&"object"==typeof r&&"string"==typeof r.method,T=e=>(null==i?void 0:i[e])||(E?r[e]:null),A=e=>{var t,n,s;return void 0!==(null==i||null==(t=i.next)?void 0:t[e])?null==i||null==(n=i.next)?void 0:n[e]:E?null==(s=r.next)?void 0:s[e]:void 0},P=A("revalidate"),N=P,x=g(A("tags")||[],`fetch ${r.toString()}`);if(I)switch(I.type){case"prerender":case"prerender-runtime":case"prerender-client":case"prerender-ppr":case"prerender-legacy":case"cache":case"private-cache":n=I}if(n&&Array.isArray(x)){let e=n.tags??(n.tags=[]);for(let t of x)e.includes(t)||e.push(t)}let k=null==I?void 0:I.implicitTags,M=C.fetchCache;I&&"unstable-cache"===I.type&&(M="force-no-store");let D=!!C.isUnstableNoStore,L=T("cache"),U="";"string"==typeof L&&void 0!==N&&("force-cache"===L&&0===N||"no-store"===L&&(N>0||!1===N))&&(s=`Specified "cache: ${L}" and "revalidate: ${N}", only one should be specified.`,L=void 0,N=void 0);let j="no-cache"===L||"no-store"===L||"force-no-store"===M||"only-no-store"===M,q=!M&&!L&&!N&&C.forceDynamic;"force-cache"===L&&void 0===N?N=!1:(j||q)&&(N=0),("no-cache"===L||"no-store"===L)&&(U=`cache: ${L}`),f=m(N,C.route);let $=T("headers"),G="function"==typeof(null==$?void 0:$.get)?$:new Headers($||{}),H=G.get("authorization")||G.get("cookie"),F=!["get","head"].includes((null==(t=T("method"))?void 0:t.toLowerCase())||"get"),B=void 0==M&&(void 0==L||"default"===L)&&void 0==N,V=!!((H||F)&&(null==n?void 0:n.revalidate)===0),W=!1;if(!V&&B&&(C.isBuildTimePrerendering?W=!0:V=!0),B&&void 0!==I)switch(I.type){case"prerender":case"prerender-runtime":case"prerender-client":return R&&(R.endRead(),R=null),(0,u.makeHangingPromise)(I.renderSignal,C.route,"fetch()")}switch(M){case"force-no-store":U="fetchCache = force-no-store";break;case"only-no-store":if("force-cache"===L||void 0!==f&&f>0)throw Object.defineProperty(Error(`cache: 'force-cache' used on fetch for ${b} with 'export const fetchCache = 'only-no-store'`),"__NEXT_ERROR_CODE",{value:"E448",enumerable:!1,configurable:!0});U="fetchCache = only-no-store";break;case"only-cache":if("no-store"===L)throw Object.defineProperty(Error(`cache: 'no-store' used on fetch for ${b} with 'export const fetchCache = 'only-cache'`),"__NEXT_ERROR_CODE",{value:"E521",enumerable:!1,configurable:!0});break;case"force-cache":(void 0===N||0===N)&&(U="fetchCache = force-cache",f=a.INFINITE_CACHE)}if(void 0===f?"default-cache"!==M||D?"default-no-store"===M?(f=0,U="fetchCache = default-no-store"):D?(f=0,U="noStore call"):V?(f=0,U="auto no cache"):(U="auto cache",f=n?n.revalidate:a.INFINITE_CACHE):(f=a.INFINITE_CACHE,U="fetchCache = default-cache"):U||(U=`revalidate: ${f}`),!(C.forceStatic&&0===f)&&!V&&n&&f<n.revalidate){if(0===f){if(I)switch(I.type){case"prerender":case"prerender-client":case"prerender-runtime":return R&&(R.endRead(),R=null),(0,u.makeHangingPromise)(I.renderSignal,C.route,"fetch()")}(0,l.markCurrentScopeAsDynamic)(C,I,`revalidate: 0 fetch ${r} ${C.route}`)}n&&P===f&&(n.revalidate=f)}let J="number"==typeof f&&f>0,{incrementalCache:K}=C,Y=!1;if(I)switch(I.type){case"request":case"cache":case"private-cache":Y=I.isHmrRefresh??!1,c=I.serverComponentsHmrCache}if(K&&(J||c))try{o=await K.generateCacheKey(b,E?r:i)}catch(e){console.error("Failed to generate cache key for",r)}let X=C.nextFetchId??1;C.nextFetchId=X+1;let z=()=>{},Q=async(t,n)=>{let l=["cache","credentials","headers","integrity","keepalive","method","mode","redirect","referrer","referrerPolicy","window","duplex",...t?[]:["signal"]];if(E){let e=r,t={body:e._ogBody||e.body};for(let n of l)t[n]=e[n];r=new Request(e.url,t)}else if(i){let{_ogBody:e,body:n,signal:r,...s}=i;i={...s,body:e||n,signal:t?void 0:r}}let u={...i,next:{...null==i?void 0:i.next,fetchType:"origin",fetchIdx:X}};return e(r,u).then(async e=>{if(!t&&w&&_(C,{start:w,url:b,cacheReason:n||U,cacheStatus:0===f||n?"skip":"miss",cacheWarning:s,status:e.status,method:u.method||"GET"}),200===e.status&&K&&o&&(J||c)){let t=f>=a.INFINITE_CACHE?a.CACHE_ONE_YEAR:f,n=J?{fetchCache:!0,fetchUrl:b,fetchIdx:X,tags:x,isImplicitBuildTimeCache:W}:void 0;switch(null==I?void 0:I.type){case"prerender":case"prerender-client":case"prerender-runtime":return y(e,o,n,K,t,z);case"request":case"prerender-ppr":case"prerender-legacy":case"cache":case"private-cache":case"unstable-cache":case void 0:return v(C,e,o,n,K,c,t,r,z)}}return await z(),e}).catch(e=>{throw z(),e})},Z=!1,ee=!1;if(o&&K){let e;if(Y&&c&&(e=c.get(o),ee=!0),J&&!e){z=await K.lock(o);let t=C.isOnDemandRevalidate?null:await K.get(o,{kind:p.IncrementalCacheKind.FETCH,revalidate:f,fetchUrl:b,fetchIdx:X,tags:x,softTags:null==k?void 0:k.tags});if(B&&I)switch(I.type){case"prerender":case"prerender-client":case"prerender-runtime":await (S||(S=new Promise(e=>{setTimeout(()=>{S=null,e()},0)})),S)}if(t?await z():d="cache-control: no-cache (hard refresh)",(null==t?void 0:t.value)&&t.value.kind===p.CachedRouteKind.FETCH)if(C.isStaticGeneration&&t.isStale)Z=!0;else{if(t.isStale&&(C.pendingRevalidates??={},!C.pendingRevalidates[o])){let e=Q(!0).then(async e=>({body:await e.arrayBuffer(),headers:e.headers,status:e.status,statusText:e.statusText})).finally(()=>{C.pendingRevalidates??={},delete C.pendingRevalidates[o||""]});e.catch(console.error),C.pendingRevalidates[o]=e}e=t.value.data}}if(e){w&&_(C,{start:w,url:b,cacheReason:U,cacheStatus:ee?"hmr":"hit",cacheWarning:s,status:e.status||200,method:(null==i?void 0:i.method)||"GET"});let t=new Response(Buffer.from(e.body,"base64"),{headers:e.headers,status:e.status});return Object.defineProperty(t,"url",{value:e.url}),t}}if(C.isStaticGeneration&&i&&"object"==typeof i){let{cache:e}=i;if("no-store"===e){if(I)switch(I.type){case"prerender":case"prerender-client":case"prerender-runtime":return R&&(R.endRead(),R=null),(0,u.makeHangingPromise)(I.renderSignal,C.route,"fetch()")}(0,l.markCurrentScopeAsDynamic)(C,I,`no-store fetch ${r} ${C.route}`)}let t="next"in i,{next:s={}}=i;if("number"==typeof s.revalidate&&n&&s.revalidate<n.revalidate){if(0===s.revalidate){if(I)switch(I.type){case"prerender":case"prerender-client":case"prerender-runtime":return(0,u.makeHangingPromise)(I.renderSignal,C.route,"fetch()")}(0,l.markCurrentScopeAsDynamic)(C,I,`revalidate: 0 fetch ${r} ${C.route}`)}C.forceStatic&&0===s.revalidate||(n.revalidate=s.revalidate)}t&&delete i.next}if(!o||!Z)return Q(!1,d);{let e=o;C.pendingRevalidates??={};let t=C.pendingRevalidates[e];if(t){let e=await t;return new Response(e.body,{headers:e.headers,status:e.status,statusText:e.statusText})}let n=Q(!0,d).then(h.cloneResponse);return(t=n.then(async e=>{let t=e[0];return{body:await t.arrayBuffer(),headers:t.headers,status:t.status,statusText:t.statusText}}).finally(()=>{var t;(null==(t=C.pendingRevalidates)?void 0:t[e])&&delete C.pendingRevalidates[e]})).catch(()=>{}),C.pendingRevalidates[e]=t,n.then(e=>e[1])}});if(R)try{return await P}finally{R&&R.endRead()}return P};return r.__nextPatched=!0,r.__nextGetStaticStore=()=>t,r._nextOriginalFetch=e,globalThis[f]=!0,Object.defineProperty(r,"name",{value:"fetch",writable:!1}),r}function b(e){if(!0===globalThis[f])return;let t=(0,c.createDedupeFetch)(globalThis.fetch);globalThis.fetch=E(t,e)}let S=null},32533,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"unstable_cache",{enumerable:!0,get:function(){return c}});let r=e.r(91401),i=e.r(16899),s=e.r(56704),o=e.r(32319),a=e.r(88119),l=0;async function u(e,t,n,i,s,o,l){await t.set(n,{kind:a.CachedRouteKind.FETCH,data:{headers:{},body:JSON.stringify(e),status:200,url:""},revalidate:"number"!=typeof s?r.CACHE_ONE_YEAR:s},{fetchCache:!0,tags:i,fetchIdx:o,fetchUrl:l})}function c(e,t,n={}){if(0===n.revalidate)throw Object.defineProperty(Error(`Invariant revalidate: 0 can not be passed to unstable_cache(), must be "false" or "> 0" ${e.toString()}`),"__NEXT_ERROR_CODE",{value:"E57",enumerable:!1,configurable:!0});let r=n.tags?(0,i.validateTags)(n.tags,`unstable_cache ${e.toString()}`):[];(0,i.validateRevalidate)(n.revalidate,`unstable_cache ${e.name||e.toString()}`);let d=`${e.toString()}-${Array.isArray(t)&&t.join(",")}`;return async(...t)=>{let i=s.workAsyncStorage.getStore(),c=o.workUnitAsyncStorage.getStore(),p=(null==i?void 0:i.incrementalCache)||globalThis.__incrementalCache;if(!p)throw Object.defineProperty(Error(`Invariant: incrementalCache missing in unstable_cache ${e.toString()}`),"__NEXT_ERROR_CODE",{value:"E469",enumerable:!1,configurable:!0});let h=c?(0,o.getCacheSignal)(c):null;h&&h.beginRead();try{let s=i&&c?function(e,t){switch(t.type){case"request":let n=t.url.pathname,r=new URLSearchParams(t.url.search),i=[...r.keys()].sort((e,t)=>e.localeCompare(t)).map(e=>`${e}=${r.get(e)}`).join("&");return`${n}${i.length?"?":""}${i}`;case"prerender":case"prerender-client":case"prerender-runtime":case"prerender-ppr":case"prerender-legacy":case"cache":case"private-cache":case"unstable-cache":return e.route;default:return t}}(i,c):"",h=`${d}-${JSON.stringify(t)}`,f=await p.generateCacheKey(h),m=`unstable_cache ${s} ${e.name?` ${e.name}`:f}`,g=(i?i.nextFetchId:l)??1,_=null==c?void 0:c.implicitTags,y={type:"unstable-cache",phase:"render",implicitTags:_,draftMode:c&&i&&(0,o.getDraftModeProviderForCacheScope)(i,c)};if(i){i.nextFetchId=g+1;let s=!1;if(c)switch(c.type){case"cache":case"private-cache":case"prerender":case"prerender-runtime":case"prerender-ppr":case"prerender-legacy":"number"==typeof n.revalidate&&(c.revalidate<n.revalidate||(c.revalidate=n.revalidate));let l=c.tags;if(null===l)c.tags=r.slice();else for(let e of r)l.includes(e)||l.push(e);break;case"unstable-cache":s=!0}if(!s&&"force-no-store"!==i.fetchCache&&!i.isOnDemandRevalidate&&!p.isOnDemandRevalidate&&!i.isDraftMode){let s=await p.get(f,{kind:a.IncrementalCacheKind.FETCH,revalidate:n.revalidate,tags:r,softTags:null==_?void 0:_.tags,fetchIdx:g,fetchUrl:m});if(s&&s.value)if(s.value.kind!==a.CachedRouteKind.FETCH)console.error(`Invariant invalid cacheEntry returned for ${h}`);else{let a=void 0!==s.value.data.body?JSON.parse(s.value.data.body):void 0;if(s.isStale){if(i.pendingRevalidates||(i.pendingRevalidates={}),!i.pendingRevalidates[h]){let s=o.workUnitAsyncStorage.run(y,e,...t).then(async e=>(await u(e,p,f,r,n.revalidate,g,m),e)).catch(e=>(console.error(`revalidating cache with key: ${h}`,e),a));i.isStaticGeneration&&s.catch(()=>{}),i.pendingRevalidates[h]=s}if(i.isStaticGeneration)return i.pendingRevalidates[h]}return a}}let d=await o.workUnitAsyncStorage.run(y,e,...t);return i.isDraftMode||(i.pendingRevalidates||(i.pendingRevalidates={}),i.pendingRevalidates[h]=u(d,p,f,r,n.revalidate,g,m)),d}{if(l+=1,!p.isOnDemandRevalidate){let e=await p.get(f,{kind:a.IncrementalCacheKind.FETCH,revalidate:n.revalidate,tags:r,fetchIdx:g,fetchUrl:m,softTags:null==_?void 0:_.tags});if(e&&e.value){if(e.value.kind!==a.CachedRouteKind.FETCH)console.error(`Invariant invalid cacheEntry returned for ${h}`);else if(!e.isStale)return void 0!==e.value.data.body?JSON.parse(e.value.data.body):void 0}}let i=await o.workUnitAsyncStorage.run(y,e,...t);return await u(i,p,f,r,n.revalidate,g,m),i}}finally{h&&h.endRead()}}}},31551,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={getSortedRouteObjects:function(){return a},getSortedRoutes:function(){return o}};for(var i in r)Object.defineProperty(n,i,{enumerable:!0,get:r[i]});class s{insert(e){this._insert(e.split("/").filter(Boolean),[],!1)}smoosh(){return this._smoosh()}_smoosh(e="/"){let t=[...this.children.keys()].sort();null!==this.slugName&&t.splice(t.indexOf("[]"),1),null!==this.restSlugName&&t.splice(t.indexOf("[...]"),1),null!==this.optionalRestSlugName&&t.splice(t.indexOf("[[...]]"),1);let n=t.map(t=>this.children.get(t)._smoosh(`${e}${t}/`)).reduce((e,t)=>[...e,...t],[]);if(null!==this.slugName&&n.push(...this.children.get("[]")._smoosh(`${e}[${this.slugName}]/`)),!this.placeholder){let t="/"===e?"/":e.slice(0,-1);if(null!=this.optionalRestSlugName)throw Object.defineProperty(Error(`You cannot define a route with the same specificity as a optional catch-all route ("${t}" and "${t}[[...${this.optionalRestSlugName}]]").`),"__NEXT_ERROR_CODE",{value:"E458",enumerable:!1,configurable:!0});n.unshift(t)}return null!==this.restSlugName&&n.push(...this.children.get("[...]")._smoosh(`${e}[...${this.restSlugName}]/`)),null!==this.optionalRestSlugName&&n.push(...this.children.get("[[...]]")._smoosh(`${e}[[...${this.optionalRestSlugName}]]/`)),n}_insert(e,t,n){if(0===e.length){this.placeholder=!1;return}if(n)throw Object.defineProperty(Error("Catch-all must be the last part of the URL."),"__NEXT_ERROR_CODE",{value:"E392",enumerable:!1,configurable:!0});let r=e[0];if(r.startsWith("[")&&r.endsWith("]")){let s=r.slice(1,-1),o=!1;if(s.startsWith("[")&&s.endsWith("]")&&(s=s.slice(1,-1),o=!0),s.startsWith(""))throw Object.defineProperty(Error(`Detected a three-dot character ('') at ('${s}'). Did you mean ('...')?`),"__NEXT_ERROR_CODE",{value:"E147",enumerable:!1,configurable:!0});if(s.startsWith("...")&&(s=s.substring(3),n=!0),s.startsWith("[")||s.endsWith("]"))throw Object.defineProperty(Error(`Segment names may not start or end with extra brackets ('${s}').`),"__NEXT_ERROR_CODE",{value:"E421",enumerable:!1,configurable:!0});if(s.startsWith("."))throw Object.defineProperty(Error(`Segment names may not start with erroneous periods ('${s}').`),"__NEXT_ERROR_CODE",{value:"E288",enumerable:!1,configurable:!0});function i(e,n){if(null!==e&&e!==n)throw Object.defineProperty(Error(`You cannot use different slug names for the same dynamic path ('${e}' !== '${n}').`),"__NEXT_ERROR_CODE",{value:"E337",enumerable:!1,configurable:!0});t.forEach(e=>{if(e===n)throw Object.defineProperty(Error(`You cannot have the same slug name "${n}" repeat within a single dynamic path`),"__NEXT_ERROR_CODE",{value:"E247",enumerable:!1,configurable:!0});if(e.replace(/\W/g,"")===r.replace(/\W/g,""))throw Object.defineProperty(Error(`You cannot have the slug names "${e}" and "${n}" differ only by non-word symbols within a single dynamic path`),"__NEXT_ERROR_CODE",{value:"E499",enumerable:!1,configurable:!0})}),t.push(n)}if(n)if(o){if(null!=this.restSlugName)throw Object.defineProperty(Error(`You cannot use both an required and optional catch-all route at the same level ("[...${this.restSlugName}]" and "${e[0]}" ).`),"__NEXT_ERROR_CODE",{value:"E299",enumerable:!1,configurable:!0});i(this.optionalRestSlugName,s),this.optionalRestSlugName=s,r="[[...]]"}else{if(null!=this.optionalRestSlugName)throw Object.defineProperty(Error(`You cannot use both an optional and required catch-all route at the same level ("[[...${this.optionalRestSlugName}]]" and "${e[0]}").`),"__NEXT_ERROR_CODE",{value:"E300",enumerable:!1,configurable:!0});i(this.restSlugName,s),this.restSlugName=s,r="[...]"}else{if(o)throw Object.defineProperty(Error(`Optional route parameters are not yet supported ("${e[0]}").`),"__NEXT_ERROR_CODE",{value:"E435",enumerable:!1,configurable:!0});i(this.slugName,s),this.slugName=s,r="[]"}}this.children.has(r)||this.children.set(r,new s),this.children.get(r)._insert(e.slice(1),t,n)}constructor(){this.placeholder=!0,this.children=new Map,this.slugName=null,this.restSlugName=null,this.optionalRestSlugName=null}}function o(e){let t=new s;return e.forEach(e=>t.insert(e)),t.smoosh()}function a(e,t){let n={},r=[];for(let i=0;i<e.length;i++){let s=t(e[i]);n[s]=i,r[i]=s}return o(r).map(t=>e[n[t]])}},64033,(e,t,n)=>{"use strict";function r(e){return e.startsWith("/")?e:`/${e}`}Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"ensureLeadingSlash",{enumerable:!0,get:function(){return r}})},60426,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={DEFAULT_SEGMENT_KEY:function(){return d},PAGE_SEGMENT_KEY:function(){return c},addSearchParamsIfPageSegment:function(){return l},computeSelectedLayoutSegment:function(){return u},getSegmentValue:function(){return s},getSelectedLayoutSegmentPath:function(){return function e(t,n,r=!0,i=[]){let o;if(r)o=t[1][n];else{let e=t[1];o=e.children??Object.values(e)[0]}if(!o)return i;let a=s(o[0]);return!a||a.startsWith(c)?i:(i.push(a),e(o,n,!1,i))}},isGroupSegment:function(){return o},isParallelRouteSegment:function(){return a}};for(var i in r)Object.defineProperty(n,i,{enumerable:!0,get:r[i]});function s(e){return Array.isArray(e)?e[1]:e}function o(e){return"("===e[0]&&e.endsWith(")")}function a(e){return e.startsWith("@")&&"@children"!==e}function l(e,t){if(e.includes(c)){let e=JSON.stringify(t);return"{}"!==e?c+"?"+e:c}return e}function u(e,t){if(!e||0===e.length)return null;let n="children"===t?e[0]:e[e.length-1];return n===d?null:n}let c="__PAGE__",d="__DEFAULT__"},65618,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={normalizeAppPath:function(){return a},normalizeRscURL:function(){return l}};for(var i in r)Object.defineProperty(n,i,{enumerable:!0,get:r[i]});let s=e.r(64033),o=e.r(60426);function a(e){return(0,s.ensureLeadingSlash)(e.split("/").reduce((e,t,n,r)=>!t||(0,o.isGroupSegment)(t)||"@"===t[0]||("page"===t||"route"===t)&&n===r.length-1?e:`${e}/${t}`,""))}function l(e){return e.replace(/\.rsc($|\?)/,"$1")}},41417,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={INTERCEPTION_ROUTE_MARKERS:function(){return o},extractInterceptionRouteInformation:function(){return l},isInterceptionRouteAppPath:function(){return a}};for(var i in r)Object.defineProperty(n,i,{enumerable:!0,get:r[i]});let s=e.r(65618),o=["(..)(..)","(.)","(..)","(...)"];function a(e){return void 0!==e.split("/").find(e=>o.find(t=>e.startsWith(t)))}function l(e){let t,n,r;for(let i of e.split("/"))if(n=o.find(e=>i.startsWith(e))){[t,r]=e.split(n,2);break}if(!t||!n||!r)throw Object.defineProperty(Error(`Invalid interception route: ${e}. Must be in the format /<intercepting route>/(..|...|..)(..)/<intercepted route>`),"__NEXT_ERROR_CODE",{value:"E269",enumerable:!1,configurable:!0});switch(t=(0,s.normalizeAppPath)(t),n){case"(.)":r="/"===t?`/${r}`:t+"/"+r;break;case"(..)":if("/"===t)throw Object.defineProperty(Error(`Invalid interception route: ${e}. Cannot use (..) marker at the root level, use (.) instead.`),"__NEXT_ERROR_CODE",{value:"E207",enumerable:!1,configurable:!0});r=t.split("/").slice(0,-1).concat(r).join("/");break;case"(...)":r="/"+r;break;case"(..)(..)":let i=t.split("/");if(i.length<=2)throw Object.defineProperty(Error(`Invalid interception route: ${e}. Cannot use (..)(..) marker at the root level or one level up.`),"__NEXT_ERROR_CODE",{value:"E486",enumerable:!1,configurable:!0});r=i.slice(0,-2).concat(r).join("/");break;default:throw Object.defineProperty(Error("Invariant: unexpected marker"),"__NEXT_ERROR_CODE",{value:"E112",enumerable:!1,configurable:!0})}return{interceptingRoute:t,interceptedRoute:r}}},58499,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"isDynamicRoute",{enumerable:!0,get:function(){return o}});let r=e.r(41417),i=/\/[^/]*\[[^/]+\][^/]*(?=\/|$)/,s=/\/\[[^/]+\](?=\/|$)/;function o(e,t=!0){return((0,r.isInterceptionRouteAppPath)(e)&&(e=(0,r.extractInterceptionRouteInformation)(e).interceptedRoute),t)?s.test(e):i.test(e)}},54692,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={getSortedRouteObjects:function(){return s.getSortedRouteObjects},getSortedRoutes:function(){return s.getSortedRoutes},isDynamicRoute:function(){return o.isDynamicRoute}};for(var i in r)Object.defineProperty(n,i,{enumerable:!0,get:r[i]});let s=e.r(31551),o=e.r(58499)},86240,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={refresh:function(){return f},revalidatePath:function(){return m},revalidateTag:function(){return p},updateTag:function(){return h}};for(var i in r)Object.defineProperty(n,i,{enumerable:!0,get:r[i]});let s=e.r(68665),o=e.r(54692),a=e.r(91401),l=e.r(56704),u=e.r(32319),c=e.r(65252),d=e.r(76414);function p(e,t){return t||console.warn('"revalidateTag" without the second argument is now deprecated, add second argument of "max" or use "updateTag". See more info here: https://nextjs.org/docs/messages/revalidate-tag-single-arg'),g([e],`revalidateTag ${e}`,t)}function h(e){let t=l.workAsyncStorage.getStore();if(!t||t.page.endsWith("/route"))throw Object.defineProperty(Error("updateTag can only be called from within a Server Action. To invalidate cache tags in Route Handlers or other contexts, use revalidateTag instead. See more info here: https://nextjs.org/docs/app/api-reference/functions/updateTag"),"__NEXT_ERROR_CODE",{value:"E872",enumerable:!1,configurable:!0});return g([e],`updateTag ${e}`,void 0)}function f(){let e=l.workAsyncStorage.getStore(),t=u.workUnitAsyncStorage.getStore();if(!e||e.page.endsWith("/route")||(null==t?void 0:t.phase)!=="action")throw Object.defineProperty(Error("refresh can only be called from within a Server Action. See more info here: https://nextjs.org/docs/app/api-reference/functions/refresh"),"__NEXT_ERROR_CODE",{value:"E870",enumerable:!1,configurable:!0});e&&(e.pathWasRevalidated=!0)}function m(e,t){if(e.length>a.NEXT_CACHE_SOFT_TAG_MAX_LENGTH)return void console.warn(`Warning: revalidatePath received "${e}" which exceeded max length of ${a.NEXT_CACHE_SOFT_TAG_MAX_LENGTH}. See more info here https://nextjs.org/docs/app/api-reference/functions/revalidatePath`);let n=`${a.NEXT_CACHE_IMPLICIT_TAG_ID}${e||"/"}`;t?n+=`${n.endsWith("/")?"":"/"}${t}`:(0,o.isDynamicRoute)(e)&&console.warn(`Warning: a dynamic page path "${e}" was passed to "revalidatePath", but the "type" parameter is missing. This has no effect by default, see more info here https://nextjs.org/docs/app/api-reference/functions/revalidatePath`);let r=[n];return n===`${a.NEXT_CACHE_IMPLICIT_TAG_ID}/`?r.push(`${a.NEXT_CACHE_IMPLICIT_TAG_ID}/index`):n===`${a.NEXT_CACHE_IMPLICIT_TAG_ID}/index`&&r.push(`${a.NEXT_CACHE_IMPLICIT_TAG_ID}/`),g(r,`revalidatePath ${e}`)}function g(e,t,n){var r;let i=l.workAsyncStorage.getStore();if(!i||!i.incrementalCache)throw Object.defineProperty(Error(`Invariant: static generation store missing in ${t}`),"__NEXT_ERROR_CODE",{value:"E263",enumerable:!1,configurable:!0});let o=u.workUnitAsyncStorage.getStore();if(o){if("render"===o.phase)throw Object.defineProperty(Error(`Route ${i.route} used "${t}" during render which is unsupported. To ensure revalidation is performed consistently it must always happen outside of renders and cached functions. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`),"__NEXT_ERROR_CODE",{value:"E7",enumerable:!1,configurable:!0});switch(o.type){case"cache":case"private-cache":throw Object.defineProperty(Error(`Route ${i.route} used "${t}" inside a "use cache" which is unsupported. To ensure revalidation is performed consistently it must always happen outside of renders and cached functions. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`),"__NEXT_ERROR_CODE",{value:"E181",enumerable:!1,configurable:!0});case"unstable-cache":throw Object.defineProperty(Error(`Route ${i.route} used "${t}" inside a function cached with "unstable_cache(...)" which is unsupported. To ensure revalidation is performed consistently it must always happen outside of renders and cached functions. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`),"__NEXT_ERROR_CODE",{value:"E306",enumerable:!1,configurable:!0});case"prerender":case"prerender-runtime":let e=Object.defineProperty(Error(`Route ${i.route} used ${t} without first calling \`await connection()\`.`),"__NEXT_ERROR_CODE",{value:"E406",enumerable:!1,configurable:!0});return(0,s.abortAndThrowOnSynchronousRequestDataAccess)(i.route,t,e,o);case"prerender-client":throw Object.defineProperty(new d.InvariantError(`${t} must not be used within a client component. Next.js should be preventing ${t} from being included in client components statically, but did not in this case.`),"__NEXT_ERROR_CODE",{value:"E693",enumerable:!1,configurable:!0});case"prerender-ppr":return(0,s.postponeWithTracking)(i.route,t,o.dynamicTracking);case"prerender-legacy":o.revalidate=0;let n=Object.defineProperty(new c.DynamicServerError(`Route ${i.route} couldn't be rendered statically because it used \`${t}\`. See more info here: https://nextjs.org/docs/messages/dynamic-server-error`),"__NEXT_ERROR_CODE",{value:"E558",enumerable:!1,configurable:!0});throw i.dynamicUsageDescription=t,i.dynamicUsageStack=n.stack,n}}for(let t of(i.pendingRevalidatedTags||(i.pendingRevalidatedTags=[]),e))-1===i.pendingRevalidatedTags.findIndex(e=>e.tag===t&&("string"==typeof e.profile&&"string"==typeof n?e.profile===n:"object"==typeof e.profile&&"object"==typeof n?JSON.stringify(e.profile)===JSON.stringify(n):e.profile===n))&&i.pendingRevalidatedTags.push({tag:t,profile:n});let a=n&&"object"==typeof n?n:n&&"string"==typeof n&&(null==i||null==(r=i.cacheLifeProfiles)?void 0:r[n])?i.cacheLifeProfiles[n]:void 0;n&&(null==a?void 0:a.expire)!==0||(i.pathWasRevalidated=!0)}},60951,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"unstable_noStore",{enumerable:!0,get:function(){return o}});let r=e.r(56704),i=e.r(32319),s=e.r(68665);function o(){let e=r.workAsyncStorage.getStore(),t=i.workUnitAsyncStorage.getStore();if(e){if(!e.forceStatic){if(e.isUnstableNoStore=!0,t)switch(t.type){case"prerender":case"prerender-client":case"prerender-runtime":return}(0,s.markCurrentScopeAsDynamic)(e,t,"unstable_noStore()")}}}},53540,(e,t,n)=>{"use strict";function r(e){throw Object.defineProperty(Error("`cacheLife()` is only available with the `cacheComponents` config."),"__NEXT_ERROR_CODE",{value:"E887",enumerable:!1,configurable:!0})}Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"cacheLife",{enumerable:!0,get:function(){return r}}),e.r(76414),e.r(56704),e.r(32319)},88819,(e,t,n)=>{"use strict";function r(){throw Object.defineProperty(Error("`cacheTag()` is only available with the `cacheComponents` config."),"__NEXT_ERROR_CODE",{value:"E886",enumerable:!1,configurable:!0})}Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"cacheTag",{enumerable:!0,get:function(){return r}}),e.r(32319),e.r(16899)},65044,(e,t,n)=>{let r={unstable_cache:e.r(32533).unstable_cache,updateTag:e.r(86240).updateTag,revalidateTag:e.r(86240).revalidateTag,revalidatePath:e.r(86240).revalidatePath,refresh:e.r(86240).refresh,unstable_noStore:e.r(60951).unstable_noStore,cacheLife:e.r(53540).cacheLife,cacheTag:e.r(88819).cacheTag},i=!1,s=!1;r.unstable_cacheLife=function(){return i||(i=!0,console.error(Error("`unstable_cacheLife` was recently stabilized and should be imported as `cacheLife`. The `unstable` prefixed form will be removed in a future version of Next.js."))),r.cacheLife.apply(this,arguments)},r.unstable_cacheTag=function(){return s||(s=!0,console.error(Error("`unstable_cacheTag` was recently stabilized and should be imported as `cacheTag`. The `unstable` prefixed form will be removed in a future version of Next.js."))),r.cacheTag.apply(this,arguments)},t.exports=r,n.unstable_cache=r.unstable_cache,n.revalidatePath=r.revalidatePath,n.revalidateTag=r.revalidateTag,n.updateTag=r.updateTag,n.unstable_noStore=r.unstable_noStore,n.cacheLife=r.cacheLife,n.unstable_cacheLife=r.unstable_cacheLife,n.cacheTag=r.cacheTag,n.unstable_cacheTag=r.unstable_cacheTag,n.refresh=r.refresh},74836,(e,t,n)=>{"use strict";let r=["nodebuffer","arraybuffer","fragments"],i="undefined"!=typeof Blob;i&&r.push("blob"),t.exports={BINARY_TYPES:r,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:i,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}},97970,(e,t,n)=>{"use strict";let{EMPTY_BUFFER:r}=e.r(74836),i=Buffer[Symbol.species];function s(e,t,n,r,i){for(let s=0;s<i;s++)n[r+s]=e[s]^t[3&s]}function o(e,t){for(let n=0;n<e.length;n++)e[n]^=t[3&n]}function a(e){let t;return(a.readOnly=!0,Buffer.isBuffer(e))?e:(e instanceof ArrayBuffer?t=new i(e):ArrayBuffer.isView(e)?t=new i(e.buffer,e.byteOffset,e.byteLength):(t=Buffer.from(e),a.readOnly=!1),t)}if(t.exports={concat:function(e,t){if(0===e.length)return r;if(1===e.length)return e[0];let n=Buffer.allocUnsafe(t),s=0;for(let t=0;t<e.length;t++){let r=e[t];n.set(r,s),s+=r.length}return s<t?new i(n.buffer,n.byteOffset,s):n},mask:s,toArrayBuffer:function(e){return e.length===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.length)},toBuffer:a,unmask:o},!process.env.WS_NO_BUFFER_UTIL)try{let e=(()=>{let e=Error("Cannot find module 'bufferutil'");throw e.code="MODULE_NOT_FOUND",e})();t.exports.mask=function(t,n,r,i,o){o<48?s(t,n,r,i,o):e.mask(t,n,r,i,o)},t.exports.unmask=function(t,n){t.length<32?o(t,n):e.unmask(t,n)}}catch(e){}},62048,(e,t,n)=>{"use strict";let r=Symbol("kDone"),i=Symbol("kRun");t.exports=class{constructor(e){this[r]=()=>{this.pending--,this[i]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[i]()}[i](){if(this.pending!==this.concurrency&&this.jobs.length){let e=this.jobs.shift();this.pending++,e(this[r])}}}},80295,(e,t,n)=>{"use strict";let r,i=e.r(6461),s=e.r(97970),o=e.r(62048),{kStatusCode:a}=e.r(74836),l=Buffer[Symbol.species],u=Buffer.from([0,0,255,255]),c=Symbol("permessage-deflate"),d=Symbol("total-length"),p=Symbol("callback"),h=Symbol("buffers"),f=Symbol("error");function m(e){this[h].push(e),this[d]+=e.length}function g(e){(this[d]+=e.length,this[c]._maxPayload<1||this[d]<=this[c]._maxPayload)?this[h].push(e):(this[f]=RangeError("Max payload size exceeded"),this[f].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[f][a]=1009,this.removeListener("data",g),this.reset())}function _(e){(this[c]._inflate=null,this[f])?this[p](this[f]):(e[a]=1007,this[p](e))}t.exports=class{constructor(e,t,n){this._maxPayload=0|n,this._options=e||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,r||(r=new o(void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10))}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let e=this._deflate[p];this._deflate.close(),this._deflate=null,e&&e(Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){let t=this._options,n=e.find(e=>(!1!==t.serverNoContextTakeover||!e.server_no_context_takeover)&&(!e.server_max_window_bits||!1!==t.serverMaxWindowBits&&("number"!=typeof t.serverMaxWindowBits||!(t.serverMaxWindowBits>e.server_max_window_bits)))&&("number"!=typeof t.clientMaxWindowBits||!!e.client_max_window_bits));if(!n)throw Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(n.server_no_context_takeover=!0),t.clientNoContextTakeover&&(n.client_no_context_takeover=!0),"number"==typeof t.serverMaxWindowBits&&(n.server_max_window_bits=t.serverMaxWindowBits),"number"==typeof t.clientMaxWindowBits?n.client_max_window_bits=t.clientMaxWindowBits:(!0===n.client_max_window_bits||!1===t.clientMaxWindowBits)&&delete n.client_max_window_bits,n}acceptAsClient(e){let t=e[0];if(!1===this._options.clientNoContextTakeover&&t.client_no_context_takeover)throw Error('Unexpected parameter "client_no_context_takeover"');if(t.client_max_window_bits){if(!1===this._options.clientMaxWindowBits||"number"==typeof this._options.clientMaxWindowBits&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw Error('Unexpected or invalid parameter "client_max_window_bits"')}else"number"==typeof this._options.clientMaxWindowBits&&(t.client_max_window_bits=this._options.clientMaxWindowBits);return t}normalizeParams(e){return e.forEach(e=>{Object.keys(e).forEach(t=>{let n=e[t];if(n.length>1)throw Error(`Parameter "${t}" must have only a single value`);if(n=n[0],"client_max_window_bits"===t){if(!0!==n){let e=+n;if(!Number.isInteger(e)||e<8||e>15)throw TypeError(`Invalid value for parameter "${t}": ${n}`);n=e}else if(!this._isServer)throw TypeError(`Invalid value for parameter "${t}": ${n}`)}else if("server_max_window_bits"===t){let e=+n;if(!Number.isInteger(e)||e<8||e>15)throw TypeError(`Invalid value for parameter "${t}": ${n}`);n=e}else if("client_no_context_takeover"===t||"server_no_context_takeover"===t){if(!0!==n)throw TypeError(`Invalid value for parameter "${t}": ${n}`)}else throw Error(`Unknown parameter "${t}"`);e[t]=n})}),e}decompress(e,t,n){r.add(r=>{this._decompress(e,t,(e,t)=>{r(),n(e,t)})})}compress(e,t,n){r.add(r=>{this._compress(e,t,(e,t)=>{r(),n(e,t)})})}_decompress(e,t,n){let r=this._isServer?"client":"server";if(!this._inflate){let e=`${r}_max_window_bits`,t="number"!=typeof this.params[e]?i.Z_DEFAULT_WINDOWBITS:this.params[e];this._inflate=i.createInflateRaw({...this._options.zlibInflateOptions,windowBits:t}),this._inflate[c]=this,this._inflate[d]=0,this._inflate[h]=[],this._inflate.on("error",_),this._inflate.on("data",g)}this._inflate[p]=n,this._inflate.write(e),t&&this._inflate.write(u),this._inflate.flush(()=>{let e=this._inflate[f];if(e){this._inflate.close(),this._inflate=null,n(e);return}let i=s.concat(this._inflate[h],this._inflate[d]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[d]=0,this._inflate[h]=[],t&&this.params[`${r}_no_context_takeover`]&&this._inflate.reset()),n(null,i)})}_compress(e,t,n){let r=this._isServer?"server":"client";if(!this._deflate){let e=`${r}_max_window_bits`,t="number"!=typeof this.params[e]?i.Z_DEFAULT_WINDOWBITS:this.params[e];this._deflate=i.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:t}),this._deflate[d]=0,this._deflate[h]=[],this._deflate.on("data",m)}this._deflate[p]=n,this._deflate.write(e),this._deflate.flush(i.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let e=s.concat(this._deflate[h],this._deflate[d]);t&&(e=new l(e.buffer,e.byteOffset,e.length-4)),this._deflate[p]=null,this._deflate[d]=0,this._deflate[h]=[],t&&this.params[`${r}_no_context_takeover`]&&this._deflate.reset(),n(null,e)})}}},58739,(e,t,n)=>{"use strict";let{isUtf8:r}=e.r(874),{hasBlob:i}=e.r(74836);function s(e){let t=e.length,n=0;for(;n<t;)if((128&e[n])==0)n++;else if((224&e[n])==192){if(n+1===t||(192&e[n+1])!=128||(254&e[n])==192)return!1;n+=2}else if((240&e[n])==224){if(n+2>=t||(192&e[n+1])!=128||(192&e[n+2])!=128||224===e[n]&&(224&e[n+1])==128||237===e[n]&&(224&e[n+1])==160)return!1;n+=3}else{if((248&e[n])!=240||n+3>=t||(192&e[n+1])!=128||(192&e[n+2])!=128||(192&e[n+3])!=128||240===e[n]&&(240&e[n+1])==128||244===e[n]&&e[n+1]>143||e[n]>244)return!1;n+=4}return!0}if(t.exports={isBlob:function(e){return i&&"object"==typeof e&&"function"==typeof e.arrayBuffer&&"string"==typeof e.type&&"function"==typeof e.stream&&("Blob"===e[Symbol.toStringTag]||"File"===e[Symbol.toStringTag])},isValidStatusCode:function(e){return e>=1e3&&e<=1014&&1004!==e&&1005!==e&&1006!==e||e>=3e3&&e<=4999},isValidUTF8:s,tokenChars:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0]},r)t.exports.isValidUTF8=function(e){return e.length<24?s(e):r(e)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let e=(()=>{let e=Error("Cannot find module 'utf-8-validate'");throw e.code="MODULE_NOT_FOUND",e})();t.exports.isValidUTF8=function(t){return t.length<32?s(t):e(t)}}catch(e){}},29485,(e,t,n)=>{"use strict";let{Writable:r}=e.r(88947),i=e.r(80295),{BINARY_TYPES:s,EMPTY_BUFFER:o,kStatusCode:a,kWebSocket:l}=e.r(74836),{concat:u,toArrayBuffer:c,unmask:d}=e.r(97970),{isValidStatusCode:p,isValidUTF8:h}=e.r(58739),f=Buffer[Symbol.species];t.exports=class extends r{constructor(e={}){super(),this._allowSynchronousEvents=void 0===e.allowSynchronousEvents||e.allowSynchronousEvents,this._binaryType=e.binaryType||s[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=0|e.maxPayload,this._skipUTF8Validation=!!e.skipUTF8Validation,this[l]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=0}_write(e,t,n){if(8===this._opcode&&0==this._state)return n();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(n)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let t=this._buffers[0];return this._buffers[0]=new f(t.buffer,t.byteOffset+e,t.length-e),new f(t.buffer,t.byteOffset,e)}let t=Buffer.allocUnsafe(e);do{let n=this._buffers[0],r=t.length-e;e>=n.length?t.set(this._buffers.shift(),r):(t.set(new Uint8Array(n.buffer,n.byteOffset,e),r),this._buffers[0]=new f(n.buffer,n.byteOffset+e,n.length-e)),e-=n.length}while(e>0)return t}startLoop(e){this._loop=!0;do switch(this._state){case 0:this.getInfo(e);break;case 1:this.getPayloadLength16(e);break;case 2:this.getPayloadLength64(e);break;case 3:this.getMask();break;case 4:this.getData(e);break;case 5:case 6:this._loop=!1;return}while(this._loop)this._errored||e()}getInfo(e){if(this._bufferedBytes<2){this._loop=!1;return}let t=this.consume(2);if((48&t[0])!=0)return void e(this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3"));let n=(64&t[0])==64;if(n&&!this._extensions[i.extensionName])return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));if(this._fin=(128&t[0])==128,this._opcode=15&t[0],this._payloadLength=127&t[1],0===this._opcode){if(n)return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));if(!this._fragmented)return void e(this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE"));this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented)return void e(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"));this._compressed=n}else{if(!(this._opcode>7)||!(this._opcode<11))return void e(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"));if(!this._fin)return void e(this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN"));if(n)return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));if(this._payloadLength>125||8===this._opcode&&1===this._payloadLength)return void e(this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH"))}if(this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=(128&t[1])==128,this._isServer){if(!this._masked)return void e(this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK"))}else if(this._masked)return void e(this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK"));126===this._payloadLength?this._state=1:127===this._payloadLength?this._state=2:this.haveLength(e)}getPayloadLength16(e){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e)}getPayloadLength64(e){if(this._bufferedBytes<8){this._loop=!1;return}let t=this.consume(8),n=t.readUInt32BE(0);n>2097151?e(this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH")):(this._payloadLength=0x100000000*n+t.readUInt32BE(4),this.haveLength(e))}haveLength(e){this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)?e(this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH")):this._masked?this._state=3:this._state=4}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=4}getData(e){let t=o;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}t=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!=0&&d(t,this._mask)}if(this._opcode>7)return void this.controlMessage(t,e);if(this._compressed){this._state=5,this.decompress(t,e);return}t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage(e)}decompress(e,t){this._extensions[i.extensionName].decompress(e,this._fin,(e,n)=>{if(e)return t(e);if(n.length){if(this._messageLength+=n.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return void t(this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));this._fragments.push(n)}this.dataMessage(t),0===this._state&&this.startLoop(t)})}dataMessage(e){if(!this._fin){this._state=0;return}let t=this._messageLength,n=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){let r;r="nodebuffer"===this._binaryType?u(n,t):"arraybuffer"===this._binaryType?c(u(n,t)):"blob"===this._binaryType?new Blob(n):n,this._allowSynchronousEvents?(this.emit("message",r,!0),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",r,!0),this._state=0,this.startLoop(e)}))}else{let r=u(n,t);if(!this._skipUTF8Validation&&!h(r))return void e(this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8"));5===this._state||this._allowSynchronousEvents?(this.emit("message",r,!1),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",r,!1),this._state=0,this.startLoop(e)}))}}controlMessage(e,t){if(8===this._opcode){if(0===e.length)this._loop=!1,this.emit("conclude",1005,o),this.end();else{let n=e.readUInt16BE(0);if(!p(n))return void t(this.createError(RangeError,`invalid status code ${n}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE"));let r=new f(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!h(r))return void t(this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8"));this._loop=!1,this.emit("conclude",n,r),this.end()}this._state=0;return}this._allowSynchronousEvents?(this.emit(9===this._opcode?"ping":"pong",e),this._state=0):(this._state=6,setImmediate(()=>{this.emit(9===this._opcode?"ping":"pong",e),this._state=0,this.startLoop(t)}))}createError(e,t,n,r,i){this._loop=!1,this._errored=!0;let s=new e(n?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(s,this.createError),s.code=i,s[a]=r,s}}},16735,(e,t,n)=>{"use strict";let r,{Duplex:i}=e.r(88947),{randomFillSync:s}=e.r(54799),o=e.r(80295),{EMPTY_BUFFER:a,kWebSocket:l,NOOP:u}=e.r(74836),{isBlob:c,isValidStatusCode:d}=e.r(58739),{mask:p,toBuffer:h}=e.r(97970),f=Symbol("kByteLength"),m=Buffer.alloc(4),g=8192;class _{constructor(e,t,n){this._extensions=t||{},n&&(this._generateMask=n,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=0,this.onerror=u,this[l]=void 0}static frame(e,t){let n,i,o=!1,a=2,l=!1;t.mask&&(n=t.maskBuffer||m,t.generateMask?t.generateMask(n):(8192===g&&(void 0===r&&(r=Buffer.alloc(8192)),s(r,0,8192),g=0),n[0]=r[g++],n[1]=r[g++],n[2]=r[g++],n[3]=r[g++]),l=(n[0]|n[1]|n[2]|n[3])==0,a=6),"string"==typeof e?i=(!t.mask||l)&&void 0!==t[f]?t[f]:(e=Buffer.from(e)).length:(i=e.length,o=t.mask&&t.readOnly&&!l);let u=i;i>=65536?(a+=8,u=127):i>125&&(a+=2,u=126);let c=Buffer.allocUnsafe(o?i+a:a);return(c[0]=t.fin?128|t.opcode:t.opcode,t.rsv1&&(c[0]|=64),c[1]=u,126===u?c.writeUInt16BE(i,2):127===u&&(c[2]=c[3]=0,c.writeUIntBE(i,4,6)),t.mask)?(c[1]|=128,c[a-4]=n[0],c[a-3]=n[1],c[a-2]=n[2],c[a-1]=n[3],l)?[c,e]:o?(p(e,n,c,a,i),[c]):(p(e,n,e,0,i),[c,e]):[c,e]}close(e,t,n,r){let i;if(void 0===e)i=a;else if("number"==typeof e&&d(e))if(void 0!==t&&t.length){let n=Buffer.byteLength(t);if(n>123)throw RangeError("The message must not be greater than 123 bytes");(i=Buffer.allocUnsafe(2+n)).writeUInt16BE(e,0),"string"==typeof t?i.write(t,2):i.set(t,2)}else(i=Buffer.allocUnsafe(2)).writeUInt16BE(e,0);else throw TypeError("First argument must be a valid error code number");let s={[f]:i.length,fin:!0,generateMask:this._generateMask,mask:n,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};0!==this._state?this.enqueue([this.dispatch,i,!1,s,r]):this.sendFrame(_.frame(i,s),r)}ping(e,t,n){let r,i;if("string"==typeof e?(r=Buffer.byteLength(e),i=!1):c(e)?(r=e.size,i=!1):(r=(e=h(e)).length,i=h.readOnly),r>125)throw RangeError("The data size must not be greater than 125 bytes");let s={[f]:r,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:9,readOnly:i,rsv1:!1};c(e)?0!==this._state?this.enqueue([this.getBlobData,e,!1,s,n]):this.getBlobData(e,!1,s,n):0!==this._state?this.enqueue([this.dispatch,e,!1,s,n]):this.sendFrame(_.frame(e,s),n)}pong(e,t,n){let r,i;if("string"==typeof e?(r=Buffer.byteLength(e),i=!1):c(e)?(r=e.size,i=!1):(r=(e=h(e)).length,i=h.readOnly),r>125)throw RangeError("The data size must not be greater than 125 bytes");let s={[f]:r,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:10,readOnly:i,rsv1:!1};c(e)?0!==this._state?this.enqueue([this.getBlobData,e,!1,s,n]):this.getBlobData(e,!1,s,n):0!==this._state?this.enqueue([this.dispatch,e,!1,s,n]):this.sendFrame(_.frame(e,s),n)}send(e,t,n){let r,i,s=this._extensions[o.extensionName],a=t.binary?2:1,l=t.compress;"string"==typeof e?(r=Buffer.byteLength(e),i=!1):c(e)?(r=e.size,i=!1):(r=(e=h(e)).length,i=h.readOnly),this._firstFragment?(this._firstFragment=!1,l&&s&&s.params[s._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(l=r>=s._threshold),this._compress=l):(l=!1,a=0),t.fin&&(this._firstFragment=!0);let u={[f]:r,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:a,readOnly:i,rsv1:l};c(e)?0!==this._state?this.enqueue([this.getBlobData,e,this._compress,u,n]):this.getBlobData(e,this._compress,u,n):0!==this._state?this.enqueue([this.dispatch,e,this._compress,u,n]):this.dispatch(e,this._compress,u,n)}getBlobData(e,t,n,r){this._bufferedBytes+=n[f],this._state=2,e.arrayBuffer().then(e=>{if(this._socket.destroyed){let e=Error("The socket was closed while the blob was being read");process.nextTick(y,this,e,r);return}this._bufferedBytes-=n[f];let i=h(e);t?this.dispatch(i,t,n,r):(this._state=0,this.sendFrame(_.frame(i,n),r),this.dequeue())}).catch(e=>{process.nextTick(v,this,e,r)})}dispatch(e,t,n,r){if(!t)return void this.sendFrame(_.frame(e,n),r);let i=this._extensions[o.extensionName];this._bufferedBytes+=n[f],this._state=1,i.compress(e,n.fin,(e,t)=>{this._socket.destroyed?y(this,Error("The socket was closed while data was being compressed"),r):(this._bufferedBytes-=n[f],this._state=0,n.readOnly=!1,this.sendFrame(_.frame(t,n),r),this.dequeue())})}dequeue(){for(;0===this._state&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[3][f],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][f],this._queue.push(e)}sendFrame(e,t){2===e.length?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}}function y(e,t,n){"function"==typeof n&&n(t);for(let n=0;n<e._queue.length;n++){let r=e._queue[n],i=r[r.length-1];"function"==typeof i&&i(t)}}function v(e,t,n){y(e,t,n),e.onerror(t)}t.exports=_},70494,(e,t,n)=>{"use strict";let{kForOnEventAttribute:r,kListener:i}=e.r(74836),s=Symbol("kCode"),o=Symbol("kData"),a=Symbol("kError"),l=Symbol("kMessage"),u=Symbol("kReason"),c=Symbol("kTarget"),d=Symbol("kType"),p=Symbol("kWasClean");class h{constructor(e){this[c]=null,this[d]=e}get target(){return this[c]}get type(){return this[d]}}Object.defineProperty(h.prototype,"target",{enumerable:!0}),Object.defineProperty(h.prototype,"type",{enumerable:!0});class f extends h{constructor(e,t={}){super(e),this[s]=void 0===t.code?0:t.code,this[u]=void 0===t.reason?"":t.reason,this[p]=void 0!==t.wasClean&&t.wasClean}get code(){return this[s]}get reason(){return this[u]}get wasClean(){return this[p]}}Object.defineProperty(f.prototype,"code",{enumerable:!0}),Object.defineProperty(f.prototype,"reason",{enumerable:!0}),Object.defineProperty(f.prototype,"wasClean",{enumerable:!0});class m extends h{constructor(e,t={}){super(e),this[a]=void 0===t.error?null:t.error,this[l]=void 0===t.message?"":t.message}get error(){return this[a]}get message(){return this[l]}}Object.defineProperty(m.prototype,"error",{enumerable:!0}),Object.defineProperty(m.prototype,"message",{enumerable:!0});class g extends h{constructor(e,t={}){super(e),this[o]=void 0===t.data?null:t.data}get data(){return this[o]}}function _(e,t,n){"object"==typeof e&&e.handleEvent?e.handleEvent.call(e,n):e.call(t,n)}Object.defineProperty(g.prototype,"data",{enumerable:!0}),t.exports={CloseEvent:f,ErrorEvent:m,Event:h,EventTarget:{addEventListener(e,t,n={}){let s;for(let s of this.listeners(e))if(!n[r]&&s[i]===t&&!s[r])return;if("message"===e)s=function(e,n){let r=new g("message",{data:n?e:e.toString()});r[c]=this,_(t,this,r)};else if("close"===e)s=function(e,n){let r=new f("close",{code:e,reason:n.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});r[c]=this,_(t,this,r)};else if("error"===e)s=function(e){let n=new m("error",{error:e,message:e.message});n[c]=this,_(t,this,n)};else{if("open"!==e)return;s=function(){let e=new h("open");e[c]=this,_(t,this,e)}}s[r]=!!n[r],s[i]=t,n.once?this.once(e,s):this.on(e,s)},removeEventListener(e,t){for(let n of this.listeners(e))if(n[i]===t&&!n[r]){this.removeListener(e,n);break}}},MessageEvent:g}},96903,(e,t,n)=>{"use strict";let{tokenChars:r}=e.r(58739);function i(e,t,n){void 0===e[t]?e[t]=[n]:e[t].push(n)}t.exports={format:function(e){return Object.keys(e).map(t=>{let n=e[t];return Array.isArray(n)||(n=[n]),n.map(e=>[t].concat(Object.keys(e).map(t=>{let n=e[t];return Array.isArray(n)||(n=[n]),n.map(e=>!0===e?t:`${t}=${e}`).join("; ")})).join("; ")).join(", ")}).join(", ")},parse:function(e){let t,n,s=Object.create(null),o=Object.create(null),a=!1,l=!1,u=!1,c=-1,d=-1,p=-1,h=0;for(;h<e.length;h++)if(d=e.charCodeAt(h),void 0===t)if(-1===p&&1===r[d])-1===c&&(c=h);else if(0!==h&&(32===d||9===d))-1===p&&-1!==c&&(p=h);else if(59===d||44===d){if(-1===c)throw SyntaxError(`Unexpected character at index ${h}`);-1===p&&(p=h);let n=e.slice(c,p);44===d?(i(s,n,o),o=Object.create(null)):t=n,c=p=-1}else throw SyntaxError(`Unexpected character at index ${h}`);else if(void 0===n)if(-1===p&&1===r[d])-1===c&&(c=h);else if(32===d||9===d)-1===p&&-1!==c&&(p=h);else if(59===d||44===d){if(-1===c)throw SyntaxError(`Unexpected character at index ${h}`);-1===p&&(p=h),i(o,e.slice(c,p),!0),44===d&&(i(s,t,o),o=Object.create(null),t=void 0),c=p=-1}else if(61===d&&-1!==c&&-1===p)n=e.slice(c,h),c=p=-1;else throw SyntaxError(`Unexpected character at index ${h}`);else if(l){if(1!==r[d])throw SyntaxError(`Unexpected character at index ${h}`);-1===c?c=h:a||(a=!0),l=!1}else if(u)if(1===r[d])-1===c&&(c=h);else if(34===d&&-1!==c)u=!1,p=h;else if(92===d)l=!0;else throw SyntaxError(`Unexpected character at index ${h}`);else if(34===d&&61===e.charCodeAt(h-1))u=!0;else if(-1===p&&1===r[d])-1===c&&(c=h);else if(-1!==c&&(32===d||9===d))-1===p&&(p=h);else if(59===d||44===d){if(-1===c)throw SyntaxError(`Unexpected character at index ${h}`);-1===p&&(p=h);let r=e.slice(c,p);a&&(r=r.replace(/\\/g,""),a=!1),i(o,n,r),44===d&&(i(s,t,o),o=Object.create(null),t=void 0),n=void 0,c=p=-1}else throw SyntaxError(`Unexpected character at index ${h}`);if(-1===c||u||32===d||9===d)throw SyntaxError("Unexpected end of input");-1===p&&(p=h);let f=e.slice(c,p);return void 0===t?i(s,f,o):(void 0===n?i(o,f,!0):a?i(o,n,f.replace(/\\/g,"")):i(o,n,f),i(s,t,o)),s}}},35065,(e,t,n)=>{"use strict";let r=e.r(27699),i=e.r(24836),s=e.r(21517),o=e.r(4446),a=e.r(55004),{randomBytes:l,createHash:u}=e.r(54799),{Duplex:c,Readable:d}=e.r(88947),{URL:p}=e.r(92509),h=e.r(80295),f=e.r(29485),m=e.r(16735),{isBlob:g}=e.r(58739),{BINARY_TYPES:_,EMPTY_BUFFER:y,GUID:v,kForOnEventAttribute:E,kListener:b,kStatusCode:S,kWebSocket:T,NOOP:O}=e.r(74836),{EventTarget:{addEventListener:A,removeEventListener:w}}=e.r(70494),{format:C,parse:I}=e.r(96903),{toBuffer:R}=e.r(97970),P=Symbol("kAborted"),N=[8,13],x=["CONNECTING","OPEN","CLOSING","CLOSED"],k=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;class M extends r{constructor(e,t,n){super(),this._binaryType=_[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=y,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=M.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,null!==e?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,void 0===t?t=[]:Array.isArray(t)||("object"==typeof t&&null!==t?(n=t,t=[]):t=[t]),function e(t,n,r,o){let a,c,d,f,m={allowSynchronousEvents:!0,autoPong:!0,protocolVersion:N[1],maxPayload:0x6400000,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...o,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(t._autoPong=m.autoPong,!N.includes(m.protocolVersion))throw RangeError(`Unsupported protocol version: ${m.protocolVersion} (supported versions: ${N.join(", ")})`);if(n instanceof p)a=n;else try{a=new p(n)}catch(e){throw SyntaxError(`Invalid URL: ${n}`)}"http:"===a.protocol?a.protocol="ws:":"https:"===a.protocol&&(a.protocol="wss:"),t._url=a.href;let g="wss:"===a.protocol,_="ws+unix:"===a.protocol;if("ws:"===a.protocol||g||_?_&&!a.pathname?c="The URL's pathname is empty":a.hash&&(c="The URL contains a fragment identifier"):c='The URL\'s protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"',c){let e=SyntaxError(c);if(0!==t._redirects)return void D(t,e);throw e}let y=g?443:80,E=l(16).toString("base64"),b=g?i.request:s.request,S=new Set;if(m.createConnection=m.createConnection||(g?U:L),m.defaultPort=m.defaultPort||y,m.port=a.port||y,m.host=a.hostname.startsWith("[")?a.hostname.slice(1,-1):a.hostname,m.headers={...m.headers,"Sec-WebSocket-Version":m.protocolVersion,"Sec-WebSocket-Key":E,Connection:"Upgrade",Upgrade:"websocket"},m.path=a.pathname+a.search,m.timeout=m.handshakeTimeout,m.perMessageDeflate&&(d=new h(!0!==m.perMessageDeflate?m.perMessageDeflate:{},!1,m.maxPayload),m.headers["Sec-WebSocket-Extensions"]=C({[h.extensionName]:d.offer()})),r.length){for(let e of r){if("string"!=typeof e||!k.test(e)||S.has(e))throw SyntaxError("An invalid or duplicated subprotocol was specified");S.add(e)}m.headers["Sec-WebSocket-Protocol"]=r.join(",")}if(m.origin&&(m.protocolVersion<13?m.headers["Sec-WebSocket-Origin"]=m.origin:m.headers.Origin=m.origin),(a.username||a.password)&&(m.auth=`${a.username}:${a.password}`),_){let e=m.path.split(":");m.socketPath=e[0],m.path=e[1]}if(m.followRedirects){if(0===t._redirects){t._originalIpc=_,t._originalSecure=g,t._originalHostOrSocketPath=_?m.socketPath:a.host;let e=o&&o.headers;if(o={...o,headers:{}},e)for(let[t,n]of Object.entries(e))o.headers[t.toLowerCase()]=n}else if(0===t.listenerCount("redirect")){let e=_?!!t._originalIpc&&m.socketPath===t._originalHostOrSocketPath:!t._originalIpc&&a.host===t._originalHostOrSocketPath;e&&(!t._originalSecure||g)||(delete m.headers.authorization,delete m.headers.cookie,e||delete m.headers.host,m.auth=void 0)}m.auth&&!o.headers.authorization&&(o.headers.authorization="Basic "+Buffer.from(m.auth).toString("base64")),f=t._req=b(m),t._redirects&&t.emit("redirect",t.url,f)}else f=t._req=b(m);m.timeout&&f.on("timeout",()=>{j(t,f,"Opening handshake has timed out")}),f.on("error",e=>{null===f||f[P]||(f=t._req=null,D(t,e))}),f.on("response",i=>{let s=i.headers.location,a=i.statusCode;if(s&&m.followRedirects&&a>=300&&a<400){let i;if(++t._redirects>m.maxRedirects)return void j(t,f,"Maximum redirects exceeded");f.abort();try{i=new p(s,n)}catch(e){D(t,SyntaxError(`Invalid URL: ${s}`));return}e(t,i,r,o)}else t.emit("unexpected-response",f,i)||j(t,f,`Unexpected server response: ${i.statusCode}`)}),f.on("upgrade",(e,n,r)=>{let i;if(t.emit("upgrade",e),t.readyState!==M.CONNECTING)return;f=t._req=null;let s=e.headers.upgrade;if(void 0===s||"websocket"!==s.toLowerCase())return void j(t,n,"Invalid Upgrade header");let o=u("sha1").update(E+v).digest("base64");if(e.headers["sec-websocket-accept"]!==o)return void j(t,n,"Invalid Sec-WebSocket-Accept header");let a=e.headers["sec-websocket-protocol"];if(void 0!==a?S.size?S.has(a)||(i="Server sent an invalid subprotocol"):i="Server sent a subprotocol but none was requested":S.size&&(i="Server sent no subprotocol"),i)return void j(t,n,i);a&&(t._protocol=a);let l=e.headers["sec-websocket-extensions"];if(void 0!==l){let e;if(!d)return void j(t,n,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");try{e=I(l)}catch(e){j(t,n,"Invalid Sec-WebSocket-Extensions header");return}let r=Object.keys(e);if(1!==r.length||r[0]!==h.extensionName)return void j(t,n,"Server indicated an extension that was not requested");try{d.accept(e[h.extensionName])}catch(e){j(t,n,"Invalid Sec-WebSocket-Extensions header");return}t._extensions[h.extensionName]=d}t.setSocket(n,r,{allowSynchronousEvents:m.allowSynchronousEvents,generateMask:m.generateMask,maxPayload:m.maxPayload,skipUTF8Validation:m.skipUTF8Validation})}),m.finishRequest?m.finishRequest(f,t):f.end()}(this,e,t,n)):(this._autoPong=n.autoPong,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){_.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,t,n){let r=new f({allowSynchronousEvents:n.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:n.maxPayload,skipUTF8Validation:n.skipUTF8Validation}),i=new m(e,this._extensions,n.generateMask);this._receiver=r,this._sender=i,this._socket=e,r[T]=this,i[T]=this,e[T]=this,r.on("conclude",$),r.on("drain",G),r.on("error",H),r.on("message",B),r.on("ping",V),r.on("pong",W),i.onerror=K,e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",X),e.on("data",z),e.on("end",Q),e.on("error",Z),this._readyState=M.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=M.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[h.extensionName]&&this._extensions[h.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=M.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==M.CLOSED){if(this.readyState===M.CONNECTING)return void j(this,this._req,"WebSocket was closed before the connection was established");if(this.readyState===M.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=M.CLOSING,this._sender.close(e,t,!this._isServer,e=>{!e&&(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),Y(this)}}pause(){this.readyState!==M.CONNECTING&&this.readyState!==M.CLOSED&&(this._paused=!0,this._socket.pause())}ping(e,t,n){if(this.readyState===M.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");("function"==typeof e?(n=e,e=t=void 0):"function"==typeof t&&(n=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState!==M.OPEN)?q(this,e,n):(void 0===t&&(t=!this._isServer),this._sender.ping(e||y,t,n))}pong(e,t,n){if(this.readyState===M.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");("function"==typeof e?(n=e,e=t=void 0):"function"==typeof t&&(n=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState!==M.OPEN)?q(this,e,n):(void 0===t&&(t=!this._isServer),this._sender.pong(e||y,t,n))}resume(){this.readyState!==M.CONNECTING&&this.readyState!==M.CLOSED&&(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,t,n){if(this.readyState===M.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof t&&(n=t,t={}),"number"==typeof e&&(e=e.toString()),this.readyState!==M.OPEN)return void q(this,e,n);let r={binary:"string"!=typeof e,mask:!this._isServer,compress:!0,fin:!0,...t};this._extensions[h.extensionName]||(r.compress=!1),this._sender.send(e||y,r,n)}terminate(){if(this.readyState!==M.CLOSED){if(this.readyState===M.CONNECTING)return void j(this,this._req,"WebSocket was closed before the connection was established");this._socket&&(this._readyState=M.CLOSING,this._socket.destroy())}}}function D(e,t){e._readyState=M.CLOSING,e._errorEmitted=!0,e.emit("error",t),e.emitClose()}function L(e){return e.path=e.socketPath,o.connect(e)}function U(e){return e.path=void 0,e.servername||""===e.servername||(e.servername=o.isIP(e.host)?"":e.host),a.connect(e)}function j(e,t,n){e._readyState=M.CLOSING;let r=Error(n);Error.captureStackTrace(r,j),t.setHeader?(t[P]=!0,t.abort(),t.socket&&!t.socket.destroyed&&t.socket.destroy(),process.nextTick(D,e,r)):(t.destroy(r),t.once("error",e.emit.bind(e,"error")),t.once("close",e.emitClose.bind(e)))}function q(e,t,n){if(t){let n=g(t)?t.size:R(t).length;e._socket?e._sender._bufferedBytes+=n:e._bufferedAmount+=n}if(n){let t=Error(`WebSocket is not open: readyState ${e.readyState} (${x[e.readyState]})`);process.nextTick(n,t)}}function $(e,t){let n=this[T];n._closeFrameReceived=!0,n._closeMessage=t,n._closeCode=e,void 0!==n._socket[T]&&(n._socket.removeListener("data",z),process.nextTick(J,n._socket),1005===e?n.close():n.close(e,t))}function G(){let e=this[T];e.isPaused||e._socket.resume()}function H(e){let t=this[T];void 0!==t._socket[T]&&(t._socket.removeListener("data",z),process.nextTick(J,t._socket),t.close(e[S])),t._errorEmitted||(t._errorEmitted=!0,t.emit("error",e))}function F(){this[T].emitClose()}function B(e,t){this[T].emit("message",e,t)}function V(e){let t=this[T];t._autoPong&&t.pong(e,!this._isServer,O),t.emit("ping",e)}function W(e){this[T].emit("pong",e)}function J(e){e.resume()}function K(e){let t=this[T];t.readyState!==M.CLOSED&&(t.readyState===M.OPEN&&(t._readyState=M.CLOSING,Y(t)),this._socket.end(),t._errorEmitted||(t._errorEmitted=!0,t.emit("error",e)))}function Y(e){e._closeTimer=setTimeout(e._socket.destroy.bind(e._socket),3e4)}function X(){let e,t=this[T];this.removeListener("close",X),this.removeListener("data",z),this.removeListener("end",Q),t._readyState=M.CLOSING,this._readableState.endEmitted||t._closeFrameReceived||t._receiver._writableState.errorEmitted||null===(e=t._socket.read())||t._receiver.write(e),t._receiver.end(),this[T]=void 0,clearTimeout(t._closeTimer),t._receiver._writableState.finished||t._receiver._writableState.errorEmitted?t.emitClose():(t._receiver.on("error",F),t._receiver.on("finish",F))}function z(e){this[T]._receiver.write(e)||this.pause()}function Q(){let e=this[T];e._readyState=M.CLOSING,e._receiver.end(),this.end()}function Z(){let e=this[T];this.removeListener("error",Z),this.on("error",O),e&&(e._readyState=M.CLOSING,this.destroy())}Object.defineProperty(M,"CONNECTING",{enumerable:!0,value:x.indexOf("CONNECTING")}),Object.defineProperty(M.prototype,"CONNECTING",{enumerable:!0,value:x.indexOf("CONNECTING")}),Object.defineProperty(M,"OPEN",{enumerable:!0,value:x.indexOf("OPEN")}),Object.defineProperty(M.prototype,"OPEN",{enumerable:!0,value:x.indexOf("OPEN")}),Object.defineProperty(M,"CLOSING",{enumerable:!0,value:x.indexOf("CLOSING")}),Object.defineProperty(M.prototype,"CLOSING",{enumerable:!0,value:x.indexOf("CLOSING")}),Object.defineProperty(M,"CLOSED",{enumerable:!0,value:x.indexOf("CLOSED")}),Object.defineProperty(M.prototype,"CLOSED",{enumerable:!0,value:x.indexOf("CLOSED")}),["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(e=>{Object.defineProperty(M.prototype,e,{enumerable:!0})}),["open","error","close","message"].forEach(e=>{Object.defineProperty(M.prototype,`on${e}`,{enumerable:!0,get(){for(let t of this.listeners(e))if(t[E])return t[b];return null},set(t){for(let t of this.listeners(e))if(t[E]){this.removeListener(e,t);break}"function"==typeof t&&this.addEventListener(e,t,{[E]:!0})}})}),M.prototype.addEventListener=A,M.prototype.removeEventListener=w,t.exports=M},21365,(e,t,n)=>{"use strict";e.r(35065);let{Duplex:r}=e.r(88947);function i(e){e.emit("close")}function s(){!this.destroyed&&this._writableState.finished&&this.destroy()}function o(e){this.removeListener("error",o),this.destroy(),0===this.listenerCount("error")&&this.emit("error",e)}t.exports=function(e,t){let n=!0,a=new r({...t,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return e.on("message",function(t,n){let r=!n&&a._readableState.objectMode?t.toString():t;a.push(r)||e.pause()}),e.once("error",function(e){a.destroyed||(n=!1,a.destroy(e))}),e.once("close",function(){a.destroyed||a.push(null)}),a._destroy=function(t,r){if(e.readyState===e.CLOSED){r(t),process.nextTick(i,a);return}let s=!1;e.once("error",function(e){s=!0,r(e)}),e.once("close",function(){s||r(t),process.nextTick(i,a)}),n&&e.terminate()},a._final=function(t){e.readyState===e.CONNECTING?e.once("open",function(){a._final(t)}):null!==e._socket&&(e._socket._writableState.finished?(t(),a._readableState.endEmitted&&a.destroy()):(e._socket.once("finish",function(){t()}),e.close()))},a._read=function(){e.isPaused&&e.resume()},a._write=function(t,n,r){e.readyState===e.CONNECTING?e.once("open",function(){a._write(t,n,r)}):e.send(t,r)},a.on("end",s),a.on("error",o),a}},42977,(e,t,n)=>{"use strict";let{tokenChars:r}=e.r(58739);t.exports={parse:function(e){let t=new Set,n=-1,i=-1,s=0;for(;s<e.length;s++){let o=e.charCodeAt(s);if(-1===i&&1===r[o])-1===n&&(n=s);else if(0!==s&&(32===o||9===o))-1===i&&-1!==n&&(i=s);else if(44===o){if(-1===n)throw SyntaxError(`Unexpected character at index ${s}`);-1===i&&(i=s);let r=e.slice(n,i);if(t.has(r))throw SyntaxError(`The "${r}" subprotocol is duplicated`);t.add(r),n=i=-1}else throw SyntaxError(`Unexpected character at index ${s}`)}if(-1===n||-1!==i)throw SyntaxError("Unexpected end of input");let o=e.slice(n,s);if(t.has(o))throw SyntaxError(`The "${o}" subprotocol is duplicated`);return t.add(o),t}}},17198,(e,t,n)=>{"use strict";let r=e.r(27699),i=e.r(21517),{Duplex:s}=e.r(88947),{createHash:o}=e.r(54799),a=e.r(96903),l=e.r(80295),u=e.r(42977),c=e.r(35065),{GUID:d,kWebSocket:p}=e.r(74836),h=/^[+/0-9A-Za-z]{22}==$/;function f(e){e._state=2,e.emit("close")}function m(){this.destroy()}function g(e,t,n,r){n=n||i.STATUS_CODES[t],r={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(n),...r},e.once("finish",e.destroy),e.end(`HTTP/1.1 ${t} ${i.STATUS_CODES[t]}\r
`+Object.keys(r).map(e=>`${e}: ${r[e]}`).join("\r\n")+"\r\n\r\n"+n)}function _(e,t,n,r,i,s){if(e.listenerCount("wsClientError")){let r=Error(i);Error.captureStackTrace(r,_),e.emit("wsClientError",r,n,t)}else g(n,r,i,s)}t.exports=class extends r{constructor(e,t){if(super(),null==(e={allowSynchronousEvents:!0,autoPong:!0,maxPayload:0x6400000,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:c,...e}).port&&!e.server&&!e.noServer||null!=e.port&&(e.server||e.noServer)||e.server&&e.noServer)throw TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(null!=e.port?(this._server=i.createServer((e,t)=>{let n=i.STATUS_CODES[426];t.writeHead(426,{"Content-Length":n.length,"Content-Type":"text/plain"}),t.end(n)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server){const e=this.emit.bind(this,"connection");this._removeListeners=function(e,t){for(let n of Object.keys(t))e.on(n,t[n]);return function(){for(let n of Object.keys(t))e.removeListener(n,t[n])}}(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(t,n,r)=>{this.handleUpgrade(t,n,r,e)}})}!0===e.perMessageDeflate&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=0}address(){if(this.options.noServer)throw Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(2===this._state){e&&this.once("close",()=>{e(Error("The server is not running"))}),process.nextTick(f,this);return}if(e&&this.once("close",e),1!==this._state)if(this._state=1,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients&&this.clients.size?this._shouldEmitClose=!0:process.nextTick(f,this);else{let e=this._server;this._removeListeners(),this._removeListeners=this._server=null,e.close(()=>{f(this)})}}shouldHandle(e){if(this.options.path){let t=e.url.indexOf("?");if((-1!==t?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,n,r){t.on("error",m);let i=e.headers["sec-websocket-key"],s=e.headers.upgrade,o=+e.headers["sec-websocket-version"];if("GET"!==e.method)return void _(this,e,t,405,"Invalid HTTP method");if(void 0===s||"websocket"!==s.toLowerCase())return void _(this,e,t,400,"Invalid Upgrade header");if(void 0===i||!h.test(i))return void _(this,e,t,400,"Missing or invalid Sec-WebSocket-Key header");if(13!==o&&8!==o)return void _(this,e,t,400,"Missing or invalid Sec-WebSocket-Version header",{"Sec-WebSocket-Version":"13, 8"});if(!this.shouldHandle(e))return void g(t,400);let c=e.headers["sec-websocket-protocol"],d=new Set;if(void 0!==c)try{d=u.parse(c)}catch(n){_(this,e,t,400,"Invalid Sec-WebSocket-Protocol header");return}let p=e.headers["sec-websocket-extensions"],f={};if(this.options.perMessageDeflate&&void 0!==p){let n=new l(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let e=a.parse(p);e[l.extensionName]&&(n.accept(e[l.extensionName]),f[l.extensionName]=n)}catch(n){_(this,e,t,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let s={origin:e.headers[`${8===o?"sec-websocket-origin":"origin"}`],secure:!!(e.socket.authorized||e.socket.encrypted),req:e};if(2===this.options.verifyClient.length)return void this.options.verifyClient(s,(s,o,a,l)=>{if(!s)return g(t,o||401,a,l);this.completeUpgrade(f,i,d,e,t,n,r)});if(!this.options.verifyClient(s))return g(t,401)}this.completeUpgrade(f,i,d,e,t,n,r)}completeUpgrade(e,t,n,r,i,s,u){if(!i.readable||!i.writable)return i.destroy();if(i[p])throw Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>0)return g(i,503);let c=o("sha1").update(t+d).digest("base64"),h=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${c}`],_=new this.options.WebSocket(null,void 0,this.options);if(n.size){let e=this.options.handleProtocols?this.options.handleProtocols(n,r):n.values().next().value;e&&(h.push(`Sec-WebSocket-Protocol: ${e}`),_._protocol=e)}if(e[l.extensionName]){let t=e[l.extensionName].params,n=a.format({[l.extensionName]:[t]});h.push(`Sec-WebSocket-Extensions: ${n}`),_._extensions=e}this.emit("headers",h,r),i.write(h.concat("\r\n").join("\r\n")),i.removeListener("error",m),_.setSocket(i,s,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(_),_.on("close",()=>{this.clients.delete(_),this._shouldEmitClose&&!this.clients.size&&process.nextTick(f,this)})),u(_,r)}}},95975,(e,t,n)=>{"use strict";function r(e){for(let t=0;t<e.length;t++){let n=e[t];if("function"!=typeof n)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof n}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"ensureServerEntryExports",{enumerable:!0,get:function(){return r}})},7312,94943,e=>{"use strict";let t,n,r,i,s,o;var a,l,u,c,d,p,h,f,m,g,_,y,v,E,b,S,T,O,A,w,C,I,R,P,N,x,k,M,D,L,U,j,q,$,G,H,F,B,V,W,J,K,Y,X,z,Q,Z,ee,et,en,er,ei,es,eo,ea,el,eu,ec,ed,ep,eh,ef,em,eg,e_,ey,ev,eE,eb,eS,eT,eO,eA,ew,eC,eI,eR,eP,eN,ex,ek,eM,eD,eL,eU,ej,eq,e$,eG,eH,eF,eB,eV,eW,eJ,eK,eY,eX,ez,eQ,eZ,e0,e1,e2,e4,e8,e6,e3,e9,e5,e7,te,tt,tn,tr,ti,ts,to,ta,tl,tu,tc,td,tp,th,tf,tm,tg,t_,ty,tv,tE,tb,tS,tT,tO,tA,tw,tC,tI,tR,tP,tN,tx,tk,tM,tD,tL,tU,tj,tq,t$,tG,tH,tF,tB,tV,tW,tJ,tK,tY,tX,tz,tQ,tZ,t0,t1,t2,t4,t8,t6,t3,t9,t5,t7,ne,nt=e.i(45015),nn=e.i(65044),nr=e.i(47334),ni=e.i(22734),ns=e.i(81111);e.i(21365),e.i(29485),e.i(16735);var no=e.i(35065);e.i(17198),no.default;var na=e.i(24868);class nl{}function nu(e,t){return e.replace(/\{([^}]+)\}/g,(e,n)=>{if(Object.prototype.hasOwnProperty.call(t,n)){let e=t[n];return null!=e?String(e):""}throw Error(`Key '${n}' not found in valueMap.`)})}function nc(e,t,n){for(let r=0;r<t.length-1;r++){let i=t[r];if(i.endsWith("[]")){let s=i.slice(0,-2);if(!(s in e))if(Array.isArray(n))e[s]=Array.from({length:n.length},()=>({}));else throw Error(`Value must be a list given an array path ${i}`);if(Array.isArray(e[s])){let i=e[s];if(Array.isArray(n))for(let e=0;e<i.length;e++)nc(i[e],t.slice(r+1),n[e]);else for(let e of i)nc(e,t.slice(r+1),n)}return}if(i.endsWith("[0]")){let s=i.slice(0,-3);s in e||(e[s]=[{}]),nc(e[s][0],t.slice(r+1),n);return}e[i]&&"object"==typeof e[i]||(e[i]={}),e=e[i]}let r=t[t.length-1],i=e[r];if(void 0!==i){if(!n||"object"==typeof n&&0===Object.keys(n).length||n===i)return;if("object"==typeof i&&"object"==typeof n&&null!==i&&null!==n)Object.assign(i,n);else throw Error(`Cannot set value for an existing key. Key: ${r}`)}else"_self"!==r||"object"!=typeof n||null===n||Array.isArray(n)?e[r]=n:Object.assign(e,n)}function nd(e,t,n){try{if(1===t.length&&"_self"===t[0])return e;for(let r=0;r<t.length;r++){if("object"!=typeof e||null===e)return n;let i=t[r];if(i.endsWith("[]")){let s=i.slice(0,-2);if(!(s in e))return n;{let i=e[s];if(!Array.isArray(i))return n;return i.map(e=>nd(e,t.slice(r+1),n))}}e=e[i]}return e}catch(e){if(e instanceof TypeError)return n;throw e}}function np(e){if("string"!=typeof e)throw Error("fromImageBytes must be a string");return e}(a=er||(er={})).OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",a.OUTCOME_OK="OUTCOME_OK",a.OUTCOME_FAILED="OUTCOME_FAILED",a.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED",(l=ei||(ei={})).LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",l.PYTHON="PYTHON",(u=es||(es={})).SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",u.SILENT="SILENT",u.WHEN_IDLE="WHEN_IDLE",u.INTERRUPT="INTERRUPT",(c=eo||(eo={})).TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",c.STRING="STRING",c.NUMBER="NUMBER",c.INTEGER="INTEGER",c.BOOLEAN="BOOLEAN",c.ARRAY="ARRAY",c.OBJECT="OBJECT",c.NULL="NULL",(d=ea||(ea={})).HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",d.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",d.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",d.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",d.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",d.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",d.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",d.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",d.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",d.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",d.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK",(p=el||(el={})).HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",p.SEVERITY="SEVERITY",p.PROBABILITY="PROBABILITY",(h=eu||(eu={})).HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",h.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",h.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",h.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",h.BLOCK_NONE="BLOCK_NONE",h.OFF="OFF",(f=ec||(ec={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",f.MODE_DYNAMIC="MODE_DYNAMIC",(m=ed||(ed={})).AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",m.NO_AUTH="NO_AUTH",m.API_KEY_AUTH="API_KEY_AUTH",m.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",m.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",m.OAUTH="OAUTH",m.OIDC_AUTH="OIDC_AUTH",(g=ep||(ep={})).API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",g.SIMPLE_SEARCH="SIMPLE_SEARCH",g.ELASTIC_SEARCH="ELASTIC_SEARCH",(_=eh||(eh={})).URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",_.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",_.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",_.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",_.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE",(y=ef||(ef={})).FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",y.STOP="STOP",y.MAX_TOKENS="MAX_TOKENS",y.SAFETY="SAFETY",y.RECITATION="RECITATION",y.LANGUAGE="LANGUAGE",y.OTHER="OTHER",y.BLOCKLIST="BLOCKLIST",y.PROHIBITED_CONTENT="PROHIBITED_CONTENT",y.SPII="SPII",y.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",y.IMAGE_SAFETY="IMAGE_SAFETY",y.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",y.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",y.NO_IMAGE="NO_IMAGE",(v=em||(em={})).HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",v.NEGLIGIBLE="NEGLIGIBLE",v.LOW="LOW",v.MEDIUM="MEDIUM",v.HIGH="HIGH",(E=eg||(eg={})).HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",E.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",E.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",E.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",E.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH",(b=e_||(e_={})).BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",b.SAFETY="SAFETY",b.OTHER="OTHER",b.BLOCKLIST="BLOCKLIST",b.PROHIBITED_CONTENT="PROHIBITED_CONTENT",b.IMAGE_SAFETY="IMAGE_SAFETY",b.MODEL_ARMOR="MODEL_ARMOR",b.JAILBREAK="JAILBREAK",(S=ey||(ey={})).TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",S.ON_DEMAND="ON_DEMAND",S.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT",(T=ev||(ev={})).MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",T.TEXT="TEXT",T.IMAGE="IMAGE",T.AUDIO="AUDIO",(O=eE||(eE={})).MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",O.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",O.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",O.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",(A=eb||(eb={})).JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",A.JOB_STATE_QUEUED="JOB_STATE_QUEUED",A.JOB_STATE_PENDING="JOB_STATE_PENDING",A.JOB_STATE_RUNNING="JOB_STATE_RUNNING",A.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",A.JOB_STATE_FAILED="JOB_STATE_FAILED",A.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",A.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",A.JOB_STATE_PAUSED="JOB_STATE_PAUSED",A.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",A.JOB_STATE_UPDATING="JOB_STATE_UPDATING",A.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED",(w=eS||(eS={})).TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",w.TUNING_MODE_FULL="TUNING_MODE_FULL",w.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER",(C=eT||(eT={})).ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",C.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",C.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",C.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",C.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",C.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",C.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO",(I=eO||(eO={})).TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",I.TUNING_TASK_I2V="TUNING_TASK_I2V",I.TUNING_TASK_T2V="TUNING_TASK_T2V",(R=eA||(eA={})).FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",R.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",R.BALANCED="BALANCED",R.PRIORITIZE_COST="PRIORITIZE_COST",(P=ew||(ew={})).UNSPECIFIED="UNSPECIFIED",P.BLOCKING="BLOCKING",P.NON_BLOCKING="NON_BLOCKING",(N=eC||(eC={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",N.MODE_DYNAMIC="MODE_DYNAMIC",(x=eI||(eI={})).ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",x.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER",(k=eR||(eR={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",k.AUTO="AUTO",k.ANY="ANY",k.NONE="NONE",k.VALIDATED="VALIDATED",(M=eP||(eP={})).BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",M.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",M.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",M.BLOCK_NONE="BLOCK_NONE",(D=eN||(eN={})).DONT_ALLOW="DONT_ALLOW",D.ALLOW_ADULT="ALLOW_ADULT",D.ALLOW_ALL="ALLOW_ALL",(L=ex||(ex={})).auto="auto",L.en="en",L.ja="ja",L.ko="ko",L.hi="hi",L.zh="zh",L.pt="pt",L.es="es",(U=ek||(ek={})).MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",U.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",U.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",U.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",U.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC",(j=eM||(eM={})).CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",j.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",j.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",j.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH",(q=eD||(eD={})).SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",q.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",q.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",q.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT",($=eL||(eL={})).EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",$.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",$.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",$.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",$.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",$.EDIT_MODE_STYLE="EDIT_MODE_STYLE",$.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",$.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE",(G=eU||(eU={})).FOREGROUND="FOREGROUND",G.BACKGROUND="BACKGROUND",G.PROMPT="PROMPT",G.SEMANTIC="SEMANTIC",G.INTERACTIVE="INTERACTIVE",(H=ej||(ej={})).ASSET="ASSET",H.STYLE="STYLE",(F=eq||(eq={})).INSERT="INSERT",F.REMOVE="REMOVE",F.REMOVE_STATIC="REMOVE_STATIC",F.OUTPAINT="OUTPAINT",(B=e$||(e$={})).OPTIMIZED="OPTIMIZED",B.LOSSLESS="LOSSLESS",(V=eG||(eG={})).STATE_UNSPECIFIED="STATE_UNSPECIFIED",V.PROCESSING="PROCESSING",V.ACTIVE="ACTIVE",V.FAILED="FAILED",(W=eH||(eH={})).SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",W.UPLOADED="UPLOADED",W.GENERATED="GENERATED",(J=eF||(eF={})).TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",J.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",J.RESPONSE_REJECTED="RESPONSE_REJECTED",J.NEED_MORE_INPUT="NEED_MORE_INPUT",(K=eB||(eB={})).MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",K.TEXT="TEXT",K.IMAGE="IMAGE",K.VIDEO="VIDEO",K.AUDIO="AUDIO",K.DOCUMENT="DOCUMENT",(Y=eV||(eV={})).START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",Y.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",Y.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW",(X=eW||(eW={})).END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",X.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",X.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW",(z=eJ||(eJ={})).ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",z.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",z.NO_INTERRUPTION="NO_INTERRUPTION",(Q=eK||(eK={})).TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",Q.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",Q.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT",(Z=eY||(eY={})).SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",Z.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",Z.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",Z.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",Z.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",Z.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",Z.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",Z.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",Z.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",Z.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",Z.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",Z.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",Z.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR",(ee=eX||(eX={})).MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",ee.QUALITY="QUALITY",ee.DIVERSITY="DIVERSITY",ee.VOCALIZATION="VOCALIZATION",(et=ez||(ez={})).PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",et.PLAY="PLAY",et.PAUSE="PAUSE",et.STOP="STOP",et.RESET_CONTEXT="RESET_CONTEXT";class nh{constructor(e){const t={};for(const n of e.headers.entries())t[n[0]]=n[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}}class nf{get text(){var e,t,n,r,i,s,o,a;if((null==(r=null==(n=null==(t=null==(e=this.candidates)?void 0:e[0])?void 0:t.content)?void 0:n.parts)?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let l="",u=!1,c=[];for(let e of null!=(a=null==(o=null==(s=null==(i=this.candidates)?void 0:i[0])?void 0:s.content)?void 0:o.parts)?a:[]){for(let[t,n]of Object.entries(e))"text"!==t&&"thought"!==t&&(null!==n||void 0!==n)&&c.push(t);if("string"==typeof e.text){if("boolean"==typeof e.thought&&e.thought)continue;u=!0,l+=e.text}}return c.length>0&&console.warn(`there are non-text parts ${c} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),u?l:void 0}get data(){var e,t,n,r,i,s,o,a;if((null==(r=null==(n=null==(t=null==(e=this.candidates)?void 0:e[0])?void 0:t.content)?void 0:n.parts)?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let l="",u=[];for(let e of null!=(a=null==(o=null==(s=null==(i=this.candidates)?void 0:i[0])?void 0:s.content)?void 0:o.parts)?a:[]){for(let[t,n]of Object.entries(e))"inlineData"!==t&&(null!==n||void 0!==n)&&u.push(t);e.inlineData&&"string"==typeof e.inlineData.data&&(l+=atob(e.inlineData.data))}return u.length>0&&console.warn(`there are non-data parts ${u} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),l.length>0?btoa(l):void 0}get functionCalls(){var e,t,n,r,i,s,o,a;if((null==(r=null==(n=null==(t=null==(e=this.candidates)?void 0:e[0])?void 0:t.content)?void 0:n.parts)?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");let l=null==(a=null==(o=null==(s=null==(i=this.candidates)?void 0:i[0])?void 0:s.content)?void 0:o.parts)?void 0:a.filter(e=>e.functionCall).map(e=>e.functionCall).filter(e=>void 0!==e);if((null==l?void 0:l.length)!==0)return l}get executableCode(){var e,t,n,r,i,s,o,a,l;if((null==(r=null==(n=null==(t=null==(e=this.candidates)?void 0:e[0])?void 0:t.content)?void 0:n.parts)?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");let u=null==(a=null==(o=null==(s=null==(i=this.candidates)?void 0:i[0])?void 0:s.content)?void 0:o.parts)?void 0:a.filter(e=>e.executableCode).map(e=>e.executableCode).filter(e=>void 0!==e);if((null==u?void 0:u.length)!==0)return null==(l=null==u?void 0:u[0])?void 0:l.code}get codeExecutionResult(){var e,t,n,r,i,s,o,a,l;if((null==(r=null==(n=null==(t=null==(e=this.candidates)?void 0:e[0])?void 0:t.content)?void 0:n.parts)?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");let u=null==(a=null==(o=null==(s=null==(i=this.candidates)?void 0:i[0])?void 0:s.content)?void 0:o.parts)?void 0:a.filter(e=>e.codeExecutionResult).map(e=>e.codeExecutionResult).filter(e=>void 0!==e);if((null==u?void 0:u.length)!==0)return null==(l=null==u?void 0:u[0])?void 0:l.output}}class nm{}class ng{}class n_{}class ny{}class nv{}class nE{}class nb{}class nS{}class nT{}class nO{}class nA{_fromAPIResponse({apiResponse:e,isVertexAI:t}){let n,r=new nA;if(t){let t,r,i,s,o,a;t={},null!=(r=nd(e,["name"]))&&nc(t,["name"],r),null!=(i=nd(e,["metadata"]))&&nc(t,["metadata"],i),null!=(s=nd(e,["done"]))&&nc(t,["done"],s),null!=(o=nd(e,["error"]))&&nc(t,["error"],o),null!=(a=nd(e,["response"]))&&nc(t,["response"],function(e){let t={},n=nd(e,["videos"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,r,i,s,o,a;return n={},null!=(r=nd(e,["_self"]))&&nc(n,["video"],(i={},null!=(s=nd(t=r,["gcsUri"]))&&nc(i,["uri"],s),null!=(o=nd(t,["bytesBase64Encoded"]))&&nc(i,["videoBytes"],np(o)),null!=(a=nd(t,["mimeType"]))&&nc(i,["mimeType"],a),i)),n})),nc(t,["generatedVideos"],e)}let r=nd(e,["raiMediaFilteredCount"]);null!=r&&nc(t,["raiMediaFilteredCount"],r);let i=nd(e,["raiMediaFilteredReasons"]);return null!=i&&nc(t,["raiMediaFilteredReasons"],i),t}(a)),n=t}else{let t,r,i,s,o,a;t={},null!=(r=nd(e,["name"]))&&nc(t,["name"],r),null!=(i=nd(e,["metadata"]))&&nc(t,["metadata"],i),null!=(s=nd(e,["done"]))&&nc(t,["done"],s),null!=(o=nd(e,["error"]))&&nc(t,["error"],o),null!=(a=nd(e,["response","generateVideoResponse"]))&&nc(t,["response"],function(e){let t={},n=nd(e,["generatedSamples"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,r,i,s,o,a;return n={},null!=(r=nd(e,["video"]))&&nc(n,["video"],(i={},null!=(s=nd(t=r,["uri"]))&&nc(i,["uri"],s),null!=(o=nd(t,["encodedVideo"]))&&nc(i,["videoBytes"],np(o)),null!=(a=nd(t,["encoding"]))&&nc(i,["mimeType"],a),i)),n})),nc(t,["generatedVideos"],e)}let r=nd(e,["raiMediaFilteredCount"]);null!=r&&nc(t,["raiMediaFilteredCount"],r);let i=nd(e,["raiMediaFilteredReasons"]);return null!=i&&nc(t,["raiMediaFilteredReasons"],i),t}(a)),n=t}return Object.assign(r,n),r}}class nw{}class nC{}class nI{}class nR{}class nP{}class nN{}class nx{}class nk{get text(){var e,t,n;let r="",i=!1,s=[];for(let o of null!=(n=null==(t=null==(e=this.serverContent)?void 0:e.modelTurn)?void 0:t.parts)?n:[]){for(let[e,t]of Object.entries(o))"text"!==e&&"thought"!==e&&null!==t&&s.push(e);if("string"==typeof o.text){if("boolean"==typeof o.thought&&o.thought)continue;i=!0,r+=o.text}}return s.length>0&&console.warn(`there are non-text parts ${s} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),i?r:void 0}get data(){var e,t,n;let r="",i=[];for(let s of null!=(n=null==(t=null==(e=this.serverContent)?void 0:e.modelTurn)?void 0:t.parts)?n:[]){for(let[e,t]of Object.entries(s))"inlineData"!==e&&null!==t&&i.push(e);s.inlineData&&"string"==typeof s.inlineData.data&&(r+=atob(s.inlineData.data))}return i.length>0&&console.warn(`there are non-data parts ${i} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),r.length>0?btoa(r):void 0}}class nM{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}function nD(e,t){if(!t||"string"!=typeof t)throw Error("model is required and must be a string");if(e.isVertexAI())if(t.startsWith("publishers/")||t.startsWith("projects/")||t.startsWith("models/"))return t;else{if(!(t.indexOf("/")>=0))return`publishers/google/models/${t}`;let e=t.split("/",2);return`publishers/${e[0]}/models/${e[1]}`}return t.startsWith("models/")||t.startsWith("tunedModels/")?t:`models/${t}`}function nL(e,t){let n=nD(e,t);return n?n.startsWith("publishers/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/${n}`:n.startsWith("models/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/publishers/google/${n}`:n:""}function nU(e){return Array.isArray(e)?e.map(e=>nj(e)):[nj(e)]}function nj(e){if("object"==typeof e&&null!==e)return e;throw Error(`Could not parse input as Blob. Unsupported blob type: ${typeof e}`)}function nq(e){let t=nj(e);if(t.mimeType&&t.mimeType.startsWith("image/"))return t;throw Error(`Unsupported mime type: ${t.mimeType}`)}function n$(e){let t=nj(e);if(t.mimeType&&t.mimeType.startsWith("audio/"))return t;throw Error(`Unsupported mime type: ${t.mimeType}`)}function nG(e){if(null==e)throw Error("PartUnion is required");if("object"==typeof e)return e;if("string"==typeof e)return{text:e};throw Error(`Unsupported part type: ${typeof e}`)}function nH(e){if(null==e||Array.isArray(e)&&0===e.length)throw Error("PartListUnion is required");return Array.isArray(e)?e.map(e=>nG(e)):[nG(e)]}function nF(e){return null!=e&&"object"==typeof e&&"parts"in e&&Array.isArray(e.parts)}function nB(e){return null!=e&&"object"==typeof e&&"functionCall"in e}function nV(e){return null!=e&&"object"==typeof e&&"functionResponse"in e}function nW(e){if(null==e)throw Error("ContentUnion is required");return nF(e)?e:{role:"user",parts:nH(e)}}function nJ(e,t){if(!t)return[];if(e.isVertexAI()&&Array.isArray(t))return t.flatMap(e=>{let t=nW(e);return t.parts&&t.parts.length>0&&void 0!==t.parts[0].text?[t.parts[0].text]:[]});if(e.isVertexAI()){let e=nW(t);return e.parts&&e.parts.length>0&&void 0!==e.parts[0].text?[e.parts[0].text]:[]}return Array.isArray(t)?t.map(e=>nW(e)):[nW(t)]}function nK(e){if(null==e||Array.isArray(e)&&0===e.length)throw Error("contents are required");if(!Array.isArray(e)){if(nB(e)||nV(e))throw Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[nW(e)]}let t=[],n=[],r=nF(e[0]);for(let i of e){let e=nF(i);if(e!=r)throw Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(e)t.push(i);else if(nB(i)||nV(i))throw Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");else n.push(i)}return r||t.push({role:"user",parts:nH(n)}),t}function nY(e){let t={},n=["items"],r=["anyOf"],i=["properties"];if(e.type&&e.anyOf)throw Error("type and anyOf cannot be both populated.");let s=e.anyOf;for(let[o,a]of(null!=s&&2==s.length&&("null"===s[0].type?(t.nullable=!0,e=s[1]):"null"===s[1].type&&(t.nullable=!0,e=s[0])),e.type instanceof Array&&function(e,t){e.includes("null")&&(t.nullable=!0);let n=e.filter(e=>"null"!==e);if(1===n.length)t.type=Object.values(eo).includes(n[0].toUpperCase())?n[0].toUpperCase():eo.TYPE_UNSPECIFIED;else for(let e of(t.anyOf=[],n))t.anyOf.push({type:Object.values(eo).includes(e.toUpperCase())?e.toUpperCase():eo.TYPE_UNSPECIFIED})}(e.type,t),Object.entries(e)))if(null!=a)if("type"==o){if("null"===a)throw Error("type: null can not be the only possible type for the field.");if(a instanceof Array)continue;t.type=Object.values(eo).includes(a.toUpperCase())?a.toUpperCase():eo.TYPE_UNSPECIFIED}else if(n.includes(o))t[o]=nY(a);else if(r.includes(o)){let e=[];for(let n of a){if("null"==n.type){t.nullable=!0;continue}e.push(nY(n))}t[o]=e}else if(i.includes(o)){let e={};for(let[t,n]of Object.entries(a))e[t]=nY(n);t[o]=e}else{if("additionalProperties"===o)continue;t[o]=a}return t}function nX(e){if("object"==typeof e)return e;if("string"==typeof e)return{voiceConfig:{prebuiltVoiceConfig:{voiceName:e}}};throw Error(`Unsupported speechConfig type: ${typeof e}`)}function nz(e){if("multiSpeakerVoiceConfig"in e)throw Error("multiSpeakerVoiceConfig is not supported in the live API.");return e}function nQ(e){if(e.functionDeclarations)for(let t of e.functionDeclarations)t.parameters&&(Object.keys(t.parameters).includes("$schema")?t.parametersJsonSchema||(t.parametersJsonSchema=t.parameters,delete t.parameters):t.parameters=nY(t.parameters)),t.response&&(Object.keys(t.response).includes("$schema")?t.responseJsonSchema||(t.responseJsonSchema=t.response,delete t.response):t.response=nY(t.response));return e}function nZ(e){if(null==e)throw Error("tools is required");if(!Array.isArray(e))throw Error("tools is required and must be an array of Tools");let t=[];for(let n of e)t.push(n);return t}function n0(e,t){if("string"!=typeof t)throw Error("name must be a string");return function(e,t,n,r=1){let i=!t.startsWith(`${n}/`)&&t.split("/").length===r;if(e.isVertexAI())if(t.startsWith("projects/"))return t;else if(t.startsWith("locations/"))return`projects/${e.getProject()}/${t}`;else if(t.startsWith(`${n}/`))return`projects/${e.getProject()}/locations/${e.getLocation()}/${t}`;else if(i)return`projects/${e.getProject()}/locations/${e.getLocation()}/${n}/${t}`;else return t;return i?`${n}/${t}`:t}(e,t,"cachedContents")}function n1(e){switch(e){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return e}}function n2(e){return null!=e&&"object"==typeof e&&"video"in e}function n4(e){return null!=e&&"object"==typeof e&&"uri"in e}function n8(e){var t;let n;if(null!=e&&"object"==typeof e&&"name"in e&&(n=e.name),!n4(e)||void 0!==(n=e.uri)){if(!n2(e)||void 0!==(n=null==(t=e.video)?void 0:t.uri)){if("string"==typeof e&&(n=e),void 0===n)throw Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){let e=n.split("files/")[1].match(/[a-z0-9]+/);if(null===e)throw Error(`Could not extract file name from URI ${n}`);n=e[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}}function n6(e,t){return e.isVertexAI()?t?"publishers/google/models":"models":t?"models":"tunedModels"}function n3(e){for(let r of["models","tunedModels","publisherModels"]){var t,n;if(t=e,n=r,null!==t&&"object"==typeof t&&n in t)return e[r]}return[]}function n9(e,t){let n;if("string"==typeof t)if(e.isVertexAI())if(t.startsWith("gs://"))n={format:"jsonl",gcsUri:[t]};else if(t.startsWith("bq://"))n={format:"bigquery",bigqueryUri:t};else throw Error(`Unsupported string source for Vertex AI: ${t}`);else if(t.startsWith("files/"))n={fileName:t};else throw Error(`Unsupported string source for Gemini API: ${t}`);else if(Array.isArray(t)){if(e.isVertexAI())throw Error("InlinedRequest[] is not supported in Vertex AI.");n={inlinedRequests:t}}else n=t;let r=[n.gcsUri,n.bigqueryUri].filter(Boolean).length,i=[n.inlinedRequests,n.fileName].filter(Boolean).length;if(e.isVertexAI()){if(i>0||1!==r)throw Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(r>0||1!==i)throw Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return n}function n5(e){if("object"!=typeof e||null===e)return{};let t=e.inlinedResponses;if("object"!=typeof t||null===t)return e;let n=t.inlinedResponses;if(!Array.isArray(n)||0===n.length)return e;let r=!1;for(let e of n){if("object"!=typeof e||null===e)continue;let t=e.response;if("object"==typeof t&&null!==t&&void 0!==t.embedding){r=!0;break}}return r&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),e}function n7(e,t){if(!e.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw Error(`Invalid batch job name: ${t}.`)}function re(e){if("BATCH_STATE_UNSPECIFIED"===e)return"JOB_STATE_UNSPECIFIED";if("BATCH_STATE_PENDING"===e)return"JOB_STATE_PENDING";if("BATCH_STATE_RUNNING"===e)return"JOB_STATE_RUNNING";if("BATCH_STATE_SUCCEEDED"===e)return"JOB_STATE_SUCCEEDED";if("BATCH_STATE_FAILED"===e)return"JOB_STATE_FAILED";else if("BATCH_STATE_CANCELLED"===e)return"JOB_STATE_CANCELLED";else if("BATCH_STATE_EXPIRED"===e)return"JOB_STATE_EXPIRED";else return e}function rt(e){let t={},n=nd(e,["name"]);null!=n&&nc(t,["name"],n);let r=nd(e,["metadata","displayName"]);null!=r&&nc(t,["displayName"],r);let i=nd(e,["metadata","state"]);null!=i&&nc(t,["state"],re(i));let s=nd(e,["metadata","createTime"]);null!=s&&nc(t,["createTime"],s);let o=nd(e,["metadata","endTime"]);null!=o&&nc(t,["endTime"],o);let a=nd(e,["metadata","updateTime"]);null!=a&&nc(t,["updateTime"],a);let l=nd(e,["metadata","model"]);null!=l&&nc(t,["model"],l);let u=nd(e,["metadata","output"]);return null!=u&&nc(t,["dest"],function(e){let t={},n=nd(e,["responsesFile"]);null!=n&&nc(t,["fileName"],n);let r=nd(e,["inlinedResponses","inlinedResponses"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>{var t;let n,r,i;return n={},null!=(r=nd(t=e,["response"]))&&nc(n,["response"],function(e){let t={},n=nd(e,["sdkHttpResponse"]);null!=n&&nc(t,["sdkHttpResponse"],n);let r=nd(e,["candidates"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=nd(e,["content"]);null!=n&&nc(t,["content"],n);let r=nd(e,["citationMetadata"]);null!=r&&nc(t,["citationMetadata"],function(e){let t={},n=nd(e,["citationSources"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),nc(t,["citations"],e)}return t}(r));let i=nd(e,["tokenCount"]);null!=i&&nc(t,["tokenCount"],i);let s=nd(e,["finishReason"]);null!=s&&nc(t,["finishReason"],s);let o=nd(e,["urlContextMetadata"]);null!=o&&nc(t,["urlContextMetadata"],o);let a=nd(e,["avgLogprobs"]);null!=a&&nc(t,["avgLogprobs"],a);let l=nd(e,["groundingMetadata"]);null!=l&&nc(t,["groundingMetadata"],l);let u=nd(e,["index"]);null!=u&&nc(t,["index"],u);let c=nd(e,["logprobsResult"]);null!=c&&nc(t,["logprobsResult"],c);let d=nd(e,["safetyRatings"]);if(null!=d){let e=d;Array.isArray(e)&&(e=e.map(e=>e)),nc(t,["safetyRatings"],e)}return t})(e))),nc(t,["candidates"],e)}let i=nd(e,["modelVersion"]);null!=i&&nc(t,["modelVersion"],i);let s=nd(e,["promptFeedback"]);null!=s&&nc(t,["promptFeedback"],s);let o=nd(e,["responseId"]);null!=o&&nc(t,["responseId"],o);let a=nd(e,["usageMetadata"]);return null!=a&&nc(t,["usageMetadata"],a),t}(r)),null!=(i=nd(t,["error"]))&&nc(n,["error"],i),n})),nc(t,["inlinedResponses"],e)}let i=nd(e,["inlinedEmbedContentResponses","inlinedResponses"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),nc(t,["inlinedEmbedContentResponses"],e)}return t}(n5(u))),t}function rn(e){var t,n;let r,i,s,o,a,l,u,c,d={},p=nd(e,["name"]);null!=p&&nc(d,["name"],p);let h=nd(e,["displayName"]);null!=h&&nc(d,["displayName"],h);let f=nd(e,["state"]);null!=f&&nc(d,["state"],re(f));let m=nd(e,["error"]);null!=m&&nc(d,["error"],m);let g=nd(e,["createTime"]);null!=g&&nc(d,["createTime"],g);let _=nd(e,["startTime"]);null!=_&&nc(d,["startTime"],_);let y=nd(e,["endTime"]);null!=y&&nc(d,["endTime"],y);let v=nd(e,["updateTime"]);null!=v&&nc(d,["updateTime"],v);let E=nd(e,["model"]);null!=E&&nc(d,["model"],E);let b=nd(e,["inputConfig"]);null!=b&&nc(d,["src"],(r={},null!=(i=nd(n=b,["instancesFormat"]))&&nc(r,["format"],i),null!=(s=nd(n,["gcsSource","uris"]))&&nc(r,["gcsUri"],s),null!=(o=nd(n,["bigquerySource","inputUri"]))&&nc(r,["bigqueryUri"],o),r));let S=nd(e,["outputConfig"]);return null!=S&&nc(d,["dest"],(t=n5(S),a={},null!=(l=nd(t,["predictionsFormat"]))&&nc(a,["format"],l),null!=(u=nd(t,["gcsDestination","outputUriPrefix"]))&&nc(a,["gcsUri"],u),null!=(c=nd(t,["bigqueryDestination","outputUri"]))&&nc(a,["bigqueryUri"],c),a)),d}function rr(e){let t={},n=nd(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,r,i,s,o,a,l,u,c,d,p;return n={},null!=(r=nd(t=e,["videoMetadata"]))&&nc(n,["videoMetadata"],r),null!=(i=nd(t,["thought"]))&&nc(n,["thought"],i),null!=(s=nd(t,["inlineData"]))&&nc(n,["inlineData"],function(e){let t={};if(void 0!==nd(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=nd(e,["data"]);null!=n&&nc(t,["data"],n);let r=nd(e,["mimeType"]);return null!=r&&nc(t,["mimeType"],r),t}(s)),null!=(o=nd(t,["fileData"]))&&nc(n,["fileData"],function(e){let t={};if(void 0!==nd(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=nd(e,["fileUri"]);null!=n&&nc(t,["fileUri"],n);let r=nd(e,["mimeType"]);return null!=r&&nc(t,["mimeType"],r),t}(o)),null!=(a=nd(t,["thoughtSignature"]))&&nc(n,["thoughtSignature"],a),null!=(l=nd(t,["functionCall"]))&&nc(n,["functionCall"],l),null!=(u=nd(t,["codeExecutionResult"]))&&nc(n,["codeExecutionResult"],u),null!=(c=nd(t,["executableCode"]))&&nc(n,["executableCode"],c),null!=(d=nd(t,["functionResponse"]))&&nc(n,["functionResponse"],d),null!=(p=nd(t,["text"]))&&nc(n,["text"],p),n})),nc(t,["parts"],e)}let r=nd(e,["role"]);return null!=r&&nc(t,["role"],r),t}function ri(e,t){let n={},r=nd(t,["model"]);null!=r&&nc(n,["_url","model"],nD(e,r));let i=nd(t,["src"]);null!=i&&nc(n,["batch","inputConfig"],function(e,t){let n={};if(void 0!==nd(t,["format"]))throw Error("format parameter is not supported in Gemini API.");if(void 0!==nd(t,["gcsUri"]))throw Error("gcsUri parameter is not supported in Gemini API.");if(void 0!==nd(t,["bigqueryUri"]))throw Error("bigqueryUri parameter is not supported in Gemini API.");let r=nd(t,["fileName"]);null!=r&&nc(n,["fileName"],r);let i=nd(t,["inlinedRequests"]);if(null!=i){let t=i;Array.isArray(t)&&(t=t.map(t=>(function(e,t){let n={},r=nd(t,["model"]);null!=r&&nc(n,["request","model"],nD(e,r));let i=nd(t,["contents"]);if(null!=i){let e=nK(i);Array.isArray(e)&&(e=e.map(e=>rr(e))),nc(n,["request","contents"],e)}let s=nd(t,["metadata"]);null!=s&&nc(n,["metadata"],s);let o=nd(t,["config"]);return null!=o&&nc(n,["request","generationConfig"],function(e,t,n){let r={},i=nd(t,["systemInstruction"]);void 0!==n&&null!=i&&nc(n,["systemInstruction"],rr(nW(i)));let s=nd(t,["temperature"]);null!=s&&nc(r,["temperature"],s);let o=nd(t,["topP"]);null!=o&&nc(r,["topP"],o);let a=nd(t,["topK"]);null!=a&&nc(r,["topK"],a);let l=nd(t,["candidateCount"]);null!=l&&nc(r,["candidateCount"],l);let u=nd(t,["maxOutputTokens"]);null!=u&&nc(r,["maxOutputTokens"],u);let c=nd(t,["stopSequences"]);null!=c&&nc(r,["stopSequences"],c);let d=nd(t,["responseLogprobs"]);null!=d&&nc(r,["responseLogprobs"],d);let p=nd(t,["logprobs"]);null!=p&&nc(r,["logprobs"],p);let h=nd(t,["presencePenalty"]);null!=h&&nc(r,["presencePenalty"],h);let f=nd(t,["frequencyPenalty"]);null!=f&&nc(r,["frequencyPenalty"],f);let m=nd(t,["seed"]);null!=m&&nc(r,["seed"],m);let g=nd(t,["responseMimeType"]);null!=g&&nc(r,["responseMimeType"],g);let _=nd(t,["responseSchema"]);null!=_&&nc(r,["responseSchema"],nY(_));let y=nd(t,["responseJsonSchema"]);if(null!=y&&nc(r,["responseJsonSchema"],y),void 0!==nd(t,["routingConfig"]))throw Error("routingConfig parameter is not supported in Gemini API.");if(void 0!==nd(t,["modelSelectionConfig"]))throw Error("modelSelectionConfig parameter is not supported in Gemini API.");let v=nd(t,["safetySettings"]);if(void 0!==n&&null!=v){let e=v;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==nd(e,["method"]))throw Error("method parameter is not supported in Gemini API.");let n=nd(e,["category"]);null!=n&&nc(t,["category"],n);let r=nd(e,["threshold"]);return null!=r&&nc(t,["threshold"],r),t})(e))),nc(n,["safetySettings"],e)}let E=nd(t,["tools"]);if(void 0!==n&&null!=E){let e=nZ(E);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=nd(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),nc(t,["functionDeclarations"],e)}if(void 0!==nd(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let r=nd(e,["googleSearch"]);null!=r&&nc(t,["googleSearch"],function(e){let t={},n=nd(e,["timeRangeFilter"]);if(null!=n&&nc(t,["timeRangeFilter"],n),void 0!==nd(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");return t}(r));let i=nd(e,["googleSearchRetrieval"]);if(null!=i&&nc(t,["googleSearchRetrieval"],i),void 0!==nd(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let s=nd(e,["googleMaps"]);null!=s&&nc(t,["googleMaps"],function(e){let t={};if(void 0!==nd(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let n=nd(e,["enableWidget"]);return null!=n&&nc(t,["enableWidget"],n),t}(s));let o=nd(e,["urlContext"]);null!=o&&nc(t,["urlContext"],o);let a=nd(e,["computerUse"]);null!=a&&nc(t,["computerUse"],a);let l=nd(e,["codeExecution"]);return null!=l&&nc(t,["codeExecution"],l),t})(nQ(e)))),nc(n,["tools"],e)}let b=nd(t,["toolConfig"]);if(void 0!==n&&null!=b&&nc(n,["toolConfig"],b),void 0!==nd(t,["labels"]))throw Error("labels parameter is not supported in Gemini API.");let S=nd(t,["cachedContent"]);void 0!==n&&null!=S&&nc(n,["cachedContent"],n0(e,S));let T=nd(t,["responseModalities"]);null!=T&&nc(r,["responseModalities"],T);let O=nd(t,["mediaResolution"]);null!=O&&nc(r,["mediaResolution"],O);let A=nd(t,["speechConfig"]);if(null!=A&&nc(r,["speechConfig"],nX(A)),void 0!==nd(t,["audioTimestamp"]))throw Error("audioTimestamp parameter is not supported in Gemini API.");let w=nd(t,["thinkingConfig"]);null!=w&&nc(r,["thinkingConfig"],w);let C=nd(t,["imageConfig"]);return null!=C&&nc(r,["imageConfig"],C),r}(e,o,nd(n,["request"],{}))),n})(e,t))),nc(n,["requests","requests"],t)}return n}(e,n9(e,i)));let s=nd(t,["config"]);return null!=s&&function(e,t){let n=nd(e,["displayName"]);if(void 0!==t&&null!=n&&nc(t,["batch","displayName"],n),void 0!==nd(e,["dest"]))throw Error("dest parameter is not supported in Gemini API.")}(s,n),n}(en=eQ||(eQ={})).PAGED_ITEM_BATCH_JOBS="batchJobs",en.PAGED_ITEM_MODELS="models",en.PAGED_ITEM_TUNING_JOBS="tuningJobs",en.PAGED_ITEM_FILES="files",en.PAGED_ITEM_CACHED_CONTENTS="cachedContents";class rs{constructor(e,t,n,r){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,n,r)}init(e,t,n){var r,i;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=null==t?void 0:t.sdkHttpResponse,this.idxInternal=0;let s={config:{}};(s=n&&0!==Object.keys(n).length?"object"==typeof n?Object.assign({},n):n:{config:{}}).config&&(s.config.pageToken=t.nextPageToken),this.paramsInternal=s,this.pageInternalSize=null!=(i=null==(r=s.config)?void 0:r.pageSize)?i:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(!this.hasNextPage())return{value:void 0,done:!0};else await this.nextPage();let e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw Error("No more pages to fetch.");let e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return(null==(e=this.params.config)?void 0:e.pageToken)!==void 0}}class ro extends nl{constructor(e){super(),this.apiClient=e,this.create=async e=>(this.apiClient.isVertexAI()&&(e.config=this.formatDestination(e.src,e.config)),this.createInternal(e)),this.createEmbeddings=async e=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(e)},this.list=async(e={})=>new rs(eQ.PAGED_ITEM_BATCH_JOBS,e=>this.listInternal(e),await this.listInternal(e),e)}createInlinedGenerateContentRequest(e){let t=ri(this.apiClient,e),n=nu("{model}:batchGenerateContent",t._url),r=t.batch.inputConfig.requests,i=r.requests,s=[];for(let e of i){let t=Object.assign({},e);if(t.systemInstruction){let e=t.systemInstruction;delete t.systemInstruction;let n=t.request;n.systemInstruction=e,t.request=n}s.push(t)}return r.requests=s,delete t.config,delete t._url,delete t._query,{path:n,body:t}}getGcsUri(e){return"string"==typeof e?e.startsWith("gs://")?e:void 0:!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0?e.gcsUri[0]:void 0}getBigqueryUri(e){return"string"==typeof e?e.startsWith("bq://")?e:void 0:Array.isArray(e)?void 0:e.bigqueryUri}formatDestination(e,t){let n=t?Object.assign({},t):{},r=Date.now().toString();if(n.displayName||(n.displayName=`genaiBatchJob_${r}`),void 0===n.dest){let t=this.getGcsUri(e),i=this.getBigqueryUri(e);if(t)t.endsWith(".jsonl")?n.dest=`${t.slice(0,-6)}/dest`:n.dest=`${t}_dest_${r}`;else if(i)n.dest=`${i}_dest_${r}`;else throw Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return n}async createInternal(e){var t,n,r,i,s;let o="",a={};if(this.apiClient.isVertexAI()){let r,i,l,u,c,d,p=(s=this.apiClient,r={},null!=(i=nd(e,["model"]))&&nc(r,["model"],nD(s,i)),null!=(l=nd(e,["src"]))&&nc(r,["inputConfig"],function(e){let t={},n=nd(e,["format"]);null!=n&&nc(t,["instancesFormat"],n);let r=nd(e,["gcsUri"]);null!=r&&nc(t,["gcsSource","uris"],r);let i=nd(e,["bigqueryUri"]);if(null!=i&&nc(t,["bigquerySource","inputUri"],i),void 0!==nd(e,["fileName"]))throw Error("fileName parameter is not supported in Vertex AI.");if(void 0!==nd(e,["inlinedRequests"]))throw Error("inlinedRequests parameter is not supported in Vertex AI.");return t}(n9(s,l))),null!=(u=nd(e,["config"]))&&(c=nd(u,["displayName"]),void 0!==r&&null!=c&&nc(r,["displayName"],c),d=nd(u,["dest"]),void 0!==r&&null!=d&&nc(r,["outputConfig"],function(e){let t={},n=nd(e,["format"]);null!=n&&nc(t,["predictionsFormat"],n);let r=nd(e,["gcsUri"]);null!=r&&nc(t,["gcsDestination","outputUriPrefix"],r);let i=nd(e,["bigqueryUri"]);if(null!=i&&nc(t,["bigqueryDestination","outputUri"],i),void 0!==nd(e,["fileName"]))throw Error("fileName parameter is not supported in Vertex AI.");if(void 0!==nd(e,["inlinedResponses"]))throw Error("inlinedResponses parameter is not supported in Vertex AI.");if(void 0!==nd(e,["inlinedEmbedContentResponses"]))throw Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return t}(function(e){if("string"!=typeof e)return e;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw Error(`Unsupported destination: ${e}`)}(d)))),r);return o=nu("batchPredictionJobs",p._url),a=p._query,delete p._url,delete p._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(p),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>rn(e))}{let t=ri(this.apiClient,e);return o=nu("{model}:batchGenerateContent",t._url),a=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json()).then(e=>rt(e))}}async createEmbeddingsInternal(e){var t,n,r,i,s;let o="",a={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let l,u,c,d,p,h,f,m,g=(r=this.apiClient,d={},null!=(p=nd(e,["model"]))&&nc(d,["_url","model"],nD(r,p)),null!=(h=nd(e,["src"]))&&nc(d,["batch","inputConfig"],(i=r,l={},null!=(u=nd(s=h,["fileName"]))&&nc(l,["file_name"],u),null!=(c=nd(s,["inlinedRequests"]))&&nc(l,["requests"],function(e,t){let n={},r=nd(t,["contents"]);if(null!=r){let t=nJ(e,r);Array.isArray(t)&&(t=t.map(e=>e)),nc(n,["requests[]","request","content"],t)}let i=nd(t,["config"]);return null!=i&&(nc(n,["_self"],function(e,t){let n=nd(e,["taskType"]);void 0!==t&&null!=n&&nc(t,["requests[]","taskType"],n);let r=nd(e,["title"]);void 0!==t&&null!=r&&nc(t,["requests[]","title"],r);let i=nd(e,["outputDimensionality"]);if(void 0!==t&&null!=i&&nc(t,["requests[]","outputDimensionality"],i),void 0!==nd(e,["mimeType"]))throw Error("mimeType parameter is not supported in Gemini API.");if(void 0!==nd(e,["autoTruncate"]))throw Error("autoTruncate parameter is not supported in Gemini API.");return{}}(i,n)),!function(e,t){for(let[n,r]of Object.entries(t)){let t=n.split("."),i=r.split("."),s=new Set,o=-1;for(let e=0;e<t.length;e++)if("*"===t[e]){o=e;break}if(-1!==o&&i.length>o)for(let e=o;e<i.length;e++){let t=i[e];"*"===t||t.endsWith("[]")||t.endsWith("[0]")||s.add(t)}!function e(t,n,r,i,s){if(i>=n.length||"object"!=typeof t||null===t)return;let o=n[i];if(o.endsWith("[]")){let a=o.slice(0,-2);if(a in t&&Array.isArray(t[a]))for(let o of t[a])e(o,n,r,i+1,s)}else if("*"===o){if("object"==typeof t&&null!==t&&!Array.isArray(t)){let e=Object.keys(t).filter(e=>!e.startsWith("_")&&!s.has(e)),n={};for(let r of e)n[r]=t[r];for(let[e,s]of Object.entries(n)){let n=[];for(let t of r.slice(i))"*"===t?n.push(e):n.push(t);nc(t,n,s)}for(let n of e)delete t[n]}}else o in t&&e(t[o],n,r,i+1,s)}(e,t,i,0,s)}}(n,{"requests[].*":"requests[].request.*"})),n}(i,c)),l)),null!=(f=nd(e,["config"]))&&(m=nd(f,["displayName"]),void 0!==d&&null!=m&&nc(d,["batch","displayName"],m)),d);return o=nu("{model}:asyncBatchEmbedContent",g._url),a=g._query,delete g._url,delete g._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(g),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>rt(e))}}async get(e){var t,n,r,i,s,o;let a="",l={};if(this.apiClient.isVertexAI()){let r,i,o=(s=this.apiClient,r={},null!=(i=nd(e,["name"]))&&nc(r,["_url","name"],n7(s,i)),r);return a=nu("batchPredictionJobs/{name}",o._url),l=o._query,delete o._url,delete o._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>rn(e))}{let t,n,s=(o=this.apiClient,t={},null!=(n=nd(e,["name"]))&&nc(t,["_url","name"],n7(o,n)),t);return a=nu("batches/{name}",s._url),l=s._query,delete s._url,delete s._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json()).then(e=>rt(e))}}async cancel(e){var t,n,r,i,s,o;let a="",l={};if(this.apiClient.isVertexAI()){let r,i,o=(s=this.apiClient,r={},null!=(i=nd(e,["name"]))&&nc(r,["_url","name"],n7(s,i)),r);a=nu("batchPredictionJobs/{name}:cancel",o._url),l=o._query,delete o._url,delete o._query,await this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal})}else{let t,n,s=(o=this.apiClient,t={},null!=(n=nd(e,["name"]))&&nc(t,["_url","name"],n7(o,n)),t);a=nu("batches/{name}:cancel",s._url),l=s._query,delete s._url,delete s._query,await this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal})}}async listInternal(e){var t,n,r,i;let s="",o={};if(this.apiClient.isVertexAI()){let r,i,a,l,u,c=(r={},null!=(i=nd(e,["config"]))&&(a=nd(i,["pageSize"]),void 0!==r&&null!=a&&nc(r,["_query","pageSize"],a),l=nd(i,["pageToken"]),void 0!==r&&null!=l&&nc(r,["_query","pageToken"],l),u=nd(i,["filter"]),void 0!==r&&null!=u&&nc(r,["_query","filter"],u)),r);return s=nu("batchPredictionJobs",c._url),o=c._query,delete c._url,delete c._query,this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(c),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=nd(e,["sdkHttpResponse"]);null!=n&&nc(t,["sdkHttpResponse"],n);let r=nd(e,["nextPageToken"]);null!=r&&nc(t,["nextPageToken"],r);let i=nd(e,["batchPredictionJobs"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>rn(e))),nc(t,["batchJobs"],e)}return t}(e),n=new nx;return Object.assign(n,t),n})}{let t,n,a=(t={},null!=(n=nd(e,["config"]))&&function(e,t){let n=nd(e,["pageSize"]);void 0!==t&&null!=n&&nc(t,["_query","pageSize"],n);let r=nd(e,["pageToken"]);if(void 0!==t&&null!=r&&nc(t,["_query","pageToken"],r),void 0!==nd(e,["filter"]))throw Error("filter parameter is not supported in Gemini API.")}(n,t),t);return s=nu("batches",a._url),o=a._query,delete a._url,delete a._query,this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=nd(e,["sdkHttpResponse"]);null!=n&&nc(t,["sdkHttpResponse"],n);let r=nd(e,["nextPageToken"]);null!=r&&nc(t,["nextPageToken"],r);let i=nd(e,["operations"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>rt(e))),nc(t,["batchJobs"],e)}return t}(e),n=new nx;return Object.assign(n,t),n})}}async delete(e){var t,n,r,i,s,o;let a="",l={};if(this.apiClient.isVertexAI()){let r,i,o=(s=this.apiClient,r={},null!=(i=nd(e,["name"]))&&nc(r,["_url","name"],n7(s,i)),r);return a=nu("batchPredictionJobs/{name}",o._url),l=o._query,delete o._url,delete o._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,r,i,s;return t={},null!=(n=nd(e,["sdkHttpResponse"]))&&nc(t,["sdkHttpResponse"],n),null!=(r=nd(e,["name"]))&&nc(t,["name"],r),null!=(i=nd(e,["done"]))&&nc(t,["done"],i),null!=(s=nd(e,["error"]))&&nc(t,["error"],s),t})}{let t,n,s=(o=this.apiClient,t={},null!=(n=nd(e,["name"]))&&nc(t,["_url","name"],n7(o,n)),t);return a=nu("batches/{name}",s._url),l=s._query,delete s._url,delete s._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,r,i,s;return t={},null!=(n=nd(e,["sdkHttpResponse"]))&&nc(t,["sdkHttpResponse"],n),null!=(r=nd(e,["name"]))&&nc(t,["name"],r),null!=(i=nd(e,["done"]))&&nc(t,["done"],i),null!=(s=nd(e,["error"]))&&nc(t,["error"],s),t})}}}function ra(e){let t={},n=nd(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,r,i,s,o,a,l,u,c,d,p;return n={},null!=(r=nd(t=e,["videoMetadata"]))&&nc(n,["videoMetadata"],r),null!=(i=nd(t,["thought"]))&&nc(n,["thought"],i),null!=(s=nd(t,["inlineData"]))&&nc(n,["inlineData"],function(e){let t={};if(void 0!==nd(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=nd(e,["data"]);null!=n&&nc(t,["data"],n);let r=nd(e,["mimeType"]);return null!=r&&nc(t,["mimeType"],r),t}(s)),null!=(o=nd(t,["fileData"]))&&nc(n,["fileData"],function(e){let t={};if(void 0!==nd(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=nd(e,["fileUri"]);null!=n&&nc(t,["fileUri"],n);let r=nd(e,["mimeType"]);return null!=r&&nc(t,["mimeType"],r),t}(o)),null!=(a=nd(t,["thoughtSignature"]))&&nc(n,["thoughtSignature"],a),null!=(l=nd(t,["functionCall"]))&&nc(n,["functionCall"],l),null!=(u=nd(t,["codeExecutionResult"]))&&nc(n,["codeExecutionResult"],u),null!=(c=nd(t,["executableCode"]))&&nc(n,["executableCode"],c),null!=(d=nd(t,["functionResponse"]))&&nc(n,["functionResponse"],d),null!=(p=nd(t,["text"]))&&nc(n,["text"],p),n})),nc(t,["parts"],e)}let r=nd(e,["role"]);return null!=r&&nc(t,["role"],r),t}class rl extends nl{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new rs(eQ.PAGED_ITEM_CACHED_CONTENTS,e=>this.listInternal(e),await this.listInternal(e),e)}async create(e){var t,n,r,i,s,o;let a="",l={};if(this.apiClient.isVertexAI()){let r,i,o,u=(s=this.apiClient,r={},null!=(i=nd(e,["model"]))&&nc(r,["model"],nL(s,i)),null!=(o=nd(e,["config"]))&&function(e,t){let n=nd(e,["ttl"]);void 0!==t&&null!=n&&nc(t,["ttl"],n);let r=nd(e,["expireTime"]);void 0!==t&&null!=r&&nc(t,["expireTime"],r);let i=nd(e,["displayName"]);void 0!==t&&null!=i&&nc(t,["displayName"],i);let s=nd(e,["contents"]);if(void 0!==t&&null!=s){let e=nK(s);Array.isArray(e)&&(e=e.map(e=>e)),nc(t,["contents"],e)}let o=nd(e,["systemInstruction"]);void 0!==t&&null!=o&&nc(t,["systemInstruction"],nW(o));let a=nd(e,["tools"]);if(void 0!==t&&null!=a){let e=a;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=nd(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==nd(e,["behavior"]))throw Error("behavior parameter is not supported in Vertex AI.");let n=nd(e,["description"]);null!=n&&nc(t,["description"],n);let r=nd(e,["name"]);null!=r&&nc(t,["name"],r);let i=nd(e,["parameters"]);null!=i&&nc(t,["parameters"],i);let s=nd(e,["parametersJsonSchema"]);null!=s&&nc(t,["parametersJsonSchema"],s);let o=nd(e,["response"]);null!=o&&nc(t,["response"],o);let a=nd(e,["responseJsonSchema"]);return null!=a&&nc(t,["responseJsonSchema"],a),t})(e))),nc(t,["functionDeclarations"],e)}let r=nd(e,["retrieval"]);null!=r&&nc(t,["retrieval"],r);let i=nd(e,["googleSearch"]);null!=i&&nc(t,["googleSearch"],i);let s=nd(e,["googleSearchRetrieval"]);null!=s&&nc(t,["googleSearchRetrieval"],s);let o=nd(e,["enterpriseWebSearch"]);null!=o&&nc(t,["enterpriseWebSearch"],o);let a=nd(e,["googleMaps"]);null!=a&&nc(t,["googleMaps"],a);let l=nd(e,["urlContext"]);null!=l&&nc(t,["urlContext"],l);let u=nd(e,["computerUse"]);null!=u&&nc(t,["computerUse"],u);let c=nd(e,["codeExecution"]);return null!=c&&nc(t,["codeExecution"],c),t})(e))),nc(t,["tools"],e)}let l=nd(e,["toolConfig"]);void 0!==t&&null!=l&&nc(t,["toolConfig"],l);let u=nd(e,["kmsKeyName"]);void 0!==t&&null!=u&&nc(t,["encryption_spec","kmsKeyName"],u)}(o,r),r);return a=nu("cachedContents",u._url),l=u._query,delete u._url,delete u._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}{let t,n,s,u=(o=this.apiClient,t={},null!=(n=nd(e,["model"]))&&nc(t,["model"],nL(o,n)),null!=(s=nd(e,["config"]))&&function(e,t){let n=nd(e,["ttl"]);void 0!==t&&null!=n&&nc(t,["ttl"],n);let r=nd(e,["expireTime"]);void 0!==t&&null!=r&&nc(t,["expireTime"],r);let i=nd(e,["displayName"]);void 0!==t&&null!=i&&nc(t,["displayName"],i);let s=nd(e,["contents"]);if(void 0!==t&&null!=s){let e=nK(s);Array.isArray(e)&&(e=e.map(e=>ra(e))),nc(t,["contents"],e)}let o=nd(e,["systemInstruction"]);void 0!==t&&null!=o&&nc(t,["systemInstruction"],ra(nW(o)));let a=nd(e,["tools"]);if(void 0!==t&&null!=a){let e=a;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=nd(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),nc(t,["functionDeclarations"],e)}if(void 0!==nd(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let r=nd(e,["googleSearch"]);null!=r&&nc(t,["googleSearch"],function(e){let t={},n=nd(e,["timeRangeFilter"]);if(null!=n&&nc(t,["timeRangeFilter"],n),void 0!==nd(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");return t}(r));let i=nd(e,["googleSearchRetrieval"]);if(null!=i&&nc(t,["googleSearchRetrieval"],i),void 0!==nd(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let s=nd(e,["googleMaps"]);null!=s&&nc(t,["googleMaps"],function(e){let t={};if(void 0!==nd(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let n=nd(e,["enableWidget"]);return null!=n&&nc(t,["enableWidget"],n),t}(s));let o=nd(e,["urlContext"]);null!=o&&nc(t,["urlContext"],o);let a=nd(e,["computerUse"]);null!=a&&nc(t,["computerUse"],a);let l=nd(e,["codeExecution"]);return null!=l&&nc(t,["codeExecution"],l),t})(e))),nc(t,["tools"],e)}let l=nd(e,["toolConfig"]);if(void 0!==t&&null!=l&&nc(t,["toolConfig"],l),void 0!==nd(e,["kmsKeyName"]))throw Error("kmsKeyName parameter is not supported in Gemini API.")}(s,t),t);return a=nu("cachedContents",u._url),l=u._query,delete u._url,delete u._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json()).then(e=>e)}}async get(e){var t,n,r,i,s,o;let a="",l={};if(this.apiClient.isVertexAI()){let r,i,o=(s=this.apiClient,r={},null!=(i=nd(e,["name"]))&&nc(r,["_url","name"],n0(s,i)),r);return a=nu("{name}",o._url),l=o._query,delete o._url,delete o._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}{let t,n,s=(o=this.apiClient,t={},null!=(n=nd(e,["name"]))&&nc(t,["_url","name"],n0(o,n)),t);return a=nu("{name}",s._url),l=s._query,delete s._url,delete s._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json()).then(e=>e)}}async delete(e){var t,n,r,i,s,o;let a="",l={};if(this.apiClient.isVertexAI()){let r,i,o=(s=this.apiClient,r={},null!=(i=nd(e,["name"]))&&nc(r,["_url","name"],n0(s,i)),r);return a=nu("{name}",o._url),l=o._query,delete o._url,delete o._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,r=(t={},null!=(n=nd(e,["sdkHttpResponse"]))&&nc(t,["sdkHttpResponse"],n),t),i=new nC;return Object.assign(i,r),i})}{let t,n,s=(o=this.apiClient,t={},null!=(n=nd(e,["name"]))&&nc(t,["_url","name"],n0(o,n)),t);return a=nu("{name}",s._url),l=s._query,delete s._url,delete s._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,r=(t={},null!=(n=nd(e,["sdkHttpResponse"]))&&nc(t,["sdkHttpResponse"],n),t),i=new nC;return Object.assign(i,r),i})}}async update(e){var t,n,r,i,s,o;let a="",l={};if(this.apiClient.isVertexAI()){let r,i,o,u,c,d=(s=this.apiClient,r={},null!=(i=nd(e,["name"]))&&nc(r,["_url","name"],n0(s,i)),null!=(o=nd(e,["config"]))&&(u=nd(o,["ttl"]),void 0!==r&&null!=u&&nc(r,["ttl"],u),c=nd(o,["expireTime"]),void 0!==r&&null!=c&&nc(r,["expireTime"],c)),r);return a=nu("{name}",d._url),l=d._query,delete d._url,delete d._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}{let t,n,s,u,c,d=(o=this.apiClient,t={},null!=(n=nd(e,["name"]))&&nc(t,["_url","name"],n0(o,n)),null!=(s=nd(e,["config"]))&&(u=nd(s,["ttl"]),void 0!==t&&null!=u&&nc(t,["ttl"],u),c=nd(s,["expireTime"]),void 0!==t&&null!=c&&nc(t,["expireTime"],c)),t);return a=nu("{name}",d._url),l=d._query,delete d._url,delete d._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json()).then(e=>e)}}async listInternal(e){var t,n,r,i;let s="",o={};if(this.apiClient.isVertexAI()){let r,i,a,l,u=(r={},null!=(i=nd(e,["config"]))&&(a=nd(i,["pageSize"]),void 0!==r&&null!=a&&nc(r,["_query","pageSize"],a),l=nd(i,["pageToken"]),void 0!==r&&null!=l&&nc(r,["_query","pageToken"],l)),r);return s=nu("cachedContents",u._url),o=u._query,delete u._url,delete u._query,this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(u),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=nd(e,["sdkHttpResponse"]);null!=n&&nc(t,["sdkHttpResponse"],n);let r=nd(e,["nextPageToken"]);null!=r&&nc(t,["nextPageToken"],r);let i=nd(e,["cachedContents"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),nc(t,["cachedContents"],e)}return t}(e),n=new nI;return Object.assign(n,t),n})}{let t,n,a,l,u=(t={},null!=(n=nd(e,["config"]))&&(a=nd(n,["pageSize"]),void 0!==t&&null!=a&&nc(t,["_query","pageSize"],a),l=nd(n,["pageToken"]),void 0!==t&&null!=l&&nc(t,["_query","pageToken"],l)),t);return s=nu("cachedContents",u._url),o=u._query,delete u._url,delete u._query,this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(u),httpMethod:"GET",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=nd(e,["sdkHttpResponse"]);null!=n&&nc(t,["sdkHttpResponse"],n);let r=nd(e,["nextPageToken"]);null!=r&&nc(t,["nextPageToken"],r);let i=nd(e,["cachedContents"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),nc(t,["cachedContents"],e)}return t}(e),n=new nI;return Object.assign(n,t),n})}}}function ru(e){return this instanceof ru?(this.v=e,this):new ru(e)}function rc(e,t,n){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),s=[];return r=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),o("next"),o("throw"),o("return",function(e){return function(t){return Promise.resolve(t).then(e,u)}}),r[Symbol.asyncIterator]=function(){return this},r;function o(e,t){i[e]&&(r[e]=function(t){return new Promise(function(n,r){s.push([e,t,n,r])>1||a(e,t)})},t&&(r[e]=t(r[e])))}function a(e,t){try{var n;(n=i[e](t)).value instanceof ru?Promise.resolve(n.value.v).then(l,u):c(s[0][2],n)}catch(e){c(s[0][3],e)}}function l(e){a("next",e)}function u(e){a("throw",e)}function c(e,t){e(t),s.shift(),s.length&&a(s[0][0],s[0][1])}}function rd(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise(function(r,i){var s,o,a;s=r,o=i,a=(t=e[n](t)).done,Promise.resolve(t.value).then(function(e){s({value:e,done:a})},o)})}}}function rp(e){if(void 0===e.parts||0===e.parts.length)return!1;for(let t of e.parts)if(void 0===t||0===Object.keys(t).length)return!1;return!0}function rh(e){if(void 0===e||0===e.length)return[];let t=[],n=e.length,r=0;for(;r<n;)if("user"===e[r].role)t.push(e[r]),r++;else{let i=[],s=!0;for(;r<n&&"model"===e[r].role;)i.push(e[r]),s&&!rp(e[r])&&(s=!1),r++;s?t.push(...i):t.pop()}return t}"function"==typeof SuppressedError&&SuppressedError;class rf{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new rm(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class rm{constructor(e,t,n,r={},i=[]){this.apiClient=e,this.modelsModule=t,this.model=n,this.config=r,this.history=i,this.sendPromise=Promise.resolve(),function(e){if(0!==e.length){for(let t of e)if("user"!==t.role&&"model"!==t.role)throw Error(`Role must be user or model, but got ${t.role}.`)}}(i)}async sendMessage(e){var t;await this.sendPromise;let n=nW(e.message),r=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(n),config:null!=(t=e.config)?t:this.config});return this.sendPromise=(async()=>{var e,t,i;let s=await r,o=null==(t=null==(e=s.candidates)?void 0:e[0])?void 0:t.content,a=s.automaticFunctionCallingHistory,l=this.getHistory(!0).length,u=[];null!=a&&(u=null!=(i=a.slice(l))?i:[]),this.recordHistory(n,o?[o]:[],u)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),r}async sendMessageStream(e){var t;await this.sendPromise;let n=nW(e.message),r=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(n),config:null!=(t=e.config)?t:this.config});this.sendPromise=r.then(()=>void 0).catch(()=>void 0);let i=await r;return this.processStreamResponse(i,n)}getHistory(e=!1){return structuredClone(e?rh(this.history):this.history)}processStreamResponse(e,t){var n,r;return rc(this,arguments,function*(){var i,s,o,a;let l=[];try{for(var u,c=!0,d=rd(e);!(i=(u=yield ru(d.next())).done);c=!0){if(a=u.value,c=!1,function(e){var t;if(void 0==e.candidates||0===e.candidates.length)return!1;let n=null==(t=e.candidates[0])?void 0:t.content;return void 0!==n&&rp(n)}(a)){let e=null==(r=null==(n=a.candidates)?void 0:n[0])?void 0:r.content;void 0!==e&&l.push(e)}yield yield ru(a)}}catch(e){s={error:e}}finally{try{!c&&!i&&(o=d.return)&&(yield ru(o.call(d)))}finally{if(s)throw s.error}}this.recordHistory(t,l)})}recordHistory(e,t,n){let r=[];t.length>0&&t.every(e=>void 0!==e.role)?r=t:r.push({role:"model",parts:[]}),n&&n.length>0?this.history.push(...rh(n)):this.history.push(e),this.history.push(...r)}}class rg extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,rg.prototype)}}class r_ extends nl{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new rs(eQ.PAGED_ITEM_FILES,e=>this.listInternal(e),await this.listInternal(e),e)}async upload(e){if(this.apiClient.isVertexAI())throw Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(e=>e)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let s,o,a,l,u=(s={},null!=(o=nd(e,["config"]))&&(a=nd(o,["pageSize"]),void 0!==s&&null!=a&&nc(s,["_query","pageSize"],a),l=nd(o,["pageToken"]),void 0!==s&&null!=l&&nc(s,["_query","pageToken"],l)),s);return r=nu("files",u._url),i=u._query,delete u._url,delete u._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(u),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=nd(e,["sdkHttpResponse"]);null!=n&&nc(t,["sdkHttpResponse"],n);let r=nd(e,["nextPageToken"]);null!=r&&nc(t,["nextPageToken"],r);let i=nd(e,["files"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),nc(t,["files"],e)}return t}(e),n=new nR;return Object.assign(n,t),n})}}async createInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let s,o,a=(s={},null!=(o=nd(e,["file"]))&&nc(s,["file"],o),s);return r=nu("upload/v1beta/files",a._url),i=a._query,delete a._url,delete a._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(a),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t,n,r=(t={},null!=(n=nd(e,["sdkHttpResponse"]))&&nc(t,["sdkHttpResponse"],n),t),i=new nP;return Object.assign(i,r),i})}}async get(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let s,o,a=(s={},null!=(o=nd(e,["name"]))&&nc(s,["_url","file"],n8(o)),s);return r=nu("files/{file}",a._url),i=a._query,delete a._url,delete a._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(a),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}}async delete(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let s,o,a=(s={},null!=(o=nd(e,["name"]))&&nc(s,["_url","file"],n8(o)),s);return r=nu("files/{file}",a._url),i=a._query,delete a._url,delete a._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,r=(t={},null!=(n=nd(e,["sdkHttpResponse"]))&&nc(t,["sdkHttpResponse"],n),t),i=new nN;return Object.assign(i,r),i})}}}function ry(e){let t={};if(void 0!==nd(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=nd(e,["data"]);null!=n&&nc(t,["data"],n);let r=nd(e,["mimeType"]);return null!=r&&nc(t,["mimeType"],r),t}function rv(e){let t={},n=nd(e,["voiceConfig"]);if(null!=n&&nc(t,["voiceConfig"],n),void 0!==nd(e,["multiSpeakerVoiceConfig"]))throw Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");let r=nd(e,["languageCode"]);return null!=r&&nc(t,["languageCode"],r),t}function rE(e){let t={},n=nd(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,r,i,s,o,a,l,u,c,d,p;return n={},null!=(r=nd(t=e,["videoMetadata"]))&&nc(n,["videoMetadata"],r),null!=(i=nd(t,["thought"]))&&nc(n,["thought"],i),null!=(s=nd(t,["inlineData"]))&&nc(n,["inlineData"],function(e){let t={};if(void 0!==nd(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=nd(e,["data"]);null!=n&&nc(t,["data"],n);let r=nd(e,["mimeType"]);return null!=r&&nc(t,["mimeType"],r),t}(s)),null!=(o=nd(t,["fileData"]))&&nc(n,["fileData"],function(e){let t={};if(void 0!==nd(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=nd(e,["fileUri"]);null!=n&&nc(t,["fileUri"],n);let r=nd(e,["mimeType"]);return null!=r&&nc(t,["mimeType"],r),t}(o)),null!=(a=nd(t,["thoughtSignature"]))&&nc(n,["thoughtSignature"],a),null!=(l=nd(t,["functionCall"]))&&nc(n,["functionCall"],l),null!=(u=nd(t,["codeExecutionResult"]))&&nc(n,["codeExecutionResult"],u),null!=(c=nd(t,["executableCode"]))&&nc(n,["executableCode"],c),null!=(d=nd(t,["functionResponse"]))&&nc(n,["functionResponse"],d),null!=(p=nd(t,["text"]))&&nc(n,["text"],p),n})),nc(t,["parts"],e)}let r=nd(e,["role"]);return null!=r&&nc(t,["role"],r),t}function rb(e,t){let n={},r=nd(t,["model"]);null!=r&&nc(n,["_url","model"],nD(e,r));let i=nd(t,["contents"]);if(null!=i){let e=nK(i);Array.isArray(e)&&(e=e.map(e=>rE(e))),nc(n,["contents"],e)}let s=nd(t,["config"]);return null!=s&&nc(n,["generationConfig"],function(e,t,n){let r={},i=nd(t,["systemInstruction"]);void 0!==n&&null!=i&&nc(n,["systemInstruction"],rE(nW(i)));let s=nd(t,["temperature"]);null!=s&&nc(r,["temperature"],s);let o=nd(t,["topP"]);null!=o&&nc(r,["topP"],o);let a=nd(t,["topK"]);null!=a&&nc(r,["topK"],a);let l=nd(t,["candidateCount"]);null!=l&&nc(r,["candidateCount"],l);let u=nd(t,["maxOutputTokens"]);null!=u&&nc(r,["maxOutputTokens"],u);let c=nd(t,["stopSequences"]);null!=c&&nc(r,["stopSequences"],c);let d=nd(t,["responseLogprobs"]);null!=d&&nc(r,["responseLogprobs"],d);let p=nd(t,["logprobs"]);null!=p&&nc(r,["logprobs"],p);let h=nd(t,["presencePenalty"]);null!=h&&nc(r,["presencePenalty"],h);let f=nd(t,["frequencyPenalty"]);null!=f&&nc(r,["frequencyPenalty"],f);let m=nd(t,["seed"]);null!=m&&nc(r,["seed"],m);let g=nd(t,["responseMimeType"]);null!=g&&nc(r,["responseMimeType"],g);let _=nd(t,["responseSchema"]);null!=_&&nc(r,["responseSchema"],nY(_));let y=nd(t,["responseJsonSchema"]);if(null!=y&&nc(r,["responseJsonSchema"],y),void 0!==nd(t,["routingConfig"]))throw Error("routingConfig parameter is not supported in Gemini API.");if(void 0!==nd(t,["modelSelectionConfig"]))throw Error("modelSelectionConfig parameter is not supported in Gemini API.");let v=nd(t,["safetySettings"]);if(void 0!==n&&null!=v){let e=v;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==nd(e,["method"]))throw Error("method parameter is not supported in Gemini API.");let n=nd(e,["category"]);null!=n&&nc(t,["category"],n);let r=nd(e,["threshold"]);return null!=r&&nc(t,["threshold"],r),t})(e))),nc(n,["safetySettings"],e)}let E=nd(t,["tools"]);if(void 0!==n&&null!=E){let e=nZ(E);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=nd(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),nc(t,["functionDeclarations"],e)}if(void 0!==nd(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let r=nd(e,["googleSearch"]);null!=r&&nc(t,["googleSearch"],function(e){let t={},n=nd(e,["timeRangeFilter"]);if(null!=n&&nc(t,["timeRangeFilter"],n),void 0!==nd(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");return t}(r));let i=nd(e,["googleSearchRetrieval"]);if(null!=i&&nc(t,["googleSearchRetrieval"],i),void 0!==nd(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let s=nd(e,["googleMaps"]);null!=s&&nc(t,["googleMaps"],function(e){let t={};if(void 0!==nd(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let n=nd(e,["enableWidget"]);return null!=n&&nc(t,["enableWidget"],n),t}(s));let o=nd(e,["urlContext"]);null!=o&&nc(t,["urlContext"],o);let a=nd(e,["computerUse"]);null!=a&&nc(t,["computerUse"],a);let l=nd(e,["codeExecution"]);return null!=l&&nc(t,["codeExecution"],l),t})(nQ(e)))),nc(n,["tools"],e)}let b=nd(t,["toolConfig"]);if(void 0!==n&&null!=b&&nc(n,["toolConfig"],b),void 0!==nd(t,["labels"]))throw Error("labels parameter is not supported in Gemini API.");let S=nd(t,["cachedContent"]);void 0!==n&&null!=S&&nc(n,["cachedContent"],n0(e,S));let T=nd(t,["responseModalities"]);null!=T&&nc(r,["responseModalities"],T);let O=nd(t,["mediaResolution"]);null!=O&&nc(r,["mediaResolution"],O);let A=nd(t,["speechConfig"]);if(null!=A&&nc(r,["speechConfig"],nX(A)),void 0!==nd(t,["audioTimestamp"]))throw Error("audioTimestamp parameter is not supported in Gemini API.");let w=nd(t,["thinkingConfig"]);null!=w&&nc(r,["thinkingConfig"],w);let C=nd(t,["imageConfig"]);return null!=C&&nc(r,["imageConfig"],C),r}(e,s,n)),n}function rS(e,t){let n={},r=nd(t,["model"]);null!=r&&nc(n,["_url","model"],nD(e,r));let i=nd(t,["contents"]);if(null!=i){let e=nK(i);Array.isArray(e)&&(e=e.map(e=>e)),nc(n,["contents"],e)}let s=nd(t,["config"]);return null!=s&&nc(n,["generationConfig"],function(e,t,n){let r={},i=nd(t,["systemInstruction"]);void 0!==n&&null!=i&&nc(n,["systemInstruction"],nW(i));let s=nd(t,["temperature"]);null!=s&&nc(r,["temperature"],s);let o=nd(t,["topP"]);null!=o&&nc(r,["topP"],o);let a=nd(t,["topK"]);null!=a&&nc(r,["topK"],a);let l=nd(t,["candidateCount"]);null!=l&&nc(r,["candidateCount"],l);let u=nd(t,["maxOutputTokens"]);null!=u&&nc(r,["maxOutputTokens"],u);let c=nd(t,["stopSequences"]);null!=c&&nc(r,["stopSequences"],c);let d=nd(t,["responseLogprobs"]);null!=d&&nc(r,["responseLogprobs"],d);let p=nd(t,["logprobs"]);null!=p&&nc(r,["logprobs"],p);let h=nd(t,["presencePenalty"]);null!=h&&nc(r,["presencePenalty"],h);let f=nd(t,["frequencyPenalty"]);null!=f&&nc(r,["frequencyPenalty"],f);let m=nd(t,["seed"]);null!=m&&nc(r,["seed"],m);let g=nd(t,["responseMimeType"]);null!=g&&nc(r,["responseMimeType"],g);let _=nd(t,["responseSchema"]);null!=_&&nc(r,["responseSchema"],nY(_));let y=nd(t,["responseJsonSchema"]);null!=y&&nc(r,["responseJsonSchema"],y);let v=nd(t,["routingConfig"]);null!=v&&nc(r,["routingConfig"],v);let E=nd(t,["modelSelectionConfig"]);null!=E&&nc(r,["modelConfig"],E);let b=nd(t,["safetySettings"]);if(void 0!==n&&null!=b){let e=b;Array.isArray(e)&&(e=e.map(e=>e)),nc(n,["safetySettings"],e)}let S=nd(t,["tools"]);if(void 0!==n&&null!=S){let e=nZ(S);Array.isArray(e)&&(e=e.map(e=>rM(nQ(e)))),nc(n,["tools"],e)}let T=nd(t,["toolConfig"]);void 0!==n&&null!=T&&nc(n,["toolConfig"],T);let O=nd(t,["labels"]);void 0!==n&&null!=O&&nc(n,["labels"],O);let A=nd(t,["cachedContent"]);void 0!==n&&null!=A&&nc(n,["cachedContent"],n0(e,A));let w=nd(t,["responseModalities"]);null!=w&&nc(r,["responseModalities"],w);let C=nd(t,["mediaResolution"]);null!=C&&nc(r,["mediaResolution"],C);let I=nd(t,["speechConfig"]);null!=I&&nc(r,["speechConfig"],rk(nX(I)));let R=nd(t,["audioTimestamp"]);null!=R&&nc(r,["audioTimestamp"],R);let P=nd(t,["thinkingConfig"]);null!=P&&nc(r,["thinkingConfig"],P);let N=nd(t,["imageConfig"]);return null!=N&&nc(r,["imageConfig"],N),r}(e,s,n)),n}function rT(e){let t={},n=nd(e,["sdkHttpResponse"]);null!=n&&nc(t,["sdkHttpResponse"],n);let r=nd(e,["candidates"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=nd(e,["content"]);null!=n&&nc(t,["content"],n);let r=nd(e,["citationMetadata"]);null!=r&&nc(t,["citationMetadata"],function(e){let t={},n=nd(e,["citationSources"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),nc(t,["citations"],e)}return t}(r));let i=nd(e,["tokenCount"]);null!=i&&nc(t,["tokenCount"],i);let s=nd(e,["finishReason"]);null!=s&&nc(t,["finishReason"],s);let o=nd(e,["urlContextMetadata"]);null!=o&&nc(t,["urlContextMetadata"],o);let a=nd(e,["avgLogprobs"]);null!=a&&nc(t,["avgLogprobs"],a);let l=nd(e,["groundingMetadata"]);null!=l&&nc(t,["groundingMetadata"],l);let u=nd(e,["index"]);null!=u&&nc(t,["index"],u);let c=nd(e,["logprobsResult"]);null!=c&&nc(t,["logprobsResult"],c);let d=nd(e,["safetyRatings"]);if(null!=d){let e=d;Array.isArray(e)&&(e=e.map(e=>e)),nc(t,["safetyRatings"],e)}return t})(e))),nc(t,["candidates"],e)}let i=nd(e,["modelVersion"]);null!=i&&nc(t,["modelVersion"],i);let s=nd(e,["promptFeedback"]);null!=s&&nc(t,["promptFeedback"],s);let o=nd(e,["responseId"]);null!=o&&nc(t,["responseId"],o);let a=nd(e,["usageMetadata"]);return null!=a&&nc(t,["usageMetadata"],a),t}function rO(e){let t={},n=nd(e,["sdkHttpResponse"]);null!=n&&nc(t,["sdkHttpResponse"],n);let r=nd(e,["candidates"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),nc(t,["candidates"],e)}let i=nd(e,["createTime"]);null!=i&&nc(t,["createTime"],i);let s=nd(e,["modelVersion"]);null!=s&&nc(t,["modelVersion"],s);let o=nd(e,["promptFeedback"]);null!=o&&nc(t,["promptFeedback"],o);let a=nd(e,["responseId"]);null!=a&&nc(t,["responseId"],a);let l=nd(e,["usageMetadata"]);return null!=l&&nc(t,["usageMetadata"],l),t}function rA(e){let t={},n=nd(e,["_self"]);null!=n&&nc(t,["image"],rw(n));let r=nd(e,["raiFilteredReason"]);null!=r&&nc(t,["raiFilteredReason"],r);let i=nd(e,["_self"]);null!=i&&nc(t,["safetyAttributes"],rx(i));let s=nd(e,["prompt"]);return null!=s&&nc(t,["enhancedPrompt"],s),t}function rw(e){let t={},n=nd(e,["gcsUri"]);null!=n&&nc(t,["gcsUri"],n);let r=nd(e,["bytesBase64Encoded"]);null!=r&&nc(t,["imageBytes"],np(r));let i=nd(e,["mimeType"]);return null!=i&&nc(t,["mimeType"],i),t}function rC(e){let t={};if(void 0!==nd(e,["gcsUri"]))throw Error("gcsUri parameter is not supported in Gemini API.");let n=nd(e,["imageBytes"]);null!=n&&nc(t,["bytesBase64Encoded"],np(n));let r=nd(e,["mimeType"]);return null!=r&&nc(t,["mimeType"],r),t}function rI(e){let t={},n=nd(e,["gcsUri"]);null!=n&&nc(t,["gcsUri"],n);let r=nd(e,["imageBytes"]);null!=r&&nc(t,["bytesBase64Encoded"],np(r));let i=nd(e,["mimeType"]);return null!=i&&nc(t,["mimeType"],i),t}function rR(e){var t;let n,r,i,s,o={},a=nd(e,["name"]);null!=a&&nc(o,["name"],a);let l=nd(e,["displayName"]);null!=l&&nc(o,["displayName"],l);let u=nd(e,["description"]);null!=u&&nc(o,["description"],u);let c=nd(e,["version"]);null!=c&&nc(o,["version"],c);let d=nd(e,["_self"]);null!=d&&nc(o,["tunedModelInfo"],(n={},null!=(r=nd(t=d,["baseModel"]))&&nc(n,["baseModel"],r),null!=(i=nd(t,["createTime"]))&&nc(n,["createTime"],i),null!=(s=nd(t,["updateTime"]))&&nc(n,["updateTime"],s),n));let p=nd(e,["inputTokenLimit"]);null!=p&&nc(o,["inputTokenLimit"],p);let h=nd(e,["outputTokenLimit"]);null!=h&&nc(o,["outputTokenLimit"],h);let f=nd(e,["supportedGenerationMethods"]);return null!=f&&nc(o,["supportedActions"],f),o}function rP(e){var t;let n,r,i,s,o={},a=nd(e,["name"]);null!=a&&nc(o,["name"],a);let l=nd(e,["displayName"]);null!=l&&nc(o,["displayName"],l);let u=nd(e,["description"]);null!=u&&nc(o,["description"],u);let c=nd(e,["versionId"]);null!=c&&nc(o,["version"],c);let d=nd(e,["deployedModels"]);if(null!=d){let e=d;Array.isArray(e)&&(e=e.map(e=>{let t,n,r;return t={},null!=(n=nd(e,["endpoint"]))&&nc(t,["name"],n),null!=(r=nd(e,["deployedModelId"]))&&nc(t,["deployedModelId"],r),t})),nc(o,["endpoints"],e)}let p=nd(e,["labels"]);null!=p&&nc(o,["labels"],p);let h=nd(e,["_self"]);null!=h&&nc(o,["tunedModelInfo"],(n={},null!=(r=nd(t=h,["labels","google-vertex-llm-tuning-base-model-id"]))&&nc(n,["baseModel"],r),null!=(i=nd(t,["createTime"]))&&nc(n,["createTime"],i),null!=(s=nd(t,["updateTime"]))&&nc(n,["updateTime"],s),n));let f=nd(e,["defaultCheckpointId"]);null!=f&&nc(o,["defaultCheckpointId"],f);let m=nd(e,["checkpoints"]);if(null!=m){let e=m;Array.isArray(e)&&(e=e.map(e=>e)),nc(o,["checkpoints"],e)}return o}function rN(e){let t={},n=nd(e,["safetyAttributes","categories"]);null!=n&&nc(t,["categories"],n);let r=nd(e,["safetyAttributes","scores"]);null!=r&&nc(t,["scores"],r);let i=nd(e,["contentType"]);return null!=i&&nc(t,["contentType"],i),t}function rx(e){let t={},n=nd(e,["safetyAttributes","categories"]);null!=n&&nc(t,["categories"],n);let r=nd(e,["safetyAttributes","scores"]);null!=r&&nc(t,["scores"],r);let i=nd(e,["contentType"]);return null!=i&&nc(t,["contentType"],i),t}function rk(e){let t={},n=nd(e,["voiceConfig"]);if(null!=n&&nc(t,["voiceConfig"],n),void 0!==nd(e,["multiSpeakerVoiceConfig"]))throw Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");let r=nd(e,["languageCode"]);return null!=r&&nc(t,["languageCode"],r),t}function rM(e){let t={},n=nd(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==nd(e,["behavior"]))throw Error("behavior parameter is not supported in Vertex AI.");let n=nd(e,["description"]);null!=n&&nc(t,["description"],n);let r=nd(e,["name"]);null!=r&&nc(t,["name"],r);let i=nd(e,["parameters"]);null!=i&&nc(t,["parameters"],i);let s=nd(e,["parametersJsonSchema"]);null!=s&&nc(t,["parametersJsonSchema"],s);let o=nd(e,["response"]);null!=o&&nc(t,["response"],o);let a=nd(e,["responseJsonSchema"]);return null!=a&&nc(t,["responseJsonSchema"],a),t})(e))),nc(t,["functionDeclarations"],e)}let r=nd(e,["retrieval"]);null!=r&&nc(t,["retrieval"],r);let i=nd(e,["googleSearch"]);null!=i&&nc(t,["googleSearch"],i);let s=nd(e,["googleSearchRetrieval"]);null!=s&&nc(t,["googleSearchRetrieval"],s);let o=nd(e,["enterpriseWebSearch"]);null!=o&&nc(t,["enterpriseWebSearch"],o);let a=nd(e,["googleMaps"]);null!=a&&nc(t,["googleMaps"],a);let l=nd(e,["urlContext"]);null!=l&&nc(t,["urlContext"],l);let u=nd(e,["computerUse"]);null!=u&&nc(t,["computerUse"],u);let c=nd(e,["codeExecution"]);return null!=c&&nc(t,["codeExecution"],c),t}function rD(e){let t={},n=nd(e,["uri"]);null!=n&&nc(t,["uri"],n);let r=nd(e,["videoBytes"]);null!=r&&nc(t,["encodedVideo"],np(r));let i=nd(e,["mimeType"]);return null!=i&&nc(t,["encoding"],i),t}function rL(e){let t={},n=nd(e,["uri"]);null!=n&&nc(t,["gcsUri"],n);let r=nd(e,["videoBytes"]);null!=r&&nc(t,["bytesBase64Encoded"],np(r));let i=nd(e,["mimeType"]);return null!=i&&nc(t,["mimeType"],i),t}let rU="x-goog-api-client",rj=/^\s*data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class rq{constructor(e){var t,n;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const r={};this.clientOptions.vertexai?(r.apiVersion=null!=(t=this.clientOptions.apiVersion)?t:"v1beta1",r.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(r.apiVersion=null!=(n=this.clientOptions.apiVersion)?n:"v1beta",r.baseUrl="https://generativelanguage.googleapis.com/"),r.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=r,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(r,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&"global"!==this.clientOptions.location?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return null!=(e=this.clientOptions.vertexai)&&e}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.apiVersion)return this.clientOptions.httpOptions.apiVersion;throw Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.baseUrl)return this.clientOptions.httpOptions.baseUrl;throw Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.headers)return this.clientOptions.httpOptions.headers;throw Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||void 0===e.baseUrl||void 0===e.apiVersion)throw Error("HTTP options are not correctly set.");let t=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&""!==e.apiVersion&&t.push(e.apiVersion),t.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){let e=new URL(this.getBaseUrl());return e.protocol="http:"==e.protocol?"ws":"wss",e.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw Error("HTTP options are not correctly set.")}constructUrl(e,t,n){let r=[this.getRequestUrlInternal(t)];return n&&r.push(this.getBaseResourcePath()),""!==e&&r.push(e),new URL(`${r.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||"GET"===e.httpMethod&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let n=this.shouldPrependVertexProjectPath(e),r=this.constructUrl(e.path,t,n);if(e.queryParams)for(let[t,n]of Object.entries(e.queryParams))r.searchParams.append(t,String(n));let i={};if("GET"===e.httpMethod){if(e.body&&"{}"!==e.body)throw Error("Request body should be empty for GET request, but got non empty request body")}else i.body=e.body;return i=await this.includeExtraHttpOptionsToRequestInit(i,t,r.toString(),e.abortSignal),this.unaryApiCall(r,i,e.httpMethod)}patchHttpOptions(e,t){let n=JSON.parse(JSON.stringify(e));for(let[e,r]of Object.entries(t))"object"==typeof r?n[e]=Object.assign(Object.assign({},n[e]),r):void 0!==r&&(n[e]=r);return n}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let n=this.shouldPrependVertexProjectPath(e),r=this.constructUrl(e.path,t,n);r.searchParams.has("alt")&&"sse"===r.searchParams.get("alt")||r.searchParams.set("alt","sse");let i={};return i.body=e.body,i=await this.includeExtraHttpOptionsToRequestInit(i,t,r.toString(),e.abortSignal),this.streamApiCall(r,i,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,n,r){if(t&&t.timeout||r){let n=new AbortController,i=n.signal;if(t.timeout&&(null==t?void 0:t.timeout)>0){let e=setTimeout(()=>n.abort(),t.timeout);e&&"function"==typeof e.unref&&e.unref()}r&&r.addEventListener("abort",()=>{n.abort()}),e.signal=i}return t&&null!==t.extraBody&&function(e,t){if(!t||0===Object.keys(t).length)return;if(e.body instanceof Blob)return console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");let n={};if("string"==typeof e.body&&e.body.length>0)try{let t=JSON.parse(e.body);if("object"!=typeof t||null===t||Array.isArray(t))return void console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");n=t}catch(e){console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}e.body=JSON.stringify(function e(t,n){let r=Object.assign({},t);for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)){let i=n[t],s=r[t];i&&"object"==typeof i&&!Array.isArray(i)&&s&&"object"==typeof s&&!Array.isArray(s)?r[t]=e(s,i):(s&&i&&typeof s!=typeof i&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${t}". Original type: ${typeof s}, New type: ${typeof i}. Overwriting.`),r[t]=i)}return r}(n,t))}(e,t.extraBody),e.headers=await this.getHeadersInternal(t,n),e}async unaryApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async e=>(await r$(e),new nh(e))).catch(e=>{if(e instanceof Error)throw e;throw Error(JSON.stringify(e))})}async streamApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async e=>(await r$(e),this.processStreamResponse(e))).catch(e=>{if(e instanceof Error)throw e;throw Error(JSON.stringify(e))})}processStreamResponse(e){var t;return rc(this,arguments,function*(){let n=null==(t=null==e?void 0:e.body)?void 0:t.getReader(),r=new TextDecoder("utf-8");if(!n)throw Error("Response body is empty");try{let t="";for(;;){let{done:i,value:s}=yield ru(n.read());if(i){if(t.trim().length>0)throw Error("Incomplete JSON segment at the end");break}let o=r.decode(s,{stream:!0});try{let e=JSON.parse(o);if("error"in e){let t=JSON.parse(JSON.stringify(e.error)),n=t.status,r=t.code,i=`got status: ${n}. ${JSON.stringify(e)}`;if(r>=400&&r<600)throw new rg({message:i,status:r})}}catch(e){if("ApiError"===e.name)throw e}let a=(t+=o).match(rj);for(;a;){let n=a[1];try{let r=new Response(n,{headers:null==e?void 0:e.headers,status:null==e?void 0:e.status,statusText:null==e?void 0:e.statusText});yield yield ru(new nh(r)),a=(t=t.slice(a[0].length)).match(rj)}catch(e){throw Error(`exception parsing stream chunk ${n}. ${e}`)}}}}finally{n.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(e=>{throw Error(`exception ${e} sending request`)})}getDefaultHeaders(){let e={},t="google-genai-sdk/1.27.0 "+this.clientOptions.userAgentExtra;return e["User-Agent"]=t,e[rU]=t,e["Content-Type"]="application/json",e}async getHeadersInternal(e,t){let n=new Headers;if(e&&e.headers){for(let[t,r]of Object.entries(e.headers))n.append(t,r);e.timeout&&e.timeout>0&&n.append("X-Server-Timeout",String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(n,t),n}async uploadFile(e,t){var n;let r={};null!=t&&(r.mimeType=t.mimeType,r.name=t.name,r.displayName=t.displayName),r.name&&!r.name.startsWith("files/")&&(r.name=`files/${r.name}`);let i=this.clientOptions.uploader,s=await i.stat(e);r.sizeBytes=String(s.size);let o=null!=(n=null==t?void 0:t.mimeType)?n:s.type;if(void 0===o||""===o)throw Error("Can not determine mimeType. Please provide mimeType in the config.");r.mimeType=o;let a=await this.fetchUploadUrl(r,t);return i.upload(e,a,this)}async downloadFile(e){let t=this.clientOptions.downloader;await t.download(e,this)}async fetchUploadUrl(e,t){var n;let r={};r=(null==t?void 0:t.httpOptions)?t.httpOptions:{apiVersion:"",headers:{"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${e.sizeBytes}`,"X-Goog-Upload-Header-Content-Type":`${e.mimeType}`}};let i={file:e},s=await this.request({path:nu("upload/v1beta/files",i._url),body:JSON.stringify(i),httpMethod:"POST",httpOptions:r});if(!s||!(null==s?void 0:s.headers))throw Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");let o=null==(n=null==s?void 0:s.headers)?void 0:n["x-goog-upload-url"];if(void 0===o)throw Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return o}}async function r$(e){var t;if(void 0===e)throw Error("response is undefined");if(!e.ok){let n=e.status,r=JSON.stringify((null==(t=e.headers.get("content-type"))?void 0:t.includes("application/json"))?await e.json():{error:{message:await e.text(),code:e.status,status:e.statusText}});if(n>=400&&n<600)throw new rg({message:r,status:n});throw Error(r)}}function rG(e){for(let n of e){var t;if(null!==(t=n)&&"object"==typeof t&&t instanceof rF||"object"==typeof n&&"inputSchema"in n)return!0}return!1}function rH(e){var t;let n=null!=(t=e[rU])?t:"";e[rU]=(n+" mcp_used/unknown").trimStart()}class rF{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new rF(e,t)}async initialize(){var e,t,n,r;if(this.mcpTools.length>0)return;let i={},s=[];for(let u of this.mcpClients)try{for(var o,a=!0,l=(t=void 0,rd(function(e,t=100){return rc(this,arguments,function*(){let n,r=0;for(;r<t;){let t=yield ru(e.listTools({cursor:n}));for(let e of t.tools)yield yield ru(e),r++;if(!t.nextCursor)break;n=t.nextCursor}})}(u)));!(e=(o=await l.next()).done);a=!0){r=o.value,a=!1,s.push(r);let e=r.name;if(i[e])throw Error(`Duplicate function name ${e} found in MCP tools. Please ensure function names are unique.`);i[e]=u}}catch(e){t={error:e}}finally{try{!a&&!e&&(n=l.return)&&await n.call(l)}finally{if(t)throw t.error}}this.mcpTools=s,this.functionNameToMcpClient=i}async tool(){return await this.initialize(),function(e,t={}){let n=[],r=new Set;for(let i of e){let e=i.name;if(r.has(e))throw Error(`Duplicate function name ${e} found in MCP tools. Please ensure function names are unique.`);r.add(e);let s=function(e,t={}){let n={name:e.name,description:e.description,parametersJsonSchema:e.inputSchema};return e.outputSchema&&(n.responseJsonSchema=e.outputSchema),t.behavior&&(n.behavior=t.behavior),{functionDeclarations:[n]}}(i,t);s.functionDeclarations&&n.push(...s.functionDeclarations)}return{functionDeclarations:n}}(this.mcpTools,this.config)}async callTool(e){await this.initialize();let t=[];for(let n of e)if(n.name in this.functionNameToMcpClient){let e,r=this.functionNameToMcpClient[n.name];this.config.timeout&&(e={timeout:this.config.timeout});let i=await r.callTool({name:n.name,arguments:n.args},void 0,e);t.push({functionResponse:{name:n.name,response:i.isError?{error:i}:i}})}return t}}async function rB(e,t,n){let r=new nM;Object.assign(r,n.data instanceof Blob?JSON.parse(await n.data.text()):JSON.parse(n.data)),t(r)}class rV{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n}async connect(e){var t,n;let r;if(this.apiClient.isVertexAI())throw Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");let i=this.apiClient.getWebsocketBaseUrl(),s=this.apiClient.getApiVersion(),o=function(e){let t=new Headers;for(let[n,r]of Object.entries(e))t.append(n,r);return t}(this.apiClient.getDefaultHeaders()),a=this.apiClient.getApiKey(),l=`${i}/ws/google.ai.generativelanguage.${s}.GenerativeService.BidiGenerateMusic?key=${a}`,u=()=>{},c=new Promise(e=>{u=e}),d=e.callbacks,p=this.apiClient,h={onopen:function(){u({})},onmessage:e=>{rB(p,d.onmessage,e)},onerror:null!=(t=null==d?void 0:d.onerror)?t:function(e){},onclose:null!=(n=null==d?void 0:d.onclose)?n:function(e){}},f=this.webSocketFactory.create(l,(r={},o.forEach((e,t)=>{r[t]=e}),r),h);f.connect(),await c;let m=nD(this.apiClient,e.model);return f.send(JSON.stringify({setup:{model:m}})),new rW(f,this.apiClient)}}class rW{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||0===Object.keys(e.weightedPrompts).length)throw Error("Weighted prompts must be set and contain at least one entry.");let t=function(e){let t={},n=nd(e,["weightedPrompts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),nc(t,["weightedPrompts"],e)}return t}(e);this.conn.send(JSON.stringify({clientContent:t}))}async setMusicGenerationConfig(e){let t,n;e.musicGenerationConfig||(e.musicGenerationConfig={});let r=(t={},null!=(n=nd(e,["musicGenerationConfig"]))&&nc(t,["musicGenerationConfig"],n),t);this.conn.send(JSON.stringify(r))}sendPlaybackControl(e){this.conn.send(JSON.stringify({playbackControl:e}))}play(){this.sendPlaybackControl(ez.PLAY)}pause(){this.sendPlaybackControl(ez.PAUSE)}stop(){this.sendPlaybackControl(ez.STOP)}resetContext(){this.sendPlaybackControl(ez.RESET_CONTEXT)}close(){this.conn.close()}}async function rJ(e,t,n){let r=new nk,i=JSON.parse(n.data instanceof Blob?await n.data.text():n.data instanceof ArrayBuffer?new TextDecoder().decode(n.data):n.data);if(e.isVertexAI()){let e,t,n,s,o,a,l,u;Object.assign(r,(e={},null!=(t=nd(i,["setupComplete"]))&&nc(e,["setupComplete"],t),null!=(n=nd(i,["serverContent"]))&&nc(e,["serverContent"],n),null!=(s=nd(i,["toolCall"]))&&nc(e,["toolCall"],s),null!=(o=nd(i,["toolCallCancellation"]))&&nc(e,["toolCallCancellation"],o),null!=(a=nd(i,["usageMetadata"]))&&nc(e,["usageMetadata"],function(e){let t={},n=nd(e,["promptTokenCount"]);null!=n&&nc(t,["promptTokenCount"],n);let r=nd(e,["cachedContentTokenCount"]);null!=r&&nc(t,["cachedContentTokenCount"],r);let i=nd(e,["candidatesTokenCount"]);null!=i&&nc(t,["responseTokenCount"],i);let s=nd(e,["toolUsePromptTokenCount"]);null!=s&&nc(t,["toolUsePromptTokenCount"],s);let o=nd(e,["thoughtsTokenCount"]);null!=o&&nc(t,["thoughtsTokenCount"],o);let a=nd(e,["totalTokenCount"]);null!=a&&nc(t,["totalTokenCount"],a);let l=nd(e,["promptTokensDetails"]);if(null!=l){let e=l;Array.isArray(e)&&(e=e.map(e=>e)),nc(t,["promptTokensDetails"],e)}let u=nd(e,["cacheTokensDetails"]);if(null!=u){let e=u;Array.isArray(e)&&(e=e.map(e=>e)),nc(t,["cacheTokensDetails"],e)}let c=nd(e,["candidatesTokensDetails"]);if(null!=c){let e=c;Array.isArray(e)&&(e=e.map(e=>e)),nc(t,["responseTokensDetails"],e)}let d=nd(e,["toolUsePromptTokensDetails"]);if(null!=d){let e=d;Array.isArray(e)&&(e=e.map(e=>e)),nc(t,["toolUsePromptTokensDetails"],e)}let p=nd(e,["trafficType"]);return null!=p&&nc(t,["trafficType"],p),t}(a)),null!=(l=nd(i,["goAway"]))&&nc(e,["goAway"],l),null!=(u=nd(i,["sessionResumptionUpdate"]))&&nc(e,["sessionResumptionUpdate"],u),e))}else Object.assign(r,i);t(r)}class rK{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n,this.music=new rV(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,n,r,i,s,o,a,l;let u,c;if(e.config&&e.config.httpOptions)throw Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");let d=this.apiClient.getWebsocketBaseUrl(),p=this.apiClient.getApiVersion(),h=this.apiClient.getHeaders();e.config&&e.config.tools&&rG(e.config.tools)&&rH(h);let f=function(e){let t=new Headers;for(let[n,r]of Object.entries(e))t.append(n,r);return t}(h);if(this.apiClient.isVertexAI())u=`${d}/ws/google.cloud.aiplatform.${p}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(f,u);else{let e=this.apiClient.getApiKey(),t="BidiGenerateContent",n="key";(null==e?void 0:e.startsWith("auth_tokens/"))&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),"v1alpha"!==p&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),t="BidiGenerateContentConstrained",n="access_token"),u=`${d}/ws/google.ai.generativelanguage.${p}.GenerativeService.${t}?${n}=${e}`}let m=()=>{},g=new Promise(e=>{m=e}),_=e.callbacks,y=this.apiClient,v={onopen:function(){var e;null==(e=null==_?void 0:_.onopen)||e.call(_),m({})},onmessage:e=>{rJ(y,_.onmessage,e)},onerror:null!=(t=null==_?void 0:_.onerror)?t:function(e){},onclose:null!=(n=null==_?void 0:_.onclose)?n:function(e){}},E=this.webSocketFactory.create(u,(c={},f.forEach((e,t)=>{c[t]=e}),c),v);E.connect(),await g;let b=nD(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&b.startsWith("publishers/")){let e=this.apiClient.getProject(),t=this.apiClient.getLocation();b=`projects/${e}/locations/${t}/`+b}let S={};this.apiClient.isVertexAI()&&(null==(r=e.config)?void 0:r.responseModalities)===void 0&&(void 0===e.config?e.config={responseModalities:[ev.AUDIO]}:e.config.responseModalities=[ev.AUDIO]),(null==(i=e.config)?void 0:i.generationConfig)&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");let T=null!=(o=null==(s=e.config)?void 0:s.tools)?o:[],O=[];for(let e of T)this.isCallableTool(e)?O.push(await e.tool()):O.push(e);O.length>0&&(e.config.tools=O);let A={model:b,config:e.config,callbacks:e.callbacks};if(this.apiClient.isVertexAI()){let e,t,n;a=this.apiClient,e={},null!=(t=nd(A,["model"]))&&nc(e,["setup","model"],nD(a,t)),null!=(n=nd(A,["config"]))&&nc(e,["config"],function(e,t){let n=nd(e,["generationConfig"]);void 0!==t&&null!=n&&nc(t,["setup","generationConfig"],function(e){let t={},n=nd(e,["modelSelectionConfig"]);null!=n&&nc(t,["modelConfig"],n);let r=nd(e,["audioTimestamp"]);null!=r&&nc(t,["audioTimestamp"],r);let i=nd(e,["candidateCount"]);null!=i&&nc(t,["candidateCount"],i);let s=nd(e,["enableAffectiveDialog"]);null!=s&&nc(t,["enableAffectiveDialog"],s);let o=nd(e,["frequencyPenalty"]);null!=o&&nc(t,["frequencyPenalty"],o);let a=nd(e,["logprobs"]);null!=a&&nc(t,["logprobs"],a);let l=nd(e,["maxOutputTokens"]);null!=l&&nc(t,["maxOutputTokens"],l);let u=nd(e,["mediaResolution"]);null!=u&&nc(t,["mediaResolution"],u);let c=nd(e,["presencePenalty"]);null!=c&&nc(t,["presencePenalty"],c);let d=nd(e,["responseJsonSchema"]);null!=d&&nc(t,["responseJsonSchema"],d);let p=nd(e,["responseLogprobs"]);null!=p&&nc(t,["responseLogprobs"],p);let h=nd(e,["responseMimeType"]);null!=h&&nc(t,["responseMimeType"],h);let f=nd(e,["responseModalities"]);null!=f&&nc(t,["responseModalities"],f);let m=nd(e,["responseSchema"]);null!=m&&nc(t,["responseSchema"],m);let g=nd(e,["routingConfig"]);null!=g&&nc(t,["routingConfig"],g);let _=nd(e,["seed"]);null!=_&&nc(t,["seed"],_);let y=nd(e,["speechConfig"]);null!=y&&nc(t,["speechConfig"],rv(y));let v=nd(e,["stopSequences"]);null!=v&&nc(t,["stopSequences"],v);let E=nd(e,["temperature"]);null!=E&&nc(t,["temperature"],E);let b=nd(e,["thinkingConfig"]);null!=b&&nc(t,["thinkingConfig"],b);let S=nd(e,["topK"]);null!=S&&nc(t,["topK"],S);let T=nd(e,["topP"]);if(null!=T&&nc(t,["topP"],T),void 0!==nd(e,["enableEnhancedCivicAnswers"]))throw Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}(n));let r=nd(e,["responseModalities"]);void 0!==t&&null!=r&&nc(t,["setup","generationConfig","responseModalities"],r);let i=nd(e,["temperature"]);void 0!==t&&null!=i&&nc(t,["setup","generationConfig","temperature"],i);let s=nd(e,["topP"]);void 0!==t&&null!=s&&nc(t,["setup","generationConfig","topP"],s);let o=nd(e,["topK"]);void 0!==t&&null!=o&&nc(t,["setup","generationConfig","topK"],o);let a=nd(e,["maxOutputTokens"]);void 0!==t&&null!=a&&nc(t,["setup","generationConfig","maxOutputTokens"],a);let l=nd(e,["mediaResolution"]);void 0!==t&&null!=l&&nc(t,["setup","generationConfig","mediaResolution"],l);let u=nd(e,["seed"]);void 0!==t&&null!=u&&nc(t,["setup","generationConfig","seed"],u);let c=nd(e,["speechConfig"]);void 0!==t&&null!=c&&nc(t,["setup","generationConfig","speechConfig"],rv(nz(c)));let d=nd(e,["thinkingConfig"]);void 0!==t&&null!=d&&nc(t,["setup","generationConfig","thinkingConfig"],d);let p=nd(e,["enableAffectiveDialog"]);void 0!==t&&null!=p&&nc(t,["setup","generationConfig","enableAffectiveDialog"],p);let h=nd(e,["systemInstruction"]);void 0!==t&&null!=h&&nc(t,["setup","systemInstruction"],nW(h));let f=nd(e,["tools"]);if(void 0!==t&&null!=f){let e=nZ(f);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=nd(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==nd(e,["behavior"]))throw Error("behavior parameter is not supported in Vertex AI.");let n=nd(e,["description"]);null!=n&&nc(t,["description"],n);let r=nd(e,["name"]);null!=r&&nc(t,["name"],r);let i=nd(e,["parameters"]);null!=i&&nc(t,["parameters"],i);let s=nd(e,["parametersJsonSchema"]);null!=s&&nc(t,["parametersJsonSchema"],s);let o=nd(e,["response"]);null!=o&&nc(t,["response"],o);let a=nd(e,["responseJsonSchema"]);return null!=a&&nc(t,["responseJsonSchema"],a),t})(e))),nc(t,["functionDeclarations"],e)}let r=nd(e,["retrieval"]);null!=r&&nc(t,["retrieval"],r);let i=nd(e,["googleSearch"]);null!=i&&nc(t,["googleSearch"],i);let s=nd(e,["googleSearchRetrieval"]);null!=s&&nc(t,["googleSearchRetrieval"],s);let o=nd(e,["enterpriseWebSearch"]);null!=o&&nc(t,["enterpriseWebSearch"],o);let a=nd(e,["googleMaps"]);null!=a&&nc(t,["googleMaps"],a);let l=nd(e,["urlContext"]);null!=l&&nc(t,["urlContext"],l);let u=nd(e,["computerUse"]);null!=u&&nc(t,["computerUse"],u);let c=nd(e,["codeExecution"]);return null!=c&&nc(t,["codeExecution"],c),t})(nQ(e)))),nc(t,["setup","tools"],e)}let m=nd(e,["sessionResumption"]);void 0!==t&&null!=m&&nc(t,["setup","sessionResumption"],m);let g=nd(e,["inputAudioTranscription"]);void 0!==t&&null!=g&&nc(t,["setup","inputAudioTranscription"],g);let _=nd(e,["outputAudioTranscription"]);void 0!==t&&null!=_&&nc(t,["setup","outputAudioTranscription"],_);let y=nd(e,["realtimeInputConfig"]);void 0!==t&&null!=y&&nc(t,["setup","realtimeInputConfig"],y);let v=nd(e,["contextWindowCompression"]);void 0!==t&&null!=v&&nc(t,["setup","contextWindowCompression"],v);let E=nd(e,["proactivity"]);return void 0!==t&&null!=E&&nc(t,["setup","proactivity"],E),{}}(n,e)),S=e}else{let e,t,n;l=this.apiClient,e={},null!=(t=nd(A,["model"]))&&nc(e,["setup","model"],nD(l,t)),null!=(n=nd(A,["config"]))&&nc(e,["config"],function(e,t){let n=nd(e,["generationConfig"]);void 0!==t&&null!=n&&nc(t,["setup","generationConfig"],n);let r=nd(e,["responseModalities"]);void 0!==t&&null!=r&&nc(t,["setup","generationConfig","responseModalities"],r);let i=nd(e,["temperature"]);void 0!==t&&null!=i&&nc(t,["setup","generationConfig","temperature"],i);let s=nd(e,["topP"]);void 0!==t&&null!=s&&nc(t,["setup","generationConfig","topP"],s);let o=nd(e,["topK"]);void 0!==t&&null!=o&&nc(t,["setup","generationConfig","topK"],o);let a=nd(e,["maxOutputTokens"]);void 0!==t&&null!=a&&nc(t,["setup","generationConfig","maxOutputTokens"],a);let l=nd(e,["mediaResolution"]);void 0!==t&&null!=l&&nc(t,["setup","generationConfig","mediaResolution"],l);let u=nd(e,["seed"]);void 0!==t&&null!=u&&nc(t,["setup","generationConfig","seed"],u);let c=nd(e,["speechConfig"]);void 0!==t&&null!=c&&nc(t,["setup","generationConfig","speechConfig"],nz(c));let d=nd(e,["thinkingConfig"]);void 0!==t&&null!=d&&nc(t,["setup","generationConfig","thinkingConfig"],d);let p=nd(e,["enableAffectiveDialog"]);void 0!==t&&null!=p&&nc(t,["setup","generationConfig","enableAffectiveDialog"],p);let h=nd(e,["systemInstruction"]);void 0!==t&&null!=h&&nc(t,["setup","systemInstruction"],function(e){let t={},n=nd(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,r,i,s,o,a,l,u,c,d,p;return n={},null!=(r=nd(t=e,["videoMetadata"]))&&nc(n,["videoMetadata"],r),null!=(i=nd(t,["thought"]))&&nc(n,["thought"],i),null!=(s=nd(t,["inlineData"]))&&nc(n,["inlineData"],ry(s)),null!=(o=nd(t,["fileData"]))&&nc(n,["fileData"],function(e){let t={};if(void 0!==nd(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=nd(e,["fileUri"]);null!=n&&nc(t,["fileUri"],n);let r=nd(e,["mimeType"]);return null!=r&&nc(t,["mimeType"],r),t}(o)),null!=(a=nd(t,["thoughtSignature"]))&&nc(n,["thoughtSignature"],a),null!=(l=nd(t,["functionCall"]))&&nc(n,["functionCall"],l),null!=(u=nd(t,["codeExecutionResult"]))&&nc(n,["codeExecutionResult"],u),null!=(c=nd(t,["executableCode"]))&&nc(n,["executableCode"],c),null!=(d=nd(t,["functionResponse"]))&&nc(n,["functionResponse"],d),null!=(p=nd(t,["text"]))&&nc(n,["text"],p),n})),nc(t,["parts"],e)}let r=nd(e,["role"]);return null!=r&&nc(t,["role"],r),t}(nW(h)));let f=nd(e,["tools"]);if(void 0!==t&&null!=f){let e=nZ(f);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=nd(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),nc(t,["functionDeclarations"],e)}if(void 0!==nd(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let r=nd(e,["googleSearch"]);null!=r&&nc(t,["googleSearch"],function(e){let t={},n=nd(e,["timeRangeFilter"]);if(null!=n&&nc(t,["timeRangeFilter"],n),void 0!==nd(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");return t}(r));let i=nd(e,["googleSearchRetrieval"]);if(null!=i&&nc(t,["googleSearchRetrieval"],i),void 0!==nd(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let s=nd(e,["googleMaps"]);null!=s&&nc(t,["googleMaps"],function(e){let t={};if(void 0!==nd(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let n=nd(e,["enableWidget"]);return null!=n&&nc(t,["enableWidget"],n),t}(s));let o=nd(e,["urlContext"]);null!=o&&nc(t,["urlContext"],o);let a=nd(e,["computerUse"]);null!=a&&nc(t,["computerUse"],a);let l=nd(e,["codeExecution"]);return null!=l&&nc(t,["codeExecution"],l),t})(nQ(e)))),nc(t,["setup","tools"],e)}let m=nd(e,["sessionResumption"]);void 0!==t&&null!=m&&nc(t,["setup","sessionResumption"],function(e){let t={},n=nd(e,["handle"]);if(null!=n&&nc(t,["handle"],n),void 0!==nd(e,["transparent"]))throw Error("transparent parameter is not supported in Gemini API.");return t}(m));let g=nd(e,["inputAudioTranscription"]);void 0!==t&&null!=g&&nc(t,["setup","inputAudioTranscription"],g);let _=nd(e,["outputAudioTranscription"]);void 0!==t&&null!=_&&nc(t,["setup","outputAudioTranscription"],_);let y=nd(e,["realtimeInputConfig"]);void 0!==t&&null!=y&&nc(t,["setup","realtimeInputConfig"],y);let v=nd(e,["contextWindowCompression"]);void 0!==t&&null!=v&&nc(t,["setup","contextWindowCompression"],v);let E=nd(e,["proactivity"]);return void 0!==t&&null!=E&&nc(t,["setup","proactivity"],E),{}}(n,e)),S=e}return delete S.config,E.send(JSON.stringify(S)),new rX(E,this.apiClient)}isCallableTool(e){return"callTool"in e&&"function"==typeof e.callTool}}let rY={turnComplete:!0};class rX{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(null!==t.turns&&void 0!==t.turns){let n=[];try{n=nK(t.turns),e.isVertexAI()||(n=n.map(e=>rE(e)))}catch(e){throw Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:n,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let n=[];if(null==t.functionResponses||0===(n=Array.isArray(t.functionResponses)?t.functionResponses:[t.functionResponses]).length)throw Error("functionResponses is required.");for(let t of n){if("object"!=typeof t||null===t||!("name"in t)||!("response"in t))throw Error(`Could not parse function response, type '${typeof t}'.`);if(!e.isVertexAI()&&!("id"in t))throw Error("FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.")}return{toolResponse:{functionResponses:n}}}sendClientContent(e){e=Object.assign(Object.assign({},rY),e);let t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};t=this.apiClient.isVertexAI()?{realtimeInput:function(e){let t={},n=nd(e,["media"]);if(null!=n){let e=nU(n);Array.isArray(e)&&(e=e.map(e=>e)),nc(t,["mediaChunks"],e)}let r=nd(e,["audio"]);null!=r&&nc(t,["audio"],n$(r));let i=nd(e,["audioStreamEnd"]);null!=i&&nc(t,["audioStreamEnd"],i);let s=nd(e,["video"]);null!=s&&nc(t,["video"],nq(s));let o=nd(e,["text"]);null!=o&&nc(t,["text"],o);let a=nd(e,["activityStart"]);null!=a&&nc(t,["activityStart"],a);let l=nd(e,["activityEnd"]);return null!=l&&nc(t,["activityEnd"],l),t}(e)}:{realtimeInput:function(e){let t={},n=nd(e,["media"]);if(null!=n){let e=nU(n);Array.isArray(e)&&(e=e.map(e=>ry(e))),nc(t,["mediaChunks"],e)}let r=nd(e,["audio"]);null!=r&&nc(t,["audio"],ry(n$(r)));let i=nd(e,["audioStreamEnd"]);null!=i&&nc(t,["audioStreamEnd"],i);let s=nd(e,["video"]);null!=s&&nc(t,["video"],ry(nq(s)));let o=nd(e,["text"]);null!=o&&nc(t,["text"],o);let a=nd(e,["activityStart"]);null!=a&&nc(t,["activityStart"],a);let l=nd(e,["activityEnd"]);return null!=l&&nc(t,["activityEnd"],l),t}(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(null==e.functionResponses)throw Error("Tool response parameters are required.");let t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}}function rz(e){var t,n,r;if(null==(t=null==e?void 0:e.automaticFunctionCalling)?void 0:t.disable)return!0;let i=!1;for(let t of null!=(n=null==e?void 0:e.tools)?n:[])if(rQ(t)){i=!0;break}if(!i)return!0;let s=null==(r=null==e?void 0:e.automaticFunctionCalling)?void 0:r.maximumRemoteCalls;return(!(!s||!(s<0)&&Number.isInteger(s))||0==s)&&(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",s),!0)}function rQ(e){return"callTool"in e&&"function"==typeof e.callTool}function rZ(e){var t;return!(null==(t=null==e?void 0:e.automaticFunctionCalling)?void 0:t.ignoreCallHistory)}class r0 extends nl{constructor(e){super(),this.apiClient=e,this.generateContent=async e=>{var t,n,r,i,s,o,a,l,u,c,d;let p,h,f=await this.processParamsMaybeAddMcpUsage(e);if(this.maybeMoveToResponseJsonSchem(e),!(null!=(l=null==(a=null==(o=e.config)?void 0:o.tools)?void 0:a.some(e=>rQ(e)))&&l)||rz(e.config))return await this.generateContentInternal(f);if(null!=(d=null==(c=null==(u=e.config)?void 0:u.tools)?void 0:c.some(e=>!rQ(e)))&&d)throw Error("Automatic function calling with CallableTools and Tools is not yet supported.");let m=nK(f.contents),g=null!=(r=null==(n=null==(t=f.config)?void 0:t.automaticFunctionCalling)?void 0:n.maximumRemoteCalls)?r:10,_=0;for(;_<g&&(p=await this.generateContentInternal(f)).functionCalls&&0!==p.functionCalls.length;){let t=p.candidates[0].content,n=[];for(let t of null!=(s=null==(i=e.config)?void 0:i.tools)?s:[])if(rQ(t)){let e=await t.callTool(p.functionCalls);n.push(...e)}_++,h={role:"user",parts:n},f.contents=nK(f.contents),f.contents.push(t),f.contents.push(h),rZ(f.config)&&(m.push(t),m.push(h))}return rZ(f.config)&&(p.automaticFunctionCallingHistory=m),p},this.generateContentStream=async e=>{if(this.maybeMoveToResponseJsonSchem(e),!rz(e.config))return await this.processAfcStream(e);{let t=await this.processParamsMaybeAddMcpUsage(e);return await this.generateContentStreamInternal(t)}},this.generateImages=async e=>await this.generateImagesInternal(e).then(e=>{var t;let n,r=[];if(null==e?void 0:e.generatedImages)for(let i of e.generatedImages)i&&(null==i?void 0:i.safetyAttributes)&&(null==(t=null==i?void 0:i.safetyAttributes)?void 0:t.contentType)==="Positive Prompt"?n=null==i?void 0:i.safetyAttributes:r.push(i);return n?{generatedImages:r,positivePromptSafetyAttributes:n,sdkHttpResponse:e.sdkHttpResponse}:{generatedImages:r,sdkHttpResponse:e.sdkHttpResponse}}),this.list=async e=>{var t;let n={config:Object.assign(Object.assign({},{queryBase:!0}),null==e?void 0:e.config)};if(this.apiClient.isVertexAI()&&!n.config.queryBase)if(null==(t=n.config)?void 0:t.filter)throw Error("Filtering tuned models list for Vertex AI is not currently supported");else n.config.filter="labels.tune-type:*";return new rs(eQ.PAGED_ITEM_MODELS,e=>this.listInternal(e),await this.listInternal(n),n)},this.editImage=async e=>{let t={model:e.model,prompt:e.prompt,referenceImages:[],config:e.config};return e.referenceImages&&e.referenceImages&&(t.referenceImages=e.referenceImages.map(e=>e.toReferenceImageAPI())),await this.editImageInternal(t)},this.upscaleImage=async e=>{let t={numberOfImages:1,mode:"upscale"};e.config&&(t=Object.assign(Object.assign({},t),e.config));let n={model:e.model,image:e.image,upscaleFactor:e.upscaleFactor,config:t};return await this.upscaleImageInternal(n)},this.generateVideos=async e=>{var t,n,r,i,s,o;if((e.prompt||e.image||e.video)&&e.source)throw Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return!this.apiClient.isVertexAI()&&((null==(t=e.video)?void 0:t.uri)&&(null==(n=e.video)?void 0:n.videoBytes)?e.video={uri:e.video.uri,mimeType:e.video.mimeType}:(null==(i=null==(r=e.source)?void 0:r.video)?void 0:i.uri)&&(null==(o=null==(s=e.source)?void 0:s.video)?void 0:o.videoBytes)&&(e.source.video={uri:e.source.video.uri,mimeType:e.source.video.mimeType})),await this.generateVideosInternal(e)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&!e.config.responseJsonSchema&&Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema)}async processParamsMaybeAddMcpUsage(e){var t,n,r;let i=null==(t=e.config)?void 0:t.tools;if(!i)return e;let s=await Promise.all(i.map(async e=>rQ(e)?await e.tool():e)),o={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:s})};if(o.config.tools=s,e.config&&e.config.tools&&rG(e.config.tools)){let t=Object.assign({},null!=(r=null==(n=e.config.httpOptions)?void 0:n.headers)?r:{});0===Object.keys(t).length&&(t=this.apiClient.getDefaultHeaders()),rH(t),o.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:t})}return o}async initAfcToolsMap(e){var t,n,r;let i=new Map;for(let s of null!=(n=null==(t=e.config)?void 0:t.tools)?n:[])if(rQ(s))for(let e of null!=(r=(await s.tool()).functionDeclarations)?r:[]){if(!e.name)throw Error("Function declaration name is required.");if(i.has(e.name))throw Error(`Duplicate tool declaration name: ${e.name}`);i.set(e.name,s)}return i}async processAfcStream(e){var t,n,r;let i=null!=(r=null==(n=null==(t=e.config)?void 0:t.automaticFunctionCalling)?void 0:n.maximumRemoteCalls)?r:10,s=!1,o=0;return function(e,t,n){var r,a;return rc(this,arguments,function*(){for(var l,u,c,d;o<i;){s&&(o++,s=!1);let m=yield ru(e.processParamsMaybeAddMcpUsage(n)),g=yield ru(e.generateContentStreamInternal(m)),_=[],y=[];try{for(var p,h=!0,f=(u=void 0,rd(g));!(l=(p=yield ru(f.next())).done);h=!0)if(d=p.value,h=!1,yield yield ru(d),d.candidates&&(null==(r=d.candidates[0])?void 0:r.content)){for(let e of(y.push(d.candidates[0].content),null!=(a=d.candidates[0].content.parts)?a:[]))if(o<i&&e.functionCall){if(!e.functionCall.name)throw Error("Function call name was not returned by the model.");if(t.has(e.functionCall.name)){let n=yield ru(t.get(e.functionCall.name).callTool([e.functionCall]));_.push(...n)}else throw Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${t.keys()}, mising tool: ${e.functionCall.name}`)}}}catch(e){u={error:e}}finally{try{!h&&!l&&(c=f.return)&&(yield ru(c.call(f)))}finally{if(u)throw u.error}}if(_.length>0){s=!0;let e=new nf;e.candidates=[{content:{role:"user",parts:_}}],yield yield ru(e);let t=[];t.push(...y),t.push({role:"user",parts:_});let r=nK(n.contents).concat(t);n.contents=r}else break}})}(this,await this.initAfcToolsMap(e),e)}async generateContentInternal(e){var t,n,r,i;let s="",o={};if(this.apiClient.isVertexAI()){let r=rS(this.apiClient,e);return s=nu("{model}:generateContent",r._url),o=r._query,delete r._url,delete r._query,this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=rO(e),n=new nf;return Object.assign(n,t),n})}{let t=rb(this.apiClient,e);return s=nu("{model}:generateContent",t._url),o=t._query,delete t._url,delete t._query,this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=rT(e),n=new nf;return Object.assign(n,t),n})}}async generateContentStreamInternal(e){var t,n,r,i;let s="",o={};if(this.apiClient.isVertexAI()){let r=rS(this.apiClient,e);return s=nu("{model}:streamGenerateContent?alt=sse",r._url),o=r._query,delete r._url,delete r._query,this.apiClient.requestStream({path:s,queryParams:o,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(function(e){return rc(this,arguments,function*(){var t,n,r,i;try{for(var s,o=!0,a=rd(e);!(t=(s=yield ru(a.next())).done);o=!0){i=s.value,o=!1;let e=rO((yield ru(i.json())));e.sdkHttpResponse={headers:i.headers};let t=new nf;Object.assign(t,e),yield yield ru(t)}}catch(e){n={error:e}}finally{try{!o&&!t&&(r=a.return)&&(yield ru(r.call(a)))}finally{if(n)throw n.error}}})})}{let t=rb(this.apiClient,e);return s=nu("{model}:streamGenerateContent?alt=sse",t._url),o=t._query,delete t._url,delete t._query,this.apiClient.requestStream({path:s,queryParams:o,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(function(e){return rc(this,arguments,function*(){var t,n,r,i;try{for(var s,o=!0,a=rd(e);!(t=(s=yield ru(a.next())).done);o=!0){i=s.value,o=!1;let e=rT((yield ru(i.json())));e.sdkHttpResponse={headers:i.headers};let t=new nf;Object.assign(t,e),yield yield ru(t)}}catch(e){n={error:e}}finally{try{!o&&!t&&(r=a.return)&&(yield ru(r.call(a)))}finally{if(n)throw n.error}}})})}}async embedContent(e){var t,n,r,i;let s="",o={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n,r,i,s,o,a={},l=nd(t,["model"]);null!=l&&nc(a,["_url","model"],nD(e,l));let u=nd(t,["contents"]);if(null!=u){let t=nJ(e,u);Array.isArray(t)&&(t=t.map(e=>e)),nc(a,["instances[]","content"],t)}let c=nd(t,["config"]);return null!=c&&(n=nd(c,["taskType"]),void 0!==a&&null!=n&&nc(a,["instances[]","task_type"],n),r=nd(c,["title"]),void 0!==a&&null!=r&&nc(a,["instances[]","title"],r),i=nd(c,["outputDimensionality"]),void 0!==a&&null!=i&&nc(a,["parameters","outputDimensionality"],i),s=nd(c,["mimeType"]),void 0!==a&&null!=s&&nc(a,["instances[]","mimeType"],s),o=nd(c,["autoTruncate"]),void 0!==a&&null!=o&&nc(a,["parameters","autoTruncate"],o)),a}(this.apiClient,e);return s=nu("{model}:predict",r._url),o=r._query,delete r._url,delete r._query,this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=nd(e,["sdkHttpResponse"]);null!=n&&nc(t,["sdkHttpResponse"],n);let r=nd(e,["predictions[]","embeddings"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>{var t;let n,r,i,s,o,a;return n={},null!=(r=nd(e,["values"]))&&nc(n,["values"],r),null!=(i=nd(e,["statistics"]))&&nc(n,["statistics"],(s={},null!=(o=nd(t=i,["truncated"]))&&nc(s,["truncated"],o),null!=(a=nd(t,["token_count"]))&&nc(s,["tokenCount"],a),s)),n})),nc(t,["embeddings"],e)}let i=nd(e,["metadata"]);return null!=i&&nc(t,["metadata"],i),t}(e),n=new nm;return Object.assign(n,t),n})}{let t=function(e,t){let n={},r=nd(t,["model"]);null!=r&&nc(n,["_url","model"],nD(e,r));let i=nd(t,["contents"]);if(null!=i){let t=nJ(e,i);Array.isArray(t)&&(t=t.map(e=>e)),nc(n,["requests[]","content"],t)}let s=nd(t,["config"]);null!=s&&function(e,t){let n=nd(e,["taskType"]);void 0!==t&&null!=n&&nc(t,["requests[]","taskType"],n);let r=nd(e,["title"]);void 0!==t&&null!=r&&nc(t,["requests[]","title"],r);let i=nd(e,["outputDimensionality"]);if(void 0!==t&&null!=i&&nc(t,["requests[]","outputDimensionality"],i),void 0!==nd(e,["mimeType"]))throw Error("mimeType parameter is not supported in Gemini API.");if(void 0!==nd(e,["autoTruncate"]))throw Error("autoTruncate parameter is not supported in Gemini API.")}(s,n);let o=nd(t,["model"]);return void 0!==o&&nc(n,["requests[]","model"],nD(e,o)),n}(this.apiClient,e);return s=nu("{model}:batchEmbedContents",t._url),o=t._query,delete t._url,delete t._query,this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=nd(e,["sdkHttpResponse"]);null!=n&&nc(t,["sdkHttpResponse"],n);let r=nd(e,["embeddings"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),nc(t,["embeddings"],e)}let i=nd(e,["metadata"]);return null!=i&&nc(t,["metadata"],i),t}(e),n=new nm;return Object.assign(n,t),n})}}async generateImagesInternal(e){var t,n,r,i,s,o;let a="",l={};if(this.apiClient.isVertexAI()){let r,i,o,u,c,d,p,h,f,m,g,_,y,v,E,b,S,T,O,A,w,C=(s=this.apiClient,r={},null!=(i=nd(e,["model"]))&&nc(r,["_url","model"],nD(s,i)),null!=(o=nd(e,["prompt"]))&&nc(r,["instances[0]","prompt"],o),null!=(u=nd(e,["config"]))&&(c=nd(u,["outputGcsUri"]),void 0!==r&&null!=c&&nc(r,["parameters","storageUri"],c),d=nd(u,["negativePrompt"]),void 0!==r&&null!=d&&nc(r,["parameters","negativePrompt"],d),p=nd(u,["numberOfImages"]),void 0!==r&&null!=p&&nc(r,["parameters","sampleCount"],p),h=nd(u,["aspectRatio"]),void 0!==r&&null!=h&&nc(r,["parameters","aspectRatio"],h),f=nd(u,["guidanceScale"]),void 0!==r&&null!=f&&nc(r,["parameters","guidanceScale"],f),m=nd(u,["seed"]),void 0!==r&&null!=m&&nc(r,["parameters","seed"],m),g=nd(u,["safetyFilterLevel"]),void 0!==r&&null!=g&&nc(r,["parameters","safetySetting"],g),_=nd(u,["personGeneration"]),void 0!==r&&null!=_&&nc(r,["parameters","personGeneration"],_),y=nd(u,["includeSafetyAttributes"]),void 0!==r&&null!=y&&nc(r,["parameters","includeSafetyAttributes"],y),v=nd(u,["includeRaiReason"]),void 0!==r&&null!=v&&nc(r,["parameters","includeRaiReason"],v),E=nd(u,["language"]),void 0!==r&&null!=E&&nc(r,["parameters","language"],E),b=nd(u,["outputMimeType"]),void 0!==r&&null!=b&&nc(r,["parameters","outputOptions","mimeType"],b),S=nd(u,["outputCompressionQuality"]),void 0!==r&&null!=S&&nc(r,["parameters","outputOptions","compressionQuality"],S),T=nd(u,["addWatermark"]),void 0!==r&&null!=T&&nc(r,["parameters","addWatermark"],T),O=nd(u,["labels"]),void 0!==r&&null!=O&&nc(r,["labels"],O),A=nd(u,["imageSize"]),void 0!==r&&null!=A&&nc(r,["parameters","sampleImageSize"],A),w=nd(u,["enhancePrompt"]),void 0!==r&&null!=w&&nc(r,["parameters","enhancePrompt"],w)),r);return a=nu("{model}:predict",C._url),l=C._query,delete C._url,delete C._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(C),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=nd(e,["sdkHttpResponse"]);null!=n&&nc(t,["sdkHttpResponse"],n);let r=nd(e,["predictions"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>rA(e))),nc(t,["generatedImages"],e)}let i=nd(e,["positivePromptSafetyAttributes"]);return null!=i&&nc(t,["positivePromptSafetyAttributes"],rx(i)),t}(e),n=new ng;return Object.assign(n,t),n})}{let t,n,s,u,c=(o=this.apiClient,t={},null!=(n=nd(e,["model"]))&&nc(t,["_url","model"],nD(o,n)),null!=(s=nd(e,["prompt"]))&&nc(t,["instances[0]","prompt"],s),null!=(u=nd(e,["config"]))&&function(e,t){if(void 0!==nd(e,["outputGcsUri"]))throw Error("outputGcsUri parameter is not supported in Gemini API.");if(void 0!==nd(e,["negativePrompt"]))throw Error("negativePrompt parameter is not supported in Gemini API.");let n=nd(e,["numberOfImages"]);void 0!==t&&null!=n&&nc(t,["parameters","sampleCount"],n);let r=nd(e,["aspectRatio"]);void 0!==t&&null!=r&&nc(t,["parameters","aspectRatio"],r);let i=nd(e,["guidanceScale"]);if(void 0!==t&&null!=i&&nc(t,["parameters","guidanceScale"],i),void 0!==nd(e,["seed"]))throw Error("seed parameter is not supported in Gemini API.");let s=nd(e,["safetyFilterLevel"]);void 0!==t&&null!=s&&nc(t,["parameters","safetySetting"],s);let o=nd(e,["personGeneration"]);void 0!==t&&null!=o&&nc(t,["parameters","personGeneration"],o);let a=nd(e,["includeSafetyAttributes"]);void 0!==t&&null!=a&&nc(t,["parameters","includeSafetyAttributes"],a);let l=nd(e,["includeRaiReason"]);void 0!==t&&null!=l&&nc(t,["parameters","includeRaiReason"],l);let u=nd(e,["language"]);void 0!==t&&null!=u&&nc(t,["parameters","language"],u);let c=nd(e,["outputMimeType"]);void 0!==t&&null!=c&&nc(t,["parameters","outputOptions","mimeType"],c);let d=nd(e,["outputCompressionQuality"]);if(void 0!==t&&null!=d&&nc(t,["parameters","outputOptions","compressionQuality"],d),void 0!==nd(e,["addWatermark"]))throw Error("addWatermark parameter is not supported in Gemini API.");if(void 0!==nd(e,["labels"]))throw Error("labels parameter is not supported in Gemini API.");let p=nd(e,["imageSize"]);if(void 0!==t&&null!=p&&nc(t,["parameters","sampleImageSize"],p),void 0!==nd(e,["enhancePrompt"]))throw Error("enhancePrompt parameter is not supported in Gemini API.")}(u,t),t);return a=nu("{model}:predict",c._url),l=c._query,delete c._url,delete c._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=nd(e,["sdkHttpResponse"]);null!=n&&nc(t,["sdkHttpResponse"],n);let r=nd(e,["predictions"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>{var t,n;let r,i,s,o,a,l,u;return r={},null!=(i=nd(t=e,["_self"]))&&nc(r,["image"],(s={},null!=(o=nd(n=i,["bytesBase64Encoded"]))&&nc(s,["imageBytes"],np(o)),null!=(a=nd(n,["mimeType"]))&&nc(s,["mimeType"],a),s)),null!=(l=nd(t,["raiFilteredReason"]))&&nc(r,["raiFilteredReason"],l),null!=(u=nd(t,["_self"]))&&nc(r,["safetyAttributes"],rN(u)),r})),nc(t,["generatedImages"],e)}let i=nd(e,["positivePromptSafetyAttributes"]);return null!=i&&nc(t,["positivePromptSafetyAttributes"],rN(i)),t}(e),n=new ng;return Object.assign(n,t),n})}}async editImageInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI()){let s=function(e,t){let n,r,i,s,o,a,l,u,c,d,p,h,f,m,g,_,y,v={},E=nd(t,["model"]);null!=E&&nc(v,["_url","model"],nD(e,E));let b=nd(t,["prompt"]);null!=b&&nc(v,["instances[0]","prompt"],b);let S=nd(t,["referenceImages"]);if(null!=S){let e=S;Array.isArray(e)&&(e=e.map(e=>(function(e){let t,n,r,i,s,o,a,l={},u=nd(e,["referenceImage"]);null!=u&&nc(l,["referenceImage"],rI(u));let c=nd(e,["referenceId"]);null!=c&&nc(l,["referenceId"],c);let d=nd(e,["referenceType"]);null!=d&&nc(l,["referenceType"],d);let p=nd(e,["maskImageConfig"]);null!=p&&nc(l,["maskImageConfig"],(t={},null!=(n=nd(p,["maskMode"]))&&nc(t,["maskMode"],n),null!=(r=nd(p,["segmentationClasses"]))&&nc(t,["maskClasses"],r),null!=(i=nd(p,["maskDilation"]))&&nc(t,["dilation"],i),t));let h=nd(e,["controlImageConfig"]);null!=h&&nc(l,["controlImageConfig"],(s={},null!=(o=nd(h,["controlType"]))&&nc(s,["controlType"],o),null!=(a=nd(h,["enableControlImageComputation"]))&&nc(s,["computeControl"],a),s));let f=nd(e,["styleImageConfig"]);null!=f&&nc(l,["styleImageConfig"],f);let m=nd(e,["subjectImageConfig"]);return null!=m&&nc(l,["subjectImageConfig"],m),l})(e))),nc(v,["instances[0]","referenceImages"],e)}let T=nd(t,["config"]);return null!=T&&(n=nd(T,["outputGcsUri"]),void 0!==v&&null!=n&&nc(v,["parameters","storageUri"],n),r=nd(T,["negativePrompt"]),void 0!==v&&null!=r&&nc(v,["parameters","negativePrompt"],r),i=nd(T,["numberOfImages"]),void 0!==v&&null!=i&&nc(v,["parameters","sampleCount"],i),s=nd(T,["aspectRatio"]),void 0!==v&&null!=s&&nc(v,["parameters","aspectRatio"],s),o=nd(T,["guidanceScale"]),void 0!==v&&null!=o&&nc(v,["parameters","guidanceScale"],o),a=nd(T,["seed"]),void 0!==v&&null!=a&&nc(v,["parameters","seed"],a),l=nd(T,["safetyFilterLevel"]),void 0!==v&&null!=l&&nc(v,["parameters","safetySetting"],l),u=nd(T,["personGeneration"]),void 0!==v&&null!=u&&nc(v,["parameters","personGeneration"],u),c=nd(T,["includeSafetyAttributes"]),void 0!==v&&null!=c&&nc(v,["parameters","includeSafetyAttributes"],c),d=nd(T,["includeRaiReason"]),void 0!==v&&null!=d&&nc(v,["parameters","includeRaiReason"],d),p=nd(T,["language"]),void 0!==v&&null!=p&&nc(v,["parameters","language"],p),h=nd(T,["outputMimeType"]),void 0!==v&&null!=h&&nc(v,["parameters","outputOptions","mimeType"],h),f=nd(T,["outputCompressionQuality"]),void 0!==v&&null!=f&&nc(v,["parameters","outputOptions","compressionQuality"],f),m=nd(T,["addWatermark"]),void 0!==v&&null!=m&&nc(v,["parameters","addWatermark"],m),g=nd(T,["labels"]),void 0!==v&&null!=g&&nc(v,["labels"],g),_=nd(T,["editMode"]),void 0!==v&&null!=_&&nc(v,["parameters","editMode"],_),y=nd(T,["baseSteps"]),void 0!==v&&null!=y&&nc(v,["parameters","editConfig","baseSteps"],y)),v}(this.apiClient,e);return r=nu("{model}:predict",s._url),i=s._query,delete s._url,delete s._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=nd(e,["sdkHttpResponse"]);null!=n&&nc(t,["sdkHttpResponse"],n);let r=nd(e,["predictions"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>rA(e))),nc(t,["generatedImages"],e)}return t}(e),n=new n_;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,n,r;let i="",s={};if(this.apiClient.isVertexAI()){let o,a,l,u,c,d,p,h,f,m,g,_,y,v,E=(r=this.apiClient,o={},null!=(a=nd(e,["model"]))&&nc(o,["_url","model"],nD(r,a)),null!=(l=nd(e,["image"]))&&nc(o,["instances[0]","image"],rI(l)),null!=(u=nd(e,["upscaleFactor"]))&&nc(o,["parameters","upscaleConfig","upscaleFactor"],u),null!=(c=nd(e,["config"]))&&(d=nd(c,["outputGcsUri"]),void 0!==o&&null!=d&&nc(o,["parameters","storageUri"],d),p=nd(c,["includeRaiReason"]),void 0!==o&&null!=p&&nc(o,["parameters","includeRaiReason"],p),h=nd(c,["outputMimeType"]),void 0!==o&&null!=h&&nc(o,["parameters","outputOptions","mimeType"],h),f=nd(c,["outputCompressionQuality"]),void 0!==o&&null!=f&&nc(o,["parameters","outputOptions","compressionQuality"],f),m=nd(c,["enhanceInputImage"]),void 0!==o&&null!=m&&nc(o,["parameters","upscaleConfig","enhanceInputImage"],m),g=nd(c,["imagePreservationFactor"]),void 0!==o&&null!=g&&nc(o,["parameters","upscaleConfig","imagePreservationFactor"],g),_=nd(c,["labels"]),void 0!==o&&null!=_&&nc(o,["labels"],_),y=nd(c,["numberOfImages"]),void 0!==o&&null!=y&&nc(o,["parameters","sampleCount"],y),v=nd(c,["mode"]),void 0!==o&&null!=v&&nc(o,["parameters","mode"],v)),o);return i=nu("{model}:predict",E._url),s=E._query,delete E._url,delete E._query,this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(E),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=nd(e,["sdkHttpResponse"]);null!=n&&nc(t,["sdkHttpResponse"],n);let r=nd(e,["predictions"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>rA(e))),nc(t,["generatedImages"],e)}return t}(e),n=new ny;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,n,r;let i="",s={};if(this.apiClient.isVertexAI()){let o,a,l,u,c,d,p,h,f,m,g,_,y,v,E,b=(r=this.apiClient,o={},null!=(a=nd(e,["model"]))&&nc(o,["_url","model"],nD(r,a)),null!=(l=nd(e,["source"]))&&function(e,t){let n=nd(e,["prompt"]);void 0!==t&&null!=n&&nc(t,["instances[0]","prompt"],n);let r=nd(e,["personImage"]);void 0!==t&&null!=r&&nc(t,["instances[0]","personImage","image"],rI(r));let i=nd(e,["productImages"]);if(void 0!==t&&null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>{let t,n;return t={},null!=(n=nd(e,["productImage"]))&&nc(t,["image"],rI(n)),t})),nc(t,["instances[0]","productImages"],e)}}(l,o),null!=(u=nd(e,["config"]))&&(c=nd(u,["numberOfImages"]),void 0!==o&&null!=c&&nc(o,["parameters","sampleCount"],c),d=nd(u,["baseSteps"]),void 0!==o&&null!=d&&nc(o,["parameters","editConfig","baseSteps"],d),p=nd(u,["outputGcsUri"]),void 0!==o&&null!=p&&nc(o,["parameters","storageUri"],p),h=nd(u,["seed"]),void 0!==o&&null!=h&&nc(o,["parameters","seed"],h),f=nd(u,["safetyFilterLevel"]),void 0!==o&&null!=f&&nc(o,["parameters","safetySetting"],f),m=nd(u,["personGeneration"]),void 0!==o&&null!=m&&nc(o,["parameters","personGeneration"],m),g=nd(u,["addWatermark"]),void 0!==o&&null!=g&&nc(o,["parameters","addWatermark"],g),_=nd(u,["outputMimeType"]),void 0!==o&&null!=_&&nc(o,["parameters","outputOptions","mimeType"],_),y=nd(u,["outputCompressionQuality"]),void 0!==o&&null!=y&&nc(o,["parameters","outputOptions","compressionQuality"],y),v=nd(u,["enhancePrompt"]),void 0!==o&&null!=v&&nc(o,["parameters","enhancePrompt"],v),E=nd(u,["labels"]),void 0!==o&&null!=E&&nc(o,["labels"],E)),o);return i=nu("{model}:predict",b._url),s=b._query,delete b._url,delete b._query,this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(b),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},n=nd(e,["predictions"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>rA(e))),nc(t,["generatedImages"],e)}return t}(e),n=new nv;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var t,n,r,i,s;let o="",a={};if(this.apiClient.isVertexAI()){let l,u,c,d,p,h,f,m,g,_,y,v,E,b,S,T=(r=this.apiClient,h={},null!=(f=nd(e,["model"]))&&nc(h,["_url","model"],nD(r,f)),null!=(m=nd(e,["source"]))&&(i=m,s=h,c=nd(i,["prompt"]),void 0!==s&&null!=c&&nc(s,["instances[0]","prompt"],c),d=nd(i,["image"]),void 0!==s&&null!=d&&nc(s,["instances[0]","image"],rI(d)),p=nd(i,["scribbleImage"]),void 0!==s&&null!=p&&nc(s,["instances[0]","scribble"],(l={},null!=(u=nd(p,["image"]))&&nc(l,["image"],rI(u)),l))),null!=(g=nd(e,["config"]))&&(_=nd(g,["mode"]),void 0!==h&&null!=_&&nc(h,["parameters","mode"],_),y=nd(g,["maxPredictions"]),void 0!==h&&null!=y&&nc(h,["parameters","maxPredictions"],y),v=nd(g,["confidenceThreshold"]),void 0!==h&&null!=v&&nc(h,["parameters","confidenceThreshold"],v),E=nd(g,["maskDilation"]),void 0!==h&&null!=E&&nc(h,["parameters","maskDilation"],E),b=nd(g,["binaryColorThreshold"]),void 0!==h&&null!=b&&nc(h,["parameters","binaryColorThreshold"],b),S=nd(g,["labels"]),void 0!==h&&null!=S&&nc(h,["labels"],S)),h);return o=nu("{model}:predict",T._url),a=T._query,delete T._url,delete T._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(T),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},n=nd(e,["predictions"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=nd(e,["_self"]);null!=n&&nc(t,["mask"],rw(n));let r=nd(e,["labels"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),nc(t,["labels"],e)}return t})(e))),nc(t,["generatedMasks"],e)}return t}(e),n=new nE;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async get(e){var t,n,r,i,s,o;let a="",l={};if(this.apiClient.isVertexAI()){let r,i,o=(s=this.apiClient,r={},null!=(i=nd(e,["model"]))&&nc(r,["_url","name"],nD(s,i)),r);return a=nu("{name}",o._url),l=o._query,delete o._url,delete o._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>rP(e))}{let t,n,s=(o=this.apiClient,t={},null!=(n=nd(e,["model"]))&&nc(t,["_url","name"],nD(o,n)),t);return a=nu("{name}",s._url),l=s._query,delete s._url,delete s._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json()).then(e=>rR(e))}}async listInternal(e){var t,n,r,i,s,o;let a="",l={};if(this.apiClient.isVertexAI()){let r,i,o,u,c,d,p=(s=this.apiClient,r={},null!=(i=nd(e,["config"]))&&(o=nd(i,["pageSize"]),void 0!==r&&null!=o&&nc(r,["_query","pageSize"],o),u=nd(i,["pageToken"]),void 0!==r&&null!=u&&nc(r,["_query","pageToken"],u),c=nd(i,["filter"]),void 0!==r&&null!=c&&nc(r,["_query","filter"],c),d=nd(i,["queryBase"]),void 0!==r&&null!=d&&nc(r,["_url","models_url"],n6(s,d))),r);return a=nu("{models_url}",p._url),l=p._query,delete p._url,delete p._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(p),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=nd(e,["sdkHttpResponse"]);null!=n&&nc(t,["sdkHttpResponse"],n);let r=nd(e,["nextPageToken"]);null!=r&&nc(t,["nextPageToken"],r);let i=nd(e,["_self"]);if(null!=i){let e=n3(i);Array.isArray(e)&&(e=e.map(e=>rP(e))),nc(t,["models"],e)}return t}(e),n=new nb;return Object.assign(n,t),n})}{let t,n,s,u,c,d,p=(o=this.apiClient,t={},null!=(n=nd(e,["config"]))&&(s=nd(n,["pageSize"]),void 0!==t&&null!=s&&nc(t,["_query","pageSize"],s),u=nd(n,["pageToken"]),void 0!==t&&null!=u&&nc(t,["_query","pageToken"],u),c=nd(n,["filter"]),void 0!==t&&null!=c&&nc(t,["_query","filter"],c),d=nd(n,["queryBase"]),void 0!==t&&null!=d&&nc(t,["_url","models_url"],n6(o,d))),t);return a=nu("{models_url}",p._url),l=p._query,delete p._url,delete p._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(p),httpMethod:"GET",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=nd(e,["sdkHttpResponse"]);null!=n&&nc(t,["sdkHttpResponse"],n);let r=nd(e,["nextPageToken"]);null!=r&&nc(t,["nextPageToken"],r);let i=nd(e,["_self"]);if(null!=i){let e=n3(i);Array.isArray(e)&&(e=e.map(e=>rR(e))),nc(t,["models"],e)}return t}(e),n=new nb;return Object.assign(n,t),n})}}async update(e){var t,n,r,i,s,o;let a="",l={};if(this.apiClient.isVertexAI()){let r,i,o,u,c,d,p=(s=this.apiClient,r={},null!=(i=nd(e,["model"]))&&nc(r,["_url","model"],nD(s,i)),null!=(o=nd(e,["config"]))&&(u=nd(o,["displayName"]),void 0!==r&&null!=u&&nc(r,["displayName"],u),c=nd(o,["description"]),void 0!==r&&null!=c&&nc(r,["description"],c),d=nd(o,["defaultCheckpointId"]),void 0!==r&&null!=d&&nc(r,["defaultCheckpointId"],d)),r);return a=nu("{model}",p._url),l=p._query,delete p._url,delete p._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(p),httpMethod:"PATCH",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>rP(e))}{let t,n,s,u,c,d,p=(o=this.apiClient,t={},null!=(n=nd(e,["model"]))&&nc(t,["_url","name"],nD(o,n)),null!=(s=nd(e,["config"]))&&(u=nd(s,["displayName"]),void 0!==t&&null!=u&&nc(t,["displayName"],u),c=nd(s,["description"]),void 0!==t&&null!=c&&nc(t,["description"],c),d=nd(s,["defaultCheckpointId"]),void 0!==t&&null!=d&&nc(t,["defaultCheckpointId"],d)),t);return a=nu("{name}",p._url),l=p._query,delete p._url,delete p._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(p),httpMethod:"PATCH",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json()).then(e=>rR(e))}}async delete(e){var t,n,r,i,s,o;let a="",l={};if(this.apiClient.isVertexAI()){let r,i,o=(s=this.apiClient,r={},null!=(i=nd(e,["model"]))&&nc(r,["_url","name"],nD(s,i)),r);return a=nu("{name}",o._url),l=o._query,delete o._url,delete o._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,r=(t={},null!=(n=nd(e,["sdkHttpResponse"]))&&nc(t,["sdkHttpResponse"],n),t),i=new nS;return Object.assign(i,r),i})}{let t,n,s=(o=this.apiClient,t={},null!=(n=nd(e,["model"]))&&nc(t,["_url","name"],nD(o,n)),t);return a=nu("{name}",s._url),l=s._query,delete s._url,delete s._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,r=(t={},null!=(n=nd(e,["sdkHttpResponse"]))&&nc(t,["sdkHttpResponse"],n),t),i=new nS;return Object.assign(i,r),i})}}async countTokens(e){var t,n,r,i;let s="",o={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=nd(t,["model"]);null!=r&&nc(n,["_url","model"],nD(e,r));let i=nd(t,["contents"]);if(null!=i){let e=nK(i);Array.isArray(e)&&(e=e.map(e=>e)),nc(n,["contents"],e)}let s=nd(t,["config"]);return null!=s&&function(e,t){let n=nd(e,["systemInstruction"]);void 0!==t&&null!=n&&nc(t,["systemInstruction"],nW(n));let r=nd(e,["tools"]);if(void 0!==t&&null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>rM(e))),nc(t,["tools"],e)}let i=nd(e,["generationConfig"]);void 0!==t&&null!=i&&nc(t,["generationConfig"],function(e){let t={},n=nd(e,["modelSelectionConfig"]);null!=n&&nc(t,["modelConfig"],n);let r=nd(e,["audioTimestamp"]);null!=r&&nc(t,["audioTimestamp"],r);let i=nd(e,["candidateCount"]);null!=i&&nc(t,["candidateCount"],i);let s=nd(e,["enableAffectiveDialog"]);null!=s&&nc(t,["enableAffectiveDialog"],s);let o=nd(e,["frequencyPenalty"]);null!=o&&nc(t,["frequencyPenalty"],o);let a=nd(e,["logprobs"]);null!=a&&nc(t,["logprobs"],a);let l=nd(e,["maxOutputTokens"]);null!=l&&nc(t,["maxOutputTokens"],l);let u=nd(e,["mediaResolution"]);null!=u&&nc(t,["mediaResolution"],u);let c=nd(e,["presencePenalty"]);null!=c&&nc(t,["presencePenalty"],c);let d=nd(e,["responseJsonSchema"]);null!=d&&nc(t,["responseJsonSchema"],d);let p=nd(e,["responseLogprobs"]);null!=p&&nc(t,["responseLogprobs"],p);let h=nd(e,["responseMimeType"]);null!=h&&nc(t,["responseMimeType"],h);let f=nd(e,["responseModalities"]);null!=f&&nc(t,["responseModalities"],f);let m=nd(e,["responseSchema"]);null!=m&&nc(t,["responseSchema"],m);let g=nd(e,["routingConfig"]);null!=g&&nc(t,["routingConfig"],g);let _=nd(e,["seed"]);null!=_&&nc(t,["seed"],_);let y=nd(e,["speechConfig"]);null!=y&&nc(t,["speechConfig"],rk(y));let v=nd(e,["stopSequences"]);null!=v&&nc(t,["stopSequences"],v);let E=nd(e,["temperature"]);null!=E&&nc(t,["temperature"],E);let b=nd(e,["thinkingConfig"]);null!=b&&nc(t,["thinkingConfig"],b);let S=nd(e,["topK"]);null!=S&&nc(t,["topK"],S);let T=nd(e,["topP"]);if(null!=T&&nc(t,["topP"],T),void 0!==nd(e,["enableEnhancedCivicAnswers"]))throw Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}(i))}(s,n),n}(this.apiClient,e);return s=nu("{model}:countTokens",r._url),o=r._query,delete r._url,delete r._query,this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,r,i=(t={},null!=(n=nd(e,["sdkHttpResponse"]))&&nc(t,["sdkHttpResponse"],n),null!=(r=nd(e,["totalTokens"]))&&nc(t,["totalTokens"],r),t),s=new nT;return Object.assign(s,i),s})}{let t=function(e,t){let n={},r=nd(t,["model"]);null!=r&&nc(n,["_url","model"],nD(e,r));let i=nd(t,["contents"]);if(null!=i){let e=nK(i);Array.isArray(e)&&(e=e.map(e=>rE(e))),nc(n,["contents"],e)}let s=nd(t,["config"]);return null!=s&&function(e){if(void 0!==nd(e,["systemInstruction"]))throw Error("systemInstruction parameter is not supported in Gemini API.");if(void 0!==nd(e,["tools"]))throw Error("tools parameter is not supported in Gemini API.");if(void 0!==nd(e,["generationConfig"]))throw Error("generationConfig parameter is not supported in Gemini API.")}(s),n}(this.apiClient,e);return s=nu("{model}:countTokens",t._url),o=t._query,delete t._url,delete t._query,this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,r,i,s=(t={},null!=(n=nd(e,["sdkHttpResponse"]))&&nc(t,["sdkHttpResponse"],n),null!=(r=nd(e,["totalTokens"]))&&nc(t,["totalTokens"],r),null!=(i=nd(e,["cachedContentTokenCount"]))&&nc(t,["cachedContentTokenCount"],i),t),o=new nT;return Object.assign(o,s),o})}}async computeTokens(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI()){let s=function(e,t){let n={},r=nd(t,["model"]);null!=r&&nc(n,["_url","model"],nD(e,r));let i=nd(t,["contents"]);if(null!=i){let e=nK(i);Array.isArray(e)&&(e=e.map(e=>e)),nc(n,["contents"],e)}return n}(this.apiClient,e);return r=nu("{model}:computeTokens",s._url),i=s._query,delete s._url,delete s._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=nd(e,["sdkHttpResponse"]);null!=n&&nc(t,["sdkHttpResponse"],n);let r=nd(e,["tokensInfo"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),nc(t,["tokensInfo"],e)}return t}(e),n=new nO;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,n,r,i,s,o,a,l,u,c;let d="",p={};if(this.apiClient.isVertexAI()){let r,i,o,u,c,h,f,m,g,_,y=(s=this.apiClient,u={},null!=(c=nd(e,["model"]))&&nc(u,["_url","model"],nD(s,c)),null!=(h=nd(e,["prompt"]))&&nc(u,["instances[0]","prompt"],h),null!=(f=nd(e,["image"]))&&nc(u,["instances[0]","image"],rI(f)),null!=(m=nd(e,["video"]))&&nc(u,["instances[0]","video"],rL(m)),null!=(g=nd(e,["source"]))&&(a=g,l=u,r=nd(a,["prompt"]),void 0!==l&&null!=r&&nc(l,["instances[0]","prompt"],r),i=nd(a,["image"]),void 0!==l&&null!=i&&nc(l,["instances[0]","image"],rI(i)),o=nd(a,["video"]),void 0!==l&&null!=o&&nc(l,["instances[0]","video"],rL(o))),null!=(_=nd(e,["config"]))&&function(e,t){var n;let r,i,s,o=nd(e,["numberOfVideos"]);void 0!==t&&null!=o&&nc(t,["parameters","sampleCount"],o);let a=nd(e,["outputGcsUri"]);void 0!==t&&null!=a&&nc(t,["parameters","storageUri"],a);let l=nd(e,["fps"]);void 0!==t&&null!=l&&nc(t,["parameters","fps"],l);let u=nd(e,["durationSeconds"]);void 0!==t&&null!=u&&nc(t,["parameters","durationSeconds"],u);let c=nd(e,["seed"]);void 0!==t&&null!=c&&nc(t,["parameters","seed"],c);let d=nd(e,["aspectRatio"]);void 0!==t&&null!=d&&nc(t,["parameters","aspectRatio"],d);let p=nd(e,["resolution"]);void 0!==t&&null!=p&&nc(t,["parameters","resolution"],p);let h=nd(e,["personGeneration"]);void 0!==t&&null!=h&&nc(t,["parameters","personGeneration"],h);let f=nd(e,["pubsubTopic"]);void 0!==t&&null!=f&&nc(t,["parameters","pubsubTopic"],f);let m=nd(e,["negativePrompt"]);void 0!==t&&null!=m&&nc(t,["parameters","negativePrompt"],m);let g=nd(e,["enhancePrompt"]);void 0!==t&&null!=g&&nc(t,["parameters","enhancePrompt"],g);let _=nd(e,["generateAudio"]);void 0!==t&&null!=_&&nc(t,["parameters","generateAudio"],_);let y=nd(e,["lastFrame"]);void 0!==t&&null!=y&&nc(t,["instances[0]","lastFrame"],rI(y));let v=nd(e,["referenceImages"]);if(void 0!==t&&null!=v){let e=v;Array.isArray(e)&&(e=e.map(e=>{var t;let n,r,i;return n={},null!=(r=nd(t=e,["image"]))&&nc(n,["image"],rI(r)),null!=(i=nd(t,["referenceType"]))&&nc(n,["referenceType"],i),n})),nc(t,["instances[0]","referenceImages"],e)}let E=nd(e,["mask"]);void 0!==t&&null!=E&&nc(t,["instances[0]","mask"],(r={},null!=(i=nd(n=E,["image"]))&&nc(r,["_self"],rI(i)),null!=(s=nd(n,["maskMode"]))&&nc(r,["maskMode"],s),r));let b=nd(e,["compressionQuality"]);void 0!==t&&null!=b&&nc(t,["parameters","compressionQuality"],b)}(_,u),u);return d=nu("{model}:predictLongRunning",y._url),p=y._query,delete y._url,delete y._query,this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(y),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t,n,r,i,s,o,a=(t={},null!=(n=nd(e,["name"]))&&nc(t,["name"],n),null!=(r=nd(e,["metadata"]))&&nc(t,["metadata"],r),null!=(i=nd(e,["done"]))&&nc(t,["done"],i),null!=(s=nd(e,["error"]))&&nc(t,["error"],s),null!=(o=nd(e,["response"]))&&nc(t,["response"],function(e){let t={},n=nd(e,["videos"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,r,i,s,o,a;return n={},null!=(r=nd(e,["_self"]))&&nc(n,["video"],(i={},null!=(s=nd(t=r,["gcsUri"]))&&nc(i,["uri"],s),null!=(o=nd(t,["bytesBase64Encoded"]))&&nc(i,["videoBytes"],np(o)),null!=(a=nd(t,["mimeType"]))&&nc(i,["mimeType"],a),i)),n})),nc(t,["generatedVideos"],e)}let r=nd(e,["raiMediaFilteredCount"]);null!=r&&nc(t,["raiMediaFilteredCount"],r);let i=nd(e,["raiMediaFilteredReasons"]);return null!=i&&nc(t,["raiMediaFilteredReasons"],i),t}(o)),t),l=new nA;return Object.assign(l,a),l})}{let t,n,s,a,l,h,f,m,g,_,y=(o=this.apiClient,a={},null!=(l=nd(e,["model"]))&&nc(a,["_url","model"],nD(o,l)),null!=(h=nd(e,["prompt"]))&&nc(a,["instances[0]","prompt"],h),null!=(f=nd(e,["image"]))&&nc(a,["instances[0]","image"],rC(f)),null!=(m=nd(e,["video"]))&&nc(a,["instances[0]","video"],rD(m)),null!=(g=nd(e,["source"]))&&(u=g,c=a,t=nd(u,["prompt"]),void 0!==c&&null!=t&&nc(c,["instances[0]","prompt"],t),n=nd(u,["image"]),void 0!==c&&null!=n&&nc(c,["instances[0]","image"],rC(n)),s=nd(u,["video"]),void 0!==c&&null!=s&&nc(c,["instances[0]","video"],rD(s))),null!=(_=nd(e,["config"]))&&function(e,t){let n=nd(e,["numberOfVideos"]);if(void 0!==t&&null!=n&&nc(t,["parameters","sampleCount"],n),void 0!==nd(e,["outputGcsUri"]))throw Error("outputGcsUri parameter is not supported in Gemini API.");if(void 0!==nd(e,["fps"]))throw Error("fps parameter is not supported in Gemini API.");let r=nd(e,["durationSeconds"]);if(void 0!==t&&null!=r&&nc(t,["parameters","durationSeconds"],r),void 0!==nd(e,["seed"]))throw Error("seed parameter is not supported in Gemini API.");let i=nd(e,["aspectRatio"]);void 0!==t&&null!=i&&nc(t,["parameters","aspectRatio"],i);let s=nd(e,["resolution"]);void 0!==t&&null!=s&&nc(t,["parameters","resolution"],s);let o=nd(e,["personGeneration"]);if(void 0!==t&&null!=o&&nc(t,["parameters","personGeneration"],o),void 0!==nd(e,["pubsubTopic"]))throw Error("pubsubTopic parameter is not supported in Gemini API.");let a=nd(e,["negativePrompt"]);void 0!==t&&null!=a&&nc(t,["parameters","negativePrompt"],a);let l=nd(e,["enhancePrompt"]);if(void 0!==t&&null!=l&&nc(t,["parameters","enhancePrompt"],l),void 0!==nd(e,["generateAudio"]))throw Error("generateAudio parameter is not supported in Gemini API.");let u=nd(e,["lastFrame"]);void 0!==t&&null!=u&&nc(t,["instances[0]","lastFrame"],rC(u));let c=nd(e,["referenceImages"]);if(void 0!==t&&null!=c){let e=c;Array.isArray(e)&&(e=e.map(e=>{var t;let n,r,i;return n={},null!=(r=nd(t=e,["image"]))&&nc(n,["image"],rC(r)),null!=(i=nd(t,["referenceType"]))&&nc(n,["referenceType"],i),n})),nc(t,["instances[0]","referenceImages"],e)}if(void 0!==nd(e,["mask"]))throw Error("mask parameter is not supported in Gemini API.");if(void 0!==nd(e,["compressionQuality"]))throw Error("compressionQuality parameter is not supported in Gemini API.")}(_,a),a);return d=nu("{model}:predictLongRunning",y._url),p=y._query,delete y._url,delete y._query,this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(y),httpMethod:"POST",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json()).then(e=>{let t,n,r,i,s,o,a=(t={},null!=(n=nd(e,["name"]))&&nc(t,["name"],n),null!=(r=nd(e,["metadata"]))&&nc(t,["metadata"],r),null!=(i=nd(e,["done"]))&&nc(t,["done"],i),null!=(s=nd(e,["error"]))&&nc(t,["error"],s),null!=(o=nd(e,["response","generateVideoResponse"]))&&nc(t,["response"],function(e){let t={},n=nd(e,["generatedSamples"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,r,i,s,o,a;return n={},null!=(r=nd(e,["video"]))&&nc(n,["video"],(i={},null!=(s=nd(t=r,["uri"]))&&nc(i,["uri"],s),null!=(o=nd(t,["encodedVideo"]))&&nc(i,["videoBytes"],np(o)),null!=(a=nd(t,["encoding"]))&&nc(i,["mimeType"],a),i)),n})),nc(t,["generatedVideos"],e)}let r=nd(e,["raiMediaFilteredCount"]);null!=r&&nc(t,["raiMediaFilteredCount"],r);let i=nd(e,["raiMediaFilteredReasons"]);return null!=i&&nc(t,["raiMediaFilteredReasons"],i),t}(o)),t),l=new nA;return Object.assign(l,a),l})}}}class r1 extends nl{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){let t=e.operation,n=e.config;if(void 0===t.name||""===t.name)throw Error("Operation name is required.");if(this.apiClient.isVertexAI()){let e,r=t.name.split("/operations/")[0];n&&"httpOptions"in n&&(e=n.httpOptions);let i=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:r,config:{httpOptions:e}});return t._fromAPIResponse({apiResponse:i,isVertexAI:!0})}{let e=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:e,isVertexAI:!1})}}async get(e){let t=e.operation,n=e.config;if(void 0===t.name||""===t.name)throw Error("Operation name is required.");if(this.apiClient.isVertexAI()){let e,r=t.name.split("/operations/")[0];n&&"httpOptions"in n&&(e=n.httpOptions);let i=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:r,config:{httpOptions:e}});return t._fromAPIResponse({apiResponse:i,isVertexAI:!0})}{let e=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:e,isVertexAI:!1})}}async getVideosOperationInternal(e){var t,n,r,i;let s="",o={};if(this.apiClient.isVertexAI()){let r,i,a=(r={},null!=(i=nd(e,["operationName"]))&&nc(r,["_url","operationName"],i),r);return s=nu("{operationName}",a._url),o=a._query,delete a._url,delete a._query,this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json())}{let t,n,a=(t={},null!=(n=nd(e,["operationName"]))&&nc(t,["_url","operationName"],n),t);return s=nu("{operationName}",a._url),o=a._query,delete a._url,delete a._query,this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json())}}async fetchPredictVideosOperationInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI()){let s,o,a,l=(s={},null!=(o=nd(e,["operationName"]))&&nc(s,["operationName"],o),null!=(a=nd(e,["resourceName"]))&&nc(s,["_url","resourceName"],a),s);return r=nu("{resourceName}:fetchPredictOperation",l._url),i=l._query,delete l._url,delete l._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(l),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json())}throw Error("This method is only supported by the Vertex AI.")}}class r2 extends nl{constructor(e){super(),this.apiClient=e}async create(e){var t,n,r,i,s;let o="",a={};if(this.apiClient.isVertexAI())throw Error("The client.tokens.create method is only supported by the Gemini Developer API.");{let l,u,c,d,p,h,f,m,g,_,y=(r=this.apiClient,d={},null!=(p=nd(e,["config"]))&&nc(d,["config"],(h=nd(p,["expireTime"]),void 0!==d&&null!=h&&nc(d,["expireTime"],h),f=nd(p,["newSessionExpireTime"]),void 0!==d&&null!=f&&nc(d,["newSessionExpireTime"],f),m=nd(p,["uses"]),void 0!==d&&null!=m&&nc(d,["uses"],m),g=nd(p,["liveConnectConstraints"]),void 0!==d&&null!=g&&nc(d,["bidiGenerateContentSetup"],(i=r,l={},null!=(u=nd(s=g,["model"]))&&nc(l,["setup","model"],nD(i,u)),null!=(c=nd(s,["config"]))&&nc(l,["config"],function(e,t){let n=nd(e,["generationConfig"]);void 0!==t&&null!=n&&nc(t,["setup","generationConfig"],n);let r=nd(e,["responseModalities"]);void 0!==t&&null!=r&&nc(t,["setup","generationConfig","responseModalities"],r);let i=nd(e,["temperature"]);void 0!==t&&null!=i&&nc(t,["setup","generationConfig","temperature"],i);let s=nd(e,["topP"]);void 0!==t&&null!=s&&nc(t,["setup","generationConfig","topP"],s);let o=nd(e,["topK"]);void 0!==t&&null!=o&&nc(t,["setup","generationConfig","topK"],o);let a=nd(e,["maxOutputTokens"]);void 0!==t&&null!=a&&nc(t,["setup","generationConfig","maxOutputTokens"],a);let l=nd(e,["mediaResolution"]);void 0!==t&&null!=l&&nc(t,["setup","generationConfig","mediaResolution"],l);let u=nd(e,["seed"]);void 0!==t&&null!=u&&nc(t,["setup","generationConfig","seed"],u);let c=nd(e,["speechConfig"]);void 0!==t&&null!=c&&nc(t,["setup","generationConfig","speechConfig"],nz(c));let d=nd(e,["thinkingConfig"]);void 0!==t&&null!=d&&nc(t,["setup","generationConfig","thinkingConfig"],d);let p=nd(e,["enableAffectiveDialog"]);void 0!==t&&null!=p&&nc(t,["setup","generationConfig","enableAffectiveDialog"],p);let h=nd(e,["systemInstruction"]);void 0!==t&&null!=h&&nc(t,["setup","systemInstruction"],function(e){let t={},n=nd(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,r,i,s,o,a,l,u,c,d,p;return n={},null!=(r=nd(t=e,["videoMetadata"]))&&nc(n,["videoMetadata"],r),null!=(i=nd(t,["thought"]))&&nc(n,["thought"],i),null!=(s=nd(t,["inlineData"]))&&nc(n,["inlineData"],function(e){let t={};if(void 0!==nd(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=nd(e,["data"]);null!=n&&nc(t,["data"],n);let r=nd(e,["mimeType"]);return null!=r&&nc(t,["mimeType"],r),t}(s)),null!=(o=nd(t,["fileData"]))&&nc(n,["fileData"],function(e){let t={};if(void 0!==nd(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=nd(e,["fileUri"]);null!=n&&nc(t,["fileUri"],n);let r=nd(e,["mimeType"]);return null!=r&&nc(t,["mimeType"],r),t}(o)),null!=(a=nd(t,["thoughtSignature"]))&&nc(n,["thoughtSignature"],a),null!=(l=nd(t,["functionCall"]))&&nc(n,["functionCall"],l),null!=(u=nd(t,["codeExecutionResult"]))&&nc(n,["codeExecutionResult"],u),null!=(c=nd(t,["executableCode"]))&&nc(n,["executableCode"],c),null!=(d=nd(t,["functionResponse"]))&&nc(n,["functionResponse"],d),null!=(p=nd(t,["text"]))&&nc(n,["text"],p),n})),nc(t,["parts"],e)}let r=nd(e,["role"]);return null!=r&&nc(t,["role"],r),t}(nW(h)));let f=nd(e,["tools"]);if(void 0!==t&&null!=f){let e=nZ(f);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=nd(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),nc(t,["functionDeclarations"],e)}if(void 0!==nd(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let r=nd(e,["googleSearch"]);null!=r&&nc(t,["googleSearch"],function(e){let t={},n=nd(e,["timeRangeFilter"]);if(null!=n&&nc(t,["timeRangeFilter"],n),void 0!==nd(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");return t}(r));let i=nd(e,["googleSearchRetrieval"]);if(null!=i&&nc(t,["googleSearchRetrieval"],i),void 0!==nd(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let s=nd(e,["googleMaps"]);null!=s&&nc(t,["googleMaps"],function(e){let t={};if(void 0!==nd(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let n=nd(e,["enableWidget"]);return null!=n&&nc(t,["enableWidget"],n),t}(s));let o=nd(e,["urlContext"]);null!=o&&nc(t,["urlContext"],o);let a=nd(e,["computerUse"]);null!=a&&nc(t,["computerUse"],a);let l=nd(e,["codeExecution"]);return null!=l&&nc(t,["codeExecution"],l),t})(nQ(e)))),nc(t,["setup","tools"],e)}let m=nd(e,["sessionResumption"]);void 0!==t&&null!=m&&nc(t,["setup","sessionResumption"],function(e){let t={},n=nd(e,["handle"]);if(null!=n&&nc(t,["handle"],n),void 0!==nd(e,["transparent"]))throw Error("transparent parameter is not supported in Gemini API.");return t}(m));let g=nd(e,["inputAudioTranscription"]);void 0!==t&&null!=g&&nc(t,["setup","inputAudioTranscription"],g);let _=nd(e,["outputAudioTranscription"]);void 0!==t&&null!=_&&nc(t,["setup","outputAudioTranscription"],_);let y=nd(e,["realtimeInputConfig"]);void 0!==t&&null!=y&&nc(t,["setup","realtimeInputConfig"],y);let v=nd(e,["contextWindowCompression"]);void 0!==t&&null!=v&&nc(t,["setup","contextWindowCompression"],v);let E=nd(e,["proactivity"]);return void 0!==t&&null!=E&&nc(t,["setup","proactivity"],E),{}}(c,l)),l)),_=nd(p,["lockAdditionalFields"]),void 0!==d&&null!=_&&nc(d,["fieldMask"],_),{})),d);o=nu("auth_tokens",y._url),a=y._query,delete y.config,delete y._url,delete y._query;let v=function(e,t){let n=null,r=e.bidiGenerateContentSetup;if("object"==typeof r&&null!==r&&"setup"in r){let t=r.setup;"object"==typeof t&&null!==t?(e.bidiGenerateContentSetup=t,n=t):delete e.bidiGenerateContentSetup}else void 0!==r&&delete e.bidiGenerateContentSetup;let i=e.fieldMask;if(n){let r=function(e){let t=[];for(let n in e)if(Object.prototype.hasOwnProperty.call(e,n)){let r=e[n];if("object"==typeof r&&null!=r&&Object.keys(r).length>0){let e=Object.keys(r).map(e=>`${n}.${e}`);t.push(...e)}else t.push(n)}return t.join(",")}(n);if(Array.isArray(null==t?void 0:t.lockAdditionalFields)&&(null==t?void 0:t.lockAdditionalFields.length)===0)r?e.fieldMask=r:delete e.fieldMask;else if((null==t?void 0:t.lockAdditionalFields)&&t.lockAdditionalFields.length>0&&null!==i&&Array.isArray(i)&&i.length>0){let t=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"],n=[];i.length>0&&(n=i.map(e=>t.includes(e)?`generationConfig.${e}`:e));let s=[];r&&s.push(r),n.length>0&&s.push(...n),s.length>0?e.fieldMask=s.join(","):delete e.fieldMask}else delete e.fieldMask}else null!==i&&Array.isArray(i)&&i.length>0?e.fieldMask=i.join(","):delete e.fieldMask;return e}(y,e.config);return this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(v),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}}}let r4="x-goog-api-key",r8="https://www.googleapis.com/auth/cloud-platform";class r6{constructor(e){if(void 0!==e.apiKey){this.apiKey=e.apiKey;return}const t=function(e){let t;if(!e)return{scopes:[r8]};if((t=e).scopes){if("string"==typeof t.scopes&&t.scopes!==r8||Array.isArray(t.scopes)&&0>t.scopes.indexOf(r8))throw Error(`Invalid auth scopes. Scopes must include: ${r8}`)}else t.scopes=[r8];return t}(e.googleAuthOptions);this.googleAuth=new nr.GoogleAuth(t)}async addAuthHeaders(e,t){if(void 0!==this.apiKey){if(this.apiKey.startsWith("auth_tokens/"))throw Error("Ephemeral tokens are only supported by the live API.");this.addKeyHeader(e);return}return this.addGoogleAuthHeaders(e,t)}addKeyHeader(e){if(null===e.get(r4)){if(void 0===this.apiKey)throw Error("Trying to set API key header but apiKey is not set");e.append(r4,this.apiKey)}}async addGoogleAuthHeaders(e,t){if(void 0===this.googleAuth)throw Error("Trying to set google-auth headers but googleAuth is unset");for(let[n,r]of(await this.googleAuth.getRequestHeaders(t)))null===e.get(n)&&e.append(n,r)}}class r3{async download(e,t){if(e.downloadPath){let n=await r9(e,t);if(n instanceof nh){let t=(0,ni.createWriteStream)(e.downloadPath);ns.Readable.fromWeb(n.responseInternal.body).pipe(t)}else(0,ni.writeFile)(e.downloadPath,n,{encoding:"base64"},t=>{if(t)throw Error(`Failed to write file to ${e.downloadPath}: ${t}`)})}}}async function r9(e,t){var n,r,i;let s=n8(e.file);if(void 0!==s)return await t.request({path:`files/${s}:download`,httpMethod:"GET",queryParams:{alt:"media"},httpOptions:null==(n=e.config)?void 0:n.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal});if(n2(e.file)){let t=null==(i=e.file.video)?void 0:i.videoBytes;if("string"==typeof t)return t;throw Error("Failed to download generated video, Uri or videoBytes not found.")}if(n4(e.file)){let t=e.file.videoBytes;if("string"==typeof t)return t;throw Error("Failed to download video, Uri or videoBytes not found.")}throw Error("Unsupported file type")}class r5{create(e,t,n){return new r7(e,t,n)}}class r7{constructor(e,t,n){this.url=e,this.headers=t,this.callbacks=n}connect(){this.ws=new no.default(this.url,{headers:this.headers}),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(void 0===this.ws)throw Error("WebSocket is not connected");this.ws.send(e)}close(){if(void 0===this.ws)throw Error("WebSocket is not connected");this.ws.close()}}function ie(e,t){let n,r,i,s={},o=nd(e,["sdkHttpResponse"]);null!=o&&nc(s,["sdkHttpResponse"],o);let a=nd(e,["name"]);null!=a&&nc(s,["name"],a);let l=nd(e,["state"]);null!=l&&nc(s,["state"],n1(l));let u=nd(e,["createTime"]);null!=u&&nc(s,["createTime"],u);let c=nd(e,["tuningTask","startTime"]);null!=c&&nc(s,["startTime"],c);let d=nd(e,["tuningTask","completeTime"]);null!=d&&nc(s,["endTime"],d);let p=nd(e,["updateTime"]);null!=p&&nc(s,["updateTime"],p);let h=nd(e,["description"]);null!=h&&nc(s,["description"],h);let f=nd(e,["baseModel"]);null!=f&&nc(s,["baseModel"],f);let m=nd(e,["_self"]);return null!=m&&nc(s,["tunedModel"],(n={},null!=(r=nd(m,["name"]))&&nc(n,["model"],r),null!=(i=nd(m,["name"]))&&nc(n,["endpoint"],i),n)),s}function it(e,t){let n={},r=nd(e,["sdkHttpResponse"]);null!=r&&nc(n,["sdkHttpResponse"],r);let i=nd(e,["name"]);null!=i&&nc(n,["name"],i);let s=nd(e,["state"]);null!=s&&nc(n,["state"],n1(s));let o=nd(e,["createTime"]);null!=o&&nc(n,["createTime"],o);let a=nd(e,["startTime"]);null!=a&&nc(n,["startTime"],a);let l=nd(e,["endTime"]);null!=l&&nc(n,["endTime"],l);let u=nd(e,["updateTime"]);null!=u&&nc(n,["updateTime"],u);let c=nd(e,["error"]);null!=c&&nc(n,["error"],c);let d=nd(e,["description"]);null!=d&&nc(n,["description"],d);let p=nd(e,["baseModel"]);null!=p&&nc(n,["baseModel"],p);let h=nd(e,["tunedModel"]);null!=h&&nc(n,["tunedModel"],h);let f=nd(e,["preTunedModel"]);null!=f&&nc(n,["preTunedModel"],f);let m=nd(e,["supervisedTuningSpec"]);null!=m&&nc(n,["supervisedTuningSpec"],m);let g=nd(e,["tuningDataStats"]);null!=g&&nc(n,["tuningDataStats"],g);let _=nd(e,["encryptionSpec"]);null!=_&&nc(n,["encryptionSpec"],_);let y=nd(e,["partnerModelTuningSpec"]);null!=y&&nc(n,["partnerModelTuningSpec"],y);let v=nd(e,["customBaseModel"]);null!=v&&nc(n,["customBaseModel"],v);let E=nd(e,["experiment"]);null!=E&&nc(n,["experiment"],E);let b=nd(e,["labels"]);null!=b&&nc(n,["labels"],b);let S=nd(e,["outputUri"]);null!=S&&nc(n,["outputUri"],S);let T=nd(e,["pipelineJob"]);null!=T&&nc(n,["pipelineJob"],T);let O=nd(e,["serviceAccount"]);null!=O&&nc(n,["serviceAccount"],O);let A=nd(e,["tunedModelDisplayName"]);null!=A&&nc(n,["tunedModelDisplayName"],A);let w=nd(e,["veoTuningSpec"]);return null!=w&&nc(n,["veoTuningSpec"],w),n}class ir extends nl{constructor(e){super(),this.apiClient=e,this.get=async e=>await this.getInternal(e),this.list=async(e={})=>new rs(eQ.PAGED_ITEM_TUNING_JOBS,e=>this.listInternal(e),await this.listInternal(e),e),this.tune=async e=>{var t;if(this.apiClient.isVertexAI())if(e.baseModel.startsWith("projects/")){let n={tunedModelName:e.baseModel};(null==(t=e.config)?void 0:t.preTunedModelCheckpointId)&&(n.checkpointId=e.config.preTunedModelCheckpointId);let r=Object.assign(Object.assign({},e),{preTunedModel:n});return r.baseModel=void 0,await this.tuneInternal(r)}else{let t=Object.assign({},e);return await this.tuneInternal(t)}{let t=Object.assign({},e),n=await this.tuneMldevInternal(t),r="";return void 0!==n.metadata&&void 0!==n.metadata.tunedModel?r=n.metadata.tunedModel:void 0!==n.name&&n.name.includes("/operations/")&&(r=n.name.split("/operations/")[0]),{name:r,state:eb.JOB_STATE_QUEUED}}}}async getInternal(e){var t,n,r,i;let s="",o={};if(this.apiClient.isVertexAI()){let r,i,a=(r={},null!=(i=nd(e,["name"]))&&nc(r,["_url","name"],i),r);return s=nu("{name}",a._url),o=a._query,delete a._url,delete a._query,this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>it(e))}{let t,n,a=(t={},null!=(n=nd(e,["name"]))&&nc(t,["_url","name"],n),t);return s=nu("{name}",a._url),o=a._query,delete a._url,delete a._query,this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>ie(e))}}async listInternal(e){var t,n,r,i;let s="",o={};if(this.apiClient.isVertexAI()){let r,i,a,l,u,c=(r={},null!=(i=nd(e,["config"]))&&(a=nd(i,["pageSize"]),void 0!==r&&null!=a&&nc(r,["_query","pageSize"],a),l=nd(i,["pageToken"]),void 0!==r&&null!=l&&nc(r,["_query","pageToken"],l),u=nd(i,["filter"]),void 0!==r&&null!=u&&nc(r,["_query","filter"],u)),r);return s=nu("tuningJobs",c._url),o=c._query,delete c._url,delete c._query,this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(c),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e,t){let n={},r=nd(e,["sdkHttpResponse"]);null!=r&&nc(n,["sdkHttpResponse"],r);let i=nd(e,["nextPageToken"]);null!=i&&nc(n,["nextPageToken"],i);let s=nd(e,["tuningJobs"]);if(null!=s){let e=s;Array.isArray(e)&&(e=e.map(e=>it(e))),nc(n,["tuningJobs"],e)}return n}(e),n=new nw;return Object.assign(n,t),n})}{let t,n,a,l,u,c=(t={},null!=(n=nd(e,["config"]))&&(a=nd(n,["pageSize"]),void 0!==t&&null!=a&&nc(t,["_query","pageSize"],a),l=nd(n,["pageToken"]),void 0!==t&&null!=l&&nc(t,["_query","pageToken"],l),u=nd(n,["filter"]),void 0!==t&&null!=u&&nc(t,["_query","filter"],u)),t);return s=nu("tunedModels",c._url),o=c._query,delete c._url,delete c._query,this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(c),httpMethod:"GET",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e,t){let n={},r=nd(e,["sdkHttpResponse"]);null!=r&&nc(n,["sdkHttpResponse"],r);let i=nd(e,["nextPageToken"]);null!=i&&nc(n,["nextPageToken"],i);let s=nd(e,["tunedModels"]);if(null!=s){let e=s;Array.isArray(e)&&(e=e.map(e=>ie(e))),nc(n,["tuningJobs"],e)}return n}(e),n=new nw;return Object.assign(n,t),n})}}async cancel(e){var t,n,r,i;let s="",o={};if(this.apiClient.isVertexAI()){let r,i,a=(r={},null!=(i=nd(e,["name"]))&&nc(r,["_url","name"],i),r);s=nu("{name}:cancel",a._url),o=a._query,delete a._url,delete a._query,await this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal})}else{let t,n,a=(t={},null!=(n=nd(e,["name"]))&&nc(t,["_url","name"],n),t);s=nu("{name}:cancel",a._url),o=a._query,delete a._url,delete a._query,await this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal})}}async tuneInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI()){let s,o,a,l,u,c=(s={},null!=(o=nd(e,["baseModel"]))&&nc(s,["baseModel"],o),null!=(a=nd(e,["preTunedModel"]))&&nc(s,["preTunedModel"],a),null!=(l=nd(e,["trainingDataset"]))&&function(e,t,n){let r=nd(e,["gcsUri"]);void 0!==t&&null!=r&&nc(t,["supervisedTuningSpec","trainingDatasetUri"],r);let i=nd(e,["vertexDatasetResource"]);if(void 0!==t&&null!=i&&nc(t,["supervisedTuningSpec","trainingDatasetUri"],i),void 0!==nd(e,["examples"]))throw Error("examples parameter is not supported in Vertex AI.")}(l,s),null!=(u=nd(e,["config"]))&&function(e,t,n){var r;let i,s,o,a=nd(e,["validationDataset"]);void 0!==t&&null!=a&&nc(t,["supervisedTuningSpec"],(i={},null!=(s=nd(r=a,["gcsUri"]))&&nc(i,["validationDatasetUri"],s),null!=(o=nd(r,["vertexDatasetResource"]))&&nc(i,["validationDatasetUri"],o),i));let l=nd(e,["tunedModelDisplayName"]);void 0!==t&&null!=l&&nc(t,["tunedModelDisplayName"],l);let u=nd(e,["description"]);void 0!==t&&null!=u&&nc(t,["description"],u);let c=nd(e,["epochCount"]);void 0!==t&&null!=c&&nc(t,["supervisedTuningSpec","hyperParameters","epochCount"],c);let d=nd(e,["learningRateMultiplier"]);void 0!==t&&null!=d&&nc(t,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],d);let p=nd(e,["exportLastCheckpointOnly"]);void 0!==t&&null!=p&&nc(t,["supervisedTuningSpec","exportLastCheckpointOnly"],p);let h=nd(e,["adapterSize"]);if(void 0!==t&&null!=h&&nc(t,["supervisedTuningSpec","hyperParameters","adapterSize"],h),void 0!==nd(e,["batchSize"]))throw Error("batchSize parameter is not supported in Vertex AI.");if(void 0!==nd(e,["learningRate"]))throw Error("learningRate parameter is not supported in Vertex AI.");let f=nd(e,["labels"]);void 0!==t&&null!=f&&nc(t,["labels"],f)}(u,s),s);return r=nu("tuningJobs",c._url),i=c._query,delete c._url,delete c._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(c),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>it(e))}throw Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let s,o,a,l,u,c=(s={},null!=(o=nd(e,["baseModel"]))&&nc(s,["baseModel"],o),null!=(a=nd(e,["preTunedModel"]))&&nc(s,["preTunedModel"],a),null!=(l=nd(e,["trainingDataset"]))&&nc(s,["tuningTask","trainingData"],function(e,t){let n={};if(void 0!==nd(e,["gcsUri"]))throw Error("gcsUri parameter is not supported in Gemini API.");if(void 0!==nd(e,["vertexDatasetResource"]))throw Error("vertexDatasetResource parameter is not supported in Gemini API.");let r=nd(e,["examples"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),nc(n,["examples","examples"],e)}return n}(l)),null!=(u=nd(e,["config"]))&&function(e,t,n){if(void 0!==nd(e,["validationDataset"]))throw Error("validationDataset parameter is not supported in Gemini API.");let r=nd(e,["tunedModelDisplayName"]);if(void 0!==t&&null!=r&&nc(t,["displayName"],r),void 0!==nd(e,["description"]))throw Error("description parameter is not supported in Gemini API.");let i=nd(e,["epochCount"]);void 0!==t&&null!=i&&nc(t,["tuningTask","hyperparameters","epochCount"],i);let s=nd(e,["learningRateMultiplier"]);if(null!=s&&nc({},["tuningTask","hyperparameters","learningRateMultiplier"],s),void 0!==nd(e,["exportLastCheckpointOnly"]))throw Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(void 0!==nd(e,["preTunedModelCheckpointId"]))throw Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(void 0!==nd(e,["adapterSize"]))throw Error("adapterSize parameter is not supported in Gemini API.");let o=nd(e,["batchSize"]);void 0!==t&&null!=o&&nc(t,["tuningTask","hyperparameters","batchSize"],o);let a=nd(e,["learningRate"]);if(void 0!==t&&null!=a&&nc(t,["tuningTask","hyperparameters","learningRate"],a),void 0!==nd(e,["labels"]))throw Error("labels parameter is not supported in Gemini API.")}(u,s),s);return r=nu("tunedModels",c._url),i=c._query,delete c._url,delete c._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(c),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,r,i,s,o;return t={},null!=(n=nd(e,["sdkHttpResponse"]))&&nc(t,["sdkHttpResponse"],n),null!=(r=nd(e,["name"]))&&nc(t,["name"],r),null!=(i=nd(e,["metadata"]))&&nc(t,["metadata"],i),null!=(s=nd(e,["done"]))&&nc(t,["done"],s),null!=(o=nd(e,["error"]))&&nc(t,["error"],o),t})}}}let ii="x-goog-upload-status";async function is(e,t,n){var r,i,s;let o=0,a=0,l=new nh(new Response),u="upload";for(o=e.size;a<o;){let s=Math.min(8388608,o-a),c=e.slice(a,a+s);a+s>=o&&(u+=", finalize");let d=0,p=1e3;for(;d<3&&(null==(r=null==(l=await n.request({path:"",body:c,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:t,headers:{"X-Goog-Upload-Command":u,"X-Goog-Upload-Offset":String(a),"Content-Length":String(s)}}}))?void 0:l.headers)||!r[ii]);)d++,await ia(p),p*=2;if(a+=s,(null==(i=null==l?void 0:l.headers)?void 0:i[ii])!=="active")break;if(o<=a)throw Error("All content has been uploaded, but the upload status is not finalized.")}let c=await (null==l?void 0:l.json());if((null==(s=null==l?void 0:l.headers)?void 0:s[ii])!=="final")throw Error("Failed to upload file: Upload status is not finalized.");return c.file}async function io(e){return{size:e.size,type:e.type}}function ia(e){return new Promise(t=>setTimeout(t,e))}class il{async stat(e){let t={size:0,type:void 0};return"string"==typeof e?(t.size=(await na.stat(e)).size,t.type=this.inferMimeType(e),t):await io(e)}async upload(e,t,n){return"string"==typeof e?await this.uploadFileFromPath(e,t,n):is(e,t,n)}inferMimeType(e){return({aac:"audio/aac",abw:"application/x-abiword",arc:"application/x-freearc",avi:"video/x-msvideo",azw:"application/vnd.amazon.ebook",bin:"application/octet-stream",bmp:"image/bmp",bz:"application/x-bzip",bz2:"application/x-bzip2",csh:"application/x-csh",css:"text/css",csv:"text/csv",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",gz:"application/gzip",gif:"image/gif",htm:"text/html",html:"text/html",ico:"image/vnd.microsoft.icon",ics:"text/calendar",jar:"application/java-archive",jpeg:"image/jpeg",jpg:"image/jpeg",js:"text/javascript",json:"application/json",jsonld:"application/ld+json",kml:"application/vnd.google-earth.kml+xml",kmz:"application/vnd.google-earth.kmz+xml",mjs:"text/javascript",mp3:"audio/mpeg",mp4:"video/mp4",mpeg:"video/mpeg",mpkg:"application/vnd.apple.installer+xml",odt:"application/vnd.oasis.opendocument.text",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",opus:"audio/opus",otf:"font/otf",png:"image/png",pdf:"application/pdf",php:"application/x-httpd-php",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",rar:"application/vnd.rar",rtf:"application/rtf",sh:"application/x-sh",svg:"image/svg+xml",swf:"application/x-shockwave-flash",tar:"application/x-tar",tif:"image/tiff",tiff:"image/tiff",ts:"video/mp2t",ttf:"font/ttf",txt:"text/plain",vsd:"application/vnd.visio",wav:"audio/wav",weba:"audio/webm",webm:"video/webm",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xml:"application/xml",xul:"application/vnd.mozilla.xul+xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2","7z":"application/x-7z-compressed"})[e.slice(e.lastIndexOf(".")+1).toLowerCase()]}async uploadFileFromPath(e,t,n){var r,i,s;let o,a=0,l=0,u=new nh(new Response),c="upload";try{if(!(o=await na.open(e,"r")))throw Error("Failed to open file");for(a=(await o.stat()).size;l<a;){let e=Math.min(8388608,a-l);l+e>=a&&(c+=", finalize");let s=new Uint8Array(e),{bytesRead:d}=await o.read(s,0,e,l);if(d!==e)throw Error(`Failed to read ${e} bytes from file at offset ${l}. bytes actually read: ${d}`);let p=new Blob([s]),h=0,f=1e3;for(;h<3&&(null==(r=null==(u=await n.request({path:"",body:p,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:t,headers:{"X-Goog-Upload-Command":c,"X-Goog-Upload-Offset":String(l),"Content-Length":String(d)}}}))?void 0:u.headers)||!r[ii]);)h++,await ia(f),f*=2;if(l+=d,(null==(i=null==u?void 0:u.headers)?void 0:i[ii])!=="active")break;if(a<=l)throw Error("All content has been uploaded, but the upload status is not finalized.")}let d=await (null==u?void 0:u.json());if((null==(s=null==u?void 0:u.headers)?void 0:s[ii])!=="final")throw Error("Failed to upload file: Upload status is not finalized.");return d.file}finally{o&&await o.close()}}}function iu(e){var t,n,r;return null!=(r=null==(n=null==(t=null==process?void 0:process.env)?void 0:t[e])?void 0:n.trim())?r:void 0}function ic(e,t,n,r,i){if("m"===r)throw TypeError("Private method is not writable");if("a"===r&&!i)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n}function id(e,t,n,r){if("a"===n&&!r)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)}let ip=function(){let{crypto:e}=globalThis;if(e?.randomUUID)return ip=e.randomUUID.bind(e),e.randomUUID();let t=new Uint8Array(1),n=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(e^n()&15>>e/4).toString(16))};function ih(e){return"object"==typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}let im=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){let t=Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return Error(JSON.stringify(e))}catch{}}return Error(e)};class ig extends Error{}class i_ extends ig{constructor(e,t,n,r){super(`${i_.makeMessage(e,t,n)}`),this.status=e,this.headers=r,this.requestID=r?.get("x-request-id"),this.error=t,this.code=t?.code,this.param=t?.param,this.type=t?.type}static makeMessage(e,t,n){let r=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,n,r){if(!e||!r)return new iv({message:n,cause:im(t)});let i=t?.error;return 400===e?new ib(e,i,n,r):401===e?new iS(e,i,n,r):403===e?new iT(e,i,n,r):404===e?new iO(e,i,n,r):409===e?new iA(e,i,n,r):422===e?new iw(e,i,n,r):429===e?new iC(e,i,n,r):e>=500?new iI(e,i,n,r):new i_(e,i,n,r)}}class iy extends i_{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class iv extends i_{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class iE extends iv{constructor({message:e}={}){super({message:e??"Request timed out."})}}class ib extends i_{}class iS extends i_{}class iT extends i_{}class iO extends i_{}class iA extends i_{}class iw extends i_{}class iC extends i_{}class iI extends i_{}class iR extends ig{constructor(){super("Could not parse response content as the length limit was reached")}}class iP extends ig{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class iN extends Error{constructor(e){super(e)}}let ix=/^[a-z][a-z0-9+.-]*:/i,ik=e=>(ik=Array.isArray)(e),iM=ik;function iD(e){return"object"!=typeof e?{}:e??{}}function iL(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}let iU=e=>new Promise(t=>setTimeout(t,e)),ij="6.8.1",iq=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",i$=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";function iG(...e){let t=globalThis.ReadableStream;if(void 0===t)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function iH(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return iG({start(){},async pull(e){let{done:n,value:r}=await t.next();n?e.close():e.enqueue(r)},async cancel(){await t.return?.()}})}function iF(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function iB(e){if(null===e||"object"!=typeof e)return;if(e[Symbol.asyncIterator])return void await e[Symbol.asyncIterator]().return?.();let t=e.getReader(),n=t.cancel();t.releaseLock(),await n}let iV=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)}),iW="RFC3986",iJ=e=>String(e),iK={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:iJ},iY=(e,t)=>(iY=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty))(e,t),iX=(()=>{let e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})();function iz(e,t){if(ik(e)){let n=[];for(let r=0;r<e.length;r+=1)n.push(t(e[r]));return n}return t(e)}let iQ={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},iZ=function(e,t){Array.prototype.push.apply(e,ik(t)?t:[t])},i0={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,n,r,i)=>{if(0===e.length)return e;let s=e;if("symbol"==typeof e?s=Symbol.prototype.toString.call(e):"string"!=typeof e&&(s=String(e)),"iso-8859-1"===n)return escape(s).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});let o="";for(let e=0;e<s.length;e+=1024){let t=s.length>=1024?s.slice(e,e+1024):s,n=[];for(let e=0;e<t.length;++e){let r=t.charCodeAt(e);if(45===r||46===r||95===r||126===r||r>=48&&r<=57||r>=65&&r<=90||r>=97&&r<=122||"RFC1738"===i&&(40===r||41===r)){n[n.length]=t.charAt(e);continue}if(r<128){n[n.length]=iX[r];continue}if(r<2048){n[n.length]=iX[192|r>>6]+iX[128|63&r];continue}if(r<55296||r>=57344){n[n.length]=iX[224|r>>12]+iX[128|r>>6&63]+iX[128|63&r];continue}e+=1,r=65536+((1023&r)<<10|1023&t.charCodeAt(e)),n[n.length]=iX[240|r>>18]+iX[128|r>>12&63]+iX[128|r>>6&63]+iX[128|63&r]}o+=n.join("")}return o},encodeValuesOnly:!1,format:iW,formatter:iJ,indices:!1,serializeDate:e=>(n??(n=Function.prototype.call.bind(Date.prototype.toISOString)))(e),skipNulls:!1,strictNullHandling:!1},i1={};function i2(e){let t;return(r??(r=(t=new globalThis.TextEncoder).encode.bind(t)))(e)}function i4(e){let t;return(i??(i=(t=new globalThis.TextDecoder).decode.bind(t)))(e)}class i8{constructor(){eZ.set(this,void 0),e0.set(this,void 0),ic(this,eZ,new Uint8Array,"f"),ic(this,e0,null,"f")}decode(e){let t;if(null==e)return[];let n=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?i2(e):e;ic(this,eZ,function(e){let t=0;for(let n of e)t+=n.length;let n=new Uint8Array(t),r=0;for(let t of e)n.set(t,r),r+=t.length;return n}([id(this,eZ,"f"),n]),"f");let r=[];for(;null!=(t=function(e,t){for(let n=t??0;n<e.length;n++){if(10===e[n])return{preceding:n,index:n+1,carriage:!1};if(13===e[n])return{preceding:n,index:n+1,carriage:!0}}return null}(id(this,eZ,"f"),id(this,e0,"f")));){if(t.carriage&&null==id(this,e0,"f")){ic(this,e0,t.index,"f");continue}if(null!=id(this,e0,"f")&&(t.index!==id(this,e0,"f")+1||t.carriage)){r.push(i4(id(this,eZ,"f").subarray(0,id(this,e0,"f")-1))),ic(this,eZ,id(this,eZ,"f").subarray(id(this,e0,"f")),"f"),ic(this,e0,null,"f");continue}let e=null!==id(this,e0,"f")?t.preceding-1:t.preceding,n=i4(id(this,eZ,"f").subarray(0,e));r.push(n),ic(this,eZ,id(this,eZ,"f").subarray(t.index),"f"),ic(this,e0,null,"f")}return r}flush(){return id(this,eZ,"f").length?this.decode("\n"):[]}}eZ=new WeakMap,e0=new WeakMap,i8.NEWLINE_CHARS=new Set(["\n","\r"]),i8.NEWLINE_REGEXP=/\r\n|[\n\r]/g;let i6={off:0,error:200,warn:300,info:400,debug:500},i3=(e,t,n)=>{if(e){if(Object.prototype.hasOwnProperty.call(i6,e))return e;st(n).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(i6))}`)}};function i9(){}function i5(e,t,n){return!t||i6[e]>i6[n]?i9:t[e].bind(t)}let i7={error:i9,warn:i9,info:i9,debug:i9},se=new WeakMap;function st(e){let t=e.logger,n=e.logLevel??"off";if(!t)return i7;let r=se.get(t);if(r&&r[0]===n)return r[1];let i={error:i5("error",t,n),warn:i5("warn",t,n),info:i5("info",t,n),debug:i5("debug",t,n)};return se.set(t,[n,i]),i}let sn=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,"authorization"===e.toLowerCase()||"cookie"===e.toLowerCase()||"set-cookie"===e.toLowerCase()?"***":t]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);class sr{constructor(e,t,n){this.iterator=e,e1.set(this,void 0),this.controller=t,ic(this,e1,n,"f")}static fromSSEResponse(e,t,n){let r=!1,i=n?st(n):console;async function*s(){if(r)throw new ig("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let n=!1;try{for await(let r of si(e,t))if(!n){if(r.data.startsWith("[DONE]")){n=!0;continue}if(null!==r.event&&r.event.startsWith("thread.")){let e;try{e=JSON.parse(r.data)}catch(e){throw console.error("Could not parse message into JSON:",r.data),console.error("From chunk:",r.raw),e}if("error"==r.event)throw new i_(void 0,e.error,e.message,void 0);yield{event:r.event,data:e}}else{let t;try{t=JSON.parse(r.data)}catch(e){throw i.error("Could not parse message into JSON:",r.data),i.error("From chunk:",r.raw),e}if(t&&t.error)throw new i_(void 0,t.error,void 0,e.headers);yield t}}n=!0}catch(e){if(ih(e))return;throw e}finally{n||t.abort()}}return new sr(s,t,n)}static fromReadableStream(e,t,n){let r=!1;async function*i(){let t=new i8;for await(let n of iF(e))for(let e of t.decode(n))yield e;for(let e of t.flush())yield e}return new sr(async function*(){if(r)throw new ig("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let e=!1;try{for await(let t of i())!e&&t&&(yield JSON.parse(t));e=!0}catch(e){if(ih(e))return;throw e}finally{e||t.abort()}},t,n)}[(e1=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let e=[],t=[],n=this.iterator(),r=r=>({next:()=>{if(0===r.length){let r=n.next();e.push(r),t.push(r)}return r.shift()}});return[new sr(()=>r(e),this.controller,id(this,e1,"f")),new sr(()=>r(t),this.controller,id(this,e1,"f"))]}toReadableStream(){let e,t=this;return iG({async start(){e=t[Symbol.asyncIterator]()},async pull(t){try{let{value:n,done:r}=await e.next();if(r)return t.close();let i=i2(JSON.stringify(n)+"\n");t.enqueue(i)}catch(e){t.error(e)}},async cancel(){await e.return?.()}})}}async function*si(e,t){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new ig("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new ig("Attempted to iterate over a response with no body")}let n=new so,r=new i8;for await(let t of ss(iF(e.body)))for(let e of r.decode(t)){let t=n.decode(e);t&&(yield t)}for(let e of r.flush()){let t=n.decode(e);t&&(yield t)}}async function*ss(e){let t=new Uint8Array;for await(let n of e){let e;if(null==n)continue;let r=n instanceof ArrayBuffer?new Uint8Array(n):"string"==typeof n?i2(n):n,i=new Uint8Array(t.length+r.length);for(i.set(t),i.set(r,t.length),t=i;-1!==(e=function(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1]||13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return -1}(t));)yield t.slice(0,e),t=t.slice(e)}t.length>0&&(yield t)}class so{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){var t;let n;if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[r,i,s]=-1!==(n=(t=e).indexOf(":"))?[t.substring(0,n),":",t.substring(n+1)]:[t,"",""];return s.startsWith(" ")&&(s=s.substring(1)),"event"===r?this.event=s:"data"===r&&this.data.push(s),null}}async function sa(e,t){let{response:n,requestLogID:r,retryOfRequestLogID:i,startTime:s}=t,o=await (async()=>{if(t.options.stream)return(st(e).debug("response",n.status,n.url,n.headers,n.body),t.options.__streamClass)?t.options.__streamClass.fromSSEResponse(n,t.controller,e):sr.fromSSEResponse(n,t.controller,e);if(204===n.status)return null;if(t.options.__binaryResponse)return n;let r=n.headers.get("content-type"),i=r?.split(";")[0]?.trim();return i?.includes("application/json")||i?.endsWith("+json")?sl(await n.json(),n):await n.text()})();return st(e).debug(`[${r}] response parsed`,sn({retryOfRequestLogID:i,url:n.url,status:n.status,body:o,durationMs:Date.now()-s})),o}function sl(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}class su extends Promise{constructor(e,t,n=sa){super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=n,e2.set(this,void 0),ic(this,e2,e,"f")}_thenUnwrap(e){return new su(id(this,e2,"f"),this.responsePromise,async(t,n)=>sl(e(await this.parseResponse(t,n),n),n.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(id(this,e2,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}e2=new WeakMap;class sc{constructor(e,t,n,r){e4.set(this,void 0),ic(this,e4,e,"f"),this.options=r,this.response=t,this.body=n}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new ig("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await id(this,e4,"f").requestAPIList(this.constructor,e)}async *iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async *[(e4=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}}class sd extends su{constructor(e,t,n){super(e,t,async(e,t)=>new n(e,t.response,await sa(e,t),t.options))}async *[Symbol.asyncIterator](){for await(let e of(await this))yield e}}class sp extends sc{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class sh extends sc{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){let e=this.getPaginatedItems(),t=e[e.length-1]?.id;return t?{...this.options,query:{...iD(this.options.query),after:t}}:null}}class sf extends sc{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.has_more=n.has_more||!1,this.last_id=n.last_id||""}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){let e=this.last_id;return e?{...this.options,query:{...iD(this.options.query),after:e}}:null}}let sm=()=>{if("undefined"==typeof File){let{process:e}=globalThis;throw Error("`File` is not defined as a global, which is required for file uploads."+("string"==typeof e?.versions?.node&&20>parseInt(e.versions.node.split("."))?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function sg(e,t,n){return sm(),new File(e,t??"unknown_file",n)}function s_(e){return("object"==typeof e&&null!==e&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}let sy=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],sv=async(e,t)=>sO(e.body)?{...e,body:await sS(e.body,t)}:e,sE=async(e,t)=>({...e,body:await sS(e.body,t)}),sb=new WeakMap,sS=async(e,t)=>{if(!await function(e){let t="function"==typeof e?e:e.fetch,n=sb.get(t);if(n)return n;let r=(async()=>{try{let e="Response"in t?t.Response:(await t("data:,")).constructor,n=new FormData;if(n.toString()===await new e(n).text())return!1;return!0}catch{return!0}})();return sb.set(t,r),r}(t))throw TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let n=new FormData;return await Promise.all(Object.entries(e||{}).map(([e,t])=>sA(n,e,t))),n},sT=e=>e instanceof Blob&&"name"in e,sO=e=>{if("object"==typeof e&&null!==e&&(e instanceof Response||sy(e)||sT(e)))return!0;if(Array.isArray(e))return e.some(sO);if(e&&"object"==typeof e){for(let t in e)if(sO(e[t]))return!0}return!1},sA=async(e,t,n)=>{if(void 0!==n){if(null==n)throw TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)e.append(t,String(n));else if(n instanceof Response)e.append(t,sg([await n.blob()],s_(n)));else if(sy(n))e.append(t,sg([await new Response(iH(n)).blob()],s_(n)));else if(sT(n))e.append(t,n,s_(n));else if(Array.isArray(n))await Promise.all(n.map(n=>sA(e,t+"[]",n)));else if("object"==typeof n)await Promise.all(Object.entries(n).map(([n,r])=>sA(e,`${t}[${n}]`,r)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`)}},sw=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer;async function sC(e,t,n){let r,i;if(sm(),null!=(r=e=await e)&&"object"==typeof r&&"string"==typeof r.name&&"number"==typeof r.lastModified&&sw(r))return e instanceof File?e:sg([await e.arrayBuffer()],e.name);if(null!=(i=e)&&"object"==typeof i&&"string"==typeof i.url&&"function"==typeof i.blob){let r=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),sg(await sI(r),t,n)}let s=await sI(e);if(t||(t=s_(e)),!n?.type){let e=s.find(e=>"object"==typeof e&&"type"in e&&e.type);"string"==typeof e&&(n={...n,type:e})}return sg(s,t,n)}async function sI(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(sw(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else if(sy(e))for await(let n of e)t.push(...await sI(n));else{let t=e?.constructor?.name;throw Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:""}${function(e){if("object"!=typeof e||null===e)return"";let t=Object.getOwnPropertyNames(e);return`; props: [${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`)}return t}class sR{constructor(e){this._client=e}}function sP(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}let sN=Object.freeze(Object.create(null)),sx=((e=sP)=>function(t,...n){let r;if(1===t.length)return t[0];let i=!1,s=[],o=t.reduce((t,r,o)=>{/[?#]/.test(r)&&(i=!0);let a=n[o],l=(i?encodeURIComponent:e)(""+a);return o!==n.length&&(null==a||"object"==typeof a&&a.toString===Object.getPrototypeOf(Object.getPrototypeOf(a.hasOwnProperty??sN)??sN)?.toString)&&(l=a+"",s.push({start:t.length+r.length,length:l.length,error:`Value of type ${Object.prototype.toString.call(a).slice(8,-1)} is not a valid path parameter`})),t+r+(o===n.length?"":l)},""),a=o.split(/[?#]/,1)[0],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;for(;null!==(r=l.exec(a));)s.push({start:r.index,length:r[0].length,error:`Value "${r[0]}" can't be safely passed as a path parameter`});if(s.sort((e,t)=>e.start-t.start),s.length>0){let e=0,t=s.reduce((t,n)=>{let r=" ".repeat(n.start-e),i="^".repeat(n.length);return e=n.start+n.length,t+r+i},"");throw new ig(`Path parameters result in path with invalid segments:
${s.map(e=>e.error).join("\n")}
${o}
${t}`)}return o})(sP);class sk extends sR{list(e,t={},n){return this._client.getAPIList(sx`/chat/completions/${e}/messages`,sh,{query:t,...n})}}function sM(e){return void 0!==e&&"function"in e&&void 0!==e.function}function sD(e){return e?.$brand==="auto-parseable-response-format"}function sL(e){return e?.$brand==="auto-parseable-tool"}function sU(e,t){let n=e.choices.map(e=>{var n,r;if("length"===e.finish_reason)throw new iR;if("content_filter"===e.finish_reason)throw new iP;return sq(e.message.tool_calls),{...e,message:{...e.message,...e.message.tool_calls?{tool_calls:e.message.tool_calls?.map(e=>{var n,r;let i;return n=t,r=e,i=n.tools?.find(e=>sM(e)&&e.function?.name===r.function.name),{...r,function:{...r.function,parsed_arguments:sL(i)?i.$parseRaw(r.function.arguments):i?.function.strict?JSON.parse(r.function.arguments):null}}})??void 0}:void 0,parsed:e.message.content&&!e.message.refusal?(n=t,r=e.message.content,n.response_format?.type!=="json_schema"?null:n.response_format?.type==="json_schema"?"$parseRaw"in n.response_format?n.response_format.$parseRaw(r):JSON.parse(r):null):null}}});return{...e,choices:n}}function sj(e){return!!sD(e.response_format)||(e.tools?.some(e=>sL(e)||"function"===e.type&&!0===e.function.strict)??!1)}function sq(e){for(let t of e||[])if("function"!==t.type)throw new ig(`Currently only \`function\` tool calls are supported; Received \`${t.type}\``)}let s$=e=>e?.role==="assistant",sG=e=>e?.role==="tool";class sH{constructor(){e8.add(this),this.controller=new AbortController,e6.set(this,void 0),e3.set(this,()=>{}),e9.set(this,()=>{}),e5.set(this,void 0),e7.set(this,()=>{}),te.set(this,()=>{}),tt.set(this,{}),tn.set(this,!1),tr.set(this,!1),ti.set(this,!1),ts.set(this,!1),ic(this,e6,new Promise((e,t)=>{ic(this,e3,e,"f"),ic(this,e9,t,"f")}),"f"),ic(this,e5,new Promise((e,t)=>{ic(this,e7,e,"f"),ic(this,te,t,"f")}),"f"),id(this,e6,"f").catch(()=>{}),id(this,e5,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},id(this,e8,"m",to).bind(this))},0)}_connected(){this.ended||(id(this,e3,"f").call(this),this._emit("connect"))}get ended(){return id(this,tn,"f")}get errored(){return id(this,tr,"f")}get aborted(){return id(this,ti,"f")}abort(){this.controller.abort()}on(e,t){return(id(this,tt,"f")[e]||(id(this,tt,"f")[e]=[])).push({listener:t}),this}off(e,t){let n=id(this,tt,"f")[e];if(!n)return this;let r=n.findIndex(e=>e.listener===t);return r>=0&&n.splice(r,1),this}once(e,t){return(id(this,tt,"f")[e]||(id(this,tt,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{ic(this,ts,!0,"f"),"error"!==e&&this.once("error",n),this.once(e,t)})}async done(){ic(this,ts,!0,"f"),await id(this,e5,"f")}_emit(e,...t){if(id(this,tn,"f"))return;"end"===e&&(ic(this,tn,!0,"f"),id(this,e7,"f").call(this));let n=id(this,tt,"f")[e];if(n&&(id(this,tt,"f")[e]=n.filter(e=>!e.once),n.forEach(({listener:e})=>e(...t))),"abort"===e){let e=t[0];id(this,ts,"f")||n?.length||Promise.reject(e),id(this,e9,"f").call(this,e),id(this,te,"f").call(this,e),this._emit("end");return}if("error"===e){let e=t[0];id(this,ts,"f")||n?.length||Promise.reject(e),id(this,e9,"f").call(this,e),id(this,te,"f").call(this,e),this._emit("end")}}_emitFinal(){}}e6=new WeakMap,e3=new WeakMap,e9=new WeakMap,e5=new WeakMap,e7=new WeakMap,te=new WeakMap,tt=new WeakMap,tn=new WeakMap,tr=new WeakMap,ti=new WeakMap,ts=new WeakMap,e8=new WeakSet,to=function(e){if(ic(this,tr,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new iy),e instanceof iy)return ic(this,ti,!0,"f"),this._emit("abort",e);if(e instanceof ig)return this._emit("error",e);if(e instanceof Error){let t=new ig(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new ig(String(e)))};class sF extends sH{constructor(){super(...arguments),ta.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),sG(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(s$(e)&&e.tool_calls)for(let t of e.tool_calls)"function"===t.type&&this._emit("functionToolCall",t.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new ig("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),id(this,ta,"m",tl).call(this)}async finalMessage(){return await this.done(),id(this,ta,"m",tu).call(this)}async finalFunctionToolCall(){return await this.done(),id(this,ta,"m",tc).call(this)}async finalFunctionToolCallResult(){return await this.done(),id(this,ta,"m",td).call(this)}async totalUsage(){return await this.done(),id(this,ta,"m",tp).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=id(this,ta,"m",tu).call(this);t&&this._emit("finalMessage",t);let n=id(this,ta,"m",tl).call(this);n&&this._emit("finalContent",n);let r=id(this,ta,"m",tc).call(this);r&&this._emit("finalFunctionToolCall",r);let i=id(this,ta,"m",td).call(this);null!=i&&this._emit("finalFunctionToolCallResult",i),this._chatCompletions.some(e=>e.usage)&&this._emit("totalUsage",id(this,ta,"m",tp).call(this))}async _createChatCompletion(e,t,n){let r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),id(this,ta,"m",th).call(this,t);let i=await e.chat.completions.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(sU(i,t))}async _runChatCompletion(e,t,n){for(let e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,n)}async _runTools(e,t,n){let r="tool",{tool_choice:i="auto",stream:s,...o}=t,a="string"!=typeof i&&"function"===i.type&&i?.function?.name,{maxChatCompletions:l=10}=n||{},u=t.tools.map(e=>{if(sL(e)){if(!e.$callback)throw new ig("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e}),c={};for(let e of u)"function"===e.type&&(c[e.function.name||e.function.function.name]=e.function);let d="tools"in t?u.map(e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e):void 0;for(let e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){let t=await this._createChatCompletion(e,{...o,tool_choice:i,tools:d,messages:[...this.messages]},n),s=t.choices[0]?.message;if(!s)throw new ig("missing message in ChatCompletion response");if(!s.tool_calls?.length)break;for(let e of s.tool_calls){let t;if("function"!==e.type)continue;let n=e.id,{name:i,arguments:s}=e.function,o=c[i];if(o){if(a&&a!==i){let e=`Invalid tool_call: ${JSON.stringify(i)}. ${JSON.stringify(a)} requested. Please try again`;this._addMessage({role:r,tool_call_id:n,content:e});continue}}else{let e=`Invalid tool_call: ${JSON.stringify(i)}. Available options are: ${Object.keys(c).map(e=>JSON.stringify(e)).join(", ")}. Please try again`;this._addMessage({role:r,tool_call_id:n,content:e});continue}try{t="function"==typeof o.parse?await o.parse(s):s}catch(t){let e=t instanceof Error?t.message:String(t);this._addMessage({role:r,tool_call_id:n,content:e});continue}let l=await o.function(t,this),u=id(this,ta,"m",tf).call(this,l);if(this._addMessage({role:r,tool_call_id:n,content:u}),a)return}}}}ta=new WeakSet,tl=function(){return id(this,ta,"m",tu).call(this).content??null},tu=function(){let e=this.messages.length;for(;e-- >0;){let t=this.messages[e];if(s$(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new ig("stream ended without producing a ChatCompletionMessage with role=assistant")},tc=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(s$(t)&&t?.tool_calls?.length)return t.tool_calls.filter(e=>"function"===e.type).at(-1)?.function}},td=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(sG(t)&&null!=t.content&&"string"==typeof t.content&&this.messages.some(e=>"assistant"===e.role&&e.tool_calls?.some(e=>"function"===e.type&&e.id===t.tool_call_id)))return t.content}},tp=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},th=function(e){if(null!=e.n&&e.n>1)throw new ig("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},tf=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class sB extends sF{static runTools(e,t,n){let r=new sB,i={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,i)),r}_addMessage(e,t=!0){super._addMessage(e,t),s$(e)&&e.content&&this._emit("content",e.content)}}let sV=511;class sW extends Error{}class sJ extends Error{}let sK=e=>(function(e,t=sV){var n,r;let i,s,o,a,l,u,c,d,p,h;if("string"!=typeof e)throw TypeError(`expecting str, got ${typeof e}`);if(!e.trim())throw Error(`${e} is empty`);return n=e.trim(),r=t,i=n.length,s=0,o=e=>{throw new sW(`${e} at position ${s}`)},a=e=>{throw new sJ(`${e} at position ${s}`)},l=()=>(h(),s>=i&&o("Unexpected end of input"),'"'===n[s])?u():"{"===n[s]?c():"["===n[s]?d():"null"===n.substring(s,s+4)||16&r&&i-s<4&&"null".startsWith(n.substring(s))?(s+=4,null):"true"===n.substring(s,s+4)||32&r&&i-s<4&&"true".startsWith(n.substring(s))?(s+=4,!0):"false"===n.substring(s,s+5)||32&r&&i-s<5&&"false".startsWith(n.substring(s))?(s+=5,!1):"Infinity"===n.substring(s,s+8)||128&r&&i-s<8&&"Infinity".startsWith(n.substring(s))?(s+=8,1/0):"-Infinity"===n.substring(s,s+9)||256&r&&1<i-s&&i-s<9&&"-Infinity".startsWith(n.substring(s))?(s+=9,-1/0):"NaN"===n.substring(s,s+3)||64&r&&i-s<3&&"NaN".startsWith(n.substring(s))?(s+=3,NaN):p(),u=()=>{let e=s,t=!1;for(s++;s<i&&('"'!==n[s]||t&&"\\"===n[s-1]);)t="\\"===n[s]&&!t,s++;if('"'==n.charAt(s))try{return JSON.parse(n.substring(e,++s-Number(t)))}catch(e){a(String(e))}else if(1&r)try{return JSON.parse(n.substring(e,s-Number(t))+'"')}catch(t){return JSON.parse(n.substring(e,n.lastIndexOf("\\"))+'"')}o("Unterminated string literal")},c=()=>{s++,h();let e={};try{for(;"}"!==n[s];){if(h(),s>=i&&8&r)return e;let t=u();h(),s++;try{let n=l();Object.defineProperty(e,t,{value:n,writable:!0,enumerable:!0,configurable:!0})}catch(t){if(8&r)return e;throw t}h(),","===n[s]&&s++}}catch(t){if(8&r)return e;o("Expected '}' at end of object")}return s++,e},d=()=>{s++;let e=[];try{for(;"]"!==n[s];)e.push(l()),h(),","===n[s]&&s++}catch(t){if(4&r)return e;o("Expected ']' at end of array")}return s++,e},p=()=>{if(0===s){"-"===n&&2&r&&o("Not sure what '-' is");try{return JSON.parse(n)}catch(e){if(2&r)try{if("."===n[n.length-1])return JSON.parse(n.substring(0,n.lastIndexOf(".")));return JSON.parse(n.substring(0,n.lastIndexOf("e")))}catch(e){}a(String(e))}}let e=s;for("-"===n[s]&&s++;n[s]&&!",]}".includes(n[s]);)s++;s!=i||2&r||o("Unterminated number literal");try{return JSON.parse(n.substring(e,s))}catch(t){"-"===n.substring(e,s)&&2&r&&o("Not sure what '-' is");try{return JSON.parse(n.substring(e,n.lastIndexOf("e")))}catch(e){a(String(e))}}},h=()=>{for(;s<i&&" \n\r	".includes(n[s]);)s++},l()})(e,2^sV);class sY extends sF{constructor(e){super(),tm.add(this),tg.set(this,void 0),t_.set(this,void 0),ty.set(this,void 0),ic(this,tg,e,"f"),ic(this,t_,[],"f")}get currentChatCompletionSnapshot(){return id(this,ty,"f")}static fromReadableStream(e){let t=new sY(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,n){let r=new sY(t);return r._run(()=>r._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createChatCompletion(e,t,n){super._createChatCompletion;let r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),id(this,tm,"m",tv).call(this);let i=await e.chat.completions.create({...t,stream:!0},{...n,signal:this.controller.signal});for await(let e of(this._connected(),i))id(this,tm,"m",tb).call(this,e);if(i.controller.signal?.aborted)throw new iy;return this._addChatCompletion(id(this,tm,"m",tO).call(this))}async _fromReadableStream(e,t){let n,r=t?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),id(this,tm,"m",tv).call(this),this._connected();let i=sr.fromReadableStream(e,this.controller);for await(let e of i)n&&n!==e.id&&this._addChatCompletion(id(this,tm,"m",tO).call(this)),id(this,tm,"m",tb).call(this,e),n=e.id;if(i.controller.signal?.aborted)throw new iy;return this._addChatCompletion(id(this,tm,"m",tO).call(this))}[(tg=new WeakMap,t_=new WeakMap,ty=new WeakMap,tm=new WeakSet,tv=function(){this.ended||ic(this,ty,void 0,"f")},tE=function(e){let t=id(this,t_,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},id(this,t_,"f")[e.index]=t),t},tb=function(e){if(this.ended)return;let t=id(this,tm,"m",tw).call(this,e);for(let n of(this._emit("chunk",e,t),e.choices)){let e=t.choices[n.index];null!=n.delta.content&&e.message?.role==="assistant"&&e.message?.content&&(this._emit("content",n.delta.content,e.message.content),this._emit("content.delta",{delta:n.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=n.delta.refusal&&e.message?.role==="assistant"&&e.message?.refusal&&this._emit("refusal.delta",{delta:n.delta.refusal,snapshot:e.message.refusal}),n.logprobs?.content!=null&&e.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:n.logprobs?.content,snapshot:e.logprobs?.content??[]}),n.logprobs?.refusal!=null&&e.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:n.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]});let r=id(this,tm,"m",tE).call(this,e);for(let t of(e.finish_reason&&(id(this,tm,"m",tT).call(this,e),null!=r.current_tool_call_index&&id(this,tm,"m",tS).call(this,e,r.current_tool_call_index)),n.delta.tool_calls??[]))r.current_tool_call_index!==t.index&&(id(this,tm,"m",tT).call(this,e),null!=r.current_tool_call_index&&id(this,tm,"m",tS).call(this,e,r.current_tool_call_index)),r.current_tool_call_index=t.index;for(let t of n.delta.tool_calls??[]){let n=e.message.tool_calls?.[t.index];n?.type&&(n?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:n.function?.name,index:t.index,arguments:n.function.arguments,parsed_arguments:n.function.parsed_arguments,arguments_delta:t.function?.arguments??""}):sQ(n?.type))}}},tS=function(e,t){if(id(this,tm,"m",tE).call(this,e).done_tool_calls.has(t))return;let n=e.message.tool_calls?.[t];if(!n)throw Error("no tool call snapshot");if(!n.type)throw Error("tool call snapshot missing `type`");if("function"===n.type){let e=id(this,tg,"f")?.tools?.find(e=>sM(e)&&e.function.name===n.function.name);this._emit("tool_calls.function.arguments.done",{name:n.function.name,index:t,arguments:n.function.arguments,parsed_arguments:sL(e)?e.$parseRaw(n.function.arguments):e?.function.strict?JSON.parse(n.function.arguments):null})}else sQ(n.type)},tT=function(e){let t=id(this,tm,"m",tE).call(this,e);if(e.message.content&&!t.content_done){t.content_done=!0;let n=id(this,tm,"m",tA).call(this);this._emit("content.done",{content:e.message.content,parsed:n?n.$parseRaw(e.message.content):null})}e.message.refusal&&!t.refusal_done&&(t.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),e.logprobs?.content&&!t.logprobs_content_done&&(t.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),e.logprobs?.refusal&&!t.logprobs_refusal_done&&(t.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},tO=function(){if(this.ended)throw new ig("stream has ended, this shouldn't happen");let e=id(this,ty,"f");if(!e)throw new ig("request ended without sending any chunks");return ic(this,ty,void 0,"f"),ic(this,t_,[],"f"),function(e,t){var n;let{id:r,choices:i,created:s,model:o,system_fingerprint:a,...l}=e;return n={...l,id:r,choices:i.map(({message:t,finish_reason:n,index:r,logprobs:i,...s})=>{if(!n)throw new ig(`missing finish_reason for choice ${r}`);let{content:o=null,function_call:a,tool_calls:l,...u}=t,c=t.role;if(!c)throw new ig(`missing role for choice ${r}`);if(a){let{arguments:e,name:l}=a;if(null==e)throw new ig(`missing function_call.arguments for choice ${r}`);if(!l)throw new ig(`missing function_call.name for choice ${r}`);return{...s,message:{content:o,function_call:{arguments:e,name:l},role:c,refusal:t.refusal??null},finish_reason:n,index:r,logprobs:i}}return l?{...s,index:r,finish_reason:n,logprobs:i,message:{...u,role:c,content:o,refusal:t.refusal??null,tool_calls:l.map((t,n)=>{let{function:i,type:s,id:o,...a}=t,{arguments:l,name:u,...c}=i||{};if(null==o)throw new ig(`missing choices[${r}].tool_calls[${n}].id
${sX(e)}`);if(null==s)throw new ig(`missing choices[${r}].tool_calls[${n}].type
${sX(e)}`);if(null==u)throw new ig(`missing choices[${r}].tool_calls[${n}].function.name
${sX(e)}`);if(null==l)throw new ig(`missing choices[${r}].tool_calls[${n}].function.arguments
${sX(e)}`);return{...a,id:o,type:s,function:{...c,name:u,arguments:l}}})}}:{...s,message:{...u,content:o,role:c,refusal:t.refusal??null},finish_reason:n,index:r,logprobs:i}}),created:s,model:o,object:"chat.completion",...a?{system_fingerprint:a}:{}},t&&sj(t)?sU(n,t):{...n,choices:n.choices.map(e=>(sq(e.message.tool_calls),{...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}}))}}(e,id(this,tg,"f"))},tA=function(){let e=id(this,tg,"f")?.response_format;return sD(e)?e:null},tw=function(e){var t,n,r,i;let s=id(this,ty,"f"),{choices:o,...a}=e;for(let{delta:o,finish_reason:l,index:u,logprobs:c=null,...d}of(s?Object.assign(s,a):s=ic(this,ty,{...a,choices:[]},"f"),e.choices)){let e=s.choices[u];if(e||(e=s.choices[u]={finish_reason:l,index:u,message:{},logprobs:c,...d}),c)if(e.logprobs){let{content:r,refusal:i,...s}=c;sz(s),Object.assign(e.logprobs,s),r&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...r)),i&&((n=e.logprobs).refusal??(n.refusal=[]),e.logprobs.refusal.push(...i))}else e.logprobs=Object.assign({},c);if(l&&(e.finish_reason=l,id(this,tg,"f")&&sj(id(this,tg,"f")))){if("length"===l)throw new iR;if("content_filter"===l)throw new iP}if(Object.assign(e,d),!o)continue;let{content:a,refusal:p,function_call:h,role:f,tool_calls:m,...g}=o;if(sz(g),Object.assign(e.message,g),p&&(e.message.refusal=(e.message.refusal||"")+p),f&&(e.message.role=f),h&&(e.message.function_call?(h.name&&(e.message.function_call.name=h.name),h.arguments&&((r=e.message.function_call).arguments??(r.arguments=""),e.message.function_call.arguments+=h.arguments)):e.message.function_call=h),a&&(e.message.content=(e.message.content||"")+a,!e.message.refusal&&id(this,tm,"m",tA).call(this)&&(e.message.parsed=sK(e.message.content))),m)for(let{index:t,id:n,type:r,function:s,...o}of(e.message.tool_calls||(e.message.tool_calls=[]),m)){let a=(i=e.message.tool_calls)[t]??(i[t]={});Object.assign(a,o),n&&(a.id=n),r&&(a.type=r),s&&(a.function??(a.function={name:s.name??"",arguments:""})),s?.name&&(a.function.name=s.name),s?.arguments&&(a.function.arguments+=s.arguments,function(e,t){if(!e||!("tools"in e)||!e.tools)return!1;let n=e.tools?.find(e=>sM(e)&&e.function?.name===t.function.name);return sM(n)&&(sL(n)||n?.function.strict||!1)}(id(this,tg,"f"),a)&&(a.function.parsed_arguments=sK(a.function.arguments)))}}return s},Symbol.asyncIterator)](){let e=[],t=[],n=!1;return this.on("chunk",n=>{let r=t.shift();r?r.resolve(n):e.push(n)}),this.on("end",()=>{for(let e of(n=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let r of(n=!0,t))r.reject(e);t.length=0}),this.on("error",e=>{for(let r of(n=!0,t))r.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((e,n)=>t.push({resolve:e,reject:n})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new sr(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function sX(e){return JSON.stringify(e)}function sz(e){}function sQ(e){}class sZ extends sY{static fromReadableStream(e){let t=new sZ(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,n){let r=new sZ(t),i={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,i)),r}}class s0 extends sR{constructor(){super(...arguments),this.messages=new sk(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(sx`/chat/completions/${e}`,t)}update(e,t,n){return this._client.post(sx`/chat/completions/${e}`,{body:t,...n})}list(e={},t){return this._client.getAPIList("/chat/completions",sh,{query:e,...t})}delete(e,t){return this._client.delete(sx`/chat/completions/${e}`,t)}parse(e,t){for(let t of e.tools??[]){if("function"!==t.type)throw new ig(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new ig(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}return this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(t=>sU(t,e))}runTools(e,t){return e.stream?sZ.runTools(this._client,e,t):sB.runTools(this._client,e,t)}stream(e,t){return sY.createChatCompletion(this._client,e,t)}}s0.Messages=sk;class s1 extends sR{constructor(){super(...arguments),this.completions=new s0(this._client)}}s1.Completions=s0,e.s([],98546);let s2=Symbol("brand.privateNullableHeaders"),s4=e=>{let t=new Headers,n=new Set;for(let r of e){let e=new Set;for(let[i,s]of function*(e){let t;if(!e)return;if(s2 in e){let{values:t,nulls:n}=e;for(let e of(yield*t.entries(),n))yield[e,null];return}let n=!1;for(let r of(e instanceof Headers?t=e.entries():iM(e)?t=e:(n=!0,t=Object.entries(e??{})),t)){let e=r[0];if("string"!=typeof e)throw TypeError("expected header name to be a string");let t=iM(r[1])?r[1]:[r[1]],i=!1;for(let r of t)void 0!==r&&(n&&!i&&(i=!0,yield[e,null]),yield[e,r])}}(r)){let r=i.toLowerCase();e.has(r)||(t.delete(i),e.add(r)),null===s?(t.delete(i),n.add(r)):(t.append(i,s),n.delete(r))}}return{[s2]:!0,values:t,nulls:n}};class s8 extends sR{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:s4([{Accept:"application/octet-stream"},t?.headers]),__binaryResponse:!0})}}class s6 extends sR{create(e,t){return this._client.post("/audio/transcriptions",sE({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}class s3 extends sR{create(e,t){return this._client.post("/audio/translations",sE({body:e,...t,__metadata:{model:e.model}},this._client))}}class s9 extends sR{constructor(){super(...arguments),this.transcriptions=new s6(this._client),this.translations=new s3(this._client),this.speech=new s8(this._client)}}s9.Transcriptions=s6,s9.Translations=s3,s9.Speech=s8;class s5 extends sR{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(sx`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",sh,{query:e,...t})}cancel(e,t){return this._client.post(sx`/batches/${e}/cancel`,t)}}class s7 extends sR{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:s4([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(sx`/assistants/${e}`,{...t,headers:s4([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,n){return this._client.post(sx`/assistants/${e}`,{body:t,...n,headers:s4([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e={},t){return this._client.getAPIList("/assistants",sh,{query:e,...t,headers:s4([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(sx`/assistants/${e}`,{...t,headers:s4([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class oe extends sR{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:s4([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class ot extends sR{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:s4([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class on extends sR{constructor(){super(...arguments),this.sessions=new oe(this._client),this.transcriptionSessions=new ot(this._client)}}on.Sessions=oe,on.TranscriptionSessions=ot;class or extends sR{create(e,t){return this._client.post("/chatkit/sessions",{body:e,...t,headers:s4([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}cancel(e,t){return this._client.post(sx`/chatkit/sessions/${e}/cancel`,{...t,headers:s4([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}}class oi extends sR{retrieve(e,t){return this._client.get(sx`/chatkit/threads/${e}`,{...t,headers:s4([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}list(e={},t){return this._client.getAPIList("/chatkit/threads",sf,{query:e,...t,headers:s4([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}delete(e,t){return this._client.delete(sx`/chatkit/threads/${e}`,{...t,headers:s4([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}listItems(e,t={},n){return this._client.getAPIList(sx`/chatkit/threads/${e}/items`,sf,{query:t,...n,headers:s4([{"OpenAI-Beta":"chatkit_beta=v1"},n?.headers])})}}class os extends sR{constructor(){super(...arguments),this.sessions=new or(this._client),this.threads=new oi(this._client)}}os.Sessions=or,os.Threads=oi;class oo extends sR{create(e,t,n){return this._client.post(sx`/threads/${e}/messages`,{body:t,...n,headers:s4([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,t,n){let{thread_id:r}=t;return this._client.get(sx`/threads/${r}/messages/${e}`,{...n,headers:s4([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,t,n){let{thread_id:r,...i}=t;return this._client.post(sx`/threads/${r}/messages/${e}`,{body:i,...n,headers:s4([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,t={},n){return this._client.getAPIList(sx`/threads/${e}/messages`,sh,{query:t,...n,headers:s4([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,t,n){let{thread_id:r}=t;return this._client.delete(sx`/threads/${r}/messages/${e}`,{...n,headers:s4([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}class oa extends sR{retrieve(e,t,n){let{thread_id:r,run_id:i,...s}=t;return this._client.get(sx`/threads/${r}/runs/${i}/steps/${e}`,{query:s,...n,headers:s4([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,t,n){let{thread_id:r,...i}=t;return this._client.getAPIList(sx`/threads/${r}/runs/${e}/steps`,sh,{query:i,...n,headers:s4([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}let ol=e=>void 0!==globalThis.process?globalThis.process.env?.[e]?.trim()??void 0:void 0!==globalThis.Deno?globalThis.Deno.env?.get?.(e)?.trim():void 0;class ou extends sH{constructor(){super(...arguments),tC.add(this),tR.set(this,[]),tP.set(this,{}),tN.set(this,{}),tx.set(this,void 0),tk.set(this,void 0),tM.set(this,void 0),tD.set(this,void 0),tL.set(this,void 0),tU.set(this,void 0),tj.set(this,void 0),tq.set(this,void 0),t$.set(this,void 0)}[(tR=new WeakMap,tP=new WeakMap,tN=new WeakMap,tx=new WeakMap,tk=new WeakMap,tM=new WeakMap,tD=new WeakMap,tL=new WeakMap,tU=new WeakMap,tj=new WeakMap,tq=new WeakMap,t$=new WeakMap,tC=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],n=!1;return this.on("event",n=>{let r=t.shift();r?r.resolve(n):e.push(n)}),this.on("end",()=>{for(let e of(n=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let r of(n=!0,t))r.reject(e);t.length=0}),this.on("error",e=>{for(let r of(n=!0,t))r.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((e,n)=>t.push({resolve:e,reject:n})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new tI;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){let n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();let r=sr.fromReadableStream(e,this.controller);for await(let e of r)id(this,tC,"m",tG).call(this,e);if(r.controller.signal?.aborted)throw new iy;return this._addRun(id(this,tC,"m",tH).call(this))}toReadableStream(){return new sr(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,r){let i=new tI;return i._run(()=>i._runToolAssistantStream(e,t,n,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createToolAssistantStream(e,t,n,r){let i=r?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let s={...n,stream:!0},o=await e.submitToolOutputs(t,s,{...r,signal:this.controller.signal});for await(let e of(this._connected(),o))id(this,tC,"m",tG).call(this,e);if(o.controller.signal?.aborted)throw new iy;return this._addRun(id(this,tC,"m",tH).call(this))}static createThreadAssistantStream(e,t,n){let r=new tI;return r._run(()=>r._threadAssistantStream(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}static createAssistantStream(e,t,n,r){let i=new tI;return i._run(()=>i._runAssistantStream(e,t,n,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return id(this,tj,"f")}currentRun(){return id(this,tq,"f")}currentMessageSnapshot(){return id(this,tx,"f")}currentRunStepSnapshot(){return id(this,t$,"f")}async finalRunSteps(){return await this.done(),Object.values(id(this,tP,"f"))}async finalMessages(){return await this.done(),Object.values(id(this,tN,"f"))}async finalRun(){if(await this.done(),!id(this,tk,"f"))throw Error("Final run was not received.");return id(this,tk,"f")}async _createThreadAssistantStream(e,t,n){let r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));let i={...t,stream:!0},s=await e.createAndRun(i,{...n,signal:this.controller.signal});for await(let e of(this._connected(),s))id(this,tC,"m",tG).call(this,e);if(s.controller.signal?.aborted)throw new iy;return this._addRun(id(this,tC,"m",tH).call(this))}async _createAssistantStream(e,t,n,r){let i=r?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let s={...n,stream:!0},o=await e.create(t,s,{...r,signal:this.controller.signal});for await(let e of(this._connected(),o))id(this,tC,"m",tG).call(this,e);if(o.controller.signal?.aborted)throw new iy;return this._addRun(id(this,tC,"m",tH).call(this))}static accumulateDelta(e,t){for(let[n,r]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=r;continue}let t=e[n];if(null==t||"index"===n||"type"===n){e[n]=r;continue}if("string"==typeof t&&"string"==typeof r)t+=r;else if("number"==typeof t&&"number"==typeof r)t+=r;else if(iL(t)&&iL(r))t=this.accumulateDelta(t,r);else if(Array.isArray(t)&&Array.isArray(r)){if(t.every(e=>"string"==typeof e||"number"==typeof e)){t.push(...r);continue}for(let e of r){if(!iL(e))throw Error(`Expected array delta entry to be an object but got: ${e}`);let n=e.index;if(null==n)throw console.error(e),Error("Expected array delta entry to have an `index` property");if("number"!=typeof n)throw Error(`Expected array delta entry \`index\` property to be a number but got ${n}`);let r=t[n];null==r?t.push(e):t[n]=this.accumulateDelta(r,e)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${r}, accValue: ${t}`);e[n]=t}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,r){return await this._createAssistantStream(t,e,n,r)}async _runToolAssistantStream(e,t,n,r){return await this._createToolAssistantStream(t,e,n,r)}}tI=ou,tG=function(e){if(!this.ended)switch(ic(this,tj,e,"f"),id(this,tC,"m",tV).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":id(this,tC,"m",tY).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":id(this,tC,"m",tB).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":id(this,tC,"m",tF).call(this,e);break;case"error":throw Error("Encountered an error event in event processing - errors should be processed earlier")}},tH=function(){if(this.ended)throw new ig("stream has ended, this shouldn't happen");if(!id(this,tk,"f"))throw Error("Final run has not been received");return id(this,tk,"f")},tF=function(e){let[t,n]=id(this,tC,"m",tJ).call(this,e,id(this,tx,"f"));for(let e of(ic(this,tx,t,"f"),id(this,tN,"f")[t.id]=t,n)){let n=t.content[e.index];n?.type=="text"&&this._emit("textCreated",n.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let n of e.data.delta.content){if("text"==n.type&&n.text){let e=n.text,r=t.content[n.index];if(r&&"text"==r.type)this._emit("textDelta",e,r.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(n.index!=id(this,tM,"f")){if(id(this,tD,"f"))switch(id(this,tD,"f").type){case"text":this._emit("textDone",id(this,tD,"f").text,id(this,tx,"f"));break;case"image_file":this._emit("imageFileDone",id(this,tD,"f").image_file,id(this,tx,"f"))}ic(this,tM,n.index,"f")}ic(this,tD,t.content[n.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==id(this,tM,"f")){let t=e.data.content[id(this,tM,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,id(this,tx,"f"));break;case"text":this._emit("textDone",t.text,id(this,tx,"f"))}}id(this,tx,"f")&&this._emit("messageDone",e.data),ic(this,tx,void 0,"f")}},tB=function(e){let t=id(this,tC,"m",tW).call(this,e);switch(ic(this,t$,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let n=e.data.delta;if(n.step_details&&"tool_calls"==n.step_details.type&&n.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(let e of n.step_details.tool_calls)e.index==id(this,tL,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(id(this,tU,"f")&&this._emit("toolCallDone",id(this,tU,"f")),ic(this,tL,e.index,"f"),ic(this,tU,t.step_details.tool_calls[e.index],"f"),id(this,tU,"f")&&this._emit("toolCallCreated",id(this,tU,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":ic(this,t$,void 0,"f"),"tool_calls"==e.data.step_details.type&&id(this,tU,"f")&&(this._emit("toolCallDone",id(this,tU,"f")),ic(this,tU,void 0,"f")),this._emit("runStepDone",e.data,t)}},tV=function(e){id(this,tR,"f").push(e),this._emit("event",e)},tW=function(e){switch(e.event){case"thread.run.step.created":return id(this,tP,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=id(this,tP,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){let r=tI.accumulateDelta(t,n.delta);id(this,tP,"f")[e.data.id]=r}return id(this,tP,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":id(this,tP,"f")[e.data.id]=e.data}if(id(this,tP,"f")[e.data.id])return id(this,tP,"f")[e.data.id];throw Error("No snapshot available")},tJ=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let r=e.data;if(r.delta.content)for(let e of r.delta.content)if(e.index in t.content){let n=t.content[e.index];t.content[e.index]=id(this,tC,"m",tK).call(this,e,n)}else t.content[e.index]=e,n.push(e);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},tK=function(e,t){return tI.accumulateDelta(t,e)},tY=function(e){switch(ic(this,tq,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":ic(this,tk,e.data,"f"),id(this,tU,"f")&&(this._emit("toolCallDone",id(this,tU,"f")),ic(this,tU,void 0,"f"))}};class oc extends sR{constructor(){super(...arguments),this.steps=new oa(this._client)}create(e,t,n){let{include:r,...i}=t;return this._client.post(sx`/threads/${e}/runs`,{query:{include:r},body:i,...n,headers:s4([{"OpenAI-Beta":"assistants=v2"},n?.headers]),stream:t.stream??!1})}retrieve(e,t,n){let{thread_id:r}=t;return this._client.get(sx`/threads/${r}/runs/${e}`,{...n,headers:s4([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,t,n){let{thread_id:r,...i}=t;return this._client.post(sx`/threads/${r}/runs/${e}`,{body:i,...n,headers:s4([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,t={},n){return this._client.getAPIList(sx`/threads/${e}/runs`,sh,{query:t,...n,headers:s4([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}cancel(e,t,n){let{thread_id:r}=t;return this._client.post(sx`/threads/${r}/runs/${e}/cancel`,{...n,headers:s4([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,t,n){let r=await this.create(e,t,n);return await this.poll(r.id,{thread_id:e},n)}createAndStream(e,t,n){return ou.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){let r=s4([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:i,response:s}=await this.retrieve(e,t,{...n,headers:{...n?.headers,...r}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(n?.pollIntervalMs)o=n.pollIntervalMs;else{let e=s.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(o=t)}}await iU(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(e,t,n){return ou.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n){let{thread_id:r,...i}=t;return this._client.post(sx`/threads/${r}/runs/${e}/submit_tool_outputs`,{body:i,...n,headers:s4([{"OpenAI-Beta":"assistants=v2"},n?.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,n){let r=await this.submitToolOutputs(e,t,n);return await this.poll(r.id,t,n)}submitToolOutputsStream(e,t,n){return ou.createToolAssistantStream(e,this._client.beta.threads.runs,t,n)}}oc.Steps=oa;class od extends sR{constructor(){super(...arguments),this.runs=new oc(this._client),this.messages=new oo(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:s4([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(sx`/threads/${e}`,{...t,headers:s4([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,n){return this._client.post(sx`/threads/${e}`,{body:t,...n,headers:s4([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,t){return this._client.delete(sx`/threads/${e}`,{...t,headers:s4([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:s4([{"OpenAI-Beta":"assistants=v2"},t?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){let n=await this.createAndRun(e,t);return await this.runs.poll(n.id,{thread_id:n.thread_id},t)}createAndRunStream(e,t){return ou.createThreadAssistantStream(e,this._client.beta.threads,t)}}od.Runs=oc,od.Messages=oo;class op extends sR{constructor(){super(...arguments),this.realtime=new on(this._client),this.chatkit=new os(this._client),this.assistants=new s7(this._client),this.threads=new od(this._client)}}op.Realtime=on,op.ChatKit=os,op.Assistants=s7,op.Threads=od;class oh extends sR{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class of extends sR{retrieve(e,t,n){let{container_id:r}=t;return this._client.get(sx`/containers/${r}/files/${e}/content`,{...n,headers:s4([{Accept:"application/binary"},n?.headers]),__binaryResponse:!0})}}class om extends sR{constructor(){super(...arguments),this.content=new of(this._client)}create(e,t,n){return this._client.post(sx`/containers/${e}/files`,sE({body:t,...n},this._client))}retrieve(e,t,n){let{container_id:r}=t;return this._client.get(sx`/containers/${r}/files/${e}`,n)}list(e,t={},n){return this._client.getAPIList(sx`/containers/${e}/files`,sh,{query:t,...n})}delete(e,t,n){let{container_id:r}=t;return this._client.delete(sx`/containers/${r}/files/${e}`,{...n,headers:s4([{Accept:"*/*"},n?.headers])})}}om.Content=of;class og extends sR{constructor(){super(...arguments),this.files=new om(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(sx`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",sh,{query:e,...t})}delete(e,t){return this._client.delete(sx`/containers/${e}`,{...t,headers:s4([{Accept:"*/*"},t?.headers])})}}og.Files=om;class o_ extends sR{create(e,t,n){let{include:r,...i}=t;return this._client.post(sx`/conversations/${e}/items`,{query:{include:r},body:i,...n})}retrieve(e,t,n){let{conversation_id:r,...i}=t;return this._client.get(sx`/conversations/${r}/items/${e}`,{query:i,...n})}list(e,t={},n){return this._client.getAPIList(sx`/conversations/${e}/items`,sf,{query:t,...n})}delete(e,t,n){let{conversation_id:r}=t;return this._client.delete(sx`/conversations/${r}/items/${e}`,n)}}class oy extends sR{constructor(){super(...arguments),this.items=new o_(this._client)}create(e={},t){return this._client.post("/conversations",{body:e,...t})}retrieve(e,t){return this._client.get(sx`/conversations/${e}`,t)}update(e,t,n){return this._client.post(sx`/conversations/${e}`,{body:t,...n})}delete(e,t){return this._client.delete(sx`/conversations/${e}`,t)}}oy.Items=o_;class ov extends sR{create(e,t){let n=!!e.encoding_format,r=n?e.encoding_format:"base64";n&&st(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);let i=this._client.post("/embeddings",{body:{...e,encoding_format:r},...t});return n?i:(st(this._client).debug("embeddings/decoding base64 embeddings from base64"),i._thenUnwrap(e=>(e&&e.data&&e.data.forEach(e=>{let t=e.embedding;e.embedding=(e=>{if("undefined"!=typeof Buffer){let t=Buffer.from(e,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}{let t=atob(e),n=t.length,r=new Uint8Array(n);for(let e=0;e<n;e++)r[e]=t.charCodeAt(e);return Array.from(new Float32Array(r.buffer))}})(t)}),e)))}}class oE extends sR{retrieve(e,t,n){let{eval_id:r,run_id:i}=t;return this._client.get(sx`/evals/${r}/runs/${i}/output_items/${e}`,n)}list(e,t,n){let{eval_id:r,...i}=t;return this._client.getAPIList(sx`/evals/${r}/runs/${e}/output_items`,sh,{query:i,...n})}}class ob extends sR{constructor(){super(...arguments),this.outputItems=new oE(this._client)}create(e,t,n){return this._client.post(sx`/evals/${e}/runs`,{body:t,...n})}retrieve(e,t,n){let{eval_id:r}=t;return this._client.get(sx`/evals/${r}/runs/${e}`,n)}list(e,t={},n){return this._client.getAPIList(sx`/evals/${e}/runs`,sh,{query:t,...n})}delete(e,t,n){let{eval_id:r}=t;return this._client.delete(sx`/evals/${r}/runs/${e}`,n)}cancel(e,t,n){let{eval_id:r}=t;return this._client.post(sx`/evals/${r}/runs/${e}`,n)}}ob.OutputItems=oE;class oS extends sR{constructor(){super(...arguments),this.runs=new ob(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(sx`/evals/${e}`,t)}update(e,t,n){return this._client.post(sx`/evals/${e}`,{body:t,...n})}list(e={},t){return this._client.getAPIList("/evals",sh,{query:e,...t})}delete(e,t){return this._client.delete(sx`/evals/${e}`,t)}}oS.Runs=ob;class oT extends sR{create(e,t){return this._client.post("/files",sE({body:e,...t},this._client))}retrieve(e,t){return this._client.get(sx`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",sh,{query:e,...t})}delete(e,t){return this._client.delete(sx`/files/${e}`,t)}content(e,t){return this._client.get(sx`/files/${e}/content`,{...t,headers:s4([{Accept:"application/binary"},t?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=18e5}={}){let r=new Set(["processed","error","deleted"]),i=Date.now(),s=await this.retrieve(e);for(;!s.status||!r.has(s.status);)if(await iU(t),s=await this.retrieve(e),Date.now()-i>n)throw new iE({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return s}}class oO extends sR{}class oA extends sR{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}}class ow extends sR{constructor(){super(...arguments),this.graders=new oA(this._client)}}ow.Graders=oA;class oC extends sR{create(e,t,n){return this._client.getAPIList(sx`/fine_tuning/checkpoints/${e}/permissions`,sp,{body:t,method:"post",...n})}retrieve(e,t={},n){return this._client.get(sx`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...n})}delete(e,t,n){let{fine_tuned_model_checkpoint:r}=t;return this._client.delete(sx`/fine_tuning/checkpoints/${r}/permissions/${e}`,n)}}class oI extends sR{constructor(){super(...arguments),this.permissions=new oC(this._client)}}oI.Permissions=oC;class oR extends sR{list(e,t={},n){return this._client.getAPIList(sx`/fine_tuning/jobs/${e}/checkpoints`,sh,{query:t,...n})}}class oP extends sR{constructor(){super(...arguments),this.checkpoints=new oR(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(sx`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",sh,{query:e,...t})}cancel(e,t){return this._client.post(sx`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return this._client.getAPIList(sx`/fine_tuning/jobs/${e}/events`,sh,{query:t,...n})}pause(e,t){return this._client.post(sx`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(sx`/fine_tuning/jobs/${e}/resume`,t)}}oP.Checkpoints=oR;class oN extends sR{constructor(){super(...arguments),this.methods=new oO(this._client),this.jobs=new oP(this._client),this.checkpoints=new oI(this._client),this.alpha=new ow(this._client)}}oN.Methods=oO,oN.Jobs=oP,oN.Checkpoints=oI,oN.Alpha=ow;class ox extends sR{}class ok extends sR{constructor(){super(...arguments),this.graderModels=new ox(this._client)}}ok.GraderModels=ox;class oM extends sR{createVariation(e,t){return this._client.post("/images/variations",sE({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",sE({body:e,...t,stream:e.stream??!1},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t,stream:e.stream??!1})}}class oD extends sR{retrieve(e,t){return this._client.get(sx`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",sp,e)}delete(e,t){return this._client.delete(sx`/models/${e}`,t)}}class oL extends sR{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class oU extends sR{accept(e,t,n){return this._client.post(sx`/realtime/calls/${e}/accept`,{body:t,...n,headers:s4([{Accept:"*/*"},n?.headers])})}hangup(e,t){return this._client.post(sx`/realtime/calls/${e}/hangup`,{...t,headers:s4([{Accept:"*/*"},t?.headers])})}refer(e,t,n){return this._client.post(sx`/realtime/calls/${e}/refer`,{body:t,...n,headers:s4([{Accept:"*/*"},n?.headers])})}reject(e,t={},n){return this._client.post(sx`/realtime/calls/${e}/reject`,{body:t,...n,headers:s4([{Accept:"*/*"},n?.headers])})}}class oj extends sR{create(e,t){return this._client.post("/realtime/client_secrets",{body:e,...t})}}class oq extends sR{constructor(){super(...arguments),this.clientSecrets=new oj(this._client),this.calls=new oU(this._client)}}function o$(e,t){let n=e.output.map(e=>{if("function_call"===e.type)return{...e,parsed_arguments:function(e,t){var n,r;let i=(n=e.tools??[],r=t.name,n.find(e=>"function"===e.type&&e.name===r));return{...t,...t,parsed_arguments:i?.$brand==="auto-parseable-tool"?i.$parseRaw(t.arguments):i?.strict?JSON.parse(t.arguments):null}}(t,e)};if("message"===e.type){let n=e.content.map(e=>{var n,r;return"output_text"===e.type?{...e,parsed:(n=t,r=e.text,n.text?.format?.type!=="json_schema"?null:"$parseRaw"in n.text?.format?(n.text?.format).$parseRaw(r):JSON.parse(r))}:e});return{...e,content:n}}return e}),r=Object.assign({},e,{output:n});return Object.getOwnPropertyDescriptor(e,"output_text")||oG(r),Object.defineProperty(r,"output_parsed",{enumerable:!0,get(){for(let e of r.output)if("message"===e.type){for(let t of e.content)if("output_text"===t.type&&null!==t.parsed)return t.parsed}return null}}),r}function oG(e){let t=[];for(let n of e.output)if("message"===n.type)for(let e of n.content)"output_text"===e.type&&t.push(e.text);e.output_text=t.join("")}oq.ClientSecrets=oj,oq.Calls=oU;class oH extends sH{constructor(e){super(),tX.add(this),tz.set(this,void 0),tQ.set(this,void 0),tZ.set(this,void 0),ic(this,tz,e,"f")}static createResponse(e,t,n){let r=new oH(t);return r._run(()=>r._createOrRetrieveResponse(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createOrRetrieveResponse(e,t,n){let r,i=n?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),id(this,tX,"m",t0).call(this);let s=null;for await(let i of("response_id"in t?(r=await e.responses.retrieve(t.response_id,{stream:!0},{...n,signal:this.controller.signal,stream:!0}),s=t.starting_after??null):r=await e.responses.create({...t,stream:!0},{...n,signal:this.controller.signal}),this._connected(),r))id(this,tX,"m",t1).call(this,i,s);if(r.controller.signal?.aborted)throw new iy;return id(this,tX,"m",t2).call(this)}[(tz=new WeakMap,tQ=new WeakMap,tZ=new WeakMap,tX=new WeakSet,t0=function(){this.ended||ic(this,tQ,void 0,"f")},t1=function(e,t){if(this.ended)return;let n=(e,n)=>{(null==t||n.sequence_number>t)&&this._emit(e,n)},r=id(this,tX,"m",t4).call(this,e);switch(n("event",e),e.type){case"response.output_text.delta":{let t=r.output[e.output_index];if(!t)throw new ig(`missing output at index ${e.output_index}`);if("message"===t.type){let r=t.content[e.content_index];if(!r)throw new ig(`missing content at index ${e.content_index}`);if("output_text"!==r.type)throw new ig(`expected content to be 'output_text', got ${r.type}`);n("response.output_text.delta",{...e,snapshot:r.text})}break}case"response.function_call_arguments.delta":{let t=r.output[e.output_index];if(!t)throw new ig(`missing output at index ${e.output_index}`);"function_call"===t.type&&n("response.function_call_arguments.delta",{...e,snapshot:t.arguments});break}default:n(e.type,e)}},t2=function(){if(this.ended)throw new ig("stream has ended, this shouldn't happen");let e=id(this,tQ,"f");if(!e)throw new ig("request ended without sending any events");ic(this,tQ,void 0,"f");let t=function(e,t){var n;return t&&(n=t,sD(n.text?.format))?o$(e,t):{...e,output_parsed:null,output:e.output.map(e=>"function_call"===e.type?{...e,parsed_arguments:null}:"message"===e.type?{...e,content:e.content.map(e=>({...e,parsed:null}))}:e)}}(e,id(this,tz,"f"));return ic(this,tZ,t,"f"),t},t4=function(e){let t=id(this,tQ,"f");if(!t){if("response.created"!==e.type)throw new ig(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return ic(this,tQ,e.response,"f")}switch(e.type){case"response.output_item.added":t.output.push(e.item);break;case"response.content_part.added":{let n=t.output[e.output_index];if(!n)throw new ig(`missing output at index ${e.output_index}`);let r=n.type,i=e.part;"message"===r&&"reasoning_text"!==i.type?n.content.push(i):"reasoning"===r&&"reasoning_text"===i.type&&(n.content||(n.content=[]),n.content.push(i));break}case"response.output_text.delta":{let n=t.output[e.output_index];if(!n)throw new ig(`missing output at index ${e.output_index}`);if("message"===n.type){let t=n.content[e.content_index];if(!t)throw new ig(`missing content at index ${e.content_index}`);if("output_text"!==t.type)throw new ig(`expected content to be 'output_text', got ${t.type}`);t.text+=e.delta}break}case"response.function_call_arguments.delta":{let n=t.output[e.output_index];if(!n)throw new ig(`missing output at index ${e.output_index}`);"function_call"===n.type&&(n.arguments+=e.delta);break}case"response.reasoning_text.delta":{let n=t.output[e.output_index];if(!n)throw new ig(`missing output at index ${e.output_index}`);if("reasoning"===n.type){let t=n.content?.[e.content_index];if(!t)throw new ig(`missing content at index ${e.content_index}`);if("reasoning_text"!==t.type)throw new ig(`expected content to be 'reasoning_text', got ${t.type}`);t.text+=e.delta}break}case"response.completed":ic(this,tQ,e.response,"f")}return t},Symbol.asyncIterator)](){let e=[],t=[],n=!1;return this.on("event",n=>{let r=t.shift();r?r.resolve(n):e.push(n)}),this.on("end",()=>{for(let e of(n=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let r of(n=!0,t))r.reject(e);t.length=0}),this.on("error",e=>{for(let r of(n=!0,t))r.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((e,n)=>t.push({resolve:e,reject:n})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=id(this,tZ,"f");if(!e)throw new ig("stream ended without producing a ChatCompletion");return e}}class oF extends sR{list(e,t={},n){return this._client.getAPIList(sx`/responses/${e}/input_items`,sh,{query:t,...n})}}class oB extends sR{count(e={},t){return this._client.post("/responses/input_tokens",{body:e,...t})}}class oV extends sR{constructor(){super(...arguments),this.inputItems=new oF(this._client),this.inputTokens=new oB(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&oG(e),e))}retrieve(e,t={},n){return this._client.get(sx`/responses/${e}`,{query:t,...n,stream:t?.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&oG(e),e))}delete(e,t){return this._client.delete(sx`/responses/${e}`,{...t,headers:s4([{Accept:"*/*"},t?.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(t=>o$(t,e))}stream(e,t){return oH.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(sx`/responses/${e}/cancel`,t)}}oV.InputItems=oF,oV.InputTokens=oB;class oW extends sR{create(e,t,n){return this._client.post(sx`/uploads/${e}/parts`,sE({body:t,...n},this._client))}}class oJ extends sR{constructor(){super(...arguments),this.parts=new oW(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(sx`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(sx`/uploads/${e}/complete`,{body:t,...n})}}oJ.Parts=oW;let oK=async e=>{let t=await Promise.allSettled(e),n=t.filter(e=>"rejected"===e.status);if(n.length){for(let e of n)console.error(e.reason);throw Error(`${n.length} promise(s) failed - see the above errors`)}let r=[];for(let e of t)"fulfilled"===e.status&&r.push(e.value);return r};class oY extends sR{create(e,t,n){return this._client.post(sx`/vector_stores/${e}/file_batches`,{body:t,...n,headers:s4([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,t,n){let{vector_store_id:r}=t;return this._client.get(sx`/vector_stores/${r}/file_batches/${e}`,{...n,headers:s4([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}cancel(e,t,n){let{vector_store_id:r}=t;return this._client.post(sx`/vector_stores/${r}/file_batches/${e}/cancel`,{...n,headers:s4([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,t,n){let r=await this.create(e,t);return await this.poll(e,r.id,n)}listFiles(e,t,n){let{vector_store_id:r,...i}=t;return this._client.getAPIList(sx`/vector_stores/${r}/file_batches/${e}/files`,sh,{query:i,...n,headers:s4([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async poll(e,t,n){let r=s4([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:i,response:s}=await this.retrieve(t,{vector_store_id:e},{...n,headers:r}).withResponse();switch(i.status){case"in_progress":let o=5e3;if(n?.pollIntervalMs)o=n.pollIntervalMs;else{let e=s.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(o=t)}}await iU(o);break;case"failed":case"cancelled":case"completed":return i}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},r){if(null==t||0==t.length)throw Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let i=Math.min(r?.maxConcurrency??5,t.length),s=this._client,o=t.values(),a=[...n];async function l(e){for(let t of e){let e=await s.files.create({file:t,purpose:"assistants"},r);a.push(e.id)}}let u=Array(i).fill(o).map(l);return await oK(u),await this.createAndPoll(e,{file_ids:a})}}class oX extends sR{create(e,t,n){return this._client.post(sx`/vector_stores/${e}/files`,{body:t,...n,headers:s4([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,t,n){let{vector_store_id:r}=t;return this._client.get(sx`/vector_stores/${r}/files/${e}`,{...n,headers:s4([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,t,n){let{vector_store_id:r,...i}=t;return this._client.post(sx`/vector_stores/${r}/files/${e}`,{body:i,...n,headers:s4([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,t={},n){return this._client.getAPIList(sx`/vector_stores/${e}/files`,sh,{query:t,...n,headers:s4([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,t,n){let{vector_store_id:r}=t;return this._client.delete(sx`/vector_stores/${r}/files/${e}`,{...n,headers:s4([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,t,n){let r=await this.create(e,t,n);return await this.poll(e,r.id,n)}async poll(e,t,n){let r=s4([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let i=await this.retrieve(t,{vector_store_id:e},{...n,headers:r}).withResponse(),s=i.data;switch(s.status){case"in_progress":let o=5e3;if(n?.pollIntervalMs)o=n.pollIntervalMs;else{let e=i.response.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(o=t)}}await iU(o);break;case"failed":case"completed":return s}}}async upload(e,t,n){let r=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:r.id},n)}async uploadAndPoll(e,t,n){let r=await this.upload(e,t,n);return await this.poll(e,r.id,n)}content(e,t,n){let{vector_store_id:r}=t;return this._client.getAPIList(sx`/vector_stores/${r}/files/${e}/content`,sp,{...n,headers:s4([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}class oz extends sR{constructor(){super(...arguments),this.files=new oX(this._client),this.fileBatches=new oY(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:s4([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(sx`/vector_stores/${e}`,{...t,headers:s4([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,n){return this._client.post(sx`/vector_stores/${e}`,{body:t,...n,headers:s4([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",sh,{query:e,...t,headers:s4([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(sx`/vector_stores/${e}`,{...t,headers:s4([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}search(e,t,n){return this._client.getAPIList(sx`/vector_stores/${e}/search`,sp,{body:t,method:"post",...n,headers:s4([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}oz.Files=oX,oz.FileBatches=oY;class oQ extends sR{create(e,t){return this._client.post("/videos",sv({body:e,...t},this._client))}retrieve(e,t){return this._client.get(sx`/videos/${e}`,t)}list(e={},t){return this._client.getAPIList("/videos",sf,{query:e,...t})}delete(e,t){return this._client.delete(sx`/videos/${e}`,t)}downloadContent(e,t={},n){return this._client.get(sx`/videos/${e}/content`,{query:t,...n,headers:s4([{Accept:"application/binary"},n?.headers]),__binaryResponse:!0})}remix(e,t,n){return this._client.post(sx`/videos/${e}/remix`,sv({body:t,...n},this._client))}}class oZ extends sR{constructor(){super(...arguments),t8.add(this)}async unwrap(e,t,n=this._client.webhookSecret,r=300){return await this.verifySignature(e,t,n,r),JSON.parse(e)}async verifySignature(e,t,n=this._client.webhookSecret,r=300){if("undefined"==typeof crypto||"function"!=typeof crypto.subtle.importKey||"function"!=typeof crypto.subtle.verify)throw Error("Webhook signature verification is only supported when the `crypto` global is defined");id(this,t8,"m",t6).call(this,n);let i=s4([t]).values,s=id(this,t8,"m",t3).call(this,i,"webhook-signature"),o=id(this,t8,"m",t3).call(this,i,"webhook-timestamp"),a=id(this,t8,"m",t3).call(this,i,"webhook-id"),l=parseInt(o,10);if(isNaN(l))throw new iN("Invalid webhook timestamp format");let u=Math.floor(Date.now()/1e3);if(u-l>r)throw new iN("Webhook timestamp is too old");if(l>u+r)throw new iN("Webhook timestamp is too new");let c=s.split(" ").map(e=>e.startsWith("v1,")?e.substring(3):e),d=n.startsWith("whsec_")?Buffer.from(n.replace("whsec_",""),"base64"):Buffer.from(n,"utf-8"),p=a?`${a}.${o}.${e}`:`${o}.${e}`,h=await crypto.subtle.importKey("raw",d,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(let e of c)try{let t=Buffer.from(e,"base64");if(await crypto.subtle.verify("HMAC",h,t,new TextEncoder().encode(p)))return}catch{continue}throw new iN("The given webhook signature does not match the expected signature")}}t8=new WeakSet,t6=function(e){if("string"!=typeof e||0===e.length)throw Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},t3=function(e,t){if(!e)throw Error("Headers are required");let n=e.get(t);if(null==n)throw Error(`Missing required header: ${t}`);return n},e.i(98546);class o0{constructor({baseURL:e=ol("OPENAI_BASE_URL"),apiKey:t=ol("OPENAI_API_KEY"),organization:n=ol("OPENAI_ORG_ID")??null,project:r=ol("OPENAI_PROJECT_ID")??null,webhookSecret:i=ol("OPENAI_WEBHOOK_SECRET")??null,...s}={}){if(t9.add(this),t7.set(this,void 0),this.completions=new oh(this),this.chat=new s1(this),this.embeddings=new ov(this),this.files=new oT(this),this.images=new oM(this),this.audio=new s9(this),this.moderations=new oL(this),this.models=new oD(this),this.fineTuning=new oN(this),this.graders=new ok(this),this.vectorStores=new oz(this),this.webhooks=new oZ(this),this.beta=new op(this),this.batches=new s5(this),this.uploads=new oJ(this),this.responses=new oV(this),this.realtime=new oq(this),this.conversations=new oy(this),this.evals=new oS(this),this.containers=new og(this),this.videos=new oQ(this),void 0===t)throw new ig("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");const o={apiKey:t,organization:n,project:r,webhookSecret:i,...s,baseURL:e||"https://api.openai.com/v1"};o.dangerouslyAllowBrowser,this.baseURL=o.baseURL,this.timeout=o.timeout??t5.DEFAULT_TIMEOUT,this.logger=o.logger??console;const a="warn";this.logLevel=a,this.logLevel=i3(o.logLevel,"ClientOptions.logLevel",this)??i3(ol("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??a,this.fetchOptions=o.fetchOptions,this.maxRetries=o.maxRetries??2,this.fetch=o.fetch??function(){if("undefined"!=typeof fetch)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),ic(this,t7,iV,"f"),this._options=o,this.apiKey="string"==typeof t?t:"Missing Key",this.organization=n,this.project=r,this.webhookSecret=i}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}async authHeaders(e){return s4([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return function(e,t={}){let n,r=e,i=function(e=i0){let t;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw TypeError("Encoder has to be a function.");let n=e.charset||i0.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let r=iW;if(void 0!==e.format){if(!iY(iK,e.format))throw TypeError("Unknown format option provided.");r=e.format}let i=iK[r],s=i0.filter;if(("function"==typeof e.filter||ik(e.filter))&&(s=e.filter),t=e.arrayFormat&&e.arrayFormat in iQ?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":i0.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw TypeError("`commaRoundTrip` must be a boolean, or absent");let o=void 0===e.allowDots?!0==!!e.encodeDotInKeys||i0.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:i0.addQueryPrefix,allowDots:o,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:i0.allowEmptyArrays,arrayFormat:t,charset:n,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:i0.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?i0.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:i0.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:i0.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:i0.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:i0.encodeValuesOnly,filter:s,format:r,formatter:i,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:i0.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:i0.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:i0.strictNullHandling}}(t);"function"==typeof i.filter?r=(0,i.filter)("",r):ik(i.filter)&&(n=i.filter);let s=[];if("object"!=typeof r||null===r)return"";let o=iQ[i.arrayFormat],a="comma"===o&&i.commaRoundTrip;n||(n=Object.keys(r)),i.sort&&n.sort(i.sort);let l=new WeakMap;for(let e=0;e<n.length;++e){let t=n[e];i.skipNulls&&null===r[t]||iZ(s,function e(t,n,r,i,s,o,a,l,u,c,d,p,h,f,m,g,_,y){var v,E;let b,S=t,T=y,O=0,A=!1;for(;void 0!==(T=T.get(i1))&&!A;){let e=T.get(t);if(O+=1,void 0!==e)if(e===O)throw RangeError("Cyclic object value");else A=!0;void 0===T.get(i1)&&(O=0)}if("function"==typeof c?S=c(n,S):S instanceof Date?S=h?.(S):"comma"===r&&ik(S)&&(S=iz(S,function(e){return e instanceof Date?h?.(e):e})),null===S){if(o)return u&&!g?u(n,i0.encoder,_,"key",f):n;S=""}if("string"==typeof(v=S)||"number"==typeof v||"boolean"==typeof v||"symbol"==typeof v||"bigint"==typeof v||(E=S)&&"object"==typeof E&&E.constructor&&E.constructor.isBuffer&&E.constructor.isBuffer(E)){if(u){let e=g?n:u(n,i0.encoder,_,"key",f);return[m?.(e)+"="+m?.(u(S,i0.encoder,_,"value",f))]}return[m?.(n)+"="+m?.(String(S))]}let w=[];if(void 0===S)return w;if("comma"===r&&ik(S))g&&u&&(S=iz(S,u)),b=[{value:S.length>0?S.join(",")||null:void 0}];else if(ik(c))b=c;else{let e=Object.keys(S);b=d?e.sort(d):e}let C=l?String(n).replace(/\./g,"%2E"):String(n),I=i&&ik(S)&&1===S.length?C+"[]":C;if(s&&ik(S)&&0===S.length)return I+"[]";for(let n=0;n<b.length;++n){let v=b[n],E="object"==typeof v&&void 0!==v.value?v.value:S[v];if(a&&null===E)continue;let T=p&&l?v.replace(/\./g,"%2E"):v,A=ik(S)?"function"==typeof r?r(I,T):I:I+(p?"."+T:"["+T+"]");y.set(t,O);let C=new WeakMap;C.set(i1,y),iZ(w,e(E,A,r,i,s,o,a,l,"comma"===r&&g&&ik(S)?null:u,c,d,p,h,f,m,g,_,C))}return w}(r[t],t,o,a,i.allowEmptyArrays,i.strictNullHandling,i.skipNulls,i.encodeDotInKeys,i.encode?i.encoder:null,i.filter,i.sort,i.allowDots,i.serializeDate,i.format,i.formatter,i.encodeValuesOnly,i.charset,l))}let u=s.join(i.delimiter),c=!0===i.addQueryPrefix?"?":"";return i.charsetSentinel&&("iso-8859-1"===i.charset?c+="utf8=%26%2310003%3B&":c+="utf8=%E2%9C%93&"),u.length>0?c+u:""}(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${ij}`}defaultIdempotencyKey(){return`stainless-node-retry-${ip()}`}makeStatusError(e,t,n,r){return i_.generate(e,t,n,r)}async _callApiKey(){let e,t=this._options.apiKey;if("function"!=typeof t)return!1;try{e=await t()}catch(e){if(e instanceof ig)throw e;throw new ig(`Failed to get token from 'apiKey' function: ${e.message}`,{cause:e})}if("string"!=typeof e||!e)throw new ig(`Expected 'apiKey' function argument to return a string but it returned ${e}`);return this.apiKey=e,!0}buildURL(e,t,n){let r=!id(this,t9,"m",ne).call(this)&&n||this.baseURL,i=new URL(ix.test(e)?e:r+(r.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return!function(e){if(!e)return!0;for(let t in e)return!1;return!0}(s)&&(t={...s,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(i.search=this.stringifyQuery(t)),i.toString()}async prepareOptions(e){await this._callApiKey()}async prepareRequest(e,{url:t,options:n}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(n=>({method:e,path:t,...n})))}request(e,t=null){return new su(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,n){let r=await e,i=r.maxRetries??this.maxRetries;null==t&&(t=i),await this.prepareOptions(r);let{req:s,url:o,timeout:a}=await this.buildRequest(r,{retryCount:i-t});await this.prepareRequest(s,{url:o,options:r});let l="log_"+(0x1000000*Math.random()|0).toString(16).padStart(6,"0"),u=void 0===n?"":`, retryOf: ${n}`,c=Date.now();if(st(this).debug(`[${l}] sending request`,sn({retryOfRequestLogID:n,method:r.method,url:o,options:r,headers:s.headers})),r.signal?.aborted)throw new iy;let d=new AbortController,p=await this.fetchWithTimeout(o,s,a,d).catch(im),h=Date.now();if(p instanceof globalThis.Error){let e=`retrying, ${t} attempts remaining`;if(r.signal?.aborted)throw new iy;let i=ih(p)||/timed? ?out/i.test(String(p)+("cause"in p?String(p.cause):""));if(t)return st(this).info(`[${l}] connection ${i?"timed out":"failed"} - ${e}`),st(this).debug(`[${l}] connection ${i?"timed out":"failed"} (${e})`,sn({retryOfRequestLogID:n,url:o,durationMs:h-c,message:p.message})),this.retryRequest(r,t,n??l);if(st(this).info(`[${l}] connection ${i?"timed out":"failed"} - error; no more retries left`),st(this).debug(`[${l}] connection ${i?"timed out":"failed"} (error; no more retries left)`,sn({retryOfRequestLogID:n,url:o,durationMs:h-c,message:p.message})),i)throw new iE;throw new iv({cause:p})}let f=[...p.headers.entries()].filter(([e])=>"x-request-id"===e).map(([e,t])=>", "+e+": "+JSON.stringify(t)).join(""),m=`[${l}${u}${f}] ${s.method} ${o} ${p.ok?"succeeded":"failed"} with status ${p.status} in ${h-c}ms`;if(!p.ok){let e=await this.shouldRetry(p);if(t&&e){let e=`retrying, ${t} attempts remaining`;return await iB(p.body),st(this).info(`${m} - ${e}`),st(this).debug(`[${l}] response error (${e})`,sn({retryOfRequestLogID:n,url:p.url,status:p.status,headers:p.headers,durationMs:h-c})),this.retryRequest(r,t,n??l,p.headers)}let i=e?"error; no more retries left":"error; not retryable";st(this).info(`${m} - ${i}`);let s=await p.text().catch(e=>im(e).message),o=(e=>{try{return JSON.parse(e)}catch(e){return}})(s),a=o?void 0:s;throw st(this).debug(`[${l}] response error (${i})`,sn({retryOfRequestLogID:n,url:p.url,status:p.status,headers:p.headers,message:a,durationMs:Date.now()-c})),this.makeStatusError(p.status,o,a,p.headers)}return st(this).info(m),st(this).debug(`[${l}] response start`,sn({retryOfRequestLogID:n,url:p.url,status:p.status,headers:p.headers,durationMs:h-c})),{response:p,options:r,controller:d,requestLogID:l,retryOfRequestLogID:n,startTime:c}}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}requestAPIList(e,t){return new sd(this,this.makeRequest(t,null,void 0),e)}async fetchWithTimeout(e,t,n,r){let{signal:i,method:s,...o}=t||{};i&&i.addEventListener("abort",()=>r.abort());let a=setTimeout(()=>r.abort(),n),l=globalThis.ReadableStream&&o.body instanceof globalThis.ReadableStream||"object"==typeof o.body&&null!==o.body&&Symbol.asyncIterator in o.body,u={signal:r.signal,...l?{duplex:"half"}:{},method:"GET",...o};s&&(u.method=s.toUpperCase());try{return await this.fetch.call(void 0,e,u)}finally{clearTimeout(a)}}async shouldRetry(e){let t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||!!(e.status>=500))}async retryRequest(e,t,n,r){let i,s=r?.get("retry-after-ms");if(s){let e=parseFloat(s);Number.isNaN(e)||(i=e)}let o=r?.get("retry-after");if(o&&!i){let e=parseFloat(o);i=Number.isNaN(e)?Date.parse(o)-Date.now():1e3*e}if(!(i&&0<=i&&i<6e4)){let n=e.maxRetries??this.maxRetries;i=this.calculateDefaultRetryTimeoutMillis(t,n)}return await iU(i),this.makeRequest(e,t-1,n)}calculateDefaultRetryTimeoutMillis(e,t){return Math.min(.5*Math.pow(2,t-e),8)*(1-.25*Math.random())*1e3}async buildRequest(e,{retryCount:t=0}={}){let n={...e},{method:r,path:i,query:s,defaultBaseURL:o}=n,a=this.buildURL(i,s,o);"timeout"in n&&((e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new ig(`${e} must be an integer`);if(t<0)throw new ig(`${e} must be a positive integer`)})("timeout",n.timeout),n.timeout=n.timeout??this.timeout;let{bodyHeaders:l,body:u}=this.buildBody({options:n}),c=await this.buildHeaders({options:e,method:r,bodyHeaders:l,retryCount:t});return{req:{method:r,headers:c,...n.signal&&{signal:n.signal},...globalThis.ReadableStream&&u instanceof globalThis.ReadableStream&&{duplex:"half"},...u&&{body:u},...this.fetchOptions??{},...n.fetchOptions??{}},url:a,timeout:n.timeout}}async buildHeaders({options:e,method:n,bodyHeaders:r,retryCount:i}){let s={};this.idempotencyHeader&&"get"!==n&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),s[this.idempotencyHeader]=e.idempotencyKey);let o=s4([s,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(i),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...t??(t=(()=>{let e="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ij,"X-Stainless-OS":i$(Deno.build.os),"X-Stainless-Arch":iq(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ij,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ij,"X-Stainless-OS":i$(globalThis.process.platform??"unknown"),"X-Stainless-Arch":iq(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let t=function(){if("undefined"==typeof navigator||!navigator)return null;for(let{key:e,pattern:t}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let n=t.exec(navigator.userAgent);if(n){let t=n[1]||0,r=n[2]||0,i=n[3]||0;return{browser:e,version:`${t}.${r}.${i}`}}}return null}();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ij,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ij,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}})()),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(e),this._options.defaultHeaders,r,e.headers]);return this.validateHeaders(o),o.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let n=s4([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||"string"==typeof e&&n.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:"object"==typeof e&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&"function"==typeof e.next)?{bodyHeaders:void 0,body:iH(e)}:id(this,t7,"f").call(this,{body:e,headers:n})}}t5=o0,t7=new WeakMap,t9=new WeakSet,ne=function(){return"https://api.openai.com/v1"!==this.baseURL},o0.OpenAI=t5,o0.DEFAULT_TIMEOUT=6e5,o0.OpenAIError=ig,o0.APIError=i_,o0.APIConnectionError=iv,o0.APIConnectionTimeoutError=iE,o0.APIUserAbortError=iy,o0.NotFoundError=iO,o0.ConflictError=iA,o0.RateLimitError=iC,o0.BadRequestError=ib,o0.AuthenticationError=iS,o0.InternalServerError=iI,o0.PermissionDeniedError=iT,o0.UnprocessableEntityError=iw,o0.InvalidWebhookSignatureError=iN,o0.toFile=sC,o0.Completions=oh,o0.Chat=s1,o0.Embeddings=ov,o0.Files=oT,o0.Images=oM,o0.Audio=s9,o0.Moderations=oL,o0.Models=oD,o0.FineTuning=oN,o0.Graders=ok,o0.VectorStores=oz,o0.Webhooks=oZ,o0.Beta=op,o0.Batches=s5,o0.Uploads=oJ,o0.Responses=oV,o0.Realtime=oq,o0.Conversations=oy,o0.Evals=oS,o0.Containers=og,o0.Videos=oQ;var o1=e.i(76590);process.env.GEMINI_API_KEY?console.log(" [GeminiService] GEMINI_API_KEY detectada com sucesso."):console.error(" [GeminiService] Varivel de ambiente GEMINI_API_KEY no configurada!"),process.env.OPENAI_API_KEY?console.log(" [OpenAIService] OPENAI_API_KEY detectada com sucesso."):console.error(" [OpenAIService] Varivel de ambiente OPENAI_API_KEY no configurada!");let o2=new class{constructor(e){var t,n,r,i,a,l;if((e.project||e.location)&&e.apiKey)throw Error("Project/location and API key are mutually exclusive in the client initializer.");this.vertexai=null!=(n=null!=(t=e.vertexai)?t:function(e){var t;return void 0!==(t=iu(e))&&"true"===t.toLowerCase()}("GOOGLE_GENAI_USE_VERTEXAI"))&&n;const u=function(){let e=iu("GOOGLE_API_KEY"),t=iu("GEMINI_API_KEY");return e&&t&&console.warn("Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY."),e||t||void 0}(),c=iu("GOOGLE_CLOUD_PROJECT"),d=iu("GOOGLE_CLOUD_LOCATION");this.apiKey=null!=(r=e.apiKey)?r:u,this.project=null!=(i=e.project)?i:c,this.location=null!=(a=e.location)?a:d,e.vertexai&&((null==(l=e.googleAuthOptions)?void 0:l.credentials)&&(console.debug("The user provided Google Cloud credentials will take precedence over the API key from the environment variable."),this.apiKey=void 0),(c||d)&&e.apiKey?(console.debug("The user provided Vertex AI API key will take precedence over the project/location from the environment variables."),this.project=void 0,this.location=void 0):(e.project||e.location)&&u?(console.debug("The user provided project/location will take precedence over the API key from the environment variables."),this.apiKey=void 0):(c||d)&&u&&(console.debug("The project/location from the environment variables will take precedence over the API key from the environment variables."),this.apiKey=void 0));const p=function(e,t,n,r){return(null==e?void 0:e.baseUrl)?e.baseUrl:t?null!=o?o:n:null!=s?s:r}(e.httpOptions,e.vertexai,iu("GOOGLE_VERTEX_BASE_URL"),iu("GOOGLE_GEMINI_BASE_URL"));p&&(e.httpOptions?e.httpOptions.baseUrl=p:e.httpOptions={baseUrl:p}),this.apiVersion=e.apiVersion;const h=new r6({apiKey:this.apiKey,googleAuthOptions:e.googleAuthOptions});this.apiClient=new rq({auth:h,project:this.project,location:this.location,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:"gl-node/"+process.version,uploader:new il,downloader:new r3}),this.models=new r0(this.apiClient),this.live=new rK(this.apiClient,h,new r5),this.batches=new ro(this.apiClient),this.chats=new rf(this.models,this.apiClient),this.caches=new rl(this.apiClient),this.files=new r_(this.apiClient),this.operations=new r1(this.apiClient),this.authTokens=new r2(this.apiClient),this.tunings=new ir(this.apiClient)}}({apiKey:process.env.GEMINI_API_KEY}),o4=new o0({apiKey:process.env.OPENAI_API_KEY});async function o8(){let e=await (0,o1.getSettings)();if(!e)throw Error("Configuraes de IA no encontradas no banco.");return e}let o6=async(e,t,n)=>{console.log(" [writeNewsArticle] Gerando artigo com OpenAI (GPT-4o-mini)");let r=await o8(),i=r.writer_instructions+`
Tema: "${e}"  
Idioma: ${t}  
Palavras-chave foco: ${n}

`;console.log(`[writeNewsArticle] Tema: ${e}`),console.log(`[writeNewsArticle] Idioma: ${t}`),console.log(`[writeNewsArticle] Palavras-chave: ${n}`),console.log(`[writeNewsArticle] Instru\xe7\xf5es utilizadas:`,r.writer_instructions);try{let e=await o4.chat.completions.create({model:"gpt-4o-mini",messages:[{role:"user",content:i}],temperature:.8}),t=e.choices[0]?.message?.content||"";return console.log(" [writeNewsArticle] Artigo gerado com sucesso."),t.trim()}catch(e){throw console.error(" [writeNewsArticle] Erro:",e),Error("Falha ao gerar o artigo de notcia pela OpenAI.")}},o3=async e=>{console.log(" [formatArticleToHtml] Iniciando formatao com Gemini");let t=await o8(),n=t.formatter_instructions+`

Texto para formatar:
${e}

`;console.log("[formatArticleToHtml] Instrues utilizadas:",t.formatter_instructions);try{let e=(await o2.models.generateContent({model:t.formatter_model||"gemini-1.5-flash",contents:[{parts:[{text:n}]}]})).text||"";return e.startsWith("```html")&&(e=e.slice(7)),e.endsWith("```")&&(e=e.slice(0,-3)),console.log(" [formatArticleToHtml] HTML gerado com sucesso. Tamanho:",e.length),e.trim()}catch(e){throw console.error(" [formatArticleToHtml] Erro ao gerar HTML:",e),Error("Falha ao formatar o artigo para HTML.")}},o9=async(e,t)=>{console.log(" [analyzeSeoAndExtractMetadata] Iniciando anlise SEO com Gemini");let n=await o8(),r=n.seo_instructions;console.log("[analyzeSeoAndExtractMetadata] Instrues utilizadas:",n.seo_instructions);try{let e=await o2.models.generateContent({model:n.seo_model||"gemini-1.5-flash",contents:[{parts:[{text:r}]}],config:{responseMimeType:"application/json",responseSchema:{type:eo.OBJECT,properties:{keywords:{type:eo.ARRAY,items:{type:eo.STRING}},metaDescription:{type:eo.STRING}}}}}),t=JSON.parse(e.text);return console.log(" [analyzeSeoAndExtractMetadata] SEO extrado:",t),{keywords:t.keywords||[],metaDescription:t.metaDescription||""}}catch(e){return console.error(" [analyzeSeoAndExtractMetadata] Erro SEO:",e),{keywords:[],metaDescription:"No foi possvel gerar a meta descrio."}}};e.s(["analyzeSeoAndExtractMetadata",0,o9,"formatArticleToHtml",0,o3,"writeNewsArticle",0,o6],94943);var o5=e.i(98323);if(o5.neonConfig.fetchConnectionCache=!0,!process.env.POSTGRES_URL)throw Error("Varivel de ambiente POSTGRES_URL no definida.");let o7=(0,o5.neon)(process.env.POSTGRES_URL),ae=e=>({id:String(e.id),generationDate:e.generation_date,title:e.title,rawContent:e.raw_content,formattedContent:e.formatted_content||"",published:e.published,keywords:Array.isArray(e.keywords)?e.keywords:"string"==typeof e.keywords?e.keywords.split(",").map(e=>e.trim()):[],metaDescription:e.meta_description||""});async function at(){try{await o7`
      CREATE TABLE IF NOT EXISTS articles (
        id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
        generation_date TIMESTAMPTZ NOT NULL,
        title TEXT NOT NULL,
        raw_content TEXT NOT NULL,
        formatted_content TEXT,
        published BOOLEAN NOT NULL DEFAULT false,
        keywords TEXT[],
        meta_description TEXT
      );
    `,console.log(" Tabela 'articles' verificada/criada com sucesso.")}catch(e){throw console.error(" Falha na configurao do banco de dados:",e),Error("Falha ao configurar a tabela do banco de dados.")}}async function an(e){try{let t=await o7`
      INSERT INTO articles (
        generation_date, title, raw_content, formatted_content, published, keywords, meta_description
      )
      VALUES (
        ${e.generationDate},
        ${e.title},
        ${e.rawContent},
        ${e.formattedContent||""},
        ${e.published??!1},
        ${Array.isArray(e.keywords)?e.keywords:[e.keywords]},
        ${e.metaDescription||""}
      )
      RETURNING *;
    `,n=Array.isArray(t)?t[0]:t;return console.log(` Artigo salvo com sucesso (ID: ${n.id})`),ae(n)}catch(e){throw console.error(" Erro ao salvar artigo:",e),Error("Falha ao salvar o artigo.")}}async function ar(e){try{let t=await o7`SELECT * FROM articles WHERE id = ${e} LIMIT 1;`,n=Array.isArray(t)?t[0]:t;if(!n)return null;return console.log("## retorno do select"),console.log(n),ae(n)}catch(e){throw console.error(" Erro ao buscar artigo:",e),Error("Falha ao buscar o artigo por ID.")}}async function ai(e,t){try{let n=Object.keys(t);if(0===n.length)return;let r=n.map((e,t)=>`${e.replace(/([A-Z])/g,"_$1").toLowerCase()} = $${t+1}`).join(", "),i=Object.values(t),s=`
      UPDATE articles
      SET ${r}
      WHERE id = $${n.length+1};
    `;await o7(s,[...i,e]),console.log(` Artigo ${e} atualizado (${n.join(", ")})`)}catch(e){throw console.error(" Erro ao atualizar artigo:",e),Error("Falha ao atualizar o artigo.")}}async function as(){try{let e=await o7`SELECT * FROM articles ORDER BY generation_date DESC;`;return(Array.isArray(e)?e:e?[e]:[]).map(ae)}catch(e){throw console.error(" Erro ao buscar artigos:",e),Error("Falha ao buscar os artigos.")}}async function ao(e,t,n){try{let r=await o6(e,t,n),i=await o3(r),{keywords:s,metaDescription:o}=await o9(r,n),a={title:e,rawContent:r,formattedContent:i,generationDate:new Date().toISOString(),published:!1,keywords:s,metaDescription:o},l=await an(a);return(0,nn.revalidatePath)("/dashboard/history"),{...l,published:!0}}catch(e){throw console.error(" Erro em generateAndSaveArticleAction:",e),Error(`Falha ao gerar e salvar o artigo: ${e instanceof Error?e.message:String(e)}`)}}async function aa(e){try{let t={title:e.title,rawContent:e.content,formattedContent:"",generationDate:new Date().toISOString(),published:!1,keywords:[""],metaDescription:""},n=await an(t);return console.log(` Rascunho salvo com ID: ${n.id}`),(0,nn.revalidatePath)("/dashboard/history"),n}catch(e){throw console.error(" Erro ao salvar rascunho:",e),Error("Falha ao salvar rascunho.")}}async function al(e){try{return await ar(e)}catch(e){return console.error(" Erro ao buscar artigo:",e),null}}async function au(e,t){try{await ai(e,{formattedContent:t}),console.log(` HTML atualizado com sucesso para o artigo ${e}`),(0,nn.revalidatePath)("/dashboard/history")}catch(e){throw console.error(" Erro ao atualizar HTML:",e),Error("Falha ao atualizar o HTML do artigo.")}}async function ac(e,t){try{let n;n=Array.isArray(t.keywords)?t.keywords:"string"==typeof t.keywords?t.keywords.split(",").map(e=>e.trim()):[];let r=t.metaDescription||"";await ai(e,{keywords:n,metaDescription:r,published:!0,generationDate:new Date().toISOString()}),console.log(` SEO atualizado e artigo ${e} publicado com sucesso.`),(0,nn.revalidatePath)("/dashboard/history")}catch(e){throw console.error(" Erro ao atualizar SEO:",e),Error(e?.message||"Falha ao atualizar os dados de SEO do artigo.")}}async function ad(){try{return await at(),await as()}catch(e){return console.error(" Erro em getArticlesAction:",e),[]}}(0,e.i(95975).ensureServerEntryExports)([ao,aa,al,au,ac,ad]),(0,nt.registerServerReference)(ao,"70f12876fc0e134895d97a7ded794efaca2a696c9b",null),(0,nt.registerServerReference)(aa,"40beaf35ecbbfb8886c6be979c13bf3516a379c0e5",null),(0,nt.registerServerReference)(al,"400e61989097eb8b9f68c780e0d03ac63cfdf09c02",null),(0,nt.registerServerReference)(au,"600f1d6fd2e8bc63d9f50ada752da9b53c4faada57",null),(0,nt.registerServerReference)(ac,"60b3884135d67f03b04d28d68149fff07fc9729e4b",null),(0,nt.registerServerReference)(ad,"00fe0019f97a45ff59a91728708b782e5fa671df37",null),e.s(["generateAndSaveArticleAction",()=>ao,"getArticleById",()=>al,"saveArticleDraft",()=>aa,"updateArticleHtml",()=>au,"updateArticleSeo",()=>ac],7312)}];

//# sourceMappingURL=_bc002d27._.js.map