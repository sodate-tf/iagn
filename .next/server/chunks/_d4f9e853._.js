module.exports=[74836,(e,t,r)=>{"use strict";let n=["nodebuffer","arraybuffer","fragments"],i="undefined"!=typeof Blob;i&&n.push("blob"),t.exports={BINARY_TYPES:n,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:i,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}},97970,(e,t,r)=>{"use strict";let{EMPTY_BUFFER:n}=e.r(74836),i=Buffer[Symbol.species];function o(e,t,r,n,i){for(let o=0;o<i;o++)r[n+o]=e[o]^t[3&o]}function s(e,t){for(let r=0;r<e.length;r++)e[r]^=t[3&r]}function a(e){let t;return(a.readOnly=!0,Buffer.isBuffer(e))?e:(e instanceof ArrayBuffer?t=new i(e):ArrayBuffer.isView(e)?t=new i(e.buffer,e.byteOffset,e.byteLength):(t=Buffer.from(e),a.readOnly=!1),t)}if(t.exports={concat:function(e,t){if(0===e.length)return n;if(1===e.length)return e[0];let r=Buffer.allocUnsafe(t),o=0;for(let t=0;t<e.length;t++){let n=e[t];r.set(n,o),o+=n.length}return o<t?new i(r.buffer,r.byteOffset,o):r},mask:o,toArrayBuffer:function(e){return e.length===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.length)},toBuffer:a,unmask:s},!process.env.WS_NO_BUFFER_UTIL)try{let e=(()=>{let e=Error("Cannot find module 'bufferutil'");throw e.code="MODULE_NOT_FOUND",e})();t.exports.mask=function(t,r,n,i,s){s<48?o(t,r,n,i,s):e.mask(t,r,n,i,s)},t.exports.unmask=function(t,r){t.length<32?s(t,r):e.unmask(t,r)}}catch(e){}},62048,(e,t,r)=>{"use strict";let n=Symbol("kDone"),i=Symbol("kRun");t.exports=class{constructor(e){this[n]=()=>{this.pending--,this[i]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[i]()}[i](){if(this.pending!==this.concurrency&&this.jobs.length){let e=this.jobs.shift();this.pending++,e(this[n])}}}},80295,(e,t,r)=>{"use strict";let n,i=e.r(6461),o=e.r(97970),s=e.r(62048),{kStatusCode:a}=e.r(74836),l=Buffer[Symbol.species],u=Buffer.from([0,0,255,255]),c=Symbol("permessage-deflate"),d=Symbol("total-length"),h=Symbol("callback"),p=Symbol("buffers"),f=Symbol("error");function m(e){this[p].push(e),this[d]+=e.length}function g(e){(this[d]+=e.length,this[c]._maxPayload<1||this[d]<=this[c]._maxPayload)?this[p].push(e):(this[f]=RangeError("Max payload size exceeded"),this[f].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[f][a]=1009,this.removeListener("data",g),this.reset())}function y(e){(this[c]._inflate=null,this[f])?this[h](this[f]):(e[a]=1007,this[h](e))}t.exports=class{constructor(e,t,r){this._maxPayload=0|r,this._options=e||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,n||(n=new s(void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10))}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let e=this._deflate[h];this._deflate.close(),this._deflate=null,e&&e(Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){let t=this._options,r=e.find(e=>(!1!==t.serverNoContextTakeover||!e.server_no_context_takeover)&&(!e.server_max_window_bits||!1!==t.serverMaxWindowBits&&("number"!=typeof t.serverMaxWindowBits||!(t.serverMaxWindowBits>e.server_max_window_bits)))&&("number"!=typeof t.clientMaxWindowBits||!!e.client_max_window_bits));if(!r)throw Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(r.server_no_context_takeover=!0),t.clientNoContextTakeover&&(r.client_no_context_takeover=!0),"number"==typeof t.serverMaxWindowBits&&(r.server_max_window_bits=t.serverMaxWindowBits),"number"==typeof t.clientMaxWindowBits?r.client_max_window_bits=t.clientMaxWindowBits:(!0===r.client_max_window_bits||!1===t.clientMaxWindowBits)&&delete r.client_max_window_bits,r}acceptAsClient(e){let t=e[0];if(!1===this._options.clientNoContextTakeover&&t.client_no_context_takeover)throw Error('Unexpected parameter "client_no_context_takeover"');if(t.client_max_window_bits){if(!1===this._options.clientMaxWindowBits||"number"==typeof this._options.clientMaxWindowBits&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw Error('Unexpected or invalid parameter "client_max_window_bits"')}else"number"==typeof this._options.clientMaxWindowBits&&(t.client_max_window_bits=this._options.clientMaxWindowBits);return t}normalizeParams(e){return e.forEach(e=>{Object.keys(e).forEach(t=>{let r=e[t];if(r.length>1)throw Error(`Parameter "${t}" must have only a single value`);if(r=r[0],"client_max_window_bits"===t){if(!0!==r){let e=+r;if(!Number.isInteger(e)||e<8||e>15)throw TypeError(`Invalid value for parameter "${t}": ${r}`);r=e}else if(!this._isServer)throw TypeError(`Invalid value for parameter "${t}": ${r}`)}else if("server_max_window_bits"===t){let e=+r;if(!Number.isInteger(e)||e<8||e>15)throw TypeError(`Invalid value for parameter "${t}": ${r}`);r=e}else if("client_no_context_takeover"===t||"server_no_context_takeover"===t){if(!0!==r)throw TypeError(`Invalid value for parameter "${t}": ${r}`)}else throw Error(`Unknown parameter "${t}"`);e[t]=r})}),e}decompress(e,t,r){n.add(n=>{this._decompress(e,t,(e,t)=>{n(),r(e,t)})})}compress(e,t,r){n.add(n=>{this._compress(e,t,(e,t)=>{n(),r(e,t)})})}_decompress(e,t,r){let n=this._isServer?"client":"server";if(!this._inflate){let e=`${n}_max_window_bits`,t="number"!=typeof this.params[e]?i.Z_DEFAULT_WINDOWBITS:this.params[e];this._inflate=i.createInflateRaw({...this._options.zlibInflateOptions,windowBits:t}),this._inflate[c]=this,this._inflate[d]=0,this._inflate[p]=[],this._inflate.on("error",y),this._inflate.on("data",g)}this._inflate[h]=r,this._inflate.write(e),t&&this._inflate.write(u),this._inflate.flush(()=>{let e=this._inflate[f];if(e){this._inflate.close(),this._inflate=null,r(e);return}let i=o.concat(this._inflate[p],this._inflate[d]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[d]=0,this._inflate[p]=[],t&&this.params[`${n}_no_context_takeover`]&&this._inflate.reset()),r(null,i)})}_compress(e,t,r){let n=this._isServer?"server":"client";if(!this._deflate){let e=`${n}_max_window_bits`,t="number"!=typeof this.params[e]?i.Z_DEFAULT_WINDOWBITS:this.params[e];this._deflate=i.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:t}),this._deflate[d]=0,this._deflate[p]=[],this._deflate.on("data",m)}this._deflate[h]=r,this._deflate.write(e),this._deflate.flush(i.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let e=o.concat(this._deflate[p],this._deflate[d]);t&&(e=new l(e.buffer,e.byteOffset,e.length-4)),this._deflate[h]=null,this._deflate[d]=0,this._deflate[p]=[],t&&this.params[`${n}_no_context_takeover`]&&this._deflate.reset(),r(null,e)})}}},58739,(e,t,r)=>{"use strict";let{isUtf8:n}=e.r(874),{hasBlob:i}=e.r(74836);function o(e){let t=e.length,r=0;for(;r<t;)if((128&e[r])==0)r++;else if((224&e[r])==192){if(r+1===t||(192&e[r+1])!=128||(254&e[r])==192)return!1;r+=2}else if((240&e[r])==224){if(r+2>=t||(192&e[r+1])!=128||(192&e[r+2])!=128||224===e[r]&&(224&e[r+1])==128||237===e[r]&&(224&e[r+1])==160)return!1;r+=3}else{if((248&e[r])!=240||r+3>=t||(192&e[r+1])!=128||(192&e[r+2])!=128||(192&e[r+3])!=128||240===e[r]&&(240&e[r+1])==128||244===e[r]&&e[r+1]>143||e[r]>244)return!1;r+=4}return!0}if(t.exports={isBlob:function(e){return i&&"object"==typeof e&&"function"==typeof e.arrayBuffer&&"string"==typeof e.type&&"function"==typeof e.stream&&("Blob"===e[Symbol.toStringTag]||"File"===e[Symbol.toStringTag])},isValidStatusCode:function(e){return e>=1e3&&e<=1014&&1004!==e&&1005!==e&&1006!==e||e>=3e3&&e<=4999},isValidUTF8:o,tokenChars:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0]},n)t.exports.isValidUTF8=function(e){return e.length<24?o(e):n(e)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let e=(()=>{let e=Error("Cannot find module 'utf-8-validate'");throw e.code="MODULE_NOT_FOUND",e})();t.exports.isValidUTF8=function(t){return t.length<32?o(t):e(t)}}catch(e){}},29485,(e,t,r)=>{"use strict";let{Writable:n}=e.r(88947),i=e.r(80295),{BINARY_TYPES:o,EMPTY_BUFFER:s,kStatusCode:a,kWebSocket:l}=e.r(74836),{concat:u,toArrayBuffer:c,unmask:d}=e.r(97970),{isValidStatusCode:h,isValidUTF8:p}=e.r(58739),f=Buffer[Symbol.species];t.exports=class extends n{constructor(e={}){super(),this._allowSynchronousEvents=void 0===e.allowSynchronousEvents||e.allowSynchronousEvents,this._binaryType=e.binaryType||o[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=0|e.maxPayload,this._skipUTF8Validation=!!e.skipUTF8Validation,this[l]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=0}_write(e,t,r){if(8===this._opcode&&0==this._state)return r();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(r)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let t=this._buffers[0];return this._buffers[0]=new f(t.buffer,t.byteOffset+e,t.length-e),new f(t.buffer,t.byteOffset,e)}let t=Buffer.allocUnsafe(e);do{let r=this._buffers[0],n=t.length-e;e>=r.length?t.set(this._buffers.shift(),n):(t.set(new Uint8Array(r.buffer,r.byteOffset,e),n),this._buffers[0]=new f(r.buffer,r.byteOffset+e,r.length-e)),e-=r.length}while(e>0)return t}startLoop(e){this._loop=!0;do switch(this._state){case 0:this.getInfo(e);break;case 1:this.getPayloadLength16(e);break;case 2:this.getPayloadLength64(e);break;case 3:this.getMask();break;case 4:this.getData(e);break;case 5:case 6:this._loop=!1;return}while(this._loop)this._errored||e()}getInfo(e){if(this._bufferedBytes<2){this._loop=!1;return}let t=this.consume(2);if((48&t[0])!=0)return void e(this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3"));let r=(64&t[0])==64;if(r&&!this._extensions[i.extensionName])return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));if(this._fin=(128&t[0])==128,this._opcode=15&t[0],this._payloadLength=127&t[1],0===this._opcode){if(r)return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));if(!this._fragmented)return void e(this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE"));this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented)return void e(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"));this._compressed=r}else{if(!(this._opcode>7)||!(this._opcode<11))return void e(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"));if(!this._fin)return void e(this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN"));if(r)return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));if(this._payloadLength>125||8===this._opcode&&1===this._payloadLength)return void e(this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH"))}if(this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=(128&t[1])==128,this._isServer){if(!this._masked)return void e(this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK"))}else if(this._masked)return void e(this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK"));126===this._payloadLength?this._state=1:127===this._payloadLength?this._state=2:this.haveLength(e)}getPayloadLength16(e){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e)}getPayloadLength64(e){if(this._bufferedBytes<8){this._loop=!1;return}let t=this.consume(8),r=t.readUInt32BE(0);r>2097151?e(this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH")):(this._payloadLength=0x100000000*r+t.readUInt32BE(4),this.haveLength(e))}haveLength(e){this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)?e(this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH")):this._masked?this._state=3:this._state=4}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=4}getData(e){let t=s;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}t=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!=0&&d(t,this._mask)}if(this._opcode>7)return void this.controlMessage(t,e);if(this._compressed){this._state=5,this.decompress(t,e);return}t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage(e)}decompress(e,t){this._extensions[i.extensionName].decompress(e,this._fin,(e,r)=>{if(e)return t(e);if(r.length){if(this._messageLength+=r.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return void t(this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));this._fragments.push(r)}this.dataMessage(t),0===this._state&&this.startLoop(t)})}dataMessage(e){if(!this._fin){this._state=0;return}let t=this._messageLength,r=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){let n;n="nodebuffer"===this._binaryType?u(r,t):"arraybuffer"===this._binaryType?c(u(r,t)):"blob"===this._binaryType?new Blob(r):r,this._allowSynchronousEvents?(this.emit("message",n,!0),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",n,!0),this._state=0,this.startLoop(e)}))}else{let n=u(r,t);if(!this._skipUTF8Validation&&!p(n))return void e(this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8"));5===this._state||this._allowSynchronousEvents?(this.emit("message",n,!1),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",n,!1),this._state=0,this.startLoop(e)}))}}controlMessage(e,t){if(8===this._opcode){if(0===e.length)this._loop=!1,this.emit("conclude",1005,s),this.end();else{let r=e.readUInt16BE(0);if(!h(r))return void t(this.createError(RangeError,`invalid status code ${r}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE"));let n=new f(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!p(n))return void t(this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8"));this._loop=!1,this.emit("conclude",r,n),this.end()}this._state=0;return}this._allowSynchronousEvents?(this.emit(9===this._opcode?"ping":"pong",e),this._state=0):(this._state=6,setImmediate(()=>{this.emit(9===this._opcode?"ping":"pong",e),this._state=0,this.startLoop(t)}))}createError(e,t,r,n,i){this._loop=!1,this._errored=!0;let o=new e(r?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(o,this.createError),o.code=i,o[a]=n,o}}},16735,(e,t,r)=>{"use strict";let n,{Duplex:i}=e.r(88947),{randomFillSync:o}=e.r(54799),s=e.r(80295),{EMPTY_BUFFER:a,kWebSocket:l,NOOP:u}=e.r(74836),{isBlob:c,isValidStatusCode:d}=e.r(58739),{mask:h,toBuffer:p}=e.r(97970),f=Symbol("kByteLength"),m=Buffer.alloc(4),g=8192;class y{constructor(e,t,r){this._extensions=t||{},r&&(this._generateMask=r,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=0,this.onerror=u,this[l]=void 0}static frame(e,t){let r,i,s=!1,a=2,l=!1;t.mask&&(r=t.maskBuffer||m,t.generateMask?t.generateMask(r):(8192===g&&(void 0===n&&(n=Buffer.alloc(8192)),o(n,0,8192),g=0),r[0]=n[g++],r[1]=n[g++],r[2]=n[g++],r[3]=n[g++]),l=(r[0]|r[1]|r[2]|r[3])==0,a=6),"string"==typeof e?i=(!t.mask||l)&&void 0!==t[f]?t[f]:(e=Buffer.from(e)).length:(i=e.length,s=t.mask&&t.readOnly&&!l);let u=i;i>=65536?(a+=8,u=127):i>125&&(a+=2,u=126);let c=Buffer.allocUnsafe(s?i+a:a);return(c[0]=t.fin?128|t.opcode:t.opcode,t.rsv1&&(c[0]|=64),c[1]=u,126===u?c.writeUInt16BE(i,2):127===u&&(c[2]=c[3]=0,c.writeUIntBE(i,4,6)),t.mask)?(c[1]|=128,c[a-4]=r[0],c[a-3]=r[1],c[a-2]=r[2],c[a-1]=r[3],l)?[c,e]:s?(h(e,r,c,a,i),[c]):(h(e,r,e,0,i),[c,e]):[c,e]}close(e,t,r,n){let i;if(void 0===e)i=a;else if("number"==typeof e&&d(e))if(void 0!==t&&t.length){let r=Buffer.byteLength(t);if(r>123)throw RangeError("The message must not be greater than 123 bytes");(i=Buffer.allocUnsafe(2+r)).writeUInt16BE(e,0),"string"==typeof t?i.write(t,2):i.set(t,2)}else(i=Buffer.allocUnsafe(2)).writeUInt16BE(e,0);else throw TypeError("First argument must be a valid error code number");let o={[f]:i.length,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};0!==this._state?this.enqueue([this.dispatch,i,!1,o,n]):this.sendFrame(y.frame(i,o),n)}ping(e,t,r){let n,i;if("string"==typeof e?(n=Buffer.byteLength(e),i=!1):c(e)?(n=e.size,i=!1):(n=(e=p(e)).length,i=p.readOnly),n>125)throw RangeError("The data size must not be greater than 125 bytes");let o={[f]:n,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:9,readOnly:i,rsv1:!1};c(e)?0!==this._state?this.enqueue([this.getBlobData,e,!1,o,r]):this.getBlobData(e,!1,o,r):0!==this._state?this.enqueue([this.dispatch,e,!1,o,r]):this.sendFrame(y.frame(e,o),r)}pong(e,t,r){let n,i;if("string"==typeof e?(n=Buffer.byteLength(e),i=!1):c(e)?(n=e.size,i=!1):(n=(e=p(e)).length,i=p.readOnly),n>125)throw RangeError("The data size must not be greater than 125 bytes");let o={[f]:n,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:10,readOnly:i,rsv1:!1};c(e)?0!==this._state?this.enqueue([this.getBlobData,e,!1,o,r]):this.getBlobData(e,!1,o,r):0!==this._state?this.enqueue([this.dispatch,e,!1,o,r]):this.sendFrame(y.frame(e,o),r)}send(e,t,r){let n,i,o=this._extensions[s.extensionName],a=t.binary?2:1,l=t.compress;"string"==typeof e?(n=Buffer.byteLength(e),i=!1):c(e)?(n=e.size,i=!1):(n=(e=p(e)).length,i=p.readOnly),this._firstFragment?(this._firstFragment=!1,l&&o&&o.params[o._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(l=n>=o._threshold),this._compress=l):(l=!1,a=0),t.fin&&(this._firstFragment=!0);let u={[f]:n,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:a,readOnly:i,rsv1:l};c(e)?0!==this._state?this.enqueue([this.getBlobData,e,this._compress,u,r]):this.getBlobData(e,this._compress,u,r):0!==this._state?this.enqueue([this.dispatch,e,this._compress,u,r]):this.dispatch(e,this._compress,u,r)}getBlobData(e,t,r,n){this._bufferedBytes+=r[f],this._state=2,e.arrayBuffer().then(e=>{if(this._socket.destroyed){let e=Error("The socket was closed while the blob was being read");process.nextTick(_,this,e,n);return}this._bufferedBytes-=r[f];let i=p(e);t?this.dispatch(i,t,r,n):(this._state=0,this.sendFrame(y.frame(i,r),n),this.dequeue())}).catch(e=>{process.nextTick(v,this,e,n)})}dispatch(e,t,r,n){if(!t)return void this.sendFrame(y.frame(e,r),n);let i=this._extensions[s.extensionName];this._bufferedBytes+=r[f],this._state=1,i.compress(e,r.fin,(e,t)=>{this._socket.destroyed?_(this,Error("The socket was closed while data was being compressed"),n):(this._bufferedBytes-=r[f],this._state=0,r.readOnly=!1,this.sendFrame(y.frame(t,r),n),this.dequeue())})}dequeue(){for(;0===this._state&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[3][f],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][f],this._queue.push(e)}sendFrame(e,t){2===e.length?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}}function _(e,t,r){"function"==typeof r&&r(t);for(let r=0;r<e._queue.length;r++){let n=e._queue[r],i=n[n.length-1];"function"==typeof i&&i(t)}}function v(e,t,r){_(e,t,r),e.onerror(t)}t.exports=y},70494,(e,t,r)=>{"use strict";let{kForOnEventAttribute:n,kListener:i}=e.r(74836),o=Symbol("kCode"),s=Symbol("kData"),a=Symbol("kError"),l=Symbol("kMessage"),u=Symbol("kReason"),c=Symbol("kTarget"),d=Symbol("kType"),h=Symbol("kWasClean");class p{constructor(e){this[c]=null,this[d]=e}get target(){return this[c]}get type(){return this[d]}}Object.defineProperty(p.prototype,"target",{enumerable:!0}),Object.defineProperty(p.prototype,"type",{enumerable:!0});class f extends p{constructor(e,t={}){super(e),this[o]=void 0===t.code?0:t.code,this[u]=void 0===t.reason?"":t.reason,this[h]=void 0!==t.wasClean&&t.wasClean}get code(){return this[o]}get reason(){return this[u]}get wasClean(){return this[h]}}Object.defineProperty(f.prototype,"code",{enumerable:!0}),Object.defineProperty(f.prototype,"reason",{enumerable:!0}),Object.defineProperty(f.prototype,"wasClean",{enumerable:!0});class m extends p{constructor(e,t={}){super(e),this[a]=void 0===t.error?null:t.error,this[l]=void 0===t.message?"":t.message}get error(){return this[a]}get message(){return this[l]}}Object.defineProperty(m.prototype,"error",{enumerable:!0}),Object.defineProperty(m.prototype,"message",{enumerable:!0});class g extends p{constructor(e,t={}){super(e),this[s]=void 0===t.data?null:t.data}get data(){return this[s]}}function y(e,t,r){"object"==typeof e&&e.handleEvent?e.handleEvent.call(e,r):e.call(t,r)}Object.defineProperty(g.prototype,"data",{enumerable:!0}),t.exports={CloseEvent:f,ErrorEvent:m,Event:p,EventTarget:{addEventListener(e,t,r={}){let o;for(let o of this.listeners(e))if(!r[n]&&o[i]===t&&!o[n])return;if("message"===e)o=function(e,r){let n=new g("message",{data:r?e:e.toString()});n[c]=this,y(t,this,n)};else if("close"===e)o=function(e,r){let n=new f("close",{code:e,reason:r.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});n[c]=this,y(t,this,n)};else if("error"===e)o=function(e){let r=new m("error",{error:e,message:e.message});r[c]=this,y(t,this,r)};else{if("open"!==e)return;o=function(){let e=new p("open");e[c]=this,y(t,this,e)}}o[n]=!!r[n],o[i]=t,r.once?this.once(e,o):this.on(e,o)},removeEventListener(e,t){for(let r of this.listeners(e))if(r[i]===t&&!r[n]){this.removeListener(e,r);break}}},MessageEvent:g}},96903,(e,t,r)=>{"use strict";let{tokenChars:n}=e.r(58739);function i(e,t,r){void 0===e[t]?e[t]=[r]:e[t].push(r)}t.exports={format:function(e){return Object.keys(e).map(t=>{let r=e[t];return Array.isArray(r)||(r=[r]),r.map(e=>[t].concat(Object.keys(e).map(t=>{let r=e[t];return Array.isArray(r)||(r=[r]),r.map(e=>!0===e?t:`${t}=${e}`).join("; ")})).join("; ")).join(", ")}).join(", ")},parse:function(e){let t,r,o=Object.create(null),s=Object.create(null),a=!1,l=!1,u=!1,c=-1,d=-1,h=-1,p=0;for(;p<e.length;p++)if(d=e.charCodeAt(p),void 0===t)if(-1===h&&1===n[d])-1===c&&(c=p);else if(0!==p&&(32===d||9===d))-1===h&&-1!==c&&(h=p);else if(59===d||44===d){if(-1===c)throw SyntaxError(`Unexpected character at index ${p}`);-1===h&&(h=p);let r=e.slice(c,h);44===d?(i(o,r,s),s=Object.create(null)):t=r,c=h=-1}else throw SyntaxError(`Unexpected character at index ${p}`);else if(void 0===r)if(-1===h&&1===n[d])-1===c&&(c=p);else if(32===d||9===d)-1===h&&-1!==c&&(h=p);else if(59===d||44===d){if(-1===c)throw SyntaxError(`Unexpected character at index ${p}`);-1===h&&(h=p),i(s,e.slice(c,h),!0),44===d&&(i(o,t,s),s=Object.create(null),t=void 0),c=h=-1}else if(61===d&&-1!==c&&-1===h)r=e.slice(c,p),c=h=-1;else throw SyntaxError(`Unexpected character at index ${p}`);else if(l){if(1!==n[d])throw SyntaxError(`Unexpected character at index ${p}`);-1===c?c=p:a||(a=!0),l=!1}else if(u)if(1===n[d])-1===c&&(c=p);else if(34===d&&-1!==c)u=!1,h=p;else if(92===d)l=!0;else throw SyntaxError(`Unexpected character at index ${p}`);else if(34===d&&61===e.charCodeAt(p-1))u=!0;else if(-1===h&&1===n[d])-1===c&&(c=p);else if(-1!==c&&(32===d||9===d))-1===h&&(h=p);else if(59===d||44===d){if(-1===c)throw SyntaxError(`Unexpected character at index ${p}`);-1===h&&(h=p);let n=e.slice(c,h);a&&(n=n.replace(/\\/g,""),a=!1),i(s,r,n),44===d&&(i(o,t,s),s=Object.create(null),t=void 0),r=void 0,c=h=-1}else throw SyntaxError(`Unexpected character at index ${p}`);if(-1===c||u||32===d||9===d)throw SyntaxError("Unexpected end of input");-1===h&&(h=p);let f=e.slice(c,h);return void 0===t?i(o,f,s):(void 0===r?i(s,f,!0):a?i(s,r,f.replace(/\\/g,"")):i(s,r,f),i(o,t,s)),o}}},35065,(e,t,r)=>{"use strict";let n=e.r(27699),i=e.r(24836),o=e.r(21517),s=e.r(4446),a=e.r(55004),{randomBytes:l,createHash:u}=e.r(54799),{Duplex:c,Readable:d}=e.r(88947),{URL:h}=e.r(92509),p=e.r(80295),f=e.r(29485),m=e.r(16735),{isBlob:g}=e.r(58739),{BINARY_TYPES:y,EMPTY_BUFFER:_,GUID:v,kForOnEventAttribute:E,kListener:b,kStatusCode:S,kWebSocket:T,NOOP:A}=e.r(74836),{EventTarget:{addEventListener:C,removeEventListener:O}}=e.r(70494),{format:w,parse:I}=e.r(96903),{toBuffer:R}=e.r(97970),x=Symbol("kAborted"),P=[8,13],N=["CONNECTING","OPEN","CLOSING","CLOSED"],M=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;class D extends n{constructor(e,t,r){super(),this._binaryType=y[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=_,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=D.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,null!==e?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,void 0===t?t=[]:Array.isArray(t)||("object"==typeof t&&null!==t?(r=t,t=[]):t=[t]),function e(t,r,n,s){let a,c,d,f,m={allowSynchronousEvents:!0,autoPong:!0,protocolVersion:P[1],maxPayload:0x6400000,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...s,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(t._autoPong=m.autoPong,!P.includes(m.protocolVersion))throw RangeError(`Unsupported protocol version: ${m.protocolVersion} (supported versions: ${P.join(", ")})`);if(r instanceof h)a=r;else try{a=new h(r)}catch(e){throw SyntaxError(`Invalid URL: ${r}`)}"http:"===a.protocol?a.protocol="ws:":"https:"===a.protocol&&(a.protocol="wss:"),t._url=a.href;let g="wss:"===a.protocol,y="ws+unix:"===a.protocol;if("ws:"===a.protocol||g||y?y&&!a.pathname?c="The URL's pathname is empty":a.hash&&(c="The URL contains a fragment identifier"):c='The URL\'s protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"',c){let e=SyntaxError(c);if(0!==t._redirects)return void k(t,e);throw e}let _=g?443:80,E=l(16).toString("base64"),b=g?i.request:o.request,S=new Set;if(m.createConnection=m.createConnection||(g?U:L),m.defaultPort=m.defaultPort||_,m.port=a.port||_,m.host=a.hostname.startsWith("[")?a.hostname.slice(1,-1):a.hostname,m.headers={...m.headers,"Sec-WebSocket-Version":m.protocolVersion,"Sec-WebSocket-Key":E,Connection:"Upgrade",Upgrade:"websocket"},m.path=a.pathname+a.search,m.timeout=m.handshakeTimeout,m.perMessageDeflate&&(d=new p(!0!==m.perMessageDeflate?m.perMessageDeflate:{},!1,m.maxPayload),m.headers["Sec-WebSocket-Extensions"]=w({[p.extensionName]:d.offer()})),n.length){for(let e of n){if("string"!=typeof e||!M.test(e)||S.has(e))throw SyntaxError("An invalid or duplicated subprotocol was specified");S.add(e)}m.headers["Sec-WebSocket-Protocol"]=n.join(",")}if(m.origin&&(m.protocolVersion<13?m.headers["Sec-WebSocket-Origin"]=m.origin:m.headers.Origin=m.origin),(a.username||a.password)&&(m.auth=`${a.username}:${a.password}`),y){let e=m.path.split(":");m.socketPath=e[0],m.path=e[1]}if(m.followRedirects){if(0===t._redirects){t._originalIpc=y,t._originalSecure=g,t._originalHostOrSocketPath=y?m.socketPath:a.host;let e=s&&s.headers;if(s={...s,headers:{}},e)for(let[t,r]of Object.entries(e))s.headers[t.toLowerCase()]=r}else if(0===t.listenerCount("redirect")){let e=y?!!t._originalIpc&&m.socketPath===t._originalHostOrSocketPath:!t._originalIpc&&a.host===t._originalHostOrSocketPath;e&&(!t._originalSecure||g)||(delete m.headers.authorization,delete m.headers.cookie,e||delete m.headers.host,m.auth=void 0)}m.auth&&!s.headers.authorization&&(s.headers.authorization="Basic "+Buffer.from(m.auth).toString("base64")),f=t._req=b(m),t._redirects&&t.emit("redirect",t.url,f)}else f=t._req=b(m);m.timeout&&f.on("timeout",()=>{B(t,f,"Opening handshake has timed out")}),f.on("error",e=>{null===f||f[x]||(f=t._req=null,k(t,e))}),f.on("response",i=>{let o=i.headers.location,a=i.statusCode;if(o&&m.followRedirects&&a>=300&&a<400){let i;if(++t._redirects>m.maxRedirects)return void B(t,f,"Maximum redirects exceeded");f.abort();try{i=new h(o,r)}catch(e){k(t,SyntaxError(`Invalid URL: ${o}`));return}e(t,i,n,s)}else t.emit("unexpected-response",f,i)||B(t,f,`Unexpected server response: ${i.statusCode}`)}),f.on("upgrade",(e,r,n)=>{let i;if(t.emit("upgrade",e),t.readyState!==D.CONNECTING)return;f=t._req=null;let o=e.headers.upgrade;if(void 0===o||"websocket"!==o.toLowerCase())return void B(t,r,"Invalid Upgrade header");let s=u("sha1").update(E+v).digest("base64");if(e.headers["sec-websocket-accept"]!==s)return void B(t,r,"Invalid Sec-WebSocket-Accept header");let a=e.headers["sec-websocket-protocol"];if(void 0!==a?S.size?S.has(a)||(i="Server sent an invalid subprotocol"):i="Server sent a subprotocol but none was requested":S.size&&(i="Server sent no subprotocol"),i)return void B(t,r,i);a&&(t._protocol=a);let l=e.headers["sec-websocket-extensions"];if(void 0!==l){let e;if(!d)return void B(t,r,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");try{e=I(l)}catch(e){B(t,r,"Invalid Sec-WebSocket-Extensions header");return}let n=Object.keys(e);if(1!==n.length||n[0]!==p.extensionName)return void B(t,r,"Server indicated an extension that was not requested");try{d.accept(e[p.extensionName])}catch(e){B(t,r,"Invalid Sec-WebSocket-Extensions header");return}t._extensions[p.extensionName]=d}t.setSocket(r,n,{allowSynchronousEvents:m.allowSynchronousEvents,generateMask:m.generateMask,maxPayload:m.maxPayload,skipUTF8Validation:m.skipUTF8Validation})}),m.finishRequest?m.finishRequest(f,t):f.end()}(this,e,t,r)):(this._autoPong=r.autoPong,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){y.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,t,r){let n=new f({allowSynchronousEvents:r.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:r.maxPayload,skipUTF8Validation:r.skipUTF8Validation}),i=new m(e,this._extensions,r.generateMask);this._receiver=n,this._sender=i,this._socket=e,n[T]=this,i[T]=this,e[T]=this,n.on("conclude",j),n.on("drain",F),n.on("error",G),n.on("message",$),n.on("ping",V),n.on("pong",W),i.onerror=K,e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",Q),e.on("data",z),e.on("end",X),e.on("error",Z),this._readyState=D.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=D.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[p.extensionName]&&this._extensions[p.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=D.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==D.CLOSED){if(this.readyState===D.CONNECTING)return void B(this,this._req,"WebSocket was closed before the connection was established");if(this.readyState===D.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=D.CLOSING,this._sender.close(e,t,!this._isServer,e=>{!e&&(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),Y(this)}}pause(){this.readyState!==D.CONNECTING&&this.readyState!==D.CLOSED&&(this._paused=!0,this._socket.pause())}ping(e,t,r){if(this.readyState===D.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");("function"==typeof e?(r=e,e=t=void 0):"function"==typeof t&&(r=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState!==D.OPEN)?q(this,e,r):(void 0===t&&(t=!this._isServer),this._sender.ping(e||_,t,r))}pong(e,t,r){if(this.readyState===D.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");("function"==typeof e?(r=e,e=t=void 0):"function"==typeof t&&(r=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState!==D.OPEN)?q(this,e,r):(void 0===t&&(t=!this._isServer),this._sender.pong(e||_,t,r))}resume(){this.readyState!==D.CONNECTING&&this.readyState!==D.CLOSED&&(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,t,r){if(this.readyState===D.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof t&&(r=t,t={}),"number"==typeof e&&(e=e.toString()),this.readyState!==D.OPEN)return void q(this,e,r);let n={binary:"string"!=typeof e,mask:!this._isServer,compress:!0,fin:!0,...t};this._extensions[p.extensionName]||(n.compress=!1),this._sender.send(e||_,n,r)}terminate(){if(this.readyState!==D.CLOSED){if(this.readyState===D.CONNECTING)return void B(this,this._req,"WebSocket was closed before the connection was established");this._socket&&(this._readyState=D.CLOSING,this._socket.destroy())}}}function k(e,t){e._readyState=D.CLOSING,e._errorEmitted=!0,e.emit("error",t),e.emitClose()}function L(e){return e.path=e.socketPath,s.connect(e)}function U(e){return e.path=void 0,e.servername||""===e.servername||(e.servername=s.isIP(e.host)?"":e.host),a.connect(e)}function B(e,t,r){e._readyState=D.CLOSING;let n=Error(r);Error.captureStackTrace(n,B),t.setHeader?(t[x]=!0,t.abort(),t.socket&&!t.socket.destroyed&&t.socket.destroy(),process.nextTick(k,e,n)):(t.destroy(n),t.once("error",e.emit.bind(e,"error")),t.once("close",e.emitClose.bind(e)))}function q(e,t,r){if(t){let r=g(t)?t.size:R(t).length;e._socket?e._sender._bufferedBytes+=r:e._bufferedAmount+=r}if(r){let t=Error(`WebSocket is not open: readyState ${e.readyState} (${N[e.readyState]})`);process.nextTick(r,t)}}function j(e,t){let r=this[T];r._closeFrameReceived=!0,r._closeMessage=t,r._closeCode=e,void 0!==r._socket[T]&&(r._socket.removeListener("data",z),process.nextTick(J,r._socket),1005===e?r.close():r.close(e,t))}function F(){let e=this[T];e.isPaused||e._socket.resume()}function G(e){let t=this[T];void 0!==t._socket[T]&&(t._socket.removeListener("data",z),process.nextTick(J,t._socket),t.close(e[S])),t._errorEmitted||(t._errorEmitted=!0,t.emit("error",e))}function H(){this[T].emitClose()}function $(e,t){this[T].emit("message",e,t)}function V(e){let t=this[T];t._autoPong&&t.pong(e,!this._isServer,A),t.emit("ping",e)}function W(e){this[T].emit("pong",e)}function J(e){e.resume()}function K(e){let t=this[T];t.readyState!==D.CLOSED&&(t.readyState===D.OPEN&&(t._readyState=D.CLOSING,Y(t)),this._socket.end(),t._errorEmitted||(t._errorEmitted=!0,t.emit("error",e)))}function Y(e){e._closeTimer=setTimeout(e._socket.destroy.bind(e._socket),3e4)}function Q(){let e,t=this[T];this.removeListener("close",Q),this.removeListener("data",z),this.removeListener("end",X),t._readyState=D.CLOSING,this._readableState.endEmitted||t._closeFrameReceived||t._receiver._writableState.errorEmitted||null===(e=t._socket.read())||t._receiver.write(e),t._receiver.end(),this[T]=void 0,clearTimeout(t._closeTimer),t._receiver._writableState.finished||t._receiver._writableState.errorEmitted?t.emitClose():(t._receiver.on("error",H),t._receiver.on("finish",H))}function z(e){this[T]._receiver.write(e)||this.pause()}function X(){let e=this[T];e._readyState=D.CLOSING,e._receiver.end(),this.end()}function Z(){let e=this[T];this.removeListener("error",Z),this.on("error",A),e&&(e._readyState=D.CLOSING,this.destroy())}Object.defineProperty(D,"CONNECTING",{enumerable:!0,value:N.indexOf("CONNECTING")}),Object.defineProperty(D.prototype,"CONNECTING",{enumerable:!0,value:N.indexOf("CONNECTING")}),Object.defineProperty(D,"OPEN",{enumerable:!0,value:N.indexOf("OPEN")}),Object.defineProperty(D.prototype,"OPEN",{enumerable:!0,value:N.indexOf("OPEN")}),Object.defineProperty(D,"CLOSING",{enumerable:!0,value:N.indexOf("CLOSING")}),Object.defineProperty(D.prototype,"CLOSING",{enumerable:!0,value:N.indexOf("CLOSING")}),Object.defineProperty(D,"CLOSED",{enumerable:!0,value:N.indexOf("CLOSED")}),Object.defineProperty(D.prototype,"CLOSED",{enumerable:!0,value:N.indexOf("CLOSED")}),["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(e=>{Object.defineProperty(D.prototype,e,{enumerable:!0})}),["open","error","close","message"].forEach(e=>{Object.defineProperty(D.prototype,`on${e}`,{enumerable:!0,get(){for(let t of this.listeners(e))if(t[E])return t[b];return null},set(t){for(let t of this.listeners(e))if(t[E]){this.removeListener(e,t);break}"function"==typeof t&&this.addEventListener(e,t,{[E]:!0})}})}),D.prototype.addEventListener=C,D.prototype.removeEventListener=O,t.exports=D},21365,(e,t,r)=>{"use strict";e.r(35065);let{Duplex:n}=e.r(88947);function i(e){e.emit("close")}function o(){!this.destroyed&&this._writableState.finished&&this.destroy()}function s(e){this.removeListener("error",s),this.destroy(),0===this.listenerCount("error")&&this.emit("error",e)}t.exports=function(e,t){let r=!0,a=new n({...t,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return e.on("message",function(t,r){let n=!r&&a._readableState.objectMode?t.toString():t;a.push(n)||e.pause()}),e.once("error",function(e){a.destroyed||(r=!1,a.destroy(e))}),e.once("close",function(){a.destroyed||a.push(null)}),a._destroy=function(t,n){if(e.readyState===e.CLOSED){n(t),process.nextTick(i,a);return}let o=!1;e.once("error",function(e){o=!0,n(e)}),e.once("close",function(){o||n(t),process.nextTick(i,a)}),r&&e.terminate()},a._final=function(t){e.readyState===e.CONNECTING?e.once("open",function(){a._final(t)}):null!==e._socket&&(e._socket._writableState.finished?(t(),a._readableState.endEmitted&&a.destroy()):(e._socket.once("finish",function(){t()}),e.close()))},a._read=function(){e.isPaused&&e.resume()},a._write=function(t,r,n){e.readyState===e.CONNECTING?e.once("open",function(){a._write(t,r,n)}):e.send(t,n)},a.on("end",o),a.on("error",s),a}},42977,(e,t,r)=>{"use strict";let{tokenChars:n}=e.r(58739);t.exports={parse:function(e){let t=new Set,r=-1,i=-1,o=0;for(;o<e.length;o++){let s=e.charCodeAt(o);if(-1===i&&1===n[s])-1===r&&(r=o);else if(0!==o&&(32===s||9===s))-1===i&&-1!==r&&(i=o);else if(44===s){if(-1===r)throw SyntaxError(`Unexpected character at index ${o}`);-1===i&&(i=o);let n=e.slice(r,i);if(t.has(n))throw SyntaxError(`The "${n}" subprotocol is duplicated`);t.add(n),r=i=-1}else throw SyntaxError(`Unexpected character at index ${o}`)}if(-1===r||-1!==i)throw SyntaxError("Unexpected end of input");let s=e.slice(r,o);if(t.has(s))throw SyntaxError(`The "${s}" subprotocol is duplicated`);return t.add(s),t}}},17198,(e,t,r)=>{"use strict";let n=e.r(27699),i=e.r(21517),{Duplex:o}=e.r(88947),{createHash:s}=e.r(54799),a=e.r(96903),l=e.r(80295),u=e.r(42977),c=e.r(35065),{GUID:d,kWebSocket:h}=e.r(74836),p=/^[+/0-9A-Za-z]{22}==$/;function f(e){e._state=2,e.emit("close")}function m(){this.destroy()}function g(e,t,r,n){r=r||i.STATUS_CODES[t],n={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(r),...n},e.once("finish",e.destroy),e.end(`HTTP/1.1 ${t} ${i.STATUS_CODES[t]}\r
`+Object.keys(n).map(e=>`${e}: ${n[e]}`).join("\r\n")+"\r\n\r\n"+r)}function y(e,t,r,n,i,o){if(e.listenerCount("wsClientError")){let n=Error(i);Error.captureStackTrace(n,y),e.emit("wsClientError",n,r,t)}else g(r,n,i,o)}t.exports=class extends n{constructor(e,t){if(super(),null==(e={allowSynchronousEvents:!0,autoPong:!0,maxPayload:0x6400000,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:c,...e}).port&&!e.server&&!e.noServer||null!=e.port&&(e.server||e.noServer)||e.server&&e.noServer)throw TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(null!=e.port?(this._server=i.createServer((e,t)=>{let r=i.STATUS_CODES[426];t.writeHead(426,{"Content-Length":r.length,"Content-Type":"text/plain"}),t.end(r)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server){const e=this.emit.bind(this,"connection");this._removeListeners=function(e,t){for(let r of Object.keys(t))e.on(r,t[r]);return function(){for(let r of Object.keys(t))e.removeListener(r,t[r])}}(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(t,r,n)=>{this.handleUpgrade(t,r,n,e)}})}!0===e.perMessageDeflate&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=0}address(){if(this.options.noServer)throw Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(2===this._state){e&&this.once("close",()=>{e(Error("The server is not running"))}),process.nextTick(f,this);return}if(e&&this.once("close",e),1!==this._state)if(this._state=1,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients&&this.clients.size?this._shouldEmitClose=!0:process.nextTick(f,this);else{let e=this._server;this._removeListeners(),this._removeListeners=this._server=null,e.close(()=>{f(this)})}}shouldHandle(e){if(this.options.path){let t=e.url.indexOf("?");if((-1!==t?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,r,n){t.on("error",m);let i=e.headers["sec-websocket-key"],o=e.headers.upgrade,s=+e.headers["sec-websocket-version"];if("GET"!==e.method)return void y(this,e,t,405,"Invalid HTTP method");if(void 0===o||"websocket"!==o.toLowerCase())return void y(this,e,t,400,"Invalid Upgrade header");if(void 0===i||!p.test(i))return void y(this,e,t,400,"Missing or invalid Sec-WebSocket-Key header");if(13!==s&&8!==s)return void y(this,e,t,400,"Missing or invalid Sec-WebSocket-Version header",{"Sec-WebSocket-Version":"13, 8"});if(!this.shouldHandle(e))return void g(t,400);let c=e.headers["sec-websocket-protocol"],d=new Set;if(void 0!==c)try{d=u.parse(c)}catch(r){y(this,e,t,400,"Invalid Sec-WebSocket-Protocol header");return}let h=e.headers["sec-websocket-extensions"],f={};if(this.options.perMessageDeflate&&void 0!==h){let r=new l(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let e=a.parse(h);e[l.extensionName]&&(r.accept(e[l.extensionName]),f[l.extensionName]=r)}catch(r){y(this,e,t,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let o={origin:e.headers[`${8===s?"sec-websocket-origin":"origin"}`],secure:!!(e.socket.authorized||e.socket.encrypted),req:e};if(2===this.options.verifyClient.length)return void this.options.verifyClient(o,(o,s,a,l)=>{if(!o)return g(t,s||401,a,l);this.completeUpgrade(f,i,d,e,t,r,n)});if(!this.options.verifyClient(o))return g(t,401)}this.completeUpgrade(f,i,d,e,t,r,n)}completeUpgrade(e,t,r,n,i,o,u){if(!i.readable||!i.writable)return i.destroy();if(i[h])throw Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>0)return g(i,503);let c=s("sha1").update(t+d).digest("base64"),p=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${c}`],y=new this.options.WebSocket(null,void 0,this.options);if(r.size){let e=this.options.handleProtocols?this.options.handleProtocols(r,n):r.values().next().value;e&&(p.push(`Sec-WebSocket-Protocol: ${e}`),y._protocol=e)}if(e[l.extensionName]){let t=e[l.extensionName].params,r=a.format({[l.extensionName]:[t]});p.push(`Sec-WebSocket-Extensions: ${r}`),y._extensions=e}this.emit("headers",p,n),i.write(p.concat("\r\n").join("\r\n")),i.removeListener("error",m),y.setSocket(i,o,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(y),y.on("close",()=>{this.clients.delete(y),this._shouldEmitClose&&!this.clients.size&&process.nextTick(f,this)})),u(y,n)}}},97953,(e,t,r)=>{"use strict";t.exports=e.r(42315).vendored["react-rsc"].ReactServerDOMTurbopackServer},45015,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"registerServerReference",{enumerable:!0,get:function(){return n.registerServerReference}});let n=e.r(97953)},64839,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i,o,s,a,l,u,c,d,h,p,f,m={AppRenderSpan:function(){return T},AppRouteRouteHandlersSpan:function(){return O},BaseServerSpan:function(){return y},LoadComponentsSpan:function(){return _},LogSpanAllowList:function(){return x},MiddlewareSpan:function(){return I},NextNodeServerSpan:function(){return E},NextServerSpan:function(){return v},NextVanillaSpanAllowlist:function(){return R},NodeSpan:function(){return C},RenderSpan:function(){return S},ResolveMetadataSpan:function(){return w},RouterSpan:function(){return A},StartServerSpan:function(){return b}};for(var g in m)Object.defineProperty(r,g,{enumerable:!0,get:m[g]});var y=((n=y||{}).handleRequest="BaseServer.handleRequest",n.run="BaseServer.run",n.pipe="BaseServer.pipe",n.getStaticHTML="BaseServer.getStaticHTML",n.render="BaseServer.render",n.renderToResponseWithComponents="BaseServer.renderToResponseWithComponents",n.renderToResponse="BaseServer.renderToResponse",n.renderToHTML="BaseServer.renderToHTML",n.renderError="BaseServer.renderError",n.renderErrorToResponse="BaseServer.renderErrorToResponse",n.renderErrorToHTML="BaseServer.renderErrorToHTML",n.render404="BaseServer.render404",n),_=((i=_||{}).loadDefaultErrorComponents="LoadComponents.loadDefaultErrorComponents",i.loadComponents="LoadComponents.loadComponents",i),v=((o=v||{}).getRequestHandler="NextServer.getRequestHandler",o.getRequestHandlerWithMetadata="NextServer.getRequestHandlerWithMetadata",o.getServer="NextServer.getServer",o.getServerRequestHandler="NextServer.getServerRequestHandler",o.createServer="createServer.createServer",o),E=((s=E||{}).compression="NextNodeServer.compression",s.getBuildId="NextNodeServer.getBuildId",s.createComponentTree="NextNodeServer.createComponentTree",s.clientComponentLoading="NextNodeServer.clientComponentLoading",s.getLayoutOrPageModule="NextNodeServer.getLayoutOrPageModule",s.generateStaticRoutes="NextNodeServer.generateStaticRoutes",s.generateFsStaticRoutes="NextNodeServer.generateFsStaticRoutes",s.generatePublicRoutes="NextNodeServer.generatePublicRoutes",s.generateImageRoutes="NextNodeServer.generateImageRoutes.route",s.sendRenderResult="NextNodeServer.sendRenderResult",s.proxyRequest="NextNodeServer.proxyRequest",s.runApi="NextNodeServer.runApi",s.render="NextNodeServer.render",s.renderHTML="NextNodeServer.renderHTML",s.imageOptimizer="NextNodeServer.imageOptimizer",s.getPagePath="NextNodeServer.getPagePath",s.getRoutesManifest="NextNodeServer.getRoutesManifest",s.findPageComponents="NextNodeServer.findPageComponents",s.getFontManifest="NextNodeServer.getFontManifest",s.getServerComponentManifest="NextNodeServer.getServerComponentManifest",s.getRequestHandler="NextNodeServer.getRequestHandler",s.renderToHTML="NextNodeServer.renderToHTML",s.renderError="NextNodeServer.renderError",s.renderErrorToHTML="NextNodeServer.renderErrorToHTML",s.render404="NextNodeServer.render404",s.startResponse="NextNodeServer.startResponse",s.route="route",s.onProxyReq="onProxyReq",s.apiResolver="apiResolver",s.internalFetch="internalFetch",s),b=((a=b||{}).startServer="startServer.startServer",a),S=((l=S||{}).getServerSideProps="Render.getServerSideProps",l.getStaticProps="Render.getStaticProps",l.renderToString="Render.renderToString",l.renderDocument="Render.renderDocument",l.createBodyResult="Render.createBodyResult",l),T=((u=T||{}).renderToString="AppRender.renderToString",u.renderToReadableStream="AppRender.renderToReadableStream",u.getBodyResult="AppRender.getBodyResult",u.fetch="AppRender.fetch",u),A=((c=A||{}).executeRoute="Router.executeRoute",c),C=((d=C||{}).runHandler="Node.runHandler",d),O=((h=O||{}).runHandler="AppRouteRouteHandlers.runHandler",h),w=((p=w||{}).generateMetadata="ResolveMetadata.generateMetadata",p.generateViewport="ResolveMetadata.generateViewport",p),I=((f=I||{}).execute="Middleware.execute",f);let R=["Middleware.execute","BaseServer.handleRequest","Render.getServerSideProps","Render.getStaticProps","AppRender.fetch","AppRender.getBodyResult","Render.renderDocument","Node.runHandler","AppRouteRouteHandlers.runHandler","ResolveMetadata.generateMetadata","ResolveMetadata.generateViewport","NextNodeServer.createComponentTree","NextNodeServer.findPageComponents","NextNodeServer.getLayoutOrPageModule","NextNodeServer.startResponse","NextNodeServer.clientComponentLoading"],x=["NextNodeServer.findPageComponents","NextNodeServer.createComponentTree","NextNodeServer.clientComponentLoading"]},31846,(e,t,r)=>{"use strict";function n(e){return null!==e&&"object"==typeof e&&"then"in e&&"function"==typeof e.then}Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"isThenable",{enumerable:!0,get:function(){return n}})},36851,(e,t,r)=>{"use strict";let n,i;Object.defineProperty(r,"__esModule",{value:!0});var o={BubbledError:function(){return m},SpanKind:function(){return p},SpanStatusCode:function(){return h},getTracer:function(){return S},isBubbledError:function(){return g}};for(var s in o)Object.defineProperty(r,s,{enumerable:!0,get:o[s]});let a=e.r(64839),l=e.r(31846);try{n=e.r(70406)}catch(t){n=e.r(17413)}let{context:u,propagation:c,trace:d,SpanStatusCode:h,SpanKind:p,ROOT_CONTEXT:f}=n;class m extends Error{constructor(e,t){super(),this.bubble=e,this.result=t}}function g(e){return"object"==typeof e&&null!==e&&e instanceof m}let y=(e,t)=>{g(t)&&t.bubble?e.setAttribute("next.bubble",!0):(t&&(e.recordException(t),e.setAttribute("error.type",t.name)),e.setStatus({code:h.ERROR,message:null==t?void 0:t.message})),e.end()},_=new Map,v=n.createContextKey("next.rootSpanId"),E=0,b={set(e,t,r){e.push({key:t,value:r})}},S=(i=new class e{getTracerInstance(){return d.getTracer("next.js","0.0.1")}getContext(){return u}getTracePropagationData(){let e=u.active(),t=[];return c.inject(e,t,b),t}getActiveScopeSpan(){return d.getSpan(null==u?void 0:u.active())}withPropagatedContext(e,t,r){let n=u.active();if(d.getSpanContext(n))return t();let i=c.extract(n,e,r);return u.with(i,t)}trace(...e){var t;let[r,n,i]=e,{fn:o,options:s}="function"==typeof n?{fn:n,options:{}}:{fn:i,options:{...n}},c=s.spanName??r;if(!a.NextVanillaSpanAllowlist.includes(r)&&"1"!==process.env.NEXT_OTEL_VERBOSE||s.hideSpan)return o();let h=this.getSpanContext((null==s?void 0:s.parentSpan)??this.getActiveScopeSpan()),p=!1;h?(null==(t=d.getSpanContext(h))?void 0:t.isRemote)&&(p=!0):(h=(null==u?void 0:u.active())??f,p=!0);let m=E++;return s.attributes={"next.span_name":c,"next.span_type":r,...s.attributes},u.with(h.setValue(v,m),()=>this.getTracerInstance().startActiveSpan(c,s,e=>{let t="performance"in globalThis&&"measure"in performance?globalThis.performance.now():void 0,n=()=>{_.delete(m),t&&process.env.NEXT_OTEL_PERFORMANCE_PREFIX&&a.LogSpanAllowList.includes(r||"")&&performance.measure(`${process.env.NEXT_OTEL_PERFORMANCE_PREFIX}:next-${(r.split(".").pop()||"").replace(/[A-Z]/g,e=>"-"+e.toLowerCase())}`,{start:t,end:performance.now()})};p&&_.set(m,new Map(Object.entries(s.attributes??{})));try{if(o.length>1)return o(e,t=>y(e,t));let t=o(e);if((0,l.isThenable)(t))return t.then(t=>(e.end(),t)).catch(t=>{throw y(e,t),t}).finally(n);return e.end(),n(),t}catch(t){throw y(e,t),n(),t}}))}wrap(...e){let t=this,[r,n,i]=3===e.length?e:[e[0],{},e[1]];return a.NextVanillaSpanAllowlist.includes(r)||"1"===process.env.NEXT_OTEL_VERBOSE?function(){let e=n;"function"==typeof e&&"function"==typeof i&&(e=e.apply(this,arguments));let o=arguments.length-1,s=arguments[o];if("function"!=typeof s)return t.trace(r,e,()=>i.apply(this,arguments));{let n=t.getContext().bind(u.active(),s);return t.trace(r,e,(e,t)=>(arguments[o]=function(e){return null==t||t(e),n.apply(this,arguments)},i.apply(this,arguments)))}}:i}startSpan(...e){let[t,r]=e,n=this.getSpanContext((null==r?void 0:r.parentSpan)??this.getActiveScopeSpan());return this.getTracerInstance().startSpan(t,r,n)}getSpanContext(e){return e?d.setSpan(u.active(),e):void 0}getRootSpanAttributes(){let e=u.active().getValue(v);return _.get(e)}setRootSpanAttribute(e,t){let r=u.active().getValue(v),n=_.get(r);n&&!n.has(e)&&n.set(e,t)}},()=>i)},66953,(e,t,r)=>{"use strict";let n;Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"cloneResponse",{enumerable:!0,get:function(){return o}});let i=()=>{};function o(e){if(!e.body)return[e,e];let[t,r]=e.body.tee(),i=new Response(t,{status:e.status,statusText:e.statusText,headers:e.headers});Object.defineProperty(i,"url",{value:e.url,configurable:!0,enumerable:!0,writable:!1}),n&&i.body&&n.register(i,new WeakRef(i.body));let o=new Response(r,{status:e.status,statusText:e.statusText,headers:e.headers});return Object.defineProperty(o,"url",{value:e.url,configurable:!0,enumerable:!0,writable:!1}),[i,o]}globalThis.FinalizationRegistry&&(n=new FinalizationRegistry(e=>{let t=e.deref();t&&!t.locked&&t.cancel("Response object has been garbage collected").then(i)}))},42966,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"createDedupeFetch",{enumerable:!0,get:function(){return l}});let n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(void 0);if(r&&r.has(e))return r.get(e);var n={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(n,o,a):n[o]=e[o]}return n.default=e,r&&r.set(e,n),n}(e.r(47540)),i=e.r(66953),o=e.r(76414);function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}let a=new Set(["traceparent","tracestate"]);function l(e){let t=n.cache(e=>[]);return function(r,n){let s,l;if(n&&n.signal)return e(r,n);if("string"!=typeof r||n){let t,i="string"==typeof r||r instanceof URL?new Request(r,n):r;if("GET"!==i.method&&"HEAD"!==i.method||i.keepalive)return e(r,n);t=Array.from(i.headers.entries()).filter(([e])=>!a.has(e.toLowerCase())),l=JSON.stringify([i.method,t,i.mode,i.redirect,i.credentials,i.referrer,i.referrerPolicy,i.integrity]),s=i.url}else l='["GET",[],null,"follow",null,null,null,null]',s=r;let u=t(s);for(let e=0,t=u.length;e<t;e+=1){let[t,r]=u[e];if(t===l)return r.then(()=>{let t=u[e][2];if(!t)throw Object.defineProperty(new o.InvariantError("No cached response"),"__NEXT_ERROR_CODE",{value:"E579",enumerable:!1,configurable:!0});let[r,n]=(0,i.cloneResponse)(t);return u[e][2]=n,r})}let c=e(r,n),d=[l,c,null];return u.push(d),c.then(e=>{let[t,r]=(0,i.cloneResponse)(e);return d[2]=r,t})}}},86082,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i,o={CachedRouteKind:function(){return a},IncrementalCacheKind:function(){return l}};for(var s in o)Object.defineProperty(r,s,{enumerable:!0,get:o[s]});var a=((n={}).APP_PAGE="APP_PAGE",n.APP_ROUTE="APP_ROUTE",n.PAGES="PAGES",n.FETCH="FETCH",n.REDIRECT="REDIRECT",n.IMAGE="IMAGE",n),l=((i={}).APP_PAGE="APP_PAGE",i.APP_ROUTE="APP_ROUTE",i.PAGES="PAGES",i.FETCH="FETCH",i.IMAGE="IMAGE",i)},98725,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"DetachedPromise",{enumerable:!0,get:function(){return n}});class n{constructor(){let e,t;this.promise=new Promise((r,n)=>{e=r,t=n}),this.resolve=e,this.reject=t}}},46518,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"Batcher",{enumerable:!0,get:function(){return i}});let n=e.r(98725);class i{constructor(e,t=e=>e()){this.cacheKeyFn=e,this.schedulerFn=t,this.pending=new Map}static create(e){return new i(null==e?void 0:e.cacheKeyFn,null==e?void 0:e.schedulerFn)}async batch(e,t){let r=this.cacheKeyFn?await this.cacheKeyFn(e):e;if(null===r)return t({resolve:e=>Promise.resolve(e),key:e});let i=this.pending.get(r);if(i)return i;let{promise:o,resolve:s,reject:a}=new n.DetachedPromise;return this.pending.set(r,o),this.schedulerFn(async()=>{try{let r=await t({resolve:s,key:e});s(r)}catch(e){a(e)}finally{this.pending.delete(r)}}),o}}},46177,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"ENCODED_TAGS",{enumerable:!0,get:function(){return n}});let n={OPENING:{HTML:new Uint8Array([60,104,116,109,108]),BODY:new Uint8Array([60,98,111,100,121])},CLOSED:{HEAD:new Uint8Array([60,47,104,101,97,100,62]),BODY:new Uint8Array([60,47,98,111,100,121,62]),HTML:new Uint8Array([60,47,104,116,109,108,62]),BODY_AND_HTML:new Uint8Array([60,47,98,111,100,121,62,60,47,104,116,109,108,62])},META:{ICON_MARK:new Uint8Array([60,109,101,116,97,32,110,97,109,101,61,34,194,171,110,120,116,45,105,99,111,110,194,187,34])}}},45144,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={indexOfUint8Array:function(){return o},isEquivalentUint8Arrays:function(){return s},removeFromUint8Array:function(){return a}};for(var i in n)Object.defineProperty(r,i,{enumerable:!0,get:n[i]});function o(e,t){if(0===t.length)return 0;if(0===e.length||t.length>e.length)return -1;for(let r=0;r<=e.length-t.length;r++){let n=!0;for(let i=0;i<t.length;i++)if(e[r+i]!==t[i]){n=!1;break}if(n)return r}return -1}function s(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function a(e,t){let r=o(e,t);if(0===r)return e.subarray(t.length);if(!(r>-1))return e;{let n=new Uint8Array(e.length-t.length);return n.set(e.slice(0,r)),n.set(e.slice(r+t.length),r),n}}},40724,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"MISSING_ROOT_TAGS_ERROR",{enumerable:!0,get:function(){return n}});let n="NEXT_MISSING_ROOT_TAGS";("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),t.exports=r.default)},8946,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={DOC_PREFETCH_RANGE_HEADER_VALUE:function(){return s},doesExportedHtmlMatchBuildId:function(){return u},insertBuildIdComment:function(){return l}};for(var i in n)Object.defineProperty(r,i,{enumerable:!0,get:n[i]});let o="<!DOCTYPE html>",s="bytes=0-63";function a(e){return e.slice(0,24).replace(/-/g,"_")}function l(e,t){return t.includes("-->")||!e.startsWith(o)?e:e.replace(o,o+"<!--"+a(t)+"-->")}function u(e,t){return e.startsWith(o+"<!--"+a(t)+"-->")}},64851,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={ACTION_HEADER:function(){return s},FLIGHT_HEADERS:function(){return f},NEXT_ACTION_NOT_FOUND_HEADER:function(){return b},NEXT_DID_POSTPONE_HEADER:function(){return y},NEXT_HMR_REFRESH_HASH_COOKIE:function(){return d},NEXT_HMR_REFRESH_HEADER:function(){return c},NEXT_HTML_REQUEST_ID_HEADER:function(){return T},NEXT_IS_PRERENDER_HEADER:function(){return E},NEXT_REQUEST_ID_HEADER:function(){return S},NEXT_REWRITTEN_PATH_HEADER:function(){return _},NEXT_REWRITTEN_QUERY_HEADER:function(){return v},NEXT_ROUTER_PREFETCH_HEADER:function(){return l},NEXT_ROUTER_SEGMENT_PREFETCH_HEADER:function(){return u},NEXT_ROUTER_STALE_TIME_HEADER:function(){return g},NEXT_ROUTER_STATE_TREE_HEADER:function(){return a},NEXT_RSC_UNION_QUERY:function(){return m},NEXT_URL:function(){return h},RSC_CONTENT_TYPE_HEADER:function(){return p},RSC_HEADER:function(){return o}};for(var i in n)Object.defineProperty(r,i,{enumerable:!0,get:n[i]});let o="rsc",s="next-action",a="next-router-state-tree",l="next-router-prefetch",u="next-router-segment-prefetch",c="next-hmr-refresh",d="__next_hmr_refresh_hash__",h="next-url",p="text/x-component",f=[o,a,l,c,u],m="_rsc",g="x-nextjs-stale-time",y="x-nextjs-postponed",_="x-nextjs-rewritten-path",v="x-nextjs-rewritten-query",E="x-nextjs-prerender",b="x-nextjs-action-not-found",S="x-nextjs-request-id",T="x-nextjs-html-request-id";("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),t.exports=r.default)},67510,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={djb2Hash:function(){return o},hexHash:function(){return s}};for(var i in n)Object.defineProperty(r,i,{enumerable:!0,get:n[i]});function o(e){let t=5381;for(let r=0;r<e.length;r++)t=(t<<5)+t+e.charCodeAt(r)|0;return t>>>0}function s(e){return o(e).toString(36).slice(0,5)}},60091,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"computeCacheBustingSearchParam",{enumerable:!0,get:function(){return i}});let n=e.r(67510);function i(e,t,r,i){return(void 0===e||"0"===e)&&void 0===t&&void 0===r&&void 0===i?"":(0,n.hexHash)([e||"0",t||"0",r||"0",i||"0"].join(","))}},56682,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={chainStreams:function(){return y},continueDynamicHTMLResume:function(){return k},continueDynamicPrerender:function(){return N},continueFizzStream:function(){return P},continueStaticFallbackPrerender:function(){return D},continueStaticPrerender:function(){return M},createBufferedTransformStream:function(){return S},createDocumentClosingStream:function(){return L},createRootLayoutValidatorStream:function(){return x},renderToInitialFizzStream:function(){return A},streamFromBuffer:function(){return v},streamFromString:function(){return _},streamToBuffer:function(){return E},streamToString:function(){return b}};for(var i in n)Object.defineProperty(r,i,{enumerable:!0,get:n[i]});let o=e.r(36851),s=e.r(64839),a=e.r(98725),l=e.r(38244),u=e.r(46177),c=e.r(45144),d=e.r(40724),h=e.r(8946),p=e.r(64851),f=e.r(60091);function m(){}let g=new TextEncoder;function y(...e){if(0===e.length)return new ReadableStream({start(e){e.close()}});if(1===e.length)return e[0];let{readable:t,writable:r}=new TransformStream,n=e[0].pipeTo(r,{preventClose:!0}),i=1;for(;i<e.length-1;i++){let t=e[i];n=n.then(()=>t.pipeTo(r,{preventClose:!0}))}let o=e[i];return(n=n.then(()=>o.pipeTo(r))).catch(m),t}function _(e){return new ReadableStream({start(t){t.enqueue(g.encode(e)),t.close()}})}function v(e){return new ReadableStream({start(t){t.enqueue(e),t.close()}})}async function E(e){let t=e.getReader(),r=[];for(;;){let{done:e,value:n}=await t.read();if(e)break;r.push(n)}return Buffer.concat(r)}async function b(e,t){let r=new TextDecoder("utf-8",{fatal:!0}),n="";for await(let i of e){if(null==t?void 0:t.aborted)return n;n+=r.decode(i,{stream:!0})}return n+r.decode()}function S(e={}){let t,{maxBufferByteLength:r=1/0}=e,n=[],i=0,o=e=>{try{if(0===n.length)return;let t=new Uint8Array(i),r=0;for(let e=0;e<n.length;e++){let i=n[e];t.set(i,r),r+=i.byteLength}n.length=0,i=0,e.enqueue(t)}catch{}};return new TransformStream({transform(e,s){n.push(e),(i+=e.byteLength)>=r?o(s):(e=>{if(t)return;let r=new a.DetachedPromise;t=r,(0,l.scheduleImmediate)(()=>{try{o(e)}finally{t=void 0,r.resolve()}})})(s)},flush:()=>null==t?void 0:t.promise})}function T(e,t){let r=!1;return new TransformStream({transform(n,i){if(e&&!r){r=!0;let e=new TextDecoder("utf-8",{fatal:!0}).decode(n,{stream:!0}),o=(0,h.insertBuildIdComment)(e,t);i.enqueue(g.encode(o));return}i.enqueue(n)}})}function A({ReactDOMServer:e,element:t,streamOptions:r}){return(0,o.getTracer)().trace(s.AppRenderSpan.renderToReadableStream,async()=>e.renderToReadableStream(t,r))}function C(e){let t=-1,r=!1;return new TransformStream({async transform(n,i){let o=-1,s=-1;if(t++,r)return void i.enqueue(n);let a=0;if(-1===o){if(-1===(o=(0,c.indexOfUint8Array)(n,u.ENCODED_TAGS.META.ICON_MARK)))return void i.enqueue(n);47===n[o+(a=u.ENCODED_TAGS.META.ICON_MARK.length)]?a+=2:a++}if(0===t){if(s=(0,c.indexOfUint8Array)(n,u.ENCODED_TAGS.CLOSED.HEAD),-1!==o){if(o<s){let e=new Uint8Array(n.length-a);e.set(n.subarray(0,o)),e.set(n.subarray(o+a),o),n=e}else{let t=await e(),r=g.encode(t),i=r.length,s=new Uint8Array(n.length-a+i);s.set(n.subarray(0,o)),s.set(r,o),s.set(n.subarray(o+a),o+i),n=s}r=!0}}else{let t=await e(),i=g.encode(t),s=i.length,l=new Uint8Array(n.length-a+s);l.set(n.subarray(0,o)),l.set(i,o),l.set(n.subarray(o+a),o+s),n=l,r=!0}i.enqueue(n)}})}function O(e){let t=!1,r=!1;return new TransformStream({async transform(n,i){r=!0;let o=await e();if(t){if(o){let e=g.encode(o);i.enqueue(e)}i.enqueue(n)}else{let e=(0,c.indexOfUint8Array)(n,u.ENCODED_TAGS.CLOSED.HEAD);if(-1!==e){if(o){let t=g.encode(o),r=new Uint8Array(n.length+t.length);r.set(n.slice(0,e)),r.set(t,e),r.set(n.slice(e),e+t.length),i.enqueue(r)}else i.enqueue(n);t=!0}else o&&i.enqueue(g.encode(o)),i.enqueue(n),t=!0}},async flush(t){if(r){let r=await e();r&&t.enqueue(g.encode(r))}}})}function w(e,t){let r=!1,n=null,i=!1;function o(e){return n||(n=s(e)),n}async function s(n){let o=e.getReader();t&&await (0,l.atLeastOneTask)();try{for(;;){let{done:e,value:s}=await o.read();if(e){i=!0;return}t||r||await (0,l.atLeastOneTask)(),n.enqueue(s)}}catch(e){n.error(e)}}return new TransformStream({start(e){t||o(e)},transform(e,r){r.enqueue(e),t&&o(r)},flush(e){if(r=!0,!i)return o(e)}})}let I="</body></html>";function R(){let e=!1;return new TransformStream({transform(t,r){if(e)return r.enqueue(t);let n=(0,c.indexOfUint8Array)(t,u.ENCODED_TAGS.CLOSED.BODY_AND_HTML);if(n>-1){if(e=!0,t.length===u.ENCODED_TAGS.CLOSED.BODY_AND_HTML.length)return;let i=t.slice(0,n);if(r.enqueue(i),t.length>u.ENCODED_TAGS.CLOSED.BODY_AND_HTML.length+n){let e=t.slice(n+u.ENCODED_TAGS.CLOSED.BODY_AND_HTML.length);r.enqueue(e)}}else r.enqueue(t)},flush(e){e.enqueue(u.ENCODED_TAGS.CLOSED.BODY_AND_HTML)}})}function x(){let e=!1,t=!1;return new TransformStream({async transform(r,n){!e&&(0,c.indexOfUint8Array)(r,u.ENCODED_TAGS.OPENING.HTML)>-1&&(e=!0),!t&&(0,c.indexOfUint8Array)(r,u.ENCODED_TAGS.OPENING.BODY)>-1&&(t=!0),n.enqueue(r)},flush(r){let n=[];e||n.push("html"),t||n.push("body"),n.length&&r.enqueue(g.encode(`<html id="__next_error__">
            <template
              data-next-error-message="Missing ${n.map(e=>`<${e}>`).join(n.length>1?" and ":"")} tags in the root layout.
Read more at https://nextjs.org/docs/messages/missing-root-layout-tags"
              data-next-error-digest="${d.MISSING_ROOT_TAGS_ERROR}"
              data-next-error-stack=""
            ></template>
          `))}})}async function P(e,{suffix:t,inlinedDataStream:r,isStaticGeneration:n,isBuildTimePrerendering:i,buildId:o,getServerInsertedHTML:s,getServerInsertedMetadata:u,validateRootLayout:c}){let d,h,p=t?t.split(I,1)[0]:null;n&&await e.allReady;var f=[S(),T(i,o),C(u),null!=p&&p.length>0?(h=!1,new TransformStream({transform(e,t){if(t.enqueue(e),!h){let e;h=!0,d=e=new a.DetachedPromise,(0,l.scheduleImmediate)(()=>{try{t.enqueue(g.encode(p))}catch{}finally{d=void 0,e.resolve()}})}},flush(e){if(d)return d.promise;h||e.enqueue(g.encode(p))}})):null,r?w(r,!0):null,c?x():null,R(),O(s)];let m=e;for(let e of f)e&&(m=m.pipeThrough(e));return m}async function N(e,{getServerInsertedHTML:t,getServerInsertedMetadata:r}){return e.pipeThrough(S()).pipeThrough(new TransformStream({transform(e,t){(0,c.isEquivalentUint8Arrays)(e,u.ENCODED_TAGS.CLOSED.BODY_AND_HTML)||(0,c.isEquivalentUint8Arrays)(e,u.ENCODED_TAGS.CLOSED.BODY)||(0,c.isEquivalentUint8Arrays)(e,u.ENCODED_TAGS.CLOSED.HTML)||(e=(0,c.removeFromUint8Array)(e,u.ENCODED_TAGS.CLOSED.BODY),e=(0,c.removeFromUint8Array)(e,u.ENCODED_TAGS.CLOSED.HTML),t.enqueue(e))}})).pipeThrough(O(t)).pipeThrough(C(r))}async function M(e,{inlinedDataStream:t,getServerInsertedHTML:r,getServerInsertedMetadata:n,isBuildTimePrerendering:i,buildId:o}){return e.pipeThrough(S()).pipeThrough(T(i,o)).pipeThrough(O(r)).pipeThrough(C(n)).pipeThrough(w(t,!0)).pipeThrough(R())}async function D(e,{inlinedDataStream:t,getServerInsertedHTML:r,getServerInsertedMetadata:n,isBuildTimePrerendering:i,buildId:o}){let s,a,l,d;return e.pipeThrough(S()).pipeThrough(T(i,o)).pipeThrough(O(r)).pipeThrough((s=(0,f.computeCacheBustingSearchParam)("1","/_full",void 0,void 0),a=`${p.NEXT_RSC_UNION_QUERY}=${s}`,l=`<script>__NEXT_CLIENT_RESUME=fetch(location.pathname+'?${a}',{credentials:'same-origin',headers:{'${p.RSC_HEADER}': '1','${p.NEXT_ROUTER_PREFETCH_HEADER}': '1','${p.NEXT_ROUTER_SEGMENT_PREFETCH_HEADER}': '/_full'}})</script>`,d=!1,new TransformStream({transform(e,t){if(d)return void t.enqueue(e);let r=(0,c.indexOfUint8Array)(e,u.ENCODED_TAGS.CLOSED.HEAD);if(-1===r)return void t.enqueue(e);let n=g.encode(l),i=new Uint8Array(e.length+n.length);i.set(e.slice(0,r)),i.set(n,r),i.set(e.slice(r),r+n.length),t.enqueue(i),d=!0}}))).pipeThrough(C(n)).pipeThrough(w(t,!0)).pipeThrough(R())}async function k(e,{delayDataUntilFirstHtmlChunk:t,inlinedDataStream:r,getServerInsertedHTML:n,getServerInsertedMetadata:i}){return e.pipeThrough(S()).pipeThrough(O(n)).pipeThrough(C(i)).pipeThrough(w(r,t)).pipeThrough(R())}function L(){return _(I)}},13472,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={NEXT_REQUEST_META:function(){return o},addRequestMeta:function(){return l},getRequestMeta:function(){return s},removeRequestMeta:function(){return u},setRequestMeta:function(){return a}};for(var i in n)Object.defineProperty(r,i,{enumerable:!0,get:n[i]});let o=Symbol.for("NextInternalRequestMeta");function s(e,t){let r=e[o]||{};return"string"==typeof t?r[t]:r}function a(e,t){return e[o]=t,t}function l(e,t,r){let n=s(e);return n[t]=r,a(e,n)}function u(e,t){let r=s(e);return delete r[t],a(e,r)}},20557,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={isNodeNextRequest:function(){return a},isNodeNextResponse:function(){return l},isWebNextRequest:function(){return o},isWebNextResponse:function(){return s}};for(var i in n)Object.defineProperty(r,i,{enumerable:!0,get:n[i]});let o=e=>!1,s=e=>!1,a=e=>!0,l=e=>!0},4649,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={NextRequestAdapter:function(){return p},ResponseAborted:function(){return c},ResponseAbortedName:function(){return u},createAbortController:function(){return d},signalFromNodeResponse:function(){return h}};for(var i in n)Object.defineProperty(r,i,{enumerable:!0,get:n[i]});let o=e.r(13472),s=e.r(80333),a=e.r(29666),l=e.r(20557),u="ResponseAborted";class c extends Error{constructor(...e){super(...e),this.name=u}}function d(e){let t=new AbortController;return e.once("close",()=>{e.writableFinished||t.abort(new c)}),t}function h(e){let{errored:t,destroyed:r}=e;if(t||r)return AbortSignal.abort(t??new c);let{signal:n}=d(e);return n}class p{static fromBaseNextRequest(e,t){if((0,l.isNodeNextRequest)(e))return p.fromNodeNextRequest(e,t);throw Object.defineProperty(Error("Invariant: Unsupported NextRequest type"),"__NEXT_ERROR_CODE",{value:"E345",enumerable:!1,configurable:!0})}static fromNodeNextRequest(e,t){let r,n=null;if("GET"!==e.method&&"HEAD"!==e.method&&e.body&&(n=e.body),e.url.startsWith("http"))r=new URL(e.url);else{let t=(0,o.getRequestMeta)(e,"initURL");r=t&&t.startsWith("http")?new URL(e.url,t):new URL(e.url,"http://n")}return new a.NextRequest(r,{method:e.method,headers:(0,s.fromNodeOutgoingHttpHeaders)(e.headers),duplex:"half",signal:t,...t.aborted?{}:{body:n}})}static fromWebNextRequest(e){let t=null;return"GET"!==e.method&&"HEAD"!==e.method&&(t=e.body),new a.NextRequest(e.url,{method:e.method,headers:(0,s.fromNodeOutgoingHttpHeaders)(e.headers),duplex:"half",signal:e.request.signal,...e.request.signal.aborted?{}:{body:t}})}}},61136,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={getClientComponentLoaderMetrics:function(){return u},wrapClientComponentLoader:function(){return l}};for(var i in n)Object.defineProperty(r,i,{enumerable:!0,get:n[i]});let o=0,s=0,a=0;function l(e){return"performance"in globalThis?{require:(...t)=>{let r=performance.now();0===o&&(o=r);try{return a+=1,e.__next_app__.require(...t)}finally{s+=performance.now()-r}},loadChunk:(...t)=>{let r=performance.now(),n=e.__next_app__.loadChunk(...t);return n.finally(()=>{s+=performance.now()-r}),n}}:e.__next_app__}function u(e={}){let t=0===o?void 0:{clientComponentLoadStart:o,clientComponentLoadTimes:s,clientComponentLoadCount:a};return e.reset&&(o=0,s=0,a=0),t}},78544,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={isAbortError:function(){return c},pipeToNodeResponse:function(){return d}};for(var i in n)Object.defineProperty(r,i,{enumerable:!0,get:n[i]});let o=e.r(4649),s=e.r(98725),a=e.r(36851),l=e.r(64839),u=e.r(61136);function c(e){return(null==e?void 0:e.name)==="AbortError"||(null==e?void 0:e.name)===o.ResponseAbortedName}async function d(e,t,r){try{let{errored:n,destroyed:i}=t;if(n||i)return;let c=(0,o.createAbortController)(t),d=function(e,t){let r=!1,n=new s.DetachedPromise;function i(){n.resolve()}e.on("drain",i),e.once("close",()=>{e.off("drain",i),n.resolve()});let o=new s.DetachedPromise;return e.once("finish",()=>{o.resolve()}),new WritableStream({write:async t=>{if(!r){if(r=!0,"performance"in globalThis&&process.env.NEXT_OTEL_PERFORMANCE_PREFIX){let e=(0,u.getClientComponentLoaderMetrics)();e&&performance.measure(`${process.env.NEXT_OTEL_PERFORMANCE_PREFIX}:next-client-component-loading`,{start:e.clientComponentLoadStart,end:e.clientComponentLoadStart+e.clientComponentLoadTimes})}e.flushHeaders(),(0,a.getTracer)().trace(l.NextNodeServerSpan.startResponse,{spanName:"start response"},()=>void 0)}try{let r=e.write(t);"flush"in e&&"function"==typeof e.flush&&e.flush(),r||(await n.promise,n=new s.DetachedPromise)}catch(t){throw e.end(),Object.defineProperty(Error("failed to write chunk to response",{cause:t}),"__NEXT_ERROR_CODE",{value:"E321",enumerable:!1,configurable:!0})}},abort:t=>{e.writableFinished||e.destroy(t)},close:async()=>{if(t&&await t,!e.writableFinished)return e.end(),o.promise}})}(t,r);await e.pipeTo(d,{signal:c.signal})}catch(e){if(c(e))return;throw Object.defineProperty(Error("failed to pipe response",{cause:e}),"__NEXT_ERROR_CODE",{value:"E180",enumerable:!1,configurable:!0})}}},82490,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"default",{enumerable:!0,get:function(){return s}});let n=e.r(56682),i=e.r(78544),o=e.r(76414);class s{static #e=this.EMPTY=new s(null,{metadata:{},contentType:null});static fromStatic(e,t){return new s(e,{metadata:{},contentType:t})}constructor(e,{contentType:t,waitUntil:r,metadata:n}){this.response=e,this.contentType=t,this.metadata=n,this.waitUntil=r}assignMetadata(e){Object.assign(this.metadata,e)}get isNull(){return null===this.response}get isDynamic(){return"string"!=typeof this.response}toUnchunkedString(e=!1){if(null===this.response)return"";if("string"!=typeof this.response){if(!e)throw Object.defineProperty(new o.InvariantError("dynamic responses cannot be unchunked. This is a bug in Next.js"),"__NEXT_ERROR_CODE",{value:"E732",enumerable:!1,configurable:!0});return(0,n.streamToString)(this.readable)}return this.response}get readable(){return null===this.response?new ReadableStream({start(e){e.close()}}):"string"==typeof this.response?(0,n.streamFromString)(this.response):Buffer.isBuffer(this.response)?(0,n.streamFromBuffer)(this.response):Array.isArray(this.response)?(0,n.chainStreams)(...this.response):this.response}coerce(){return null===this.response?[]:"string"==typeof this.response?[(0,n.streamFromString)(this.response)]:Array.isArray(this.response)?this.response:Buffer.isBuffer(this.response)?[(0,n.streamFromBuffer)(this.response)]:[this.response]}unshift(e){this.response=this.coerce(),this.response.unshift(e)}push(e){this.response=this.coerce(),this.response.push(e)}async pipeTo(e){try{await this.readable.pipeTo(e,{preventClose:!0}),this.waitUntil&&await this.waitUntil,await e.close()}catch(t){if((0,i.isAbortError)(t))return void await e.abort(t);throw t}}async pipeToNodeResponse(e){await (0,i.pipeToNodeResponse)(this.readable,e,this.waitUntil)}}},2222,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"RouteKind",{enumerable:!0,get:function(){return i}});var n,i=((n={}).PAGES="PAGES",n.PAGES_API="PAGES_API",n.APP_PAGE="APP_PAGE",n.APP_ROUTE="APP_ROUTE",n.IMAGE="IMAGE",n)},22536,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i={fromResponseCacheEntry:function(){return c},routeKindToIncrementalCacheKind:function(){return h},toResponseCacheEntry:function(){return d}};for(var o in i)Object.defineProperty(r,o,{enumerable:!0,get:i[o]});let s=e.r(86082),a=(n=e.r(82490))&&n.__esModule?n:{default:n},l=e.r(2222),u=e.r(91401);async function c(e){var t,r;return{...e,value:(null==(t=e.value)?void 0:t.kind)===s.CachedRouteKind.PAGES?{kind:s.CachedRouteKind.PAGES,html:await e.value.html.toUnchunkedString(!0),pageData:e.value.pageData,headers:e.value.headers,status:e.value.status}:(null==(r=e.value)?void 0:r.kind)===s.CachedRouteKind.APP_PAGE?{kind:s.CachedRouteKind.APP_PAGE,html:await e.value.html.toUnchunkedString(!0),postponed:e.value.postponed,rscData:e.value.rscData,headers:e.value.headers,status:e.value.status,segmentData:e.value.segmentData}:e.value}}async function d(e){var t,r;return e?{isMiss:e.isMiss,isStale:e.isStale,cacheControl:e.cacheControl,value:(null==(t=e.value)?void 0:t.kind)===s.CachedRouteKind.PAGES?{kind:s.CachedRouteKind.PAGES,html:a.default.fromStatic(e.value.html,u.HTML_CONTENT_TYPE_HEADER),pageData:e.value.pageData,headers:e.value.headers,status:e.value.status}:(null==(r=e.value)?void 0:r.kind)===s.CachedRouteKind.APP_PAGE?{kind:s.CachedRouteKind.APP_PAGE,html:a.default.fromStatic(e.value.html,u.HTML_CONTENT_TYPE_HEADER),rscData:e.value.rscData,headers:e.value.headers,status:e.value.status,postponed:e.value.postponed,segmentData:e.value.segmentData}:e.value}:null}function h(e){switch(e){case l.RouteKind.PAGES:return s.IncrementalCacheKind.PAGES;case l.RouteKind.APP_PAGE:return s.IncrementalCacheKind.APP_PAGE;case l.RouteKind.IMAGE:return s.IncrementalCacheKind.IMAGE;case l.RouteKind.APP_ROUTE:return s.IncrementalCacheKind.APP_ROUTE;case l.RouteKind.PAGES_API:throw Object.defineProperty(Error(`Unexpected route kind ${e}`),"__NEXT_ERROR_CODE",{value:"E64",enumerable:!1,configurable:!0});default:return e}}},88119,(e,t,r)=>{"use strict";var n,i;Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"default",{enumerable:!0,get:function(){return l}});let o=e.r(46518),s=e.r(38244),a=e.r(22536);n=e.r(86082),i=r,Object.keys(n).forEach(function(e){"default"===e||Object.prototype.hasOwnProperty.call(i,e)||Object.defineProperty(i,e,{enumerable:!0,get:function(){return n[e]}})});class l{constructor(e){this.getBatcher=o.Batcher.create({cacheKeyFn:({key:e,isOnDemandRevalidate:t})=>`${e}-${t?"1":"0"}`,schedulerFn:s.scheduleOnNextTick}),this.revalidateBatcher=o.Batcher.create({schedulerFn:s.scheduleOnNextTick}),this.minimal_mode=e}async get(e,t,r){var n;if(!e)return t({hasResolved:!1,previousCacheEntry:null});if(this.minimal_mode&&(null==(n=this.previousCacheItem)?void 0:n.key)===e&&this.previousCacheItem.expiresAt>Date.now())return(0,a.toResponseCacheEntry)(this.previousCacheItem.entry);let{incrementalCache:i,isOnDemandRevalidate:o=!1,isFallback:s=!1,isRoutePPREnabled:l=!1,isPrefetch:u=!1,waitUntil:c,routeKind:d}=r,h=await this.getBatcher.batch({key:e,isOnDemandRevalidate:o},({resolve:r})=>{let n=this.handleGet(e,t,{incrementalCache:i,isOnDemandRevalidate:o,isFallback:s,isRoutePPREnabled:l,isPrefetch:u,routeKind:d},r);return c&&c(n),n});return(0,a.toResponseCacheEntry)(h)}async handleGet(e,t,r,n){let i=null,o=!1;try{if((i=this.minimal_mode?null:await r.incrementalCache.get(e,{kind:(0,a.routeKindToIncrementalCacheKind)(r.routeKind),isRoutePPREnabled:r.isRoutePPREnabled,isFallback:r.isFallback}))&&!r.isOnDemandRevalidate&&(n(i),o=!0,!i.isStale||r.isPrefetch))return i;let s=await this.revalidate(e,r.incrementalCache,r.isRoutePPREnabled,r.isFallback,t,i,null!==i&&!r.isOnDemandRevalidate);if(!s)return this.minimal_mode&&(this.previousCacheItem=void 0),null;return r.isOnDemandRevalidate,s}catch(e){if(o)return console.error(e),null;throw e}}async revalidate(e,t,r,n,i,o,s,a){return this.revalidateBatcher.batch(e,()=>{let l=this.handleRevalidate(e,t,r,n,i,o,s);return a&&a(l),l})}async handleRevalidate(e,t,r,n,i,o,s){try{let l=await i({hasResolved:s,previousCacheEntry:o,isRevalidating:!0});if(!l)return null;let u=await (0,a.fromResponseCacheEntry)({...l,isMiss:!o});return u.cacheControl&&(this.minimal_mode?this.previousCacheItem={key:e,entry:u,expiresAt:Date.now()+1e3}:await t.set(e,u.value,{cacheControl:u.cacheControl,isRoutePPREnabled:r,isFallback:n})),u}catch(i){if(null==o?void 0:o.cacheControl){let i=Math.min(Math.max(o.cacheControl.revalidate||3,3),30),s=void 0===o.cacheControl.expire?void 0:Math.max(i+3,o.cacheControl.expire);await t.set(e,o.value,{cacheControl:{revalidate:i,expire:s},isRoutePPREnabled:r,isFallback:n})}throw i}}}},16899,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={NEXT_PATCH_SYMBOL:function(){return f},createPatchedFetcher:function(){return E},patchFetch:function(){return b},validateRevalidate:function(){return m},validateTags:function(){return g}};for(var i in n)Object.defineProperty(r,i,{enumerable:!0,get:n[i]});let o=e.r(64839),s=e.r(36851),a=e.r(91401),l=e.r(68665),u=e.r(4642),c=e.r(42966),d=e.r(32319),h=e.r(88119),p=e.r(66953);e.r(18185);let f=Symbol.for("next-patch");function m(e,t){try{let r;if(!1===e)r=a.INFINITE_CACHE;else if("number"==typeof e&&!isNaN(e)&&e>-1)r=e;else if(void 0!==e)throw Object.defineProperty(Error(`Invalid revalidate value "${e}" on "${t}", must be a non-negative number or false`),"__NEXT_ERROR_CODE",{value:"E179",enumerable:!1,configurable:!0});return r}catch(e){if(e instanceof Error&&e.message.includes("Invalid revalidate"))throw e;return}}function g(e,t){let r=[],n=[];for(let i=0;i<e.length;i++){let o=e[i];if("string"!=typeof o?n.push({tag:o,reason:"invalid type, must be a string"}):o.length>a.NEXT_CACHE_TAG_MAX_LENGTH?n.push({tag:o,reason:`exceeded max length of ${a.NEXT_CACHE_TAG_MAX_LENGTH}`}):r.push(o),r.length>a.NEXT_CACHE_TAG_MAX_ITEMS){console.warn(`Warning: exceeded max tag count for ${t}, dropped tags:`,e.slice(i).join(", "));break}}if(n.length>0)for(let{tag:e,reason:r}of(console.warn(`Warning: invalid tags passed to ${t}: `),n))console.log(`tag: "${e}" ${r}`);return r}function y(e,t){e.shouldTrackFetchMetrics&&(e.fetchMetrics??=[],e.fetchMetrics.push({...t,end:performance.timeOrigin+performance.now(),idx:e.nextFetchId||0}))}async function _(e,t,r,n,i,o){let s=await e.arrayBuffer(),a={headers:Object.fromEntries(e.headers.entries()),body:Buffer.from(s).toString("base64"),status:e.status,url:e.url};return r&&await n.set(t,{kind:h.CachedRouteKind.FETCH,data:a,revalidate:i},r),await o(),new Response(s,{headers:e.headers,status:e.status,statusText:e.statusText})}async function v(e,t,r,n,i,o,s,a,l){let[u,c]=(0,p.cloneResponse)(t),d=u.arrayBuffer().then(async e=>{let t=Buffer.from(e),a={headers:Object.fromEntries(u.headers.entries()),body:t.toString("base64"),status:u.status,url:u.url};null==o||o.set(r,a),n&&await i.set(r,{kind:h.CachedRouteKind.FETCH,data:a,revalidate:s},n)}).catch(e=>console.warn("Failed to set fetch cache",a,e)).finally(l),f=`cache-set-${r}`;return e.pendingRevalidates??={},f in e.pendingRevalidates&&await e.pendingRevalidates[f],e.pendingRevalidates[f]=d.finally(()=>{var t;(null==(t=e.pendingRevalidates)?void 0:t[f])&&delete e.pendingRevalidates[f]}),c}function E(e,{workAsyncStorage:t,workUnitAsyncStorage:r}){let n=async function(n,i){var c,f;let E;try{(E=new URL(n instanceof Request?n.url:n)).username="",E.password=""}catch{E=void 0}let b=(null==E?void 0:E.href)??"",T=(null==i||null==(c=i.method)?void 0:c.toUpperCase())||"GET",A=(null==i||null==(f=i.next)?void 0:f.internal)===!0,C="1"===process.env.NEXT_OTEL_FETCH_DISABLED,O=A?void 0:performance.timeOrigin+performance.now(),w=t.getStore(),I=r.getStore(),R=I?(0,d.getCacheSignal)(I):null;R&&R.beginRead();let x=(0,s.getTracer)().trace(A?o.NextNodeServerSpan.internalFetch:o.AppRenderSpan.fetch,{hideSpan:C,kind:s.SpanKind.CLIENT,spanName:["fetch",T,b].filter(Boolean).join(" "),attributes:{"http.url":b,"http.method":T,"net.peer.name":null==E?void 0:E.hostname,"net.peer.port":(null==E?void 0:E.port)||void 0}},async()=>{var t;let r,o,s,c,d,f;if(A||!w||w.isDraftMode)return e(n,i);let E=n&&"object"==typeof n&&"string"==typeof n.method,T=e=>(null==i?void 0:i[e])||(E?n[e]:null),C=e=>{var t,r,o;return void 0!==(null==i||null==(t=i.next)?void 0:t[e])?null==i||null==(r=i.next)?void 0:r[e]:E?null==(o=n.next)?void 0:o[e]:void 0},x=C("revalidate"),P=x,N=g(C("tags")||[],`fetch ${n.toString()}`);if(I)switch(I.type){case"prerender":case"prerender-runtime":case"prerender-client":case"prerender-ppr":case"prerender-legacy":case"cache":case"private-cache":r=I}if(r&&Array.isArray(N)){let e=r.tags??(r.tags=[]);for(let t of N)e.includes(t)||e.push(t)}let M=null==I?void 0:I.implicitTags,D=w.fetchCache;I&&"unstable-cache"===I.type&&(D="force-no-store");let k=!!w.isUnstableNoStore,L=T("cache"),U="";"string"==typeof L&&void 0!==P&&("force-cache"===L&&0===P||"no-store"===L&&(P>0||!1===P))&&(o=`Specified "cache: ${L}" and "revalidate: ${P}", only one should be specified.`,L=void 0,P=void 0);let B="no-cache"===L||"no-store"===L||"force-no-store"===D||"only-no-store"===D,q=!D&&!L&&!P&&w.forceDynamic;"force-cache"===L&&void 0===P?P=!1:(B||q)&&(P=0),("no-cache"===L||"no-store"===L)&&(U=`cache: ${L}`),f=m(P,w.route);let j=T("headers"),F="function"==typeof(null==j?void 0:j.get)?j:new Headers(j||{}),G=F.get("authorization")||F.get("cookie"),H=!["get","head"].includes((null==(t=T("method"))?void 0:t.toLowerCase())||"get"),$=void 0==D&&(void 0==L||"default"===L)&&void 0==P,V=!!((G||H)&&(null==r?void 0:r.revalidate)===0),W=!1;if(!V&&$&&(w.isBuildTimePrerendering?W=!0:V=!0),$&&void 0!==I)switch(I.type){case"prerender":case"prerender-runtime":case"prerender-client":return R&&(R.endRead(),R=null),(0,u.makeHangingPromise)(I.renderSignal,w.route,"fetch()")}switch(D){case"force-no-store":U="fetchCache = force-no-store";break;case"only-no-store":if("force-cache"===L||void 0!==f&&f>0)throw Object.defineProperty(Error(`cache: 'force-cache' used on fetch for ${b} with 'export const fetchCache = 'only-no-store'`),"__NEXT_ERROR_CODE",{value:"E448",enumerable:!1,configurable:!0});U="fetchCache = only-no-store";break;case"only-cache":if("no-store"===L)throw Object.defineProperty(Error(`cache: 'no-store' used on fetch for ${b} with 'export const fetchCache = 'only-cache'`),"__NEXT_ERROR_CODE",{value:"E521",enumerable:!1,configurable:!0});break;case"force-cache":(void 0===P||0===P)&&(U="fetchCache = force-cache",f=a.INFINITE_CACHE)}if(void 0===f?"default-cache"!==D||k?"default-no-store"===D?(f=0,U="fetchCache = default-no-store"):k?(f=0,U="noStore call"):V?(f=0,U="auto no cache"):(U="auto cache",f=r?r.revalidate:a.INFINITE_CACHE):(f=a.INFINITE_CACHE,U="fetchCache = default-cache"):U||(U=`revalidate: ${f}`),!(w.forceStatic&&0===f)&&!V&&r&&f<r.revalidate){if(0===f){if(I)switch(I.type){case"prerender":case"prerender-client":case"prerender-runtime":return R&&(R.endRead(),R=null),(0,u.makeHangingPromise)(I.renderSignal,w.route,"fetch()")}(0,l.markCurrentScopeAsDynamic)(w,I,`revalidate: 0 fetch ${n} ${w.route}`)}r&&x===f&&(r.revalidate=f)}let J="number"==typeof f&&f>0,{incrementalCache:K}=w,Y=!1;if(I)switch(I.type){case"request":case"cache":case"private-cache":Y=I.isHmrRefresh??!1,c=I.serverComponentsHmrCache}if(K&&(J||c))try{s=await K.generateCacheKey(b,E?n:i)}catch(e){console.error("Failed to generate cache key for",n)}let Q=w.nextFetchId??1;w.nextFetchId=Q+1;let z=()=>{},X=async(t,r)=>{let l=["cache","credentials","headers","integrity","keepalive","method","mode","redirect","referrer","referrerPolicy","window","duplex",...t?[]:["signal"]];if(E){let e=n,t={body:e._ogBody||e.body};for(let r of l)t[r]=e[r];n=new Request(e.url,t)}else if(i){let{_ogBody:e,body:r,signal:n,...o}=i;i={...o,body:e||r,signal:t?void 0:n}}let u={...i,next:{...null==i?void 0:i.next,fetchType:"origin",fetchIdx:Q}};return e(n,u).then(async e=>{if(!t&&O&&y(w,{start:O,url:b,cacheReason:r||U,cacheStatus:0===f||r?"skip":"miss",cacheWarning:o,status:e.status,method:u.method||"GET"}),200===e.status&&K&&s&&(J||c)){let t=f>=a.INFINITE_CACHE?a.CACHE_ONE_YEAR:f,r=J?{fetchCache:!0,fetchUrl:b,fetchIdx:Q,tags:N,isImplicitBuildTimeCache:W}:void 0;switch(null==I?void 0:I.type){case"prerender":case"prerender-client":case"prerender-runtime":return _(e,s,r,K,t,z);case"request":case"prerender-ppr":case"prerender-legacy":case"cache":case"private-cache":case"unstable-cache":case void 0:return v(w,e,s,r,K,c,t,n,z)}}return await z(),e}).catch(e=>{throw z(),e})},Z=!1,ee=!1;if(s&&K){let e;if(Y&&c&&(e=c.get(s),ee=!0),J&&!e){z=await K.lock(s);let t=w.isOnDemandRevalidate?null:await K.get(s,{kind:h.IncrementalCacheKind.FETCH,revalidate:f,fetchUrl:b,fetchIdx:Q,tags:N,softTags:null==M?void 0:M.tags});if($&&I)switch(I.type){case"prerender":case"prerender-client":case"prerender-runtime":await (S||(S=new Promise(e=>{setTimeout(()=>{S=null,e()},0)})),S)}if(t?await z():d="cache-control: no-cache (hard refresh)",(null==t?void 0:t.value)&&t.value.kind===h.CachedRouteKind.FETCH)if(w.isStaticGeneration&&t.isStale)Z=!0;else{if(t.isStale&&(w.pendingRevalidates??={},!w.pendingRevalidates[s])){let e=X(!0).then(async e=>({body:await e.arrayBuffer(),headers:e.headers,status:e.status,statusText:e.statusText})).finally(()=>{w.pendingRevalidates??={},delete w.pendingRevalidates[s||""]});e.catch(console.error),w.pendingRevalidates[s]=e}e=t.value.data}}if(e){O&&y(w,{start:O,url:b,cacheReason:U,cacheStatus:ee?"hmr":"hit",cacheWarning:o,status:e.status||200,method:(null==i?void 0:i.method)||"GET"});let t=new Response(Buffer.from(e.body,"base64"),{headers:e.headers,status:e.status});return Object.defineProperty(t,"url",{value:e.url}),t}}if(w.isStaticGeneration&&i&&"object"==typeof i){let{cache:e}=i;if("no-store"===e){if(I)switch(I.type){case"prerender":case"prerender-client":case"prerender-runtime":return R&&(R.endRead(),R=null),(0,u.makeHangingPromise)(I.renderSignal,w.route,"fetch()")}(0,l.markCurrentScopeAsDynamic)(w,I,`no-store fetch ${n} ${w.route}`)}let t="next"in i,{next:o={}}=i;if("number"==typeof o.revalidate&&r&&o.revalidate<r.revalidate){if(0===o.revalidate){if(I)switch(I.type){case"prerender":case"prerender-client":case"prerender-runtime":return(0,u.makeHangingPromise)(I.renderSignal,w.route,"fetch()")}(0,l.markCurrentScopeAsDynamic)(w,I,`revalidate: 0 fetch ${n} ${w.route}`)}w.forceStatic&&0===o.revalidate||(r.revalidate=o.revalidate)}t&&delete i.next}if(!s||!Z)return X(!1,d);{let e=s;w.pendingRevalidates??={};let t=w.pendingRevalidates[e];if(t){let e=await t;return new Response(e.body,{headers:e.headers,status:e.status,statusText:e.statusText})}let r=X(!0,d).then(p.cloneResponse);return(t=r.then(async e=>{let t=e[0];return{body:await t.arrayBuffer(),headers:t.headers,status:t.status,statusText:t.statusText}}).finally(()=>{var t;(null==(t=w.pendingRevalidates)?void 0:t[e])&&delete w.pendingRevalidates[e]})).catch(()=>{}),w.pendingRevalidates[e]=t,r.then(e=>e[1])}});if(R)try{return await x}finally{R&&R.endRead()}return x};return n.__nextPatched=!0,n.__nextGetStaticStore=()=>t,n._nextOriginalFetch=e,globalThis[f]=!0,Object.defineProperty(n,"name",{value:"fetch",writable:!1}),n}function b(e){if(!0===globalThis[f])return;let t=(0,c.createDedupeFetch)(globalThis.fetch);globalThis.fetch=E(t,e)}let S=null},32533,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"unstable_cache",{enumerable:!0,get:function(){return c}});let n=e.r(91401),i=e.r(16899),o=e.r(56704),s=e.r(32319),a=e.r(88119),l=0;async function u(e,t,r,i,o,s,l){await t.set(r,{kind:a.CachedRouteKind.FETCH,data:{headers:{},body:JSON.stringify(e),status:200,url:""},revalidate:"number"!=typeof o?n.CACHE_ONE_YEAR:o},{fetchCache:!0,tags:i,fetchIdx:s,fetchUrl:l})}function c(e,t,r={}){if(0===r.revalidate)throw Object.defineProperty(Error(`Invariant revalidate: 0 can not be passed to unstable_cache(), must be "false" or "> 0" ${e.toString()}`),"__NEXT_ERROR_CODE",{value:"E57",enumerable:!1,configurable:!0});let n=r.tags?(0,i.validateTags)(r.tags,`unstable_cache ${e.toString()}`):[];(0,i.validateRevalidate)(r.revalidate,`unstable_cache ${e.name||e.toString()}`);let d=`${e.toString()}-${Array.isArray(t)&&t.join(",")}`;return async(...t)=>{let i=o.workAsyncStorage.getStore(),c=s.workUnitAsyncStorage.getStore(),h=(null==i?void 0:i.incrementalCache)||globalThis.__incrementalCache;if(!h)throw Object.defineProperty(Error(`Invariant: incrementalCache missing in unstable_cache ${e.toString()}`),"__NEXT_ERROR_CODE",{value:"E469",enumerable:!1,configurable:!0});let p=c?(0,s.getCacheSignal)(c):null;p&&p.beginRead();try{let o=i&&c?function(e,t){switch(t.type){case"request":let r=t.url.pathname,n=new URLSearchParams(t.url.search),i=[...n.keys()].sort((e,t)=>e.localeCompare(t)).map(e=>`${e}=${n.get(e)}`).join("&");return`${r}${i.length?"?":""}${i}`;case"prerender":case"prerender-client":case"prerender-runtime":case"prerender-ppr":case"prerender-legacy":case"cache":case"private-cache":case"unstable-cache":return e.route;default:return t}}(i,c):"",p=`${d}-${JSON.stringify(t)}`,f=await h.generateCacheKey(p),m=`unstable_cache ${o} ${e.name?` ${e.name}`:f}`,g=(i?i.nextFetchId:l)??1,y=null==c?void 0:c.implicitTags,_={type:"unstable-cache",phase:"render",implicitTags:y,draftMode:c&&i&&(0,s.getDraftModeProviderForCacheScope)(i,c)};if(i){i.nextFetchId=g+1;let o=!1;if(c)switch(c.type){case"cache":case"private-cache":case"prerender":case"prerender-runtime":case"prerender-ppr":case"prerender-legacy":"number"==typeof r.revalidate&&(c.revalidate<r.revalidate||(c.revalidate=r.revalidate));let l=c.tags;if(null===l)c.tags=n.slice();else for(let e of n)l.includes(e)||l.push(e);break;case"unstable-cache":o=!0}if(!o&&"force-no-store"!==i.fetchCache&&!i.isOnDemandRevalidate&&!h.isOnDemandRevalidate&&!i.isDraftMode){let o=await h.get(f,{kind:a.IncrementalCacheKind.FETCH,revalidate:r.revalidate,tags:n,softTags:null==y?void 0:y.tags,fetchIdx:g,fetchUrl:m});if(o&&o.value)if(o.value.kind!==a.CachedRouteKind.FETCH)console.error(`Invariant invalid cacheEntry returned for ${p}`);else{let a=void 0!==o.value.data.body?JSON.parse(o.value.data.body):void 0;if(o.isStale){if(i.pendingRevalidates||(i.pendingRevalidates={}),!i.pendingRevalidates[p]){let o=s.workUnitAsyncStorage.run(_,e,...t).then(async e=>(await u(e,h,f,n,r.revalidate,g,m),e)).catch(e=>(console.error(`revalidating cache with key: ${p}`,e),a));i.isStaticGeneration&&o.catch(()=>{}),i.pendingRevalidates[p]=o}if(i.isStaticGeneration)return i.pendingRevalidates[p]}return a}}let d=await s.workUnitAsyncStorage.run(_,e,...t);return i.isDraftMode||(i.pendingRevalidates||(i.pendingRevalidates={}),i.pendingRevalidates[p]=u(d,h,f,n,r.revalidate,g,m)),d}{if(l+=1,!h.isOnDemandRevalidate){let e=await h.get(f,{kind:a.IncrementalCacheKind.FETCH,revalidate:r.revalidate,tags:n,fetchIdx:g,fetchUrl:m,softTags:null==y?void 0:y.tags});if(e&&e.value){if(e.value.kind!==a.CachedRouteKind.FETCH)console.error(`Invariant invalid cacheEntry returned for ${p}`);else if(!e.isStale)return void 0!==e.value.data.body?JSON.parse(e.value.data.body):void 0}}let i=await s.workUnitAsyncStorage.run(_,e,...t);return await u(i,h,f,n,r.revalidate,g,m),i}}finally{p&&p.endRead()}}}},31551,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={getSortedRouteObjects:function(){return a},getSortedRoutes:function(){return s}};for(var i in n)Object.defineProperty(r,i,{enumerable:!0,get:n[i]});class o{insert(e){this._insert(e.split("/").filter(Boolean),[],!1)}smoosh(){return this._smoosh()}_smoosh(e="/"){let t=[...this.children.keys()].sort();null!==this.slugName&&t.splice(t.indexOf("[]"),1),null!==this.restSlugName&&t.splice(t.indexOf("[...]"),1),null!==this.optionalRestSlugName&&t.splice(t.indexOf("[[...]]"),1);let r=t.map(t=>this.children.get(t)._smoosh(`${e}${t}/`)).reduce((e,t)=>[...e,...t],[]);if(null!==this.slugName&&r.push(...this.children.get("[]")._smoosh(`${e}[${this.slugName}]/`)),!this.placeholder){let t="/"===e?"/":e.slice(0,-1);if(null!=this.optionalRestSlugName)throw Object.defineProperty(Error(`You cannot define a route with the same specificity as a optional catch-all route ("${t}" and "${t}[[...${this.optionalRestSlugName}]]").`),"__NEXT_ERROR_CODE",{value:"E458",enumerable:!1,configurable:!0});r.unshift(t)}return null!==this.restSlugName&&r.push(...this.children.get("[...]")._smoosh(`${e}[...${this.restSlugName}]/`)),null!==this.optionalRestSlugName&&r.push(...this.children.get("[[...]]")._smoosh(`${e}[[...${this.optionalRestSlugName}]]/`)),r}_insert(e,t,r){if(0===e.length){this.placeholder=!1;return}if(r)throw Object.defineProperty(Error("Catch-all must be the last part of the URL."),"__NEXT_ERROR_CODE",{value:"E392",enumerable:!1,configurable:!0});let n=e[0];if(n.startsWith("[")&&n.endsWith("]")){let o=n.slice(1,-1),s=!1;if(o.startsWith("[")&&o.endsWith("]")&&(o=o.slice(1,-1),s=!0),o.startsWith(""))throw Object.defineProperty(Error(`Detected a three-dot character ('') at ('${o}'). Did you mean ('...')?`),"__NEXT_ERROR_CODE",{value:"E147",enumerable:!1,configurable:!0});if(o.startsWith("...")&&(o=o.substring(3),r=!0),o.startsWith("[")||o.endsWith("]"))throw Object.defineProperty(Error(`Segment names may not start or end with extra brackets ('${o}').`),"__NEXT_ERROR_CODE",{value:"E421",enumerable:!1,configurable:!0});if(o.startsWith("."))throw Object.defineProperty(Error(`Segment names may not start with erroneous periods ('${o}').`),"__NEXT_ERROR_CODE",{value:"E288",enumerable:!1,configurable:!0});function i(e,r){if(null!==e&&e!==r)throw Object.defineProperty(Error(`You cannot use different slug names for the same dynamic path ('${e}' !== '${r}').`),"__NEXT_ERROR_CODE",{value:"E337",enumerable:!1,configurable:!0});t.forEach(e=>{if(e===r)throw Object.defineProperty(Error(`You cannot have the same slug name "${r}" repeat within a single dynamic path`),"__NEXT_ERROR_CODE",{value:"E247",enumerable:!1,configurable:!0});if(e.replace(/\W/g,"")===n.replace(/\W/g,""))throw Object.defineProperty(Error(`You cannot have the slug names "${e}" and "${r}" differ only by non-word symbols within a single dynamic path`),"__NEXT_ERROR_CODE",{value:"E499",enumerable:!1,configurable:!0})}),t.push(r)}if(r)if(s){if(null!=this.restSlugName)throw Object.defineProperty(Error(`You cannot use both an required and optional catch-all route at the same level ("[...${this.restSlugName}]" and "${e[0]}" ).`),"__NEXT_ERROR_CODE",{value:"E299",enumerable:!1,configurable:!0});i(this.optionalRestSlugName,o),this.optionalRestSlugName=o,n="[[...]]"}else{if(null!=this.optionalRestSlugName)throw Object.defineProperty(Error(`You cannot use both an optional and required catch-all route at the same level ("[[...${this.optionalRestSlugName}]]" and "${e[0]}").`),"__NEXT_ERROR_CODE",{value:"E300",enumerable:!1,configurable:!0});i(this.restSlugName,o),this.restSlugName=o,n="[...]"}else{if(s)throw Object.defineProperty(Error(`Optional route parameters are not yet supported ("${e[0]}").`),"__NEXT_ERROR_CODE",{value:"E435",enumerable:!1,configurable:!0});i(this.slugName,o),this.slugName=o,n="[]"}}this.children.has(n)||this.children.set(n,new o),this.children.get(n)._insert(e.slice(1),t,r)}constructor(){this.placeholder=!0,this.children=new Map,this.slugName=null,this.restSlugName=null,this.optionalRestSlugName=null}}function s(e){let t=new o;return e.forEach(e=>t.insert(e)),t.smoosh()}function a(e,t){let r={},n=[];for(let i=0;i<e.length;i++){let o=t(e[i]);r[o]=i,n[i]=o}return s(n).map(t=>e[r[t]])}},64033,(e,t,r)=>{"use strict";function n(e){return e.startsWith("/")?e:`/${e}`}Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"ensureLeadingSlash",{enumerable:!0,get:function(){return n}})},60426,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={DEFAULT_SEGMENT_KEY:function(){return d},PAGE_SEGMENT_KEY:function(){return c},addSearchParamsIfPageSegment:function(){return l},computeSelectedLayoutSegment:function(){return u},getSegmentValue:function(){return o},getSelectedLayoutSegmentPath:function(){return function e(t,r,n=!0,i=[]){let s;if(n)s=t[1][r];else{let e=t[1];s=e.children??Object.values(e)[0]}if(!s)return i;let a=o(s[0]);return!a||a.startsWith(c)?i:(i.push(a),e(s,r,!1,i))}},isGroupSegment:function(){return s},isParallelRouteSegment:function(){return a}};for(var i in n)Object.defineProperty(r,i,{enumerable:!0,get:n[i]});function o(e){return Array.isArray(e)?e[1]:e}function s(e){return"("===e[0]&&e.endsWith(")")}function a(e){return e.startsWith("@")&&"@children"!==e}function l(e,t){if(e.includes(c)){let e=JSON.stringify(t);return"{}"!==e?c+"?"+e:c}return e}function u(e,t){if(!e||0===e.length)return null;let r="children"===t?e[0]:e[e.length-1];return r===d?null:r}let c="__PAGE__",d="__DEFAULT__"},65618,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={normalizeAppPath:function(){return a},normalizeRscURL:function(){return l}};for(var i in n)Object.defineProperty(r,i,{enumerable:!0,get:n[i]});let o=e.r(64033),s=e.r(60426);function a(e){return(0,o.ensureLeadingSlash)(e.split("/").reduce((e,t,r,n)=>!t||(0,s.isGroupSegment)(t)||"@"===t[0]||("page"===t||"route"===t)&&r===n.length-1?e:`${e}/${t}`,""))}function l(e){return e.replace(/\.rsc($|\?)/,"$1")}},41417,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={INTERCEPTION_ROUTE_MARKERS:function(){return s},extractInterceptionRouteInformation:function(){return l},isInterceptionRouteAppPath:function(){return a}};for(var i in n)Object.defineProperty(r,i,{enumerable:!0,get:n[i]});let o=e.r(65618),s=["(..)(..)","(.)","(..)","(...)"];function a(e){return void 0!==e.split("/").find(e=>s.find(t=>e.startsWith(t)))}function l(e){let t,r,n;for(let i of e.split("/"))if(r=s.find(e=>i.startsWith(e))){[t,n]=e.split(r,2);break}if(!t||!r||!n)throw Object.defineProperty(Error(`Invalid interception route: ${e}. Must be in the format /<intercepting route>/(..|...|..)(..)/<intercepted route>`),"__NEXT_ERROR_CODE",{value:"E269",enumerable:!1,configurable:!0});switch(t=(0,o.normalizeAppPath)(t),r){case"(.)":n="/"===t?`/${n}`:t+"/"+n;break;case"(..)":if("/"===t)throw Object.defineProperty(Error(`Invalid interception route: ${e}. Cannot use (..) marker at the root level, use (.) instead.`),"__NEXT_ERROR_CODE",{value:"E207",enumerable:!1,configurable:!0});n=t.split("/").slice(0,-1).concat(n).join("/");break;case"(...)":n="/"+n;break;case"(..)(..)":let i=t.split("/");if(i.length<=2)throw Object.defineProperty(Error(`Invalid interception route: ${e}. Cannot use (..)(..) marker at the root level or one level up.`),"__NEXT_ERROR_CODE",{value:"E486",enumerable:!1,configurable:!0});n=i.slice(0,-2).concat(n).join("/");break;default:throw Object.defineProperty(Error("Invariant: unexpected marker"),"__NEXT_ERROR_CODE",{value:"E112",enumerable:!1,configurable:!0})}return{interceptingRoute:t,interceptedRoute:n}}},58499,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"isDynamicRoute",{enumerable:!0,get:function(){return s}});let n=e.r(41417),i=/\/[^/]*\[[^/]+\][^/]*(?=\/|$)/,o=/\/\[[^/]+\](?=\/|$)/;function s(e,t=!0){return((0,n.isInterceptionRouteAppPath)(e)&&(e=(0,n.extractInterceptionRouteInformation)(e).interceptedRoute),t)?o.test(e):i.test(e)}},54692,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={getSortedRouteObjects:function(){return o.getSortedRouteObjects},getSortedRoutes:function(){return o.getSortedRoutes},isDynamicRoute:function(){return s.isDynamicRoute}};for(var i in n)Object.defineProperty(r,i,{enumerable:!0,get:n[i]});let o=e.r(31551),s=e.r(58499)},86240,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={refresh:function(){return f},revalidatePath:function(){return m},revalidateTag:function(){return h},updateTag:function(){return p}};for(var i in n)Object.defineProperty(r,i,{enumerable:!0,get:n[i]});let o=e.r(68665),s=e.r(54692),a=e.r(91401),l=e.r(56704),u=e.r(32319),c=e.r(65252),d=e.r(76414);function h(e,t){return t||console.warn('"revalidateTag" without the second argument is now deprecated, add second argument of "max" or use "updateTag". See more info here: https://nextjs.org/docs/messages/revalidate-tag-single-arg'),g([e],`revalidateTag ${e}`,t)}function p(e){let t=l.workAsyncStorage.getStore();if(!t||t.page.endsWith("/route"))throw Object.defineProperty(Error("updateTag can only be called from within a Server Action. To invalidate cache tags in Route Handlers or other contexts, use revalidateTag instead. See more info here: https://nextjs.org/docs/app/api-reference/functions/updateTag"),"__NEXT_ERROR_CODE",{value:"E872",enumerable:!1,configurable:!0});return g([e],`updateTag ${e}`,void 0)}function f(){let e=l.workAsyncStorage.getStore(),t=u.workUnitAsyncStorage.getStore();if(!e||e.page.endsWith("/route")||(null==t?void 0:t.phase)!=="action")throw Object.defineProperty(Error("refresh can only be called from within a Server Action. See more info here: https://nextjs.org/docs/app/api-reference/functions/refresh"),"__NEXT_ERROR_CODE",{value:"E870",enumerable:!1,configurable:!0});e&&(e.pathWasRevalidated=!0)}function m(e,t){if(e.length>a.NEXT_CACHE_SOFT_TAG_MAX_LENGTH)return void console.warn(`Warning: revalidatePath received "${e}" which exceeded max length of ${a.NEXT_CACHE_SOFT_TAG_MAX_LENGTH}. See more info here https://nextjs.org/docs/app/api-reference/functions/revalidatePath`);let r=`${a.NEXT_CACHE_IMPLICIT_TAG_ID}${e||"/"}`;t?r+=`${r.endsWith("/")?"":"/"}${t}`:(0,s.isDynamicRoute)(e)&&console.warn(`Warning: a dynamic page path "${e}" was passed to "revalidatePath", but the "type" parameter is missing. This has no effect by default, see more info here https://nextjs.org/docs/app/api-reference/functions/revalidatePath`);let n=[r];return r===`${a.NEXT_CACHE_IMPLICIT_TAG_ID}/`?n.push(`${a.NEXT_CACHE_IMPLICIT_TAG_ID}/index`):r===`${a.NEXT_CACHE_IMPLICIT_TAG_ID}/index`&&n.push(`${a.NEXT_CACHE_IMPLICIT_TAG_ID}/`),g(n,`revalidatePath ${e}`)}function g(e,t,r){var n;let i=l.workAsyncStorage.getStore();if(!i||!i.incrementalCache)throw Object.defineProperty(Error(`Invariant: static generation store missing in ${t}`),"__NEXT_ERROR_CODE",{value:"E263",enumerable:!1,configurable:!0});let s=u.workUnitAsyncStorage.getStore();if(s){if("render"===s.phase)throw Object.defineProperty(Error(`Route ${i.route} used "${t}" during render which is unsupported. To ensure revalidation is performed consistently it must always happen outside of renders and cached functions. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`),"__NEXT_ERROR_CODE",{value:"E7",enumerable:!1,configurable:!0});switch(s.type){case"cache":case"private-cache":throw Object.defineProperty(Error(`Route ${i.route} used "${t}" inside a "use cache" which is unsupported. To ensure revalidation is performed consistently it must always happen outside of renders and cached functions. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`),"__NEXT_ERROR_CODE",{value:"E181",enumerable:!1,configurable:!0});case"unstable-cache":throw Object.defineProperty(Error(`Route ${i.route} used "${t}" inside a function cached with "unstable_cache(...)" which is unsupported. To ensure revalidation is performed consistently it must always happen outside of renders and cached functions. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`),"__NEXT_ERROR_CODE",{value:"E306",enumerable:!1,configurable:!0});case"prerender":case"prerender-runtime":let e=Object.defineProperty(Error(`Route ${i.route} used ${t} without first calling \`await connection()\`.`),"__NEXT_ERROR_CODE",{value:"E406",enumerable:!1,configurable:!0});return(0,o.abortAndThrowOnSynchronousRequestDataAccess)(i.route,t,e,s);case"prerender-client":throw Object.defineProperty(new d.InvariantError(`${t} must not be used within a client component. Next.js should be preventing ${t} from being included in client components statically, but did not in this case.`),"__NEXT_ERROR_CODE",{value:"E693",enumerable:!1,configurable:!0});case"prerender-ppr":return(0,o.postponeWithTracking)(i.route,t,s.dynamicTracking);case"prerender-legacy":s.revalidate=0;let r=Object.defineProperty(new c.DynamicServerError(`Route ${i.route} couldn't be rendered statically because it used \`${t}\`. See more info here: https://nextjs.org/docs/messages/dynamic-server-error`),"__NEXT_ERROR_CODE",{value:"E558",enumerable:!1,configurable:!0});throw i.dynamicUsageDescription=t,i.dynamicUsageStack=r.stack,r}}for(let t of(i.pendingRevalidatedTags||(i.pendingRevalidatedTags=[]),e))-1===i.pendingRevalidatedTags.findIndex(e=>e.tag===t&&("string"==typeof e.profile&&"string"==typeof r?e.profile===r:"object"==typeof e.profile&&"object"==typeof r?JSON.stringify(e.profile)===JSON.stringify(r):e.profile===r))&&i.pendingRevalidatedTags.push({tag:t,profile:r});let a=r&&"object"==typeof r?r:r&&"string"==typeof r&&(null==i||null==(n=i.cacheLifeProfiles)?void 0:n[r])?i.cacheLifeProfiles[r]:void 0;r&&(null==a?void 0:a.expire)!==0||(i.pathWasRevalidated=!0)}},60951,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"unstable_noStore",{enumerable:!0,get:function(){return s}});let n=e.r(56704),i=e.r(32319),o=e.r(68665);function s(){let e=n.workAsyncStorage.getStore(),t=i.workUnitAsyncStorage.getStore();if(e){if(!e.forceStatic){if(e.isUnstableNoStore=!0,t)switch(t.type){case"prerender":case"prerender-client":case"prerender-runtime":return}(0,o.markCurrentScopeAsDynamic)(e,t,"unstable_noStore()")}}}},53540,(e,t,r)=>{"use strict";function n(e){throw Object.defineProperty(Error("`cacheLife()` is only available with the `cacheComponents` config."),"__NEXT_ERROR_CODE",{value:"E887",enumerable:!1,configurable:!0})}Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"cacheLife",{enumerable:!0,get:function(){return n}}),e.r(76414),e.r(56704),e.r(32319)},88819,(e,t,r)=>{"use strict";function n(){throw Object.defineProperty(Error("`cacheTag()` is only available with the `cacheComponents` config."),"__NEXT_ERROR_CODE",{value:"E886",enumerable:!1,configurable:!0})}Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"cacheTag",{enumerable:!0,get:function(){return n}}),e.r(32319),e.r(16899)},65044,(e,t,r)=>{let n={unstable_cache:e.r(32533).unstable_cache,updateTag:e.r(86240).updateTag,revalidateTag:e.r(86240).revalidateTag,revalidatePath:e.r(86240).revalidatePath,refresh:e.r(86240).refresh,unstable_noStore:e.r(60951).unstable_noStore,cacheLife:e.r(53540).cacheLife,cacheTag:e.r(88819).cacheTag},i=!1,o=!1;n.unstable_cacheLife=function(){return i||(i=!0,console.error(Error("`unstable_cacheLife` was recently stabilized and should be imported as `cacheLife`. The `unstable` prefixed form will be removed in a future version of Next.js."))),n.cacheLife.apply(this,arguments)},n.unstable_cacheTag=function(){return o||(o=!0,console.error(Error("`unstable_cacheTag` was recently stabilized and should be imported as `cacheTag`. The `unstable` prefixed form will be removed in a future version of Next.js."))),n.cacheTag.apply(this,arguments)},t.exports=n,r.unstable_cache=n.unstable_cache,r.revalidatePath=n.revalidatePath,r.revalidateTag=n.revalidateTag,r.updateTag=n.updateTag,r.unstable_noStore=n.unstable_noStore,r.cacheLife=n.cacheLife,r.unstable_cacheLife=n.unstable_cacheLife,r.cacheTag=n.cacheTag,r.unstable_cacheTag=n.unstable_cacheTag,r.refresh=n.refresh},95975,(e,t,r)=>{"use strict";function n(e){for(let t=0;t<e.length;t++){let r=e[t];if("function"!=typeof r)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof r}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"ensureServerEntryExports",{enumerable:!0,get:function(){return n}})},7312,94943,e=>{"use strict";let t,r;var n=e.i(45015),i=e.i(65044),o=e.i(47334),s=e.i(22734),a=e.i(81111);e.i(21365),e.i(29485),e.i(16735);var l=e.i(35065);e.i(17198),l.default;var u=e.i(24868);class c{}function d(e,t){return e.replace(/\{([^}]+)\}/g,(e,r)=>{if(Object.prototype.hasOwnProperty.call(t,r)){let e=t[r];return null!=e?String(e):""}throw Error(`Key '${r}' not found in valueMap.`)})}function h(e,t,r){for(let n=0;n<t.length-1;n++){let i=t[n];if(i.endsWith("[]")){let o=i.slice(0,-2);if(!(o in e))if(Array.isArray(r))e[o]=Array.from({length:r.length},()=>({}));else throw Error(`Value must be a list given an array path ${i}`);if(Array.isArray(e[o])){let i=e[o];if(Array.isArray(r))for(let e=0;e<i.length;e++)h(i[e],t.slice(n+1),r[e]);else for(let e of i)h(e,t.slice(n+1),r)}return}if(i.endsWith("[0]")){let o=i.slice(0,-3);o in e||(e[o]=[{}]),h(e[o][0],t.slice(n+1),r);return}e[i]&&"object"==typeof e[i]||(e[i]={}),e=e[i]}let n=t[t.length-1],i=e[n];if(void 0!==i){if(!r||"object"==typeof r&&0===Object.keys(r).length||r===i)return;if("object"==typeof i&&"object"==typeof r&&null!==i&&null!==r)Object.assign(i,r);else throw Error(`Cannot set value for an existing key. Key: ${n}`)}else"_self"!==n||"object"!=typeof r||null===r||Array.isArray(r)?e[n]=r:Object.assign(e,r)}function p(e,t,r){try{if(1===t.length&&"_self"===t[0])return e;for(let n=0;n<t.length;n++){if("object"!=typeof e||null===e)return r;let i=t[n];if(i.endsWith("[]")){let o=i.slice(0,-2);if(!(o in e))return r;{let i=e[o];if(!Array.isArray(i))return r;return i.map(e=>p(e,t.slice(n+1),r))}}e=e[i]}return e}catch(e){if(e instanceof TypeError)return r;throw e}}function f(e){if("string"!=typeof e)throw Error("fromImageBytes must be a string");return e}(tC=rd||(rd={})).OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",tC.OUTCOME_OK="OUTCOME_OK",tC.OUTCOME_FAILED="OUTCOME_FAILED",tC.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED",(tO=rh||(rh={})).LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",tO.PYTHON="PYTHON",(tw=rp||(rp={})).SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",tw.SILENT="SILENT",tw.WHEN_IDLE="WHEN_IDLE",tw.INTERRUPT="INTERRUPT",(tI=rf||(rf={})).TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",tI.STRING="STRING",tI.NUMBER="NUMBER",tI.INTEGER="INTEGER",tI.BOOLEAN="BOOLEAN",tI.ARRAY="ARRAY",tI.OBJECT="OBJECT",tI.NULL="NULL",(tR=rm||(rm={})).HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",tR.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",tR.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",tR.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",tR.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",tR.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",tR.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",tR.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",tR.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",tR.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",tR.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK",(tx=rg||(rg={})).HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",tx.SEVERITY="SEVERITY",tx.PROBABILITY="PROBABILITY",(tP=ry||(ry={})).HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",tP.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",tP.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",tP.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",tP.BLOCK_NONE="BLOCK_NONE",tP.OFF="OFF",(tN=r_||(r_={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",tN.MODE_DYNAMIC="MODE_DYNAMIC",(tM=rv||(rv={})).AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",tM.NO_AUTH="NO_AUTH",tM.API_KEY_AUTH="API_KEY_AUTH",tM.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",tM.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",tM.OAUTH="OAUTH",tM.OIDC_AUTH="OIDC_AUTH",(tD=rE||(rE={})).API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",tD.SIMPLE_SEARCH="SIMPLE_SEARCH",tD.ELASTIC_SEARCH="ELASTIC_SEARCH",(tk=rb||(rb={})).URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",tk.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",tk.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",tk.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",tk.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE",(tL=rS||(rS={})).FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",tL.STOP="STOP",tL.MAX_TOKENS="MAX_TOKENS",tL.SAFETY="SAFETY",tL.RECITATION="RECITATION",tL.LANGUAGE="LANGUAGE",tL.OTHER="OTHER",tL.BLOCKLIST="BLOCKLIST",tL.PROHIBITED_CONTENT="PROHIBITED_CONTENT",tL.SPII="SPII",tL.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",tL.IMAGE_SAFETY="IMAGE_SAFETY",tL.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",tL.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",tL.NO_IMAGE="NO_IMAGE",(tU=rT||(rT={})).HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",tU.NEGLIGIBLE="NEGLIGIBLE",tU.LOW="LOW",tU.MEDIUM="MEDIUM",tU.HIGH="HIGH",(tB=rA||(rA={})).HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",tB.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",tB.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",tB.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",tB.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH",(tq=rC||(rC={})).BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",tq.SAFETY="SAFETY",tq.OTHER="OTHER",tq.BLOCKLIST="BLOCKLIST",tq.PROHIBITED_CONTENT="PROHIBITED_CONTENT",tq.IMAGE_SAFETY="IMAGE_SAFETY",tq.MODEL_ARMOR="MODEL_ARMOR",tq.JAILBREAK="JAILBREAK",(tj=rO||(rO={})).TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",tj.ON_DEMAND="ON_DEMAND",tj.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT",(tF=rw||(rw={})).MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",tF.TEXT="TEXT",tF.IMAGE="IMAGE",tF.AUDIO="AUDIO",(tG=rI||(rI={})).MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",tG.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",tG.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",tG.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",(tH=rR||(rR={})).JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",tH.JOB_STATE_QUEUED="JOB_STATE_QUEUED",tH.JOB_STATE_PENDING="JOB_STATE_PENDING",tH.JOB_STATE_RUNNING="JOB_STATE_RUNNING",tH.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",tH.JOB_STATE_FAILED="JOB_STATE_FAILED",tH.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",tH.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",tH.JOB_STATE_PAUSED="JOB_STATE_PAUSED",tH.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",tH.JOB_STATE_UPDATING="JOB_STATE_UPDATING",tH.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED",(t$=rx||(rx={})).TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",t$.TUNING_MODE_FULL="TUNING_MODE_FULL",t$.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER",(tV=rP||(rP={})).ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",tV.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",tV.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",tV.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",tV.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",tV.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",tV.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO",(tW=rN||(rN={})).TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",tW.TUNING_TASK_I2V="TUNING_TASK_I2V",tW.TUNING_TASK_T2V="TUNING_TASK_T2V",(tJ=rM||(rM={})).FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",tJ.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",tJ.BALANCED="BALANCED",tJ.PRIORITIZE_COST="PRIORITIZE_COST",(tK=rD||(rD={})).UNSPECIFIED="UNSPECIFIED",tK.BLOCKING="BLOCKING",tK.NON_BLOCKING="NON_BLOCKING",(tY=rk||(rk={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",tY.MODE_DYNAMIC="MODE_DYNAMIC",(tQ=rL||(rL={})).ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",tQ.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER",(tz=rU||(rU={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",tz.AUTO="AUTO",tz.ANY="ANY",tz.NONE="NONE",tz.VALIDATED="VALIDATED",(tX=rB||(rB={})).BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",tX.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",tX.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",tX.BLOCK_NONE="BLOCK_NONE",(tZ=rq||(rq={})).DONT_ALLOW="DONT_ALLOW",tZ.ALLOW_ADULT="ALLOW_ADULT",tZ.ALLOW_ALL="ALLOW_ALL",(t0=rj||(rj={})).auto="auto",t0.en="en",t0.ja="ja",t0.ko="ko",t0.hi="hi",t0.zh="zh",t0.pt="pt",t0.es="es",(t1=rF||(rF={})).MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",t1.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",t1.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",t1.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",t1.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC",(t2=rG||(rG={})).CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",t2.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",t2.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",t2.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH",(t6=rH||(rH={})).SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",t6.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",t6.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",t6.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT",(t3=r$||(r$={})).EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",t3.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",t3.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",t3.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",t3.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",t3.EDIT_MODE_STYLE="EDIT_MODE_STYLE",t3.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",t3.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE",(t8=rV||(rV={})).FOREGROUND="FOREGROUND",t8.BACKGROUND="BACKGROUND",t8.PROMPT="PROMPT",t8.SEMANTIC="SEMANTIC",t8.INTERACTIVE="INTERACTIVE",(t5=rW||(rW={})).ASSET="ASSET",t5.STYLE="STYLE",(t4=rJ||(rJ={})).INSERT="INSERT",t4.REMOVE="REMOVE",t4.REMOVE_STATIC="REMOVE_STATIC",t4.OUTPAINT="OUTPAINT",(t9=rK||(rK={})).OPTIMIZED="OPTIMIZED",t9.LOSSLESS="LOSSLESS",(t7=rY||(rY={})).STATE_UNSPECIFIED="STATE_UNSPECIFIED",t7.PROCESSING="PROCESSING",t7.ACTIVE="ACTIVE",t7.FAILED="FAILED",(re=rQ||(rQ={})).SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",re.UPLOADED="UPLOADED",re.GENERATED="GENERATED",(rt=rz||(rz={})).TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",rt.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",rt.RESPONSE_REJECTED="RESPONSE_REJECTED",rt.NEED_MORE_INPUT="NEED_MORE_INPUT",(rr=rX||(rX={})).MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",rr.TEXT="TEXT",rr.IMAGE="IMAGE",rr.VIDEO="VIDEO",rr.AUDIO="AUDIO",rr.DOCUMENT="DOCUMENT",(rn=rZ||(rZ={})).START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",rn.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",rn.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW",(ri=r0||(r0={})).END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",ri.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",ri.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW",(ro=r1||(r1={})).ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",ro.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",ro.NO_INTERRUPTION="NO_INTERRUPTION",(rs=r2||(r2={})).TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",rs.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",rs.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT",(ra=r6||(r6={})).SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",ra.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",ra.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",ra.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",ra.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",ra.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",ra.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",ra.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",ra.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",ra.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",ra.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",ra.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",ra.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR",(rl=r3||(r3={})).MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",rl.QUALITY="QUALITY",rl.DIVERSITY="DIVERSITY",rl.VOCALIZATION="VOCALIZATION",(ru=r8||(r8={})).PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",ru.PLAY="PLAY",ru.PAUSE="PAUSE",ru.STOP="STOP",ru.RESET_CONTEXT="RESET_CONTEXT";class m{constructor(e){const t={};for(const r of e.headers.entries())t[r[0]]=r[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}}class g{get text(){var e,t,r,n,i,o,s,a;if((null==(n=null==(r=null==(t=null==(e=this.candidates)?void 0:e[0])?void 0:t.content)?void 0:r.parts)?void 0:n.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let l="",u=!1,c=[];for(let e of null!=(a=null==(s=null==(o=null==(i=this.candidates)?void 0:i[0])?void 0:o.content)?void 0:s.parts)?a:[]){for(let[t,r]of Object.entries(e))"text"!==t&&"thought"!==t&&(null!==r||void 0!==r)&&c.push(t);if("string"==typeof e.text){if("boolean"==typeof e.thought&&e.thought)continue;u=!0,l+=e.text}}return c.length>0&&console.warn(`there are non-text parts ${c} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),u?l:void 0}get data(){var e,t,r,n,i,o,s,a;if((null==(n=null==(r=null==(t=null==(e=this.candidates)?void 0:e[0])?void 0:t.content)?void 0:r.parts)?void 0:n.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let l="",u=[];for(let e of null!=(a=null==(s=null==(o=null==(i=this.candidates)?void 0:i[0])?void 0:o.content)?void 0:s.parts)?a:[]){for(let[t,r]of Object.entries(e))"inlineData"!==t&&(null!==r||void 0!==r)&&u.push(t);e.inlineData&&"string"==typeof e.inlineData.data&&(l+=atob(e.inlineData.data))}return u.length>0&&console.warn(`there are non-data parts ${u} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),l.length>0?btoa(l):void 0}get functionCalls(){var e,t,r,n,i,o,s,a;if((null==(n=null==(r=null==(t=null==(e=this.candidates)?void 0:e[0])?void 0:t.content)?void 0:r.parts)?void 0:n.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");let l=null==(a=null==(s=null==(o=null==(i=this.candidates)?void 0:i[0])?void 0:o.content)?void 0:s.parts)?void 0:a.filter(e=>e.functionCall).map(e=>e.functionCall).filter(e=>void 0!==e);if((null==l?void 0:l.length)!==0)return l}get executableCode(){var e,t,r,n,i,o,s,a,l;if((null==(n=null==(r=null==(t=null==(e=this.candidates)?void 0:e[0])?void 0:t.content)?void 0:r.parts)?void 0:n.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");let u=null==(a=null==(s=null==(o=null==(i=this.candidates)?void 0:i[0])?void 0:o.content)?void 0:s.parts)?void 0:a.filter(e=>e.executableCode).map(e=>e.executableCode).filter(e=>void 0!==e);if((null==u?void 0:u.length)!==0)return null==(l=null==u?void 0:u[0])?void 0:l.code}get codeExecutionResult(){var e,t,r,n,i,o,s,a,l;if((null==(n=null==(r=null==(t=null==(e=this.candidates)?void 0:e[0])?void 0:t.content)?void 0:r.parts)?void 0:n.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");let u=null==(a=null==(s=null==(o=null==(i=this.candidates)?void 0:i[0])?void 0:o.content)?void 0:s.parts)?void 0:a.filter(e=>e.codeExecutionResult).map(e=>e.codeExecutionResult).filter(e=>void 0!==e);if((null==u?void 0:u.length)!==0)return null==(l=null==u?void 0:u[0])?void 0:l.output}}class y{}class _{}class v{}class E{}class b{}class S{}class T{}class A{}class C{}class O{}class w{_fromAPIResponse({apiResponse:e,isVertexAI:t}){let r,n=new w;if(t){let t,n,i,o,s,a;t={},null!=(n=p(e,["name"]))&&h(t,["name"],n),null!=(i=p(e,["metadata"]))&&h(t,["metadata"],i),null!=(o=p(e,["done"]))&&h(t,["done"],o),null!=(s=p(e,["error"]))&&h(t,["error"],s),null!=(a=p(e,["response"]))&&h(t,["response"],function(e){let t={},r=p(e,["videos"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>{var t;let r,n,i,o,s,a;return r={},null!=(n=p(e,["_self"]))&&h(r,["video"],(i={},null!=(o=p(t=n,["gcsUri"]))&&h(i,["uri"],o),null!=(s=p(t,["bytesBase64Encoded"]))&&h(i,["videoBytes"],f(s)),null!=(a=p(t,["mimeType"]))&&h(i,["mimeType"],a),i)),r})),h(t,["generatedVideos"],e)}let n=p(e,["raiMediaFilteredCount"]);null!=n&&h(t,["raiMediaFilteredCount"],n);let i=p(e,["raiMediaFilteredReasons"]);return null!=i&&h(t,["raiMediaFilteredReasons"],i),t}(a)),r=t}else{let t,n,i,o,s,a;t={},null!=(n=p(e,["name"]))&&h(t,["name"],n),null!=(i=p(e,["metadata"]))&&h(t,["metadata"],i),null!=(o=p(e,["done"]))&&h(t,["done"],o),null!=(s=p(e,["error"]))&&h(t,["error"],s),null!=(a=p(e,["response","generateVideoResponse"]))&&h(t,["response"],function(e){let t={},r=p(e,["generatedSamples"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>{var t;let r,n,i,o,s,a;return r={},null!=(n=p(e,["video"]))&&h(r,["video"],(i={},null!=(o=p(t=n,["uri"]))&&h(i,["uri"],o),null!=(s=p(t,["encodedVideo"]))&&h(i,["videoBytes"],f(s)),null!=(a=p(t,["encoding"]))&&h(i,["mimeType"],a),i)),r})),h(t,["generatedVideos"],e)}let n=p(e,["raiMediaFilteredCount"]);null!=n&&h(t,["raiMediaFilteredCount"],n);let i=p(e,["raiMediaFilteredReasons"]);return null!=i&&h(t,["raiMediaFilteredReasons"],i),t}(a)),r=t}return Object.assign(n,r),n}}class I{}class R{}class x{}class P{}class N{}class M{}class D{}class k{get text(){var e,t,r;let n="",i=!1,o=[];for(let s of null!=(r=null==(t=null==(e=this.serverContent)?void 0:e.modelTurn)?void 0:t.parts)?r:[]){for(let[e,t]of Object.entries(s))"text"!==e&&"thought"!==e&&null!==t&&o.push(e);if("string"==typeof s.text){if("boolean"==typeof s.thought&&s.thought)continue;i=!0,n+=s.text}}return o.length>0&&console.warn(`there are non-text parts ${o} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),i?n:void 0}get data(){var e,t,r;let n="",i=[];for(let o of null!=(r=null==(t=null==(e=this.serverContent)?void 0:e.modelTurn)?void 0:t.parts)?r:[]){for(let[e,t]of Object.entries(o))"inlineData"!==e&&null!==t&&i.push(e);o.inlineData&&"string"==typeof o.inlineData.data&&(n+=atob(o.inlineData.data))}return i.length>0&&console.warn(`there are non-data parts ${i} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),n.length>0?btoa(n):void 0}}class L{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}function U(e,t){if(!t||"string"!=typeof t)throw Error("model is required and must be a string");if(e.isVertexAI())if(t.startsWith("publishers/")||t.startsWith("projects/")||t.startsWith("models/"))return t;else{if(!(t.indexOf("/")>=0))return`publishers/google/models/${t}`;let e=t.split("/",2);return`publishers/${e[0]}/models/${e[1]}`}return t.startsWith("models/")||t.startsWith("tunedModels/")?t:`models/${t}`}function B(e,t){let r=U(e,t);return r?r.startsWith("publishers/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/${r}`:r.startsWith("models/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/publishers/google/${r}`:r:""}function q(e){return Array.isArray(e)?e.map(e=>j(e)):[j(e)]}function j(e){if("object"==typeof e&&null!==e)return e;throw Error(`Could not parse input as Blob. Unsupported blob type: ${typeof e}`)}function F(e){let t=j(e);if(t.mimeType&&t.mimeType.startsWith("image/"))return t;throw Error(`Unsupported mime type: ${t.mimeType}`)}function G(e){let t=j(e);if(t.mimeType&&t.mimeType.startsWith("audio/"))return t;throw Error(`Unsupported mime type: ${t.mimeType}`)}function H(e){if(null==e)throw Error("PartUnion is required");if("object"==typeof e)return e;if("string"==typeof e)return{text:e};throw Error(`Unsupported part type: ${typeof e}`)}function $(e){if(null==e||Array.isArray(e)&&0===e.length)throw Error("PartListUnion is required");return Array.isArray(e)?e.map(e=>H(e)):[H(e)]}function V(e){return null!=e&&"object"==typeof e&&"parts"in e&&Array.isArray(e.parts)}function W(e){return null!=e&&"object"==typeof e&&"functionCall"in e}function J(e){return null!=e&&"object"==typeof e&&"functionResponse"in e}function K(e){if(null==e)throw Error("ContentUnion is required");return V(e)?e:{role:"user",parts:$(e)}}function Y(e,t){if(!t)return[];if(e.isVertexAI()&&Array.isArray(t))return t.flatMap(e=>{let t=K(e);return t.parts&&t.parts.length>0&&void 0!==t.parts[0].text?[t.parts[0].text]:[]});if(e.isVertexAI()){let e=K(t);return e.parts&&e.parts.length>0&&void 0!==e.parts[0].text?[e.parts[0].text]:[]}return Array.isArray(t)?t.map(e=>K(e)):[K(t)]}function Q(e){if(null==e||Array.isArray(e)&&0===e.length)throw Error("contents are required");if(!Array.isArray(e)){if(W(e)||J(e))throw Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[K(e)]}let t=[],r=[],n=V(e[0]);for(let i of e){let e=V(i);if(e!=n)throw Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(e)t.push(i);else if(W(i)||J(i))throw Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");else r.push(i)}return n||t.push({role:"user",parts:$(r)}),t}function z(e){let t={},r=["items"],n=["anyOf"],i=["properties"];if(e.type&&e.anyOf)throw Error("type and anyOf cannot be both populated.");let o=e.anyOf;for(let[s,a]of(null!=o&&2==o.length&&("null"===o[0].type?(t.nullable=!0,e=o[1]):"null"===o[1].type&&(t.nullable=!0,e=o[0])),e.type instanceof Array&&function(e,t){e.includes("null")&&(t.nullable=!0);let r=e.filter(e=>"null"!==e);if(1===r.length)t.type=Object.values(rf).includes(r[0].toUpperCase())?r[0].toUpperCase():rf.TYPE_UNSPECIFIED;else for(let e of(t.anyOf=[],r))t.anyOf.push({type:Object.values(rf).includes(e.toUpperCase())?e.toUpperCase():rf.TYPE_UNSPECIFIED})}(e.type,t),Object.entries(e)))if(null!=a)if("type"==s){if("null"===a)throw Error("type: null can not be the only possible type for the field.");if(a instanceof Array)continue;t.type=Object.values(rf).includes(a.toUpperCase())?a.toUpperCase():rf.TYPE_UNSPECIFIED}else if(r.includes(s))t[s]=z(a);else if(n.includes(s)){let e=[];for(let r of a){if("null"==r.type){t.nullable=!0;continue}e.push(z(r))}t[s]=e}else if(i.includes(s)){let e={};for(let[t,r]of Object.entries(a))e[t]=z(r);t[s]=e}else{if("additionalProperties"===s)continue;t[s]=a}return t}function X(e){if("object"==typeof e)return e;if("string"==typeof e)return{voiceConfig:{prebuiltVoiceConfig:{voiceName:e}}};throw Error(`Unsupported speechConfig type: ${typeof e}`)}function Z(e){if("multiSpeakerVoiceConfig"in e)throw Error("multiSpeakerVoiceConfig is not supported in the live API.");return e}function ee(e){if(e.functionDeclarations)for(let t of e.functionDeclarations)t.parameters&&(Object.keys(t.parameters).includes("$schema")?t.parametersJsonSchema||(t.parametersJsonSchema=t.parameters,delete t.parameters):t.parameters=z(t.parameters)),t.response&&(Object.keys(t.response).includes("$schema")?t.responseJsonSchema||(t.responseJsonSchema=t.response,delete t.response):t.response=z(t.response));return e}function et(e){if(null==e)throw Error("tools is required");if(!Array.isArray(e))throw Error("tools is required and must be an array of Tools");let t=[];for(let r of e)t.push(r);return t}function er(e,t){if("string"!=typeof t)throw Error("name must be a string");return function(e,t,r,n=1){let i=!t.startsWith(`${r}/`)&&t.split("/").length===n;if(e.isVertexAI())if(t.startsWith("projects/"))return t;else if(t.startsWith("locations/"))return`projects/${e.getProject()}/${t}`;else if(t.startsWith(`${r}/`))return`projects/${e.getProject()}/locations/${e.getLocation()}/${t}`;else if(i)return`projects/${e.getProject()}/locations/${e.getLocation()}/${r}/${t}`;else return t;return i?`${r}/${t}`:t}(e,t,"cachedContents")}function en(e){switch(e){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return e}}function ei(e){return null!=e&&"object"==typeof e&&"video"in e}function eo(e){return null!=e&&"object"==typeof e&&"uri"in e}function es(e){var t;let r;if(null!=e&&"object"==typeof e&&"name"in e&&(r=e.name),!eo(e)||void 0!==(r=e.uri)){if(!ei(e)||void 0!==(r=null==(t=e.video)?void 0:t.uri)){if("string"==typeof e&&(r=e),void 0===r)throw Error("Could not extract file name from the provided input.");if(r.startsWith("https://")){let e=r.split("files/")[1].match(/[a-z0-9]+/);if(null===e)throw Error(`Could not extract file name from URI ${r}`);r=e[0]}else r.startsWith("files/")&&(r=r.split("files/")[1]);return r}}}function ea(e,t){return e.isVertexAI()?t?"publishers/google/models":"models":t?"models":"tunedModels"}function el(e){for(let n of["models","tunedModels","publisherModels"]){var t,r;if(t=e,r=n,null!==t&&"object"==typeof t&&r in t)return e[n]}return[]}function eu(e,t){let r;if("string"==typeof t)if(e.isVertexAI())if(t.startsWith("gs://"))r={format:"jsonl",gcsUri:[t]};else if(t.startsWith("bq://"))r={format:"bigquery",bigqueryUri:t};else throw Error(`Unsupported string source for Vertex AI: ${t}`);else if(t.startsWith("files/"))r={fileName:t};else throw Error(`Unsupported string source for Gemini API: ${t}`);else if(Array.isArray(t)){if(e.isVertexAI())throw Error("InlinedRequest[] is not supported in Vertex AI.");r={inlinedRequests:t}}else r=t;let n=[r.gcsUri,r.bigqueryUri].filter(Boolean).length,i=[r.inlinedRequests,r.fileName].filter(Boolean).length;if(e.isVertexAI()){if(i>0||1!==n)throw Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(n>0||1!==i)throw Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return r}function ec(e){if("object"!=typeof e||null===e)return{};let t=e.inlinedResponses;if("object"!=typeof t||null===t)return e;let r=t.inlinedResponses;if(!Array.isArray(r)||0===r.length)return e;let n=!1;for(let e of r){if("object"!=typeof e||null===e)continue;let t=e.response;if("object"==typeof t&&null!==t&&void 0!==t.embedding){n=!0;break}}return n&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),e}function ed(e,t){if(!e.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw Error(`Invalid batch job name: ${t}.`)}function eh(e){if("BATCH_STATE_UNSPECIFIED"===e)return"JOB_STATE_UNSPECIFIED";if("BATCH_STATE_PENDING"===e)return"JOB_STATE_PENDING";if("BATCH_STATE_RUNNING"===e)return"JOB_STATE_RUNNING";if("BATCH_STATE_SUCCEEDED"===e)return"JOB_STATE_SUCCEEDED";if("BATCH_STATE_FAILED"===e)return"JOB_STATE_FAILED";else if("BATCH_STATE_CANCELLED"===e)return"JOB_STATE_CANCELLED";else if("BATCH_STATE_EXPIRED"===e)return"JOB_STATE_EXPIRED";else return e}function ep(e){let t={},r=p(e,["name"]);null!=r&&h(t,["name"],r);let n=p(e,["metadata","displayName"]);null!=n&&h(t,["displayName"],n);let i=p(e,["metadata","state"]);null!=i&&h(t,["state"],eh(i));let o=p(e,["metadata","createTime"]);null!=o&&h(t,["createTime"],o);let s=p(e,["metadata","endTime"]);null!=s&&h(t,["endTime"],s);let a=p(e,["metadata","updateTime"]);null!=a&&h(t,["updateTime"],a);let l=p(e,["metadata","model"]);null!=l&&h(t,["model"],l);let u=p(e,["metadata","output"]);return null!=u&&h(t,["dest"],function(e){let t={},r=p(e,["responsesFile"]);null!=r&&h(t,["fileName"],r);let n=p(e,["inlinedResponses","inlinedResponses"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let r,n,i;return r={},null!=(n=p(t=e,["response"]))&&h(r,["response"],function(e){let t={},r=p(e,["sdkHttpResponse"]);null!=r&&h(t,["sdkHttpResponse"],r);let n=p(e,["candidates"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=p(e,["content"]);null!=r&&h(t,["content"],r);let n=p(e,["citationMetadata"]);null!=n&&h(t,["citationMetadata"],function(e){let t={},r=p(e,["citationSources"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),h(t,["citations"],e)}return t}(n));let i=p(e,["tokenCount"]);null!=i&&h(t,["tokenCount"],i);let o=p(e,["finishReason"]);null!=o&&h(t,["finishReason"],o);let s=p(e,["urlContextMetadata"]);null!=s&&h(t,["urlContextMetadata"],s);let a=p(e,["avgLogprobs"]);null!=a&&h(t,["avgLogprobs"],a);let l=p(e,["groundingMetadata"]);null!=l&&h(t,["groundingMetadata"],l);let u=p(e,["index"]);null!=u&&h(t,["index"],u);let c=p(e,["logprobsResult"]);null!=c&&h(t,["logprobsResult"],c);let d=p(e,["safetyRatings"]);if(null!=d){let e=d;Array.isArray(e)&&(e=e.map(e=>e)),h(t,["safetyRatings"],e)}return t})(e))),h(t,["candidates"],e)}let i=p(e,["modelVersion"]);null!=i&&h(t,["modelVersion"],i);let o=p(e,["promptFeedback"]);null!=o&&h(t,["promptFeedback"],o);let s=p(e,["responseId"]);null!=s&&h(t,["responseId"],s);let a=p(e,["usageMetadata"]);return null!=a&&h(t,["usageMetadata"],a),t}(n)),null!=(i=p(t,["error"]))&&h(r,["error"],i),r})),h(t,["inlinedResponses"],e)}let i=p(e,["inlinedEmbedContentResponses","inlinedResponses"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),h(t,["inlinedEmbedContentResponses"],e)}return t}(ec(u))),t}function ef(e){var t,r;let n,i,o,s,a,l,u,c,d={},f=p(e,["name"]);null!=f&&h(d,["name"],f);let m=p(e,["displayName"]);null!=m&&h(d,["displayName"],m);let g=p(e,["state"]);null!=g&&h(d,["state"],eh(g));let y=p(e,["error"]);null!=y&&h(d,["error"],y);let _=p(e,["createTime"]);null!=_&&h(d,["createTime"],_);let v=p(e,["startTime"]);null!=v&&h(d,["startTime"],v);let E=p(e,["endTime"]);null!=E&&h(d,["endTime"],E);let b=p(e,["updateTime"]);null!=b&&h(d,["updateTime"],b);let S=p(e,["model"]);null!=S&&h(d,["model"],S);let T=p(e,["inputConfig"]);null!=T&&h(d,["src"],(n={},null!=(i=p(r=T,["instancesFormat"]))&&h(n,["format"],i),null!=(o=p(r,["gcsSource","uris"]))&&h(n,["gcsUri"],o),null!=(s=p(r,["bigquerySource","inputUri"]))&&h(n,["bigqueryUri"],s),n));let A=p(e,["outputConfig"]);return null!=A&&h(d,["dest"],(t=ec(A),a={},null!=(l=p(t,["predictionsFormat"]))&&h(a,["format"],l),null!=(u=p(t,["gcsDestination","outputUriPrefix"]))&&h(a,["gcsUri"],u),null!=(c=p(t,["bigqueryDestination","outputUri"]))&&h(a,["bigqueryUri"],c),a)),d}function em(e){let t={},r=p(e,["parts"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>{var t;let r,n,i,o,s,a,l,u,c,d,f;return r={},null!=(n=p(t=e,["videoMetadata"]))&&h(r,["videoMetadata"],n),null!=(i=p(t,["thought"]))&&h(r,["thought"],i),null!=(o=p(t,["inlineData"]))&&h(r,["inlineData"],function(e){let t={};if(void 0!==p(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=p(e,["data"]);null!=r&&h(t,["data"],r);let n=p(e,["mimeType"]);return null!=n&&h(t,["mimeType"],n),t}(o)),null!=(s=p(t,["fileData"]))&&h(r,["fileData"],function(e){let t={};if(void 0!==p(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=p(e,["fileUri"]);null!=r&&h(t,["fileUri"],r);let n=p(e,["mimeType"]);return null!=n&&h(t,["mimeType"],n),t}(s)),null!=(a=p(t,["thoughtSignature"]))&&h(r,["thoughtSignature"],a),null!=(l=p(t,["functionCall"]))&&h(r,["functionCall"],l),null!=(u=p(t,["codeExecutionResult"]))&&h(r,["codeExecutionResult"],u),null!=(c=p(t,["executableCode"]))&&h(r,["executableCode"],c),null!=(d=p(t,["functionResponse"]))&&h(r,["functionResponse"],d),null!=(f=p(t,["text"]))&&h(r,["text"],f),r})),h(t,["parts"],e)}let n=p(e,["role"]);return null!=n&&h(t,["role"],n),t}function eg(e,t){let r={},n=p(t,["model"]);null!=n&&h(r,["_url","model"],U(e,n));let i=p(t,["src"]);null!=i&&h(r,["batch","inputConfig"],function(e,t){let r={};if(void 0!==p(t,["format"]))throw Error("format parameter is not supported in Gemini API.");if(void 0!==p(t,["gcsUri"]))throw Error("gcsUri parameter is not supported in Gemini API.");if(void 0!==p(t,["bigqueryUri"]))throw Error("bigqueryUri parameter is not supported in Gemini API.");let n=p(t,["fileName"]);null!=n&&h(r,["fileName"],n);let i=p(t,["inlinedRequests"]);if(null!=i){let t=i;Array.isArray(t)&&(t=t.map(t=>(function(e,t){let r={},n=p(t,["model"]);null!=n&&h(r,["request","model"],U(e,n));let i=p(t,["contents"]);if(null!=i){let e=Q(i);Array.isArray(e)&&(e=e.map(e=>em(e))),h(r,["request","contents"],e)}let o=p(t,["metadata"]);null!=o&&h(r,["metadata"],o);let s=p(t,["config"]);return null!=s&&h(r,["request","generationConfig"],function(e,t,r){let n={},i=p(t,["systemInstruction"]);void 0!==r&&null!=i&&h(r,["systemInstruction"],em(K(i)));let o=p(t,["temperature"]);null!=o&&h(n,["temperature"],o);let s=p(t,["topP"]);null!=s&&h(n,["topP"],s);let a=p(t,["topK"]);null!=a&&h(n,["topK"],a);let l=p(t,["candidateCount"]);null!=l&&h(n,["candidateCount"],l);let u=p(t,["maxOutputTokens"]);null!=u&&h(n,["maxOutputTokens"],u);let c=p(t,["stopSequences"]);null!=c&&h(n,["stopSequences"],c);let d=p(t,["responseLogprobs"]);null!=d&&h(n,["responseLogprobs"],d);let f=p(t,["logprobs"]);null!=f&&h(n,["logprobs"],f);let m=p(t,["presencePenalty"]);null!=m&&h(n,["presencePenalty"],m);let g=p(t,["frequencyPenalty"]);null!=g&&h(n,["frequencyPenalty"],g);let y=p(t,["seed"]);null!=y&&h(n,["seed"],y);let _=p(t,["responseMimeType"]);null!=_&&h(n,["responseMimeType"],_);let v=p(t,["responseSchema"]);null!=v&&h(n,["responseSchema"],z(v));let E=p(t,["responseJsonSchema"]);if(null!=E&&h(n,["responseJsonSchema"],E),void 0!==p(t,["routingConfig"]))throw Error("routingConfig parameter is not supported in Gemini API.");if(void 0!==p(t,["modelSelectionConfig"]))throw Error("modelSelectionConfig parameter is not supported in Gemini API.");let b=p(t,["safetySettings"]);if(void 0!==r&&null!=b){let e=b;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==p(e,["method"]))throw Error("method parameter is not supported in Gemini API.");let r=p(e,["category"]);null!=r&&h(t,["category"],r);let n=p(e,["threshold"]);return null!=n&&h(t,["threshold"],n),t})(e))),h(r,["safetySettings"],e)}let S=p(t,["tools"]);if(void 0!==r&&null!=S){let e=et(S);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=p(e,["functionDeclarations"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),h(t,["functionDeclarations"],e)}if(void 0!==p(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let n=p(e,["googleSearch"]);null!=n&&h(t,["googleSearch"],function(e){let t={},r=p(e,["timeRangeFilter"]);if(null!=r&&h(t,["timeRangeFilter"],r),void 0!==p(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");return t}(n));let i=p(e,["googleSearchRetrieval"]);if(null!=i&&h(t,["googleSearchRetrieval"],i),void 0!==p(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let o=p(e,["googleMaps"]);null!=o&&h(t,["googleMaps"],function(e){let t={};if(void 0!==p(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let r=p(e,["enableWidget"]);return null!=r&&h(t,["enableWidget"],r),t}(o));let s=p(e,["urlContext"]);null!=s&&h(t,["urlContext"],s);let a=p(e,["computerUse"]);null!=a&&h(t,["computerUse"],a);let l=p(e,["codeExecution"]);return null!=l&&h(t,["codeExecution"],l),t})(ee(e)))),h(r,["tools"],e)}let T=p(t,["toolConfig"]);if(void 0!==r&&null!=T&&h(r,["toolConfig"],T),void 0!==p(t,["labels"]))throw Error("labels parameter is not supported in Gemini API.");let A=p(t,["cachedContent"]);void 0!==r&&null!=A&&h(r,["cachedContent"],er(e,A));let C=p(t,["responseModalities"]);null!=C&&h(n,["responseModalities"],C);let O=p(t,["mediaResolution"]);null!=O&&h(n,["mediaResolution"],O);let w=p(t,["speechConfig"]);if(null!=w&&h(n,["speechConfig"],X(w)),void 0!==p(t,["audioTimestamp"]))throw Error("audioTimestamp parameter is not supported in Gemini API.");let I=p(t,["thinkingConfig"]);null!=I&&h(n,["thinkingConfig"],I);let R=p(t,["imageConfig"]);return null!=R&&h(n,["imageConfig"],R),n}(e,s,p(r,["request"],{}))),r})(e,t))),h(r,["requests","requests"],t)}return r}(e,eu(e,i)));let o=p(t,["config"]);return null!=o&&function(e,t){let r=p(e,["displayName"]);if(void 0!==t&&null!=r&&h(t,["batch","displayName"],r),void 0!==p(e,["dest"]))throw Error("dest parameter is not supported in Gemini API.")}(o,r),r}(rc=r5||(r5={})).PAGED_ITEM_BATCH_JOBS="batchJobs",rc.PAGED_ITEM_MODELS="models",rc.PAGED_ITEM_TUNING_JOBS="tuningJobs",rc.PAGED_ITEM_FILES="files",rc.PAGED_ITEM_CACHED_CONTENTS="cachedContents";class ey{constructor(e,t,r,n){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,r,n)}init(e,t,r){var n,i;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=null==t?void 0:t.sdkHttpResponse,this.idxInternal=0;let o={config:{}};(o=r&&0!==Object.keys(r).length?"object"==typeof r?Object.assign({},r):r:{config:{}}).config&&(o.config.pageToken=t.nextPageToken),this.paramsInternal=o,this.pageInternalSize=null!=(i=null==(n=o.config)?void 0:n.pageSize)?i:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(!this.hasNextPage())return{value:void 0,done:!0};else await this.nextPage();let e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw Error("No more pages to fetch.");let e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return(null==(e=this.params.config)?void 0:e.pageToken)!==void 0}}class e_ extends c{constructor(e){super(),this.apiClient=e,this.create=async e=>(this.apiClient.isVertexAI()&&(e.config=this.formatDestination(e.src,e.config)),this.createInternal(e)),this.createEmbeddings=async e=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(e)},this.list=async(e={})=>new ey(r5.PAGED_ITEM_BATCH_JOBS,e=>this.listInternal(e),await this.listInternal(e),e)}createInlinedGenerateContentRequest(e){let t=eg(this.apiClient,e),r=d("{model}:batchGenerateContent",t._url),n=t.batch.inputConfig.requests,i=n.requests,o=[];for(let e of i){let t=Object.assign({},e);if(t.systemInstruction){let e=t.systemInstruction;delete t.systemInstruction;let r=t.request;r.systemInstruction=e,t.request=r}o.push(t)}return n.requests=o,delete t.config,delete t._url,delete t._query,{path:r,body:t}}getGcsUri(e){return"string"==typeof e?e.startsWith("gs://")?e:void 0:!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0?e.gcsUri[0]:void 0}getBigqueryUri(e){return"string"==typeof e?e.startsWith("bq://")?e:void 0:Array.isArray(e)?void 0:e.bigqueryUri}formatDestination(e,t){let r=t?Object.assign({},t):{},n=Date.now().toString();if(r.displayName||(r.displayName=`genaiBatchJob_${n}`),void 0===r.dest){let t=this.getGcsUri(e),i=this.getBigqueryUri(e);if(t)t.endsWith(".jsonl")?r.dest=`${t.slice(0,-6)}/dest`:r.dest=`${t}_dest_${n}`;else if(i)r.dest=`${i}_dest_${n}`;else throw Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return r}async createInternal(e){var t,r,n,i,o;let s="",a={};if(this.apiClient.isVertexAI()){let n,i,l,u,c,f,m=(o=this.apiClient,n={},null!=(i=p(e,["model"]))&&h(n,["model"],U(o,i)),null!=(l=p(e,["src"]))&&h(n,["inputConfig"],function(e){let t={},r=p(e,["format"]);null!=r&&h(t,["instancesFormat"],r);let n=p(e,["gcsUri"]);null!=n&&h(t,["gcsSource","uris"],n);let i=p(e,["bigqueryUri"]);if(null!=i&&h(t,["bigquerySource","inputUri"],i),void 0!==p(e,["fileName"]))throw Error("fileName parameter is not supported in Vertex AI.");if(void 0!==p(e,["inlinedRequests"]))throw Error("inlinedRequests parameter is not supported in Vertex AI.");return t}(eu(o,l))),null!=(u=p(e,["config"]))&&(c=p(u,["displayName"]),void 0!==n&&null!=c&&h(n,["displayName"],c),f=p(u,["dest"]),void 0!==n&&null!=f&&h(n,["outputConfig"],function(e){let t={},r=p(e,["format"]);null!=r&&h(t,["predictionsFormat"],r);let n=p(e,["gcsUri"]);null!=n&&h(t,["gcsDestination","outputUriPrefix"],n);let i=p(e,["bigqueryUri"]);if(null!=i&&h(t,["bigqueryDestination","outputUri"],i),void 0!==p(e,["fileName"]))throw Error("fileName parameter is not supported in Vertex AI.");if(void 0!==p(e,["inlinedResponses"]))throw Error("inlinedResponses parameter is not supported in Vertex AI.");if(void 0!==p(e,["inlinedEmbedContentResponses"]))throw Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return t}(function(e){if("string"!=typeof e)return e;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw Error(`Unsupported destination: ${e}`)}(f)))),n);return s=d("batchPredictionJobs",m._url),a=m._query,delete m._url,delete m._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(m),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json()).then(e=>ef(e))}{let t=eg(this.apiClient,e);return s=d("{model}:batchGenerateContent",t._url),a=t._query,delete t._url,delete t._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(n=e.config)?void 0:n.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json()).then(e=>ep(e))}}async createEmbeddingsInternal(e){var t,r,n,i,o;let s="",a={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let l,u,c,f,m,g,y,_,v=(n=this.apiClient,f={},null!=(m=p(e,["model"]))&&h(f,["_url","model"],U(n,m)),null!=(g=p(e,["src"]))&&h(f,["batch","inputConfig"],(i=n,l={},null!=(u=p(o=g,["fileName"]))&&h(l,["file_name"],u),null!=(c=p(o,["inlinedRequests"]))&&h(l,["requests"],function(e,t){let r={},n=p(t,["contents"]);if(null!=n){let t=Y(e,n);Array.isArray(t)&&(t=t.map(e=>e)),h(r,["requests[]","request","content"],t)}let i=p(t,["config"]);return null!=i&&(h(r,["_self"],function(e,t){let r=p(e,["taskType"]);void 0!==t&&null!=r&&h(t,["requests[]","taskType"],r);let n=p(e,["title"]);void 0!==t&&null!=n&&h(t,["requests[]","title"],n);let i=p(e,["outputDimensionality"]);if(void 0!==t&&null!=i&&h(t,["requests[]","outputDimensionality"],i),void 0!==p(e,["mimeType"]))throw Error("mimeType parameter is not supported in Gemini API.");if(void 0!==p(e,["autoTruncate"]))throw Error("autoTruncate parameter is not supported in Gemini API.");return{}}(i,r)),!function(e,t){for(let[r,n]of Object.entries(t)){let t=r.split("."),i=n.split("."),o=new Set,s=-1;for(let e=0;e<t.length;e++)if("*"===t[e]){s=e;break}if(-1!==s&&i.length>s)for(let e=s;e<i.length;e++){let t=i[e];"*"===t||t.endsWith("[]")||t.endsWith("[0]")||o.add(t)}!function e(t,r,n,i,o){if(i>=r.length||"object"!=typeof t||null===t)return;let s=r[i];if(s.endsWith("[]")){let a=s.slice(0,-2);if(a in t&&Array.isArray(t[a]))for(let s of t[a])e(s,r,n,i+1,o)}else if("*"===s){if("object"==typeof t&&null!==t&&!Array.isArray(t)){let e=Object.keys(t).filter(e=>!e.startsWith("_")&&!o.has(e)),r={};for(let n of e)r[n]=t[n];for(let[e,o]of Object.entries(r)){let r=[];for(let t of n.slice(i))"*"===t?r.push(e):r.push(t);h(t,r,o)}for(let r of e)delete t[r]}}else s in t&&e(t[s],r,n,i+1,o)}(e,t,i,0,o)}}(r,{"requests[].*":"requests[].request.*"})),r}(i,c)),l)),null!=(y=p(e,["config"]))&&(_=p(y,["displayName"]),void 0!==f&&null!=_&&h(f,["batch","displayName"],_)),f);return s=d("{model}:asyncBatchEmbedContent",v._url),a=v._query,delete v._url,delete v._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(v),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json()).then(e=>ep(e))}}async get(e){var t,r,n,i,o,s;let a="",l={};if(this.apiClient.isVertexAI()){let n,i,s=(o=this.apiClient,n={},null!=(i=p(e,["name"]))&&h(n,["_url","name"],ed(o,i)),n);return a=d("batchPredictionJobs/{name}",s._url),l=s._query,delete s._url,delete s._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json()).then(e=>ef(e))}{let t,r,o=(s=this.apiClient,t={},null!=(r=p(e,["name"]))&&h(t,["_url","name"],ed(s,r)),t);return a=d("batches/{name}",o._url),l=o._query,delete o._url,delete o._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null==(n=e.config)?void 0:n.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json()).then(e=>ep(e))}}async cancel(e){var t,r,n,i,o,s;let a="",l={};if(this.apiClient.isVertexAI()){let n,i,s=(o=this.apiClient,n={},null!=(i=p(e,["name"]))&&h(n,["_url","name"],ed(o,i)),n);a=d("batchPredictionJobs/{name}:cancel",s._url),l=s._query,delete s._url,delete s._query,await this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal})}else{let t,r,o=(s=this.apiClient,t={},null!=(r=p(e,["name"]))&&h(t,["_url","name"],ed(s,r)),t);a=d("batches/{name}:cancel",o._url),l=o._query,delete o._url,delete o._query,await this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null==(n=e.config)?void 0:n.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal})}}async listInternal(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n,i,a,l,u,c=(n={},null!=(i=p(e,["config"]))&&(a=p(i,["pageSize"]),void 0!==n&&null!=a&&h(n,["_query","pageSize"],a),l=p(i,["pageToken"]),void 0!==n&&null!=l&&h(n,["_query","pageToken"],l),u=p(i,["filter"]),void 0!==n&&null!=u&&h(n,["_query","filter"],u)),n);return o=d("batchPredictionJobs",c._url),s=c._query,delete c._url,delete c._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(c),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=p(e,["sdkHttpResponse"]);null!=r&&h(t,["sdkHttpResponse"],r);let n=p(e,["nextPageToken"]);null!=n&&h(t,["nextPageToken"],n);let i=p(e,["batchPredictionJobs"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>ef(e))),h(t,["batchJobs"],e)}return t}(e),r=new D;return Object.assign(r,t),r})}{let t,r,a=(t={},null!=(r=p(e,["config"]))&&function(e,t){let r=p(e,["pageSize"]);void 0!==t&&null!=r&&h(t,["_query","pageSize"],r);let n=p(e,["pageToken"]);if(void 0!==t&&null!=n&&h(t,["_query","pageToken"],n),void 0!==p(e,["filter"]))throw Error("filter parameter is not supported in Gemini API.")}(r,t),t);return o=d("batches",a._url),s=a._query,delete a._url,delete a._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(a),httpMethod:"GET",httpOptions:null==(n=e.config)?void 0:n.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=p(e,["sdkHttpResponse"]);null!=r&&h(t,["sdkHttpResponse"],r);let n=p(e,["nextPageToken"]);null!=n&&h(t,["nextPageToken"],n);let i=p(e,["operations"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>ep(e))),h(t,["batchJobs"],e)}return t}(e),r=new D;return Object.assign(r,t),r})}}async delete(e){var t,r,n,i,o,s;let a="",l={};if(this.apiClient.isVertexAI()){let n,i,s=(o=this.apiClient,n={},null!=(i=p(e,["name"]))&&h(n,["_url","name"],ed(o,i)),n);return a=d("batchPredictionJobs/{name}",s._url),l=s._query,delete s._url,delete s._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,r,n,i,o;return t={},null!=(r=p(e,["sdkHttpResponse"]))&&h(t,["sdkHttpResponse"],r),null!=(n=p(e,["name"]))&&h(t,["name"],n),null!=(i=p(e,["done"]))&&h(t,["done"],i),null!=(o=p(e,["error"]))&&h(t,["error"],o),t})}{let t,r,o=(s=this.apiClient,t={},null!=(r=p(e,["name"]))&&h(t,["_url","name"],ed(s,r)),t);return a=d("batches/{name}",o._url),l=o._query,delete o._url,delete o._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:null==(n=e.config)?void 0:n.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,r,n,i,o;return t={},null!=(r=p(e,["sdkHttpResponse"]))&&h(t,["sdkHttpResponse"],r),null!=(n=p(e,["name"]))&&h(t,["name"],n),null!=(i=p(e,["done"]))&&h(t,["done"],i),null!=(o=p(e,["error"]))&&h(t,["error"],o),t})}}}function ev(e){let t={},r=p(e,["parts"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>{var t;let r,n,i,o,s,a,l,u,c,d,f;return r={},null!=(n=p(t=e,["videoMetadata"]))&&h(r,["videoMetadata"],n),null!=(i=p(t,["thought"]))&&h(r,["thought"],i),null!=(o=p(t,["inlineData"]))&&h(r,["inlineData"],function(e){let t={};if(void 0!==p(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=p(e,["data"]);null!=r&&h(t,["data"],r);let n=p(e,["mimeType"]);return null!=n&&h(t,["mimeType"],n),t}(o)),null!=(s=p(t,["fileData"]))&&h(r,["fileData"],function(e){let t={};if(void 0!==p(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=p(e,["fileUri"]);null!=r&&h(t,["fileUri"],r);let n=p(e,["mimeType"]);return null!=n&&h(t,["mimeType"],n),t}(s)),null!=(a=p(t,["thoughtSignature"]))&&h(r,["thoughtSignature"],a),null!=(l=p(t,["functionCall"]))&&h(r,["functionCall"],l),null!=(u=p(t,["codeExecutionResult"]))&&h(r,["codeExecutionResult"],u),null!=(c=p(t,["executableCode"]))&&h(r,["executableCode"],c),null!=(d=p(t,["functionResponse"]))&&h(r,["functionResponse"],d),null!=(f=p(t,["text"]))&&h(r,["text"],f),r})),h(t,["parts"],e)}let n=p(e,["role"]);return null!=n&&h(t,["role"],n),t}class eE extends c{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new ey(r5.PAGED_ITEM_CACHED_CONTENTS,e=>this.listInternal(e),await this.listInternal(e),e)}async create(e){var t,r,n,i,o,s;let a="",l={};if(this.apiClient.isVertexAI()){let n,i,s,u=(o=this.apiClient,n={},null!=(i=p(e,["model"]))&&h(n,["model"],B(o,i)),null!=(s=p(e,["config"]))&&function(e,t){let r=p(e,["ttl"]);void 0!==t&&null!=r&&h(t,["ttl"],r);let n=p(e,["expireTime"]);void 0!==t&&null!=n&&h(t,["expireTime"],n);let i=p(e,["displayName"]);void 0!==t&&null!=i&&h(t,["displayName"],i);let o=p(e,["contents"]);if(void 0!==t&&null!=o){let e=Q(o);Array.isArray(e)&&(e=e.map(e=>e)),h(t,["contents"],e)}let s=p(e,["systemInstruction"]);void 0!==t&&null!=s&&h(t,["systemInstruction"],K(s));let a=p(e,["tools"]);if(void 0!==t&&null!=a){let e=a;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=p(e,["functionDeclarations"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==p(e,["behavior"]))throw Error("behavior parameter is not supported in Vertex AI.");let r=p(e,["description"]);null!=r&&h(t,["description"],r);let n=p(e,["name"]);null!=n&&h(t,["name"],n);let i=p(e,["parameters"]);null!=i&&h(t,["parameters"],i);let o=p(e,["parametersJsonSchema"]);null!=o&&h(t,["parametersJsonSchema"],o);let s=p(e,["response"]);null!=s&&h(t,["response"],s);let a=p(e,["responseJsonSchema"]);return null!=a&&h(t,["responseJsonSchema"],a),t})(e))),h(t,["functionDeclarations"],e)}let n=p(e,["retrieval"]);null!=n&&h(t,["retrieval"],n);let i=p(e,["googleSearch"]);null!=i&&h(t,["googleSearch"],i);let o=p(e,["googleSearchRetrieval"]);null!=o&&h(t,["googleSearchRetrieval"],o);let s=p(e,["enterpriseWebSearch"]);null!=s&&h(t,["enterpriseWebSearch"],s);let a=p(e,["googleMaps"]);null!=a&&h(t,["googleMaps"],a);let l=p(e,["urlContext"]);null!=l&&h(t,["urlContext"],l);let u=p(e,["computerUse"]);null!=u&&h(t,["computerUse"],u);let c=p(e,["codeExecution"]);return null!=c&&h(t,["codeExecution"],c),t})(e))),h(t,["tools"],e)}let l=p(e,["toolConfig"]);void 0!==t&&null!=l&&h(t,["toolConfig"],l);let u=p(e,["kmsKeyName"]);void 0!==t&&null!=u&&h(t,["encryption_spec","kmsKeyName"],u)}(s,n),n);return a=d("cachedContents",u._url),l=u._query,delete u._url,delete u._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json()).then(e=>e)}{let t,r,o,u=(s=this.apiClient,t={},null!=(r=p(e,["model"]))&&h(t,["model"],B(s,r)),null!=(o=p(e,["config"]))&&function(e,t){let r=p(e,["ttl"]);void 0!==t&&null!=r&&h(t,["ttl"],r);let n=p(e,["expireTime"]);void 0!==t&&null!=n&&h(t,["expireTime"],n);let i=p(e,["displayName"]);void 0!==t&&null!=i&&h(t,["displayName"],i);let o=p(e,["contents"]);if(void 0!==t&&null!=o){let e=Q(o);Array.isArray(e)&&(e=e.map(e=>ev(e))),h(t,["contents"],e)}let s=p(e,["systemInstruction"]);void 0!==t&&null!=s&&h(t,["systemInstruction"],ev(K(s)));let a=p(e,["tools"]);if(void 0!==t&&null!=a){let e=a;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=p(e,["functionDeclarations"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),h(t,["functionDeclarations"],e)}if(void 0!==p(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let n=p(e,["googleSearch"]);null!=n&&h(t,["googleSearch"],function(e){let t={},r=p(e,["timeRangeFilter"]);if(null!=r&&h(t,["timeRangeFilter"],r),void 0!==p(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");return t}(n));let i=p(e,["googleSearchRetrieval"]);if(null!=i&&h(t,["googleSearchRetrieval"],i),void 0!==p(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let o=p(e,["googleMaps"]);null!=o&&h(t,["googleMaps"],function(e){let t={};if(void 0!==p(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let r=p(e,["enableWidget"]);return null!=r&&h(t,["enableWidget"],r),t}(o));let s=p(e,["urlContext"]);null!=s&&h(t,["urlContext"],s);let a=p(e,["computerUse"]);null!=a&&h(t,["computerUse"],a);let l=p(e,["codeExecution"]);return null!=l&&h(t,["codeExecution"],l),t})(e))),h(t,["tools"],e)}let l=p(e,["toolConfig"]);if(void 0!==t&&null!=l&&h(t,["toolConfig"],l),void 0!==p(e,["kmsKeyName"]))throw Error("kmsKeyName parameter is not supported in Gemini API.")}(o,t),t);return a=d("cachedContents",u._url),l=u._query,delete u._url,delete u._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:null==(n=e.config)?void 0:n.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json()).then(e=>e)}}async get(e){var t,r,n,i,o,s;let a="",l={};if(this.apiClient.isVertexAI()){let n,i,s=(o=this.apiClient,n={},null!=(i=p(e,["name"]))&&h(n,["_url","name"],er(o,i)),n);return a=d("{name}",s._url),l=s._query,delete s._url,delete s._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json()).then(e=>e)}{let t,r,o=(s=this.apiClient,t={},null!=(r=p(e,["name"]))&&h(t,["_url","name"],er(s,r)),t);return a=d("{name}",o._url),l=o._query,delete o._url,delete o._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null==(n=e.config)?void 0:n.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json()).then(e=>e)}}async delete(e){var t,r,n,i,o,s;let a="",l={};if(this.apiClient.isVertexAI()){let n,i,s=(o=this.apiClient,n={},null!=(i=p(e,["name"]))&&h(n,["_url","name"],er(o,i)),n);return a=d("{name}",s._url),l=s._query,delete s._url,delete s._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,r,n=(t={},null!=(r=p(e,["sdkHttpResponse"]))&&h(t,["sdkHttpResponse"],r),t),i=new R;return Object.assign(i,n),i})}{let t,r,o=(s=this.apiClient,t={},null!=(r=p(e,["name"]))&&h(t,["_url","name"],er(s,r)),t);return a=d("{name}",o._url),l=o._query,delete o._url,delete o._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:null==(n=e.config)?void 0:n.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,r,n=(t={},null!=(r=p(e,["sdkHttpResponse"]))&&h(t,["sdkHttpResponse"],r),t),i=new R;return Object.assign(i,n),i})}}async update(e){var t,r,n,i,o,s;let a="",l={};if(this.apiClient.isVertexAI()){let n,i,s,u,c,f=(o=this.apiClient,n={},null!=(i=p(e,["name"]))&&h(n,["_url","name"],er(o,i)),null!=(s=p(e,["config"]))&&(u=p(s,["ttl"]),void 0!==n&&null!=u&&h(n,["ttl"],u),c=p(s,["expireTime"]),void 0!==n&&null!=c&&h(n,["expireTime"],c)),n);return a=d("{name}",f._url),l=f._query,delete f._url,delete f._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(f),httpMethod:"PATCH",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json()).then(e=>e)}{let t,r,o,u,c,f=(s=this.apiClient,t={},null!=(r=p(e,["name"]))&&h(t,["_url","name"],er(s,r)),null!=(o=p(e,["config"]))&&(u=p(o,["ttl"]),void 0!==t&&null!=u&&h(t,["ttl"],u),c=p(o,["expireTime"]),void 0!==t&&null!=c&&h(t,["expireTime"],c)),t);return a=d("{name}",f._url),l=f._query,delete f._url,delete f._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(f),httpMethod:"PATCH",httpOptions:null==(n=e.config)?void 0:n.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json()).then(e=>e)}}async listInternal(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n,i,a,l,u=(n={},null!=(i=p(e,["config"]))&&(a=p(i,["pageSize"]),void 0!==n&&null!=a&&h(n,["_query","pageSize"],a),l=p(i,["pageToken"]),void 0!==n&&null!=l&&h(n,["_query","pageToken"],l)),n);return o=d("cachedContents",u._url),s=u._query,delete u._url,delete u._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=p(e,["sdkHttpResponse"]);null!=r&&h(t,["sdkHttpResponse"],r);let n=p(e,["nextPageToken"]);null!=n&&h(t,["nextPageToken"],n);let i=p(e,["cachedContents"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),h(t,["cachedContents"],e)}return t}(e),r=new x;return Object.assign(r,t),r})}{let t,r,a,l,u=(t={},null!=(r=p(e,["config"]))&&(a=p(r,["pageSize"]),void 0!==t&&null!=a&&h(t,["_query","pageSize"],a),l=p(r,["pageToken"]),void 0!==t&&null!=l&&h(t,["_query","pageToken"],l)),t);return o=d("cachedContents",u._url),s=u._query,delete u._url,delete u._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"GET",httpOptions:null==(n=e.config)?void 0:n.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=p(e,["sdkHttpResponse"]);null!=r&&h(t,["sdkHttpResponse"],r);let n=p(e,["nextPageToken"]);null!=n&&h(t,["nextPageToken"],n);let i=p(e,["cachedContents"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),h(t,["cachedContents"],e)}return t}(e),r=new x;return Object.assign(r,t),r})}}}function eb(e){return this instanceof eb?(this.v=e,this):new eb(e)}function eS(e,t,r){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(e,t||[]),o=[];return n=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),s("next"),s("throw"),s("return",function(e){return function(t){return Promise.resolve(t).then(e,u)}}),n[Symbol.asyncIterator]=function(){return this},n;function s(e,t){i[e]&&(n[e]=function(t){return new Promise(function(r,n){o.push([e,t,r,n])>1||a(e,t)})},t&&(n[e]=t(n[e])))}function a(e,t){try{var r;(r=i[e](t)).value instanceof eb?Promise.resolve(r.value.v).then(l,u):c(o[0][2],r)}catch(e){c(o[0][3],e)}}function l(e){a("next",e)}function u(e){a("throw",e)}function c(e,t){e(t),o.shift(),o.length&&a(o[0][0],o[0][1])}}function eT(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise(function(n,i){var o,s,a;o=n,s=i,a=(t=e[r](t)).done,Promise.resolve(t.value).then(function(e){o({value:e,done:a})},s)})}}}function eA(e){if(void 0===e.parts||0===e.parts.length)return!1;for(let t of e.parts)if(void 0===t||0===Object.keys(t).length)return!1;return!0}function eC(e){if(void 0===e||0===e.length)return[];let t=[],r=e.length,n=0;for(;n<r;)if("user"===e[n].role)t.push(e[n]),n++;else{let i=[],o=!0;for(;n<r&&"model"===e[n].role;)i.push(e[n]),o&&!eA(e[n])&&(o=!1),n++;o?t.push(...i):t.pop()}return t}"function"==typeof SuppressedError&&SuppressedError;class eO{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new ew(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class ew{constructor(e,t,r,n={},i=[]){this.apiClient=e,this.modelsModule=t,this.model=r,this.config=n,this.history=i,this.sendPromise=Promise.resolve(),function(e){if(0!==e.length){for(let t of e)if("user"!==t.role&&"model"!==t.role)throw Error(`Role must be user or model, but got ${t.role}.`)}}(i)}async sendMessage(e){var t;await this.sendPromise;let r=K(e.message),n=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(r),config:null!=(t=e.config)?t:this.config});return this.sendPromise=(async()=>{var e,t,i;let o=await n,s=null==(t=null==(e=o.candidates)?void 0:e[0])?void 0:t.content,a=o.automaticFunctionCallingHistory,l=this.getHistory(!0).length,u=[];null!=a&&(u=null!=(i=a.slice(l))?i:[]),this.recordHistory(r,s?[s]:[],u)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),n}async sendMessageStream(e){var t;await this.sendPromise;let r=K(e.message),n=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(r),config:null!=(t=e.config)?t:this.config});this.sendPromise=n.then(()=>void 0).catch(()=>void 0);let i=await n;return this.processStreamResponse(i,r)}getHistory(e=!1){return structuredClone(e?eC(this.history):this.history)}processStreamResponse(e,t){var r,n;return eS(this,arguments,function*(){var i,o,s,a;let l=[];try{for(var u,c=!0,d=eT(e);!(i=(u=yield eb(d.next())).done);c=!0){if(a=u.value,c=!1,function(e){var t;if(void 0==e.candidates||0===e.candidates.length)return!1;let r=null==(t=e.candidates[0])?void 0:t.content;return void 0!==r&&eA(r)}(a)){let e=null==(n=null==(r=a.candidates)?void 0:r[0])?void 0:n.content;void 0!==e&&l.push(e)}yield yield eb(a)}}catch(e){o={error:e}}finally{try{!c&&!i&&(s=d.return)&&(yield eb(s.call(d)))}finally{if(o)throw o.error}}this.recordHistory(t,l)})}recordHistory(e,t,r){let n=[];t.length>0&&t.every(e=>void 0!==e.role)?n=t:n.push({role:"model",parts:[]}),r&&r.length>0?this.history.push(...eC(r)):this.history.push(e),this.history.push(...n)}}class eI extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,eI.prototype)}}class eR extends c{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new ey(r5.PAGED_ITEM_FILES,e=>this.listInternal(e),await this.listInternal(e),e)}async upload(e){if(this.apiClient.isVertexAI())throw Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(e=>e)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o,s,a,l,u=(o={},null!=(s=p(e,["config"]))&&(a=p(s,["pageSize"]),void 0!==o&&null!=a&&h(o,["_query","pageSize"],a),l=p(s,["pageToken"]),void 0!==o&&null!=l&&h(o,["_query","pageToken"],l)),o);return n=d("files",u._url),i=u._query,delete u._url,delete u._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(u),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=p(e,["sdkHttpResponse"]);null!=r&&h(t,["sdkHttpResponse"],r);let n=p(e,["nextPageToken"]);null!=n&&h(t,["nextPageToken"],n);let i=p(e,["files"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),h(t,["files"],e)}return t}(e),r=new P;return Object.assign(r,t),r})}}async createInternal(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o,s,a=(o={},null!=(s=p(e,["file"]))&&h(o,["file"],s),o);return n=d("upload/v1beta/files",a._url),i=a._query,delete a._url,delete a._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(a),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json()).then(e=>{let t,r,n=(t={},null!=(r=p(e,["sdkHttpResponse"]))&&h(t,["sdkHttpResponse"],r),t),i=new N;return Object.assign(i,n),i})}}async get(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o,s,a=(o={},null!=(s=p(e,["name"]))&&h(o,["_url","file"],es(s)),o);return n=d("files/{file}",a._url),i=a._query,delete a._url,delete a._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(a),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json()).then(e=>e)}}async delete(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o,s,a=(o={},null!=(s=p(e,["name"]))&&h(o,["_url","file"],es(s)),o);return n=d("files/{file}",a._url),i=a._query,delete a._url,delete a._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,r,n=(t={},null!=(r=p(e,["sdkHttpResponse"]))&&h(t,["sdkHttpResponse"],r),t),i=new M;return Object.assign(i,n),i})}}}function ex(e){let t={};if(void 0!==p(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=p(e,["data"]);null!=r&&h(t,["data"],r);let n=p(e,["mimeType"]);return null!=n&&h(t,["mimeType"],n),t}function eP(e){let t={},r=p(e,["voiceConfig"]);if(null!=r&&h(t,["voiceConfig"],r),void 0!==p(e,["multiSpeakerVoiceConfig"]))throw Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");let n=p(e,["languageCode"]);return null!=n&&h(t,["languageCode"],n),t}function eN(e){let t={},r=p(e,["parts"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>{var t;let r,n,i,o,s,a,l,u,c,d,f;return r={},null!=(n=p(t=e,["videoMetadata"]))&&h(r,["videoMetadata"],n),null!=(i=p(t,["thought"]))&&h(r,["thought"],i),null!=(o=p(t,["inlineData"]))&&h(r,["inlineData"],function(e){let t={};if(void 0!==p(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=p(e,["data"]);null!=r&&h(t,["data"],r);let n=p(e,["mimeType"]);return null!=n&&h(t,["mimeType"],n),t}(o)),null!=(s=p(t,["fileData"]))&&h(r,["fileData"],function(e){let t={};if(void 0!==p(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=p(e,["fileUri"]);null!=r&&h(t,["fileUri"],r);let n=p(e,["mimeType"]);return null!=n&&h(t,["mimeType"],n),t}(s)),null!=(a=p(t,["thoughtSignature"]))&&h(r,["thoughtSignature"],a),null!=(l=p(t,["functionCall"]))&&h(r,["functionCall"],l),null!=(u=p(t,["codeExecutionResult"]))&&h(r,["codeExecutionResult"],u),null!=(c=p(t,["executableCode"]))&&h(r,["executableCode"],c),null!=(d=p(t,["functionResponse"]))&&h(r,["functionResponse"],d),null!=(f=p(t,["text"]))&&h(r,["text"],f),r})),h(t,["parts"],e)}let n=p(e,["role"]);return null!=n&&h(t,["role"],n),t}function eM(e,t){let r={},n=p(t,["model"]);null!=n&&h(r,["_url","model"],U(e,n));let i=p(t,["contents"]);if(null!=i){let e=Q(i);Array.isArray(e)&&(e=e.map(e=>eN(e))),h(r,["contents"],e)}let o=p(t,["config"]);return null!=o&&h(r,["generationConfig"],function(e,t,r){let n={},i=p(t,["systemInstruction"]);void 0!==r&&null!=i&&h(r,["systemInstruction"],eN(K(i)));let o=p(t,["temperature"]);null!=o&&h(n,["temperature"],o);let s=p(t,["topP"]);null!=s&&h(n,["topP"],s);let a=p(t,["topK"]);null!=a&&h(n,["topK"],a);let l=p(t,["candidateCount"]);null!=l&&h(n,["candidateCount"],l);let u=p(t,["maxOutputTokens"]);null!=u&&h(n,["maxOutputTokens"],u);let c=p(t,["stopSequences"]);null!=c&&h(n,["stopSequences"],c);let d=p(t,["responseLogprobs"]);null!=d&&h(n,["responseLogprobs"],d);let f=p(t,["logprobs"]);null!=f&&h(n,["logprobs"],f);let m=p(t,["presencePenalty"]);null!=m&&h(n,["presencePenalty"],m);let g=p(t,["frequencyPenalty"]);null!=g&&h(n,["frequencyPenalty"],g);let y=p(t,["seed"]);null!=y&&h(n,["seed"],y);let _=p(t,["responseMimeType"]);null!=_&&h(n,["responseMimeType"],_);let v=p(t,["responseSchema"]);null!=v&&h(n,["responseSchema"],z(v));let E=p(t,["responseJsonSchema"]);if(null!=E&&h(n,["responseJsonSchema"],E),void 0!==p(t,["routingConfig"]))throw Error("routingConfig parameter is not supported in Gemini API.");if(void 0!==p(t,["modelSelectionConfig"]))throw Error("modelSelectionConfig parameter is not supported in Gemini API.");let b=p(t,["safetySettings"]);if(void 0!==r&&null!=b){let e=b;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==p(e,["method"]))throw Error("method parameter is not supported in Gemini API.");let r=p(e,["category"]);null!=r&&h(t,["category"],r);let n=p(e,["threshold"]);return null!=n&&h(t,["threshold"],n),t})(e))),h(r,["safetySettings"],e)}let S=p(t,["tools"]);if(void 0!==r&&null!=S){let e=et(S);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=p(e,["functionDeclarations"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),h(t,["functionDeclarations"],e)}if(void 0!==p(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let n=p(e,["googleSearch"]);null!=n&&h(t,["googleSearch"],function(e){let t={},r=p(e,["timeRangeFilter"]);if(null!=r&&h(t,["timeRangeFilter"],r),void 0!==p(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");return t}(n));let i=p(e,["googleSearchRetrieval"]);if(null!=i&&h(t,["googleSearchRetrieval"],i),void 0!==p(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let o=p(e,["googleMaps"]);null!=o&&h(t,["googleMaps"],function(e){let t={};if(void 0!==p(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let r=p(e,["enableWidget"]);return null!=r&&h(t,["enableWidget"],r),t}(o));let s=p(e,["urlContext"]);null!=s&&h(t,["urlContext"],s);let a=p(e,["computerUse"]);null!=a&&h(t,["computerUse"],a);let l=p(e,["codeExecution"]);return null!=l&&h(t,["codeExecution"],l),t})(ee(e)))),h(r,["tools"],e)}let T=p(t,["toolConfig"]);if(void 0!==r&&null!=T&&h(r,["toolConfig"],T),void 0!==p(t,["labels"]))throw Error("labels parameter is not supported in Gemini API.");let A=p(t,["cachedContent"]);void 0!==r&&null!=A&&h(r,["cachedContent"],er(e,A));let C=p(t,["responseModalities"]);null!=C&&h(n,["responseModalities"],C);let O=p(t,["mediaResolution"]);null!=O&&h(n,["mediaResolution"],O);let w=p(t,["speechConfig"]);if(null!=w&&h(n,["speechConfig"],X(w)),void 0!==p(t,["audioTimestamp"]))throw Error("audioTimestamp parameter is not supported in Gemini API.");let I=p(t,["thinkingConfig"]);null!=I&&h(n,["thinkingConfig"],I);let R=p(t,["imageConfig"]);return null!=R&&h(n,["imageConfig"],R),n}(e,o,r)),r}function eD(e,t){let r={},n=p(t,["model"]);null!=n&&h(r,["_url","model"],U(e,n));let i=p(t,["contents"]);if(null!=i){let e=Q(i);Array.isArray(e)&&(e=e.map(e=>e)),h(r,["contents"],e)}let o=p(t,["config"]);return null!=o&&h(r,["generationConfig"],function(e,t,r){let n={},i=p(t,["systemInstruction"]);void 0!==r&&null!=i&&h(r,["systemInstruction"],K(i));let o=p(t,["temperature"]);null!=o&&h(n,["temperature"],o);let s=p(t,["topP"]);null!=s&&h(n,["topP"],s);let a=p(t,["topK"]);null!=a&&h(n,["topK"],a);let l=p(t,["candidateCount"]);null!=l&&h(n,["candidateCount"],l);let u=p(t,["maxOutputTokens"]);null!=u&&h(n,["maxOutputTokens"],u);let c=p(t,["stopSequences"]);null!=c&&h(n,["stopSequences"],c);let d=p(t,["responseLogprobs"]);null!=d&&h(n,["responseLogprobs"],d);let f=p(t,["logprobs"]);null!=f&&h(n,["logprobs"],f);let m=p(t,["presencePenalty"]);null!=m&&h(n,["presencePenalty"],m);let g=p(t,["frequencyPenalty"]);null!=g&&h(n,["frequencyPenalty"],g);let y=p(t,["seed"]);null!=y&&h(n,["seed"],y);let _=p(t,["responseMimeType"]);null!=_&&h(n,["responseMimeType"],_);let v=p(t,["responseSchema"]);null!=v&&h(n,["responseSchema"],z(v));let E=p(t,["responseJsonSchema"]);null!=E&&h(n,["responseJsonSchema"],E);let b=p(t,["routingConfig"]);null!=b&&h(n,["routingConfig"],b);let S=p(t,["modelSelectionConfig"]);null!=S&&h(n,["modelConfig"],S);let T=p(t,["safetySettings"]);if(void 0!==r&&null!=T){let e=T;Array.isArray(e)&&(e=e.map(e=>e)),h(r,["safetySettings"],e)}let A=p(t,["tools"]);if(void 0!==r&&null!=A){let e=et(A);Array.isArray(e)&&(e=e.map(e=>eW(ee(e)))),h(r,["tools"],e)}let C=p(t,["toolConfig"]);void 0!==r&&null!=C&&h(r,["toolConfig"],C);let O=p(t,["labels"]);void 0!==r&&null!=O&&h(r,["labels"],O);let w=p(t,["cachedContent"]);void 0!==r&&null!=w&&h(r,["cachedContent"],er(e,w));let I=p(t,["responseModalities"]);null!=I&&h(n,["responseModalities"],I);let R=p(t,["mediaResolution"]);null!=R&&h(n,["mediaResolution"],R);let x=p(t,["speechConfig"]);null!=x&&h(n,["speechConfig"],eV(X(x)));let P=p(t,["audioTimestamp"]);null!=P&&h(n,["audioTimestamp"],P);let N=p(t,["thinkingConfig"]);null!=N&&h(n,["thinkingConfig"],N);let M=p(t,["imageConfig"]);return null!=M&&h(n,["imageConfig"],M),n}(e,o,r)),r}function ek(e){let t={},r=p(e,["sdkHttpResponse"]);null!=r&&h(t,["sdkHttpResponse"],r);let n=p(e,["candidates"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=p(e,["content"]);null!=r&&h(t,["content"],r);let n=p(e,["citationMetadata"]);null!=n&&h(t,["citationMetadata"],function(e){let t={},r=p(e,["citationSources"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),h(t,["citations"],e)}return t}(n));let i=p(e,["tokenCount"]);null!=i&&h(t,["tokenCount"],i);let o=p(e,["finishReason"]);null!=o&&h(t,["finishReason"],o);let s=p(e,["urlContextMetadata"]);null!=s&&h(t,["urlContextMetadata"],s);let a=p(e,["avgLogprobs"]);null!=a&&h(t,["avgLogprobs"],a);let l=p(e,["groundingMetadata"]);null!=l&&h(t,["groundingMetadata"],l);let u=p(e,["index"]);null!=u&&h(t,["index"],u);let c=p(e,["logprobsResult"]);null!=c&&h(t,["logprobsResult"],c);let d=p(e,["safetyRatings"]);if(null!=d){let e=d;Array.isArray(e)&&(e=e.map(e=>e)),h(t,["safetyRatings"],e)}return t})(e))),h(t,["candidates"],e)}let i=p(e,["modelVersion"]);null!=i&&h(t,["modelVersion"],i);let o=p(e,["promptFeedback"]);null!=o&&h(t,["promptFeedback"],o);let s=p(e,["responseId"]);null!=s&&h(t,["responseId"],s);let a=p(e,["usageMetadata"]);return null!=a&&h(t,["usageMetadata"],a),t}function eL(e){let t={},r=p(e,["sdkHttpResponse"]);null!=r&&h(t,["sdkHttpResponse"],r);let n=p(e,["candidates"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),h(t,["candidates"],e)}let i=p(e,["createTime"]);null!=i&&h(t,["createTime"],i);let o=p(e,["modelVersion"]);null!=o&&h(t,["modelVersion"],o);let s=p(e,["promptFeedback"]);null!=s&&h(t,["promptFeedback"],s);let a=p(e,["responseId"]);null!=a&&h(t,["responseId"],a);let l=p(e,["usageMetadata"]);return null!=l&&h(t,["usageMetadata"],l),t}function eU(e){let t={},r=p(e,["_self"]);null!=r&&h(t,["image"],eB(r));let n=p(e,["raiFilteredReason"]);null!=n&&h(t,["raiFilteredReason"],n);let i=p(e,["_self"]);null!=i&&h(t,["safetyAttributes"],e$(i));let o=p(e,["prompt"]);return null!=o&&h(t,["enhancedPrompt"],o),t}function eB(e){let t={},r=p(e,["gcsUri"]);null!=r&&h(t,["gcsUri"],r);let n=p(e,["bytesBase64Encoded"]);null!=n&&h(t,["imageBytes"],f(n));let i=p(e,["mimeType"]);return null!=i&&h(t,["mimeType"],i),t}function eq(e){let t={};if(void 0!==p(e,["gcsUri"]))throw Error("gcsUri parameter is not supported in Gemini API.");let r=p(e,["imageBytes"]);null!=r&&h(t,["bytesBase64Encoded"],f(r));let n=p(e,["mimeType"]);return null!=n&&h(t,["mimeType"],n),t}function ej(e){let t={},r=p(e,["gcsUri"]);null!=r&&h(t,["gcsUri"],r);let n=p(e,["imageBytes"]);null!=n&&h(t,["bytesBase64Encoded"],f(n));let i=p(e,["mimeType"]);return null!=i&&h(t,["mimeType"],i),t}function eF(e){var t;let r,n,i,o,s={},a=p(e,["name"]);null!=a&&h(s,["name"],a);let l=p(e,["displayName"]);null!=l&&h(s,["displayName"],l);let u=p(e,["description"]);null!=u&&h(s,["description"],u);let c=p(e,["version"]);null!=c&&h(s,["version"],c);let d=p(e,["_self"]);null!=d&&h(s,["tunedModelInfo"],(r={},null!=(n=p(t=d,["baseModel"]))&&h(r,["baseModel"],n),null!=(i=p(t,["createTime"]))&&h(r,["createTime"],i),null!=(o=p(t,["updateTime"]))&&h(r,["updateTime"],o),r));let f=p(e,["inputTokenLimit"]);null!=f&&h(s,["inputTokenLimit"],f);let m=p(e,["outputTokenLimit"]);null!=m&&h(s,["outputTokenLimit"],m);let g=p(e,["supportedGenerationMethods"]);return null!=g&&h(s,["supportedActions"],g),s}function eG(e){var t;let r,n,i,o,s={},a=p(e,["name"]);null!=a&&h(s,["name"],a);let l=p(e,["displayName"]);null!=l&&h(s,["displayName"],l);let u=p(e,["description"]);null!=u&&h(s,["description"],u);let c=p(e,["versionId"]);null!=c&&h(s,["version"],c);let d=p(e,["deployedModels"]);if(null!=d){let e=d;Array.isArray(e)&&(e=e.map(e=>{let t,r,n;return t={},null!=(r=p(e,["endpoint"]))&&h(t,["name"],r),null!=(n=p(e,["deployedModelId"]))&&h(t,["deployedModelId"],n),t})),h(s,["endpoints"],e)}let f=p(e,["labels"]);null!=f&&h(s,["labels"],f);let m=p(e,["_self"]);null!=m&&h(s,["tunedModelInfo"],(r={},null!=(n=p(t=m,["labels","google-vertex-llm-tuning-base-model-id"]))&&h(r,["baseModel"],n),null!=(i=p(t,["createTime"]))&&h(r,["createTime"],i),null!=(o=p(t,["updateTime"]))&&h(r,["updateTime"],o),r));let g=p(e,["defaultCheckpointId"]);null!=g&&h(s,["defaultCheckpointId"],g);let y=p(e,["checkpoints"]);if(null!=y){let e=y;Array.isArray(e)&&(e=e.map(e=>e)),h(s,["checkpoints"],e)}return s}function eH(e){let t={},r=p(e,["safetyAttributes","categories"]);null!=r&&h(t,["categories"],r);let n=p(e,["safetyAttributes","scores"]);null!=n&&h(t,["scores"],n);let i=p(e,["contentType"]);return null!=i&&h(t,["contentType"],i),t}function e$(e){let t={},r=p(e,["safetyAttributes","categories"]);null!=r&&h(t,["categories"],r);let n=p(e,["safetyAttributes","scores"]);null!=n&&h(t,["scores"],n);let i=p(e,["contentType"]);return null!=i&&h(t,["contentType"],i),t}function eV(e){let t={},r=p(e,["voiceConfig"]);if(null!=r&&h(t,["voiceConfig"],r),void 0!==p(e,["multiSpeakerVoiceConfig"]))throw Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");let n=p(e,["languageCode"]);return null!=n&&h(t,["languageCode"],n),t}function eW(e){let t={},r=p(e,["functionDeclarations"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==p(e,["behavior"]))throw Error("behavior parameter is not supported in Vertex AI.");let r=p(e,["description"]);null!=r&&h(t,["description"],r);let n=p(e,["name"]);null!=n&&h(t,["name"],n);let i=p(e,["parameters"]);null!=i&&h(t,["parameters"],i);let o=p(e,["parametersJsonSchema"]);null!=o&&h(t,["parametersJsonSchema"],o);let s=p(e,["response"]);null!=s&&h(t,["response"],s);let a=p(e,["responseJsonSchema"]);return null!=a&&h(t,["responseJsonSchema"],a),t})(e))),h(t,["functionDeclarations"],e)}let n=p(e,["retrieval"]);null!=n&&h(t,["retrieval"],n);let i=p(e,["googleSearch"]);null!=i&&h(t,["googleSearch"],i);let o=p(e,["googleSearchRetrieval"]);null!=o&&h(t,["googleSearchRetrieval"],o);let s=p(e,["enterpriseWebSearch"]);null!=s&&h(t,["enterpriseWebSearch"],s);let a=p(e,["googleMaps"]);null!=a&&h(t,["googleMaps"],a);let l=p(e,["urlContext"]);null!=l&&h(t,["urlContext"],l);let u=p(e,["computerUse"]);null!=u&&h(t,["computerUse"],u);let c=p(e,["codeExecution"]);return null!=c&&h(t,["codeExecution"],c),t}function eJ(e){let t={},r=p(e,["uri"]);null!=r&&h(t,["uri"],r);let n=p(e,["videoBytes"]);null!=n&&h(t,["encodedVideo"],f(n));let i=p(e,["mimeType"]);return null!=i&&h(t,["encoding"],i),t}function eK(e){let t={},r=p(e,["uri"]);null!=r&&h(t,["gcsUri"],r);let n=p(e,["videoBytes"]);null!=n&&h(t,["bytesBase64Encoded"],f(n));let i=p(e,["mimeType"]);return null!=i&&h(t,["mimeType"],i),t}let eY="x-goog-api-client",eQ=/^\s*data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class ez{constructor(e){var t,r;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const n={};this.clientOptions.vertexai?(n.apiVersion=null!=(t=this.clientOptions.apiVersion)?t:"v1beta1",n.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(n.apiVersion=null!=(r=this.clientOptions.apiVersion)?r:"v1beta",n.baseUrl="https://generativelanguage.googleapis.com/"),n.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=n,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(n,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&"global"!==this.clientOptions.location?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return null!=(e=this.clientOptions.vertexai)&&e}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.apiVersion)return this.clientOptions.httpOptions.apiVersion;throw Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.baseUrl)return this.clientOptions.httpOptions.baseUrl;throw Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.headers)return this.clientOptions.httpOptions.headers;throw Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||void 0===e.baseUrl||void 0===e.apiVersion)throw Error("HTTP options are not correctly set.");let t=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&""!==e.apiVersion&&t.push(e.apiVersion),t.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){let e=new URL(this.getBaseUrl());return e.protocol="http:"==e.protocol?"ws":"wss",e.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw Error("HTTP options are not correctly set.")}constructUrl(e,t,r){let n=[this.getRequestUrlInternal(t)];return r&&n.push(this.getBaseResourcePath()),""!==e&&n.push(e),new URL(`${n.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||"GET"===e.httpMethod&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let r=this.shouldPrependVertexProjectPath(e),n=this.constructUrl(e.path,t,r);if(e.queryParams)for(let[t,r]of Object.entries(e.queryParams))n.searchParams.append(t,String(r));let i={};if("GET"===e.httpMethod){if(e.body&&"{}"!==e.body)throw Error("Request body should be empty for GET request, but got non empty request body")}else i.body=e.body;return i=await this.includeExtraHttpOptionsToRequestInit(i,t,n.toString(),e.abortSignal),this.unaryApiCall(n,i,e.httpMethod)}patchHttpOptions(e,t){let r=JSON.parse(JSON.stringify(e));for(let[e,n]of Object.entries(t))"object"==typeof n?r[e]=Object.assign(Object.assign({},r[e]),n):void 0!==n&&(r[e]=n);return r}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let r=this.shouldPrependVertexProjectPath(e),n=this.constructUrl(e.path,t,r);n.searchParams.has("alt")&&"sse"===n.searchParams.get("alt")||n.searchParams.set("alt","sse");let i={};return i.body=e.body,i=await this.includeExtraHttpOptionsToRequestInit(i,t,n.toString(),e.abortSignal),this.streamApiCall(n,i,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,r,n){if(t&&t.timeout||n){let r=new AbortController,i=r.signal;if(t.timeout&&(null==t?void 0:t.timeout)>0){let e=setTimeout(()=>r.abort(),t.timeout);e&&"function"==typeof e.unref&&e.unref()}n&&n.addEventListener("abort",()=>{r.abort()}),e.signal=i}return t&&null!==t.extraBody&&function(e,t){if(!t||0===Object.keys(t).length)return;if(e.body instanceof Blob)return console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");let r={};if("string"==typeof e.body&&e.body.length>0)try{let t=JSON.parse(e.body);if("object"!=typeof t||null===t||Array.isArray(t))return void console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");r=t}catch(e){console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}e.body=JSON.stringify(function e(t,r){let n=Object.assign({},t);for(let t in r)if(Object.prototype.hasOwnProperty.call(r,t)){let i=r[t],o=n[t];i&&"object"==typeof i&&!Array.isArray(i)&&o&&"object"==typeof o&&!Array.isArray(o)?n[t]=e(o,i):(o&&i&&typeof o!=typeof i&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${t}". Original type: ${typeof o}, New type: ${typeof i}. Overwriting.`),n[t]=i)}return n}(r,t))}(e,t.extraBody),e.headers=await this.getHeadersInternal(t,r),e}async unaryApiCall(e,t,r){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:r})).then(async e=>(await eX(e),new m(e))).catch(e=>{if(e instanceof Error)throw e;throw Error(JSON.stringify(e))})}async streamApiCall(e,t,r){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:r})).then(async e=>(await eX(e),this.processStreamResponse(e))).catch(e=>{if(e instanceof Error)throw e;throw Error(JSON.stringify(e))})}processStreamResponse(e){var t;return eS(this,arguments,function*(){let r=null==(t=null==e?void 0:e.body)?void 0:t.getReader(),n=new TextDecoder("utf-8");if(!r)throw Error("Response body is empty");try{let t="";for(;;){let{done:i,value:o}=yield eb(r.read());if(i){if(t.trim().length>0)throw Error("Incomplete JSON segment at the end");break}let s=n.decode(o,{stream:!0});try{let e=JSON.parse(s);if("error"in e){let t=JSON.parse(JSON.stringify(e.error)),r=t.status,n=t.code,i=`got status: ${r}. ${JSON.stringify(e)}`;if(n>=400&&n<600)throw new eI({message:i,status:n})}}catch(e){if("ApiError"===e.name)throw e}let a=(t+=s).match(eQ);for(;a;){let r=a[1];try{let n=new Response(r,{headers:null==e?void 0:e.headers,status:null==e?void 0:e.status,statusText:null==e?void 0:e.statusText});yield yield eb(new m(n)),a=(t=t.slice(a[0].length)).match(eQ)}catch(e){throw Error(`exception parsing stream chunk ${r}. ${e}`)}}}}finally{r.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(e=>{throw Error(`exception ${e} sending request`)})}getDefaultHeaders(){let e={},t="google-genai-sdk/1.27.0 "+this.clientOptions.userAgentExtra;return e["User-Agent"]=t,e[eY]=t,e["Content-Type"]="application/json",e}async getHeadersInternal(e,t){let r=new Headers;if(e&&e.headers){for(let[t,n]of Object.entries(e.headers))r.append(t,n);e.timeout&&e.timeout>0&&r.append("X-Server-Timeout",String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(r,t),r}async uploadFile(e,t){var r;let n={};null!=t&&(n.mimeType=t.mimeType,n.name=t.name,n.displayName=t.displayName),n.name&&!n.name.startsWith("files/")&&(n.name=`files/${n.name}`);let i=this.clientOptions.uploader,o=await i.stat(e);n.sizeBytes=String(o.size);let s=null!=(r=null==t?void 0:t.mimeType)?r:o.type;if(void 0===s||""===s)throw Error("Can not determine mimeType. Please provide mimeType in the config.");n.mimeType=s;let a=await this.fetchUploadUrl(n,t);return i.upload(e,a,this)}async downloadFile(e){let t=this.clientOptions.downloader;await t.download(e,this)}async fetchUploadUrl(e,t){var r;let n={};n=(null==t?void 0:t.httpOptions)?t.httpOptions:{apiVersion:"",headers:{"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${e.sizeBytes}`,"X-Goog-Upload-Header-Content-Type":`${e.mimeType}`}};let i={file:e},o=await this.request({path:d("upload/v1beta/files",i._url),body:JSON.stringify(i),httpMethod:"POST",httpOptions:n});if(!o||!(null==o?void 0:o.headers))throw Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");let s=null==(r=null==o?void 0:o.headers)?void 0:r["x-goog-upload-url"];if(void 0===s)throw Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return s}}async function eX(e){var t;if(void 0===e)throw Error("response is undefined");if(!e.ok){let r=e.status,n=JSON.stringify((null==(t=e.headers.get("content-type"))?void 0:t.includes("application/json"))?await e.json():{error:{message:await e.text(),code:e.status,status:e.statusText}});if(r>=400&&r<600)throw new eI({message:n,status:r});throw Error(n)}}function eZ(e){for(let r of e){var t;if(null!==(t=r)&&"object"==typeof t&&t instanceof e1||"object"==typeof r&&"inputSchema"in r)return!0}return!1}function e0(e){var t;let r=null!=(t=e[eY])?t:"";e[eY]=(r+" mcp_used/unknown").trimStart()}class e1{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new e1(e,t)}async initialize(){var e,t,r,n;if(this.mcpTools.length>0)return;let i={},o=[];for(let u of this.mcpClients)try{for(var s,a=!0,l=(t=void 0,eT(function(e,t=100){return eS(this,arguments,function*(){let r,n=0;for(;n<t;){let t=yield eb(e.listTools({cursor:r}));for(let e of t.tools)yield yield eb(e),n++;if(!t.nextCursor)break;r=t.nextCursor}})}(u)));!(e=(s=await l.next()).done);a=!0){n=s.value,a=!1,o.push(n);let e=n.name;if(i[e])throw Error(`Duplicate function name ${e} found in MCP tools. Please ensure function names are unique.`);i[e]=u}}catch(e){t={error:e}}finally{try{!a&&!e&&(r=l.return)&&await r.call(l)}finally{if(t)throw t.error}}this.mcpTools=o,this.functionNameToMcpClient=i}async tool(){return await this.initialize(),function(e,t={}){let r=[],n=new Set;for(let i of e){let e=i.name;if(n.has(e))throw Error(`Duplicate function name ${e} found in MCP tools. Please ensure function names are unique.`);n.add(e);let o=function(e,t={}){let r={name:e.name,description:e.description,parametersJsonSchema:e.inputSchema};return e.outputSchema&&(r.responseJsonSchema=e.outputSchema),t.behavior&&(r.behavior=t.behavior),{functionDeclarations:[r]}}(i,t);o.functionDeclarations&&r.push(...o.functionDeclarations)}return{functionDeclarations:r}}(this.mcpTools,this.config)}async callTool(e){await this.initialize();let t=[];for(let r of e)if(r.name in this.functionNameToMcpClient){let e,n=this.functionNameToMcpClient[r.name];this.config.timeout&&(e={timeout:this.config.timeout});let i=await n.callTool({name:r.name,arguments:r.args},void 0,e);t.push({functionResponse:{name:r.name,response:i.isError?{error:i}:i}})}return t}}async function e2(e,t,r){let n=new L;Object.assign(n,r.data instanceof Blob?JSON.parse(await r.data.text()):JSON.parse(r.data)),t(n)}class e6{constructor(e,t,r){this.apiClient=e,this.auth=t,this.webSocketFactory=r}async connect(e){var t,r;let n;if(this.apiClient.isVertexAI())throw Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");let i=this.apiClient.getWebsocketBaseUrl(),o=this.apiClient.getApiVersion(),s=function(e){let t=new Headers;for(let[r,n]of Object.entries(e))t.append(r,n);return t}(this.apiClient.getDefaultHeaders()),a=this.apiClient.getApiKey(),l=`${i}/ws/google.ai.generativelanguage.${o}.GenerativeService.BidiGenerateMusic?key=${a}`,u=()=>{},c=new Promise(e=>{u=e}),d=e.callbacks,h=this.apiClient,p={onopen:function(){u({})},onmessage:e=>{e2(h,d.onmessage,e)},onerror:null!=(t=null==d?void 0:d.onerror)?t:function(e){},onclose:null!=(r=null==d?void 0:d.onclose)?r:function(e){}},f=this.webSocketFactory.create(l,(n={},s.forEach((e,t)=>{n[t]=e}),n),p);f.connect(),await c;let m=U(this.apiClient,e.model);return f.send(JSON.stringify({setup:{model:m}})),new e3(f,this.apiClient)}}class e3{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||0===Object.keys(e.weightedPrompts).length)throw Error("Weighted prompts must be set and contain at least one entry.");let t=function(e){let t={},r=p(e,["weightedPrompts"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),h(t,["weightedPrompts"],e)}return t}(e);this.conn.send(JSON.stringify({clientContent:t}))}async setMusicGenerationConfig(e){let t,r;e.musicGenerationConfig||(e.musicGenerationConfig={});let n=(t={},null!=(r=p(e,["musicGenerationConfig"]))&&h(t,["musicGenerationConfig"],r),t);this.conn.send(JSON.stringify(n))}sendPlaybackControl(e){this.conn.send(JSON.stringify({playbackControl:e}))}play(){this.sendPlaybackControl(r8.PLAY)}pause(){this.sendPlaybackControl(r8.PAUSE)}stop(){this.sendPlaybackControl(r8.STOP)}resetContext(){this.sendPlaybackControl(r8.RESET_CONTEXT)}close(){this.conn.close()}}async function e8(e,t,r){let n=new k,i=JSON.parse(r.data instanceof Blob?await r.data.text():r.data instanceof ArrayBuffer?new TextDecoder().decode(r.data):r.data);if(e.isVertexAI()){let e,t,r,o,s,a,l,u;Object.assign(n,(e={},null!=(t=p(i,["setupComplete"]))&&h(e,["setupComplete"],t),null!=(r=p(i,["serverContent"]))&&h(e,["serverContent"],r),null!=(o=p(i,["toolCall"]))&&h(e,["toolCall"],o),null!=(s=p(i,["toolCallCancellation"]))&&h(e,["toolCallCancellation"],s),null!=(a=p(i,["usageMetadata"]))&&h(e,["usageMetadata"],function(e){let t={},r=p(e,["promptTokenCount"]);null!=r&&h(t,["promptTokenCount"],r);let n=p(e,["cachedContentTokenCount"]);null!=n&&h(t,["cachedContentTokenCount"],n);let i=p(e,["candidatesTokenCount"]);null!=i&&h(t,["responseTokenCount"],i);let o=p(e,["toolUsePromptTokenCount"]);null!=o&&h(t,["toolUsePromptTokenCount"],o);let s=p(e,["thoughtsTokenCount"]);null!=s&&h(t,["thoughtsTokenCount"],s);let a=p(e,["totalTokenCount"]);null!=a&&h(t,["totalTokenCount"],a);let l=p(e,["promptTokensDetails"]);if(null!=l){let e=l;Array.isArray(e)&&(e=e.map(e=>e)),h(t,["promptTokensDetails"],e)}let u=p(e,["cacheTokensDetails"]);if(null!=u){let e=u;Array.isArray(e)&&(e=e.map(e=>e)),h(t,["cacheTokensDetails"],e)}let c=p(e,["candidatesTokensDetails"]);if(null!=c){let e=c;Array.isArray(e)&&(e=e.map(e=>e)),h(t,["responseTokensDetails"],e)}let d=p(e,["toolUsePromptTokensDetails"]);if(null!=d){let e=d;Array.isArray(e)&&(e=e.map(e=>e)),h(t,["toolUsePromptTokensDetails"],e)}let f=p(e,["trafficType"]);return null!=f&&h(t,["trafficType"],f),t}(a)),null!=(l=p(i,["goAway"]))&&h(e,["goAway"],l),null!=(u=p(i,["sessionResumptionUpdate"]))&&h(e,["sessionResumptionUpdate"],u),e))}else Object.assign(n,i);t(n)}class e5{constructor(e,t,r){this.apiClient=e,this.auth=t,this.webSocketFactory=r,this.music=new e6(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,r,n,i,o,s,a,l;let u,c;if(e.config&&e.config.httpOptions)throw Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");let d=this.apiClient.getWebsocketBaseUrl(),f=this.apiClient.getApiVersion(),m=this.apiClient.getHeaders();e.config&&e.config.tools&&eZ(e.config.tools)&&e0(m);let g=function(e){let t=new Headers;for(let[r,n]of Object.entries(e))t.append(r,n);return t}(m);if(this.apiClient.isVertexAI())u=`${d}/ws/google.cloud.aiplatform.${f}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(g,u);else{let e=this.apiClient.getApiKey(),t="BidiGenerateContent",r="key";(null==e?void 0:e.startsWith("auth_tokens/"))&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),"v1alpha"!==f&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),t="BidiGenerateContentConstrained",r="access_token"),u=`${d}/ws/google.ai.generativelanguage.${f}.GenerativeService.${t}?${r}=${e}`}let y=()=>{},_=new Promise(e=>{y=e}),v=e.callbacks,E=this.apiClient,b={onopen:function(){var e;null==(e=null==v?void 0:v.onopen)||e.call(v),y({})},onmessage:e=>{e8(E,v.onmessage,e)},onerror:null!=(t=null==v?void 0:v.onerror)?t:function(e){},onclose:null!=(r=null==v?void 0:v.onclose)?r:function(e){}},S=this.webSocketFactory.create(u,(c={},g.forEach((e,t)=>{c[t]=e}),c),b);S.connect(),await _;let T=U(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&T.startsWith("publishers/")){let e=this.apiClient.getProject(),t=this.apiClient.getLocation();T=`projects/${e}/locations/${t}/`+T}let A={};this.apiClient.isVertexAI()&&(null==(n=e.config)?void 0:n.responseModalities)===void 0&&(void 0===e.config?e.config={responseModalities:[rw.AUDIO]}:e.config.responseModalities=[rw.AUDIO]),(null==(i=e.config)?void 0:i.generationConfig)&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");let C=null!=(s=null==(o=e.config)?void 0:o.tools)?s:[],O=[];for(let e of C)this.isCallableTool(e)?O.push(await e.tool()):O.push(e);O.length>0&&(e.config.tools=O);let w={model:T,config:e.config,callbacks:e.callbacks};if(this.apiClient.isVertexAI()){let e,t,r;a=this.apiClient,e={},null!=(t=p(w,["model"]))&&h(e,["setup","model"],U(a,t)),null!=(r=p(w,["config"]))&&h(e,["config"],function(e,t){let r=p(e,["generationConfig"]);void 0!==t&&null!=r&&h(t,["setup","generationConfig"],function(e){let t={},r=p(e,["modelSelectionConfig"]);null!=r&&h(t,["modelConfig"],r);let n=p(e,["audioTimestamp"]);null!=n&&h(t,["audioTimestamp"],n);let i=p(e,["candidateCount"]);null!=i&&h(t,["candidateCount"],i);let o=p(e,["enableAffectiveDialog"]);null!=o&&h(t,["enableAffectiveDialog"],o);let s=p(e,["frequencyPenalty"]);null!=s&&h(t,["frequencyPenalty"],s);let a=p(e,["logprobs"]);null!=a&&h(t,["logprobs"],a);let l=p(e,["maxOutputTokens"]);null!=l&&h(t,["maxOutputTokens"],l);let u=p(e,["mediaResolution"]);null!=u&&h(t,["mediaResolution"],u);let c=p(e,["presencePenalty"]);null!=c&&h(t,["presencePenalty"],c);let d=p(e,["responseJsonSchema"]);null!=d&&h(t,["responseJsonSchema"],d);let f=p(e,["responseLogprobs"]);null!=f&&h(t,["responseLogprobs"],f);let m=p(e,["responseMimeType"]);null!=m&&h(t,["responseMimeType"],m);let g=p(e,["responseModalities"]);null!=g&&h(t,["responseModalities"],g);let y=p(e,["responseSchema"]);null!=y&&h(t,["responseSchema"],y);let _=p(e,["routingConfig"]);null!=_&&h(t,["routingConfig"],_);let v=p(e,["seed"]);null!=v&&h(t,["seed"],v);let E=p(e,["speechConfig"]);null!=E&&h(t,["speechConfig"],eP(E));let b=p(e,["stopSequences"]);null!=b&&h(t,["stopSequences"],b);let S=p(e,["temperature"]);null!=S&&h(t,["temperature"],S);let T=p(e,["thinkingConfig"]);null!=T&&h(t,["thinkingConfig"],T);let A=p(e,["topK"]);null!=A&&h(t,["topK"],A);let C=p(e,["topP"]);if(null!=C&&h(t,["topP"],C),void 0!==p(e,["enableEnhancedCivicAnswers"]))throw Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}(r));let n=p(e,["responseModalities"]);void 0!==t&&null!=n&&h(t,["setup","generationConfig","responseModalities"],n);let i=p(e,["temperature"]);void 0!==t&&null!=i&&h(t,["setup","generationConfig","temperature"],i);let o=p(e,["topP"]);void 0!==t&&null!=o&&h(t,["setup","generationConfig","topP"],o);let s=p(e,["topK"]);void 0!==t&&null!=s&&h(t,["setup","generationConfig","topK"],s);let a=p(e,["maxOutputTokens"]);void 0!==t&&null!=a&&h(t,["setup","generationConfig","maxOutputTokens"],a);let l=p(e,["mediaResolution"]);void 0!==t&&null!=l&&h(t,["setup","generationConfig","mediaResolution"],l);let u=p(e,["seed"]);void 0!==t&&null!=u&&h(t,["setup","generationConfig","seed"],u);let c=p(e,["speechConfig"]);void 0!==t&&null!=c&&h(t,["setup","generationConfig","speechConfig"],eP(Z(c)));let d=p(e,["thinkingConfig"]);void 0!==t&&null!=d&&h(t,["setup","generationConfig","thinkingConfig"],d);let f=p(e,["enableAffectiveDialog"]);void 0!==t&&null!=f&&h(t,["setup","generationConfig","enableAffectiveDialog"],f);let m=p(e,["systemInstruction"]);void 0!==t&&null!=m&&h(t,["setup","systemInstruction"],K(m));let g=p(e,["tools"]);if(void 0!==t&&null!=g){let e=et(g);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=p(e,["functionDeclarations"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==p(e,["behavior"]))throw Error("behavior parameter is not supported in Vertex AI.");let r=p(e,["description"]);null!=r&&h(t,["description"],r);let n=p(e,["name"]);null!=n&&h(t,["name"],n);let i=p(e,["parameters"]);null!=i&&h(t,["parameters"],i);let o=p(e,["parametersJsonSchema"]);null!=o&&h(t,["parametersJsonSchema"],o);let s=p(e,["response"]);null!=s&&h(t,["response"],s);let a=p(e,["responseJsonSchema"]);return null!=a&&h(t,["responseJsonSchema"],a),t})(e))),h(t,["functionDeclarations"],e)}let n=p(e,["retrieval"]);null!=n&&h(t,["retrieval"],n);let i=p(e,["googleSearch"]);null!=i&&h(t,["googleSearch"],i);let o=p(e,["googleSearchRetrieval"]);null!=o&&h(t,["googleSearchRetrieval"],o);let s=p(e,["enterpriseWebSearch"]);null!=s&&h(t,["enterpriseWebSearch"],s);let a=p(e,["googleMaps"]);null!=a&&h(t,["googleMaps"],a);let l=p(e,["urlContext"]);null!=l&&h(t,["urlContext"],l);let u=p(e,["computerUse"]);null!=u&&h(t,["computerUse"],u);let c=p(e,["codeExecution"]);return null!=c&&h(t,["codeExecution"],c),t})(ee(e)))),h(t,["setup","tools"],e)}let y=p(e,["sessionResumption"]);void 0!==t&&null!=y&&h(t,["setup","sessionResumption"],y);let _=p(e,["inputAudioTranscription"]);void 0!==t&&null!=_&&h(t,["setup","inputAudioTranscription"],_);let v=p(e,["outputAudioTranscription"]);void 0!==t&&null!=v&&h(t,["setup","outputAudioTranscription"],v);let E=p(e,["realtimeInputConfig"]);void 0!==t&&null!=E&&h(t,["setup","realtimeInputConfig"],E);let b=p(e,["contextWindowCompression"]);void 0!==t&&null!=b&&h(t,["setup","contextWindowCompression"],b);let S=p(e,["proactivity"]);return void 0!==t&&null!=S&&h(t,["setup","proactivity"],S),{}}(r,e)),A=e}else{let e,t,r;l=this.apiClient,e={},null!=(t=p(w,["model"]))&&h(e,["setup","model"],U(l,t)),null!=(r=p(w,["config"]))&&h(e,["config"],function(e,t){let r=p(e,["generationConfig"]);void 0!==t&&null!=r&&h(t,["setup","generationConfig"],r);let n=p(e,["responseModalities"]);void 0!==t&&null!=n&&h(t,["setup","generationConfig","responseModalities"],n);let i=p(e,["temperature"]);void 0!==t&&null!=i&&h(t,["setup","generationConfig","temperature"],i);let o=p(e,["topP"]);void 0!==t&&null!=o&&h(t,["setup","generationConfig","topP"],o);let s=p(e,["topK"]);void 0!==t&&null!=s&&h(t,["setup","generationConfig","topK"],s);let a=p(e,["maxOutputTokens"]);void 0!==t&&null!=a&&h(t,["setup","generationConfig","maxOutputTokens"],a);let l=p(e,["mediaResolution"]);void 0!==t&&null!=l&&h(t,["setup","generationConfig","mediaResolution"],l);let u=p(e,["seed"]);void 0!==t&&null!=u&&h(t,["setup","generationConfig","seed"],u);let c=p(e,["speechConfig"]);void 0!==t&&null!=c&&h(t,["setup","generationConfig","speechConfig"],Z(c));let d=p(e,["thinkingConfig"]);void 0!==t&&null!=d&&h(t,["setup","generationConfig","thinkingConfig"],d);let f=p(e,["enableAffectiveDialog"]);void 0!==t&&null!=f&&h(t,["setup","generationConfig","enableAffectiveDialog"],f);let m=p(e,["systemInstruction"]);void 0!==t&&null!=m&&h(t,["setup","systemInstruction"],function(e){let t={},r=p(e,["parts"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>{var t;let r,n,i,o,s,a,l,u,c,d,f;return r={},null!=(n=p(t=e,["videoMetadata"]))&&h(r,["videoMetadata"],n),null!=(i=p(t,["thought"]))&&h(r,["thought"],i),null!=(o=p(t,["inlineData"]))&&h(r,["inlineData"],ex(o)),null!=(s=p(t,["fileData"]))&&h(r,["fileData"],function(e){let t={};if(void 0!==p(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=p(e,["fileUri"]);null!=r&&h(t,["fileUri"],r);let n=p(e,["mimeType"]);return null!=n&&h(t,["mimeType"],n),t}(s)),null!=(a=p(t,["thoughtSignature"]))&&h(r,["thoughtSignature"],a),null!=(l=p(t,["functionCall"]))&&h(r,["functionCall"],l),null!=(u=p(t,["codeExecutionResult"]))&&h(r,["codeExecutionResult"],u),null!=(c=p(t,["executableCode"]))&&h(r,["executableCode"],c),null!=(d=p(t,["functionResponse"]))&&h(r,["functionResponse"],d),null!=(f=p(t,["text"]))&&h(r,["text"],f),r})),h(t,["parts"],e)}let n=p(e,["role"]);return null!=n&&h(t,["role"],n),t}(K(m)));let g=p(e,["tools"]);if(void 0!==t&&null!=g){let e=et(g);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=p(e,["functionDeclarations"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),h(t,["functionDeclarations"],e)}if(void 0!==p(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let n=p(e,["googleSearch"]);null!=n&&h(t,["googleSearch"],function(e){let t={},r=p(e,["timeRangeFilter"]);if(null!=r&&h(t,["timeRangeFilter"],r),void 0!==p(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");return t}(n));let i=p(e,["googleSearchRetrieval"]);if(null!=i&&h(t,["googleSearchRetrieval"],i),void 0!==p(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let o=p(e,["googleMaps"]);null!=o&&h(t,["googleMaps"],function(e){let t={};if(void 0!==p(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let r=p(e,["enableWidget"]);return null!=r&&h(t,["enableWidget"],r),t}(o));let s=p(e,["urlContext"]);null!=s&&h(t,["urlContext"],s);let a=p(e,["computerUse"]);null!=a&&h(t,["computerUse"],a);let l=p(e,["codeExecution"]);return null!=l&&h(t,["codeExecution"],l),t})(ee(e)))),h(t,["setup","tools"],e)}let y=p(e,["sessionResumption"]);void 0!==t&&null!=y&&h(t,["setup","sessionResumption"],function(e){let t={},r=p(e,["handle"]);if(null!=r&&h(t,["handle"],r),void 0!==p(e,["transparent"]))throw Error("transparent parameter is not supported in Gemini API.");return t}(y));let _=p(e,["inputAudioTranscription"]);void 0!==t&&null!=_&&h(t,["setup","inputAudioTranscription"],_);let v=p(e,["outputAudioTranscription"]);void 0!==t&&null!=v&&h(t,["setup","outputAudioTranscription"],v);let E=p(e,["realtimeInputConfig"]);void 0!==t&&null!=E&&h(t,["setup","realtimeInputConfig"],E);let b=p(e,["contextWindowCompression"]);void 0!==t&&null!=b&&h(t,["setup","contextWindowCompression"],b);let S=p(e,["proactivity"]);return void 0!==t&&null!=S&&h(t,["setup","proactivity"],S),{}}(r,e)),A=e}return delete A.config,S.send(JSON.stringify(A)),new e9(S,this.apiClient)}isCallableTool(e){return"callTool"in e&&"function"==typeof e.callTool}}let e4={turnComplete:!0};class e9{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(null!==t.turns&&void 0!==t.turns){let r=[];try{r=Q(t.turns),e.isVertexAI()||(r=r.map(e=>eN(e)))}catch(e){throw Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:r,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let r=[];if(null==t.functionResponses||0===(r=Array.isArray(t.functionResponses)?t.functionResponses:[t.functionResponses]).length)throw Error("functionResponses is required.");for(let t of r){if("object"!=typeof t||null===t||!("name"in t)||!("response"in t))throw Error(`Could not parse function response, type '${typeof t}'.`);if(!e.isVertexAI()&&!("id"in t))throw Error("FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.")}return{toolResponse:{functionResponses:r}}}sendClientContent(e){e=Object.assign(Object.assign({},e4),e);let t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};t=this.apiClient.isVertexAI()?{realtimeInput:function(e){let t={},r=p(e,["media"]);if(null!=r){let e=q(r);Array.isArray(e)&&(e=e.map(e=>e)),h(t,["mediaChunks"],e)}let n=p(e,["audio"]);null!=n&&h(t,["audio"],G(n));let i=p(e,["audioStreamEnd"]);null!=i&&h(t,["audioStreamEnd"],i);let o=p(e,["video"]);null!=o&&h(t,["video"],F(o));let s=p(e,["text"]);null!=s&&h(t,["text"],s);let a=p(e,["activityStart"]);null!=a&&h(t,["activityStart"],a);let l=p(e,["activityEnd"]);return null!=l&&h(t,["activityEnd"],l),t}(e)}:{realtimeInput:function(e){let t={},r=p(e,["media"]);if(null!=r){let e=q(r);Array.isArray(e)&&(e=e.map(e=>ex(e))),h(t,["mediaChunks"],e)}let n=p(e,["audio"]);null!=n&&h(t,["audio"],ex(G(n)));let i=p(e,["audioStreamEnd"]);null!=i&&h(t,["audioStreamEnd"],i);let o=p(e,["video"]);null!=o&&h(t,["video"],ex(F(o)));let s=p(e,["text"]);null!=s&&h(t,["text"],s);let a=p(e,["activityStart"]);null!=a&&h(t,["activityStart"],a);let l=p(e,["activityEnd"]);return null!=l&&h(t,["activityEnd"],l),t}(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(null==e.functionResponses)throw Error("Tool response parameters are required.");let t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}}function e7(e){var t,r,n;if(null==(t=null==e?void 0:e.automaticFunctionCalling)?void 0:t.disable)return!0;let i=!1;for(let t of null!=(r=null==e?void 0:e.tools)?r:[])if(te(t)){i=!0;break}if(!i)return!0;let o=null==(n=null==e?void 0:e.automaticFunctionCalling)?void 0:n.maximumRemoteCalls;return(!(!o||!(o<0)&&Number.isInteger(o))||0==o)&&(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",o),!0)}function te(e){return"callTool"in e&&"function"==typeof e.callTool}function tt(e){var t;return!(null==(t=null==e?void 0:e.automaticFunctionCalling)?void 0:t.ignoreCallHistory)}class tr extends c{constructor(e){super(),this.apiClient=e,this.generateContent=async e=>{var t,r,n,i,o,s,a,l,u,c,d;let h,p,f=await this.processParamsMaybeAddMcpUsage(e);if(this.maybeMoveToResponseJsonSchem(e),!(null!=(l=null==(a=null==(s=e.config)?void 0:s.tools)?void 0:a.some(e=>te(e)))&&l)||e7(e.config))return await this.generateContentInternal(f);if(null!=(d=null==(c=null==(u=e.config)?void 0:u.tools)?void 0:c.some(e=>!te(e)))&&d)throw Error("Automatic function calling with CallableTools and Tools is not yet supported.");let m=Q(f.contents),g=null!=(n=null==(r=null==(t=f.config)?void 0:t.automaticFunctionCalling)?void 0:r.maximumRemoteCalls)?n:10,y=0;for(;y<g&&(h=await this.generateContentInternal(f)).functionCalls&&0!==h.functionCalls.length;){let t=h.candidates[0].content,r=[];for(let t of null!=(o=null==(i=e.config)?void 0:i.tools)?o:[])if(te(t)){let e=await t.callTool(h.functionCalls);r.push(...e)}y++,p={role:"user",parts:r},f.contents=Q(f.contents),f.contents.push(t),f.contents.push(p),tt(f.config)&&(m.push(t),m.push(p))}return tt(f.config)&&(h.automaticFunctionCallingHistory=m),h},this.generateContentStream=async e=>{if(this.maybeMoveToResponseJsonSchem(e),!e7(e.config))return await this.processAfcStream(e);{let t=await this.processParamsMaybeAddMcpUsage(e);return await this.generateContentStreamInternal(t)}},this.generateImages=async e=>await this.generateImagesInternal(e).then(e=>{var t;let r,n=[];if(null==e?void 0:e.generatedImages)for(let i of e.generatedImages)i&&(null==i?void 0:i.safetyAttributes)&&(null==(t=null==i?void 0:i.safetyAttributes)?void 0:t.contentType)==="Positive Prompt"?r=null==i?void 0:i.safetyAttributes:n.push(i);return r?{generatedImages:n,positivePromptSafetyAttributes:r,sdkHttpResponse:e.sdkHttpResponse}:{generatedImages:n,sdkHttpResponse:e.sdkHttpResponse}}),this.list=async e=>{var t;let r={config:Object.assign(Object.assign({},{queryBase:!0}),null==e?void 0:e.config)};if(this.apiClient.isVertexAI()&&!r.config.queryBase)if(null==(t=r.config)?void 0:t.filter)throw Error("Filtering tuned models list for Vertex AI is not currently supported");else r.config.filter="labels.tune-type:*";return new ey(r5.PAGED_ITEM_MODELS,e=>this.listInternal(e),await this.listInternal(r),r)},this.editImage=async e=>{let t={model:e.model,prompt:e.prompt,referenceImages:[],config:e.config};return e.referenceImages&&e.referenceImages&&(t.referenceImages=e.referenceImages.map(e=>e.toReferenceImageAPI())),await this.editImageInternal(t)},this.upscaleImage=async e=>{let t={numberOfImages:1,mode:"upscale"};e.config&&(t=Object.assign(Object.assign({},t),e.config));let r={model:e.model,image:e.image,upscaleFactor:e.upscaleFactor,config:t};return await this.upscaleImageInternal(r)},this.generateVideos=async e=>{var t,r,n,i,o,s;if((e.prompt||e.image||e.video)&&e.source)throw Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return!this.apiClient.isVertexAI()&&((null==(t=e.video)?void 0:t.uri)&&(null==(r=e.video)?void 0:r.videoBytes)?e.video={uri:e.video.uri,mimeType:e.video.mimeType}:(null==(i=null==(n=e.source)?void 0:n.video)?void 0:i.uri)&&(null==(s=null==(o=e.source)?void 0:o.video)?void 0:s.videoBytes)&&(e.source.video={uri:e.source.video.uri,mimeType:e.source.video.mimeType})),await this.generateVideosInternal(e)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&!e.config.responseJsonSchema&&Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema)}async processParamsMaybeAddMcpUsage(e){var t,r,n;let i=null==(t=e.config)?void 0:t.tools;if(!i)return e;let o=await Promise.all(i.map(async e=>te(e)?await e.tool():e)),s={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:o})};if(s.config.tools=o,e.config&&e.config.tools&&eZ(e.config.tools)){let t=Object.assign({},null!=(n=null==(r=e.config.httpOptions)?void 0:r.headers)?n:{});0===Object.keys(t).length&&(t=this.apiClient.getDefaultHeaders()),e0(t),s.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:t})}return s}async initAfcToolsMap(e){var t,r,n;let i=new Map;for(let o of null!=(r=null==(t=e.config)?void 0:t.tools)?r:[])if(te(o))for(let e of null!=(n=(await o.tool()).functionDeclarations)?n:[]){if(!e.name)throw Error("Function declaration name is required.");if(i.has(e.name))throw Error(`Duplicate tool declaration name: ${e.name}`);i.set(e.name,o)}return i}async processAfcStream(e){var t,r,n;let i=null!=(n=null==(r=null==(t=e.config)?void 0:t.automaticFunctionCalling)?void 0:r.maximumRemoteCalls)?n:10,o=!1,s=0;return function(e,t,r){var n,a;return eS(this,arguments,function*(){for(var l,u,c,d;s<i;){o&&(s++,o=!1);let m=yield eb(e.processParamsMaybeAddMcpUsage(r)),y=yield eb(e.generateContentStreamInternal(m)),_=[],v=[];try{for(var h,p=!0,f=(u=void 0,eT(y));!(l=(h=yield eb(f.next())).done);p=!0)if(d=h.value,p=!1,yield yield eb(d),d.candidates&&(null==(n=d.candidates[0])?void 0:n.content)){for(let e of(v.push(d.candidates[0].content),null!=(a=d.candidates[0].content.parts)?a:[]))if(s<i&&e.functionCall){if(!e.functionCall.name)throw Error("Function call name was not returned by the model.");if(t.has(e.functionCall.name)){let r=yield eb(t.get(e.functionCall.name).callTool([e.functionCall]));_.push(...r)}else throw Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${t.keys()}, mising tool: ${e.functionCall.name}`)}}}catch(e){u={error:e}}finally{try{!p&&!l&&(c=f.return)&&(yield eb(c.call(f)))}finally{if(u)throw u.error}}if(_.length>0){o=!0;let e=new g;e.candidates=[{content:{role:"user",parts:_}}],yield yield eb(e);let t=[];t.push(...v),t.push({role:"user",parts:_});let n=Q(r.contents).concat(t);r.contents=n}else break}})}(this,await this.initAfcToolsMap(e),e)}async generateContentInternal(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=eD(this.apiClient,e);return o=d("{model}:generateContent",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=eL(e),r=new g;return Object.assign(r,t),r})}{let t=eM(this.apiClient,e);return o=d("{model}:generateContent",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(n=e.config)?void 0:n.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=ek(e),r=new g;return Object.assign(r,t),r})}}async generateContentStreamInternal(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=eD(this.apiClient,e);return o=d("{model}:streamGenerateContent?alt=sse",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.requestStream({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(function(e){return eS(this,arguments,function*(){var t,r,n,i;try{for(var o,s=!0,a=eT(e);!(t=(o=yield eb(a.next())).done);s=!0){i=o.value,s=!1;let e=eL((yield eb(i.json())));e.sdkHttpResponse={headers:i.headers};let t=new g;Object.assign(t,e),yield yield eb(t)}}catch(e){r={error:e}}finally{try{!s&&!t&&(n=a.return)&&(yield eb(n.call(a)))}finally{if(r)throw r.error}}})})}{let t=eM(this.apiClient,e);return o=d("{model}:streamGenerateContent?alt=sse",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.requestStream({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(n=e.config)?void 0:n.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(function(e){return eS(this,arguments,function*(){var t,r,n,i;try{for(var o,s=!0,a=eT(e);!(t=(o=yield eb(a.next())).done);s=!0){i=o.value,s=!1;let e=ek((yield eb(i.json())));e.sdkHttpResponse={headers:i.headers};let t=new g;Object.assign(t,e),yield yield eb(t)}}catch(e){r={error:e}}finally{try{!s&&!t&&(n=a.return)&&(yield eb(n.call(a)))}finally{if(r)throw r.error}}})})}}async embedContent(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e,t){let r,n,i,o,s,a={},l=p(t,["model"]);null!=l&&h(a,["_url","model"],U(e,l));let u=p(t,["contents"]);if(null!=u){let t=Y(e,u);Array.isArray(t)&&(t=t.map(e=>e)),h(a,["instances[]","content"],t)}let c=p(t,["config"]);return null!=c&&(r=p(c,["taskType"]),void 0!==a&&null!=r&&h(a,["instances[]","task_type"],r),n=p(c,["title"]),void 0!==a&&null!=n&&h(a,["instances[]","title"],n),i=p(c,["outputDimensionality"]),void 0!==a&&null!=i&&h(a,["parameters","outputDimensionality"],i),o=p(c,["mimeType"]),void 0!==a&&null!=o&&h(a,["instances[]","mimeType"],o),s=p(c,["autoTruncate"]),void 0!==a&&null!=s&&h(a,["parameters","autoTruncate"],s)),a}(this.apiClient,e);return o=d("{model}:predict",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=p(e,["sdkHttpResponse"]);null!=r&&h(t,["sdkHttpResponse"],r);let n=p(e,["predictions[]","embeddings"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let r,n,i,o,s,a;return r={},null!=(n=p(e,["values"]))&&h(r,["values"],n),null!=(i=p(e,["statistics"]))&&h(r,["statistics"],(o={},null!=(s=p(t=i,["truncated"]))&&h(o,["truncated"],s),null!=(a=p(t,["token_count"]))&&h(o,["tokenCount"],a),o)),r})),h(t,["embeddings"],e)}let i=p(e,["metadata"]);return null!=i&&h(t,["metadata"],i),t}(e),r=new y;return Object.assign(r,t),r})}{let t=function(e,t){let r={},n=p(t,["model"]);null!=n&&h(r,["_url","model"],U(e,n));let i=p(t,["contents"]);if(null!=i){let t=Y(e,i);Array.isArray(t)&&(t=t.map(e=>e)),h(r,["requests[]","content"],t)}let o=p(t,["config"]);null!=o&&function(e,t){let r=p(e,["taskType"]);void 0!==t&&null!=r&&h(t,["requests[]","taskType"],r);let n=p(e,["title"]);void 0!==t&&null!=n&&h(t,["requests[]","title"],n);let i=p(e,["outputDimensionality"]);if(void 0!==t&&null!=i&&h(t,["requests[]","outputDimensionality"],i),void 0!==p(e,["mimeType"]))throw Error("mimeType parameter is not supported in Gemini API.");if(void 0!==p(e,["autoTruncate"]))throw Error("autoTruncate parameter is not supported in Gemini API.")}(o,r);let s=p(t,["model"]);return void 0!==s&&h(r,["requests[]","model"],U(e,s)),r}(this.apiClient,e);return o=d("{model}:batchEmbedContents",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(n=e.config)?void 0:n.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=p(e,["sdkHttpResponse"]);null!=r&&h(t,["sdkHttpResponse"],r);let n=p(e,["embeddings"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),h(t,["embeddings"],e)}let i=p(e,["metadata"]);return null!=i&&h(t,["metadata"],i),t}(e),r=new y;return Object.assign(r,t),r})}}async generateImagesInternal(e){var t,r,n,i,o,s;let a="",l={};if(this.apiClient.isVertexAI()){let n,i,s,u,c,f,m,g,y,v,E,b,S,T,A,C,O,w,I,R,x,P=(o=this.apiClient,n={},null!=(i=p(e,["model"]))&&h(n,["_url","model"],U(o,i)),null!=(s=p(e,["prompt"]))&&h(n,["instances[0]","prompt"],s),null!=(u=p(e,["config"]))&&(c=p(u,["outputGcsUri"]),void 0!==n&&null!=c&&h(n,["parameters","storageUri"],c),f=p(u,["negativePrompt"]),void 0!==n&&null!=f&&h(n,["parameters","negativePrompt"],f),m=p(u,["numberOfImages"]),void 0!==n&&null!=m&&h(n,["parameters","sampleCount"],m),g=p(u,["aspectRatio"]),void 0!==n&&null!=g&&h(n,["parameters","aspectRatio"],g),y=p(u,["guidanceScale"]),void 0!==n&&null!=y&&h(n,["parameters","guidanceScale"],y),v=p(u,["seed"]),void 0!==n&&null!=v&&h(n,["parameters","seed"],v),E=p(u,["safetyFilterLevel"]),void 0!==n&&null!=E&&h(n,["parameters","safetySetting"],E),b=p(u,["personGeneration"]),void 0!==n&&null!=b&&h(n,["parameters","personGeneration"],b),S=p(u,["includeSafetyAttributes"]),void 0!==n&&null!=S&&h(n,["parameters","includeSafetyAttributes"],S),T=p(u,["includeRaiReason"]),void 0!==n&&null!=T&&h(n,["parameters","includeRaiReason"],T),A=p(u,["language"]),void 0!==n&&null!=A&&h(n,["parameters","language"],A),C=p(u,["outputMimeType"]),void 0!==n&&null!=C&&h(n,["parameters","outputOptions","mimeType"],C),O=p(u,["outputCompressionQuality"]),void 0!==n&&null!=O&&h(n,["parameters","outputOptions","compressionQuality"],O),w=p(u,["addWatermark"]),void 0!==n&&null!=w&&h(n,["parameters","addWatermark"],w),I=p(u,["labels"]),void 0!==n&&null!=I&&h(n,["labels"],I),R=p(u,["imageSize"]),void 0!==n&&null!=R&&h(n,["parameters","sampleImageSize"],R),x=p(u,["enhancePrompt"]),void 0!==n&&null!=x&&h(n,["parameters","enhancePrompt"],x)),n);return a=d("{model}:predict",P._url),l=P._query,delete P._url,delete P._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(P),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=p(e,["sdkHttpResponse"]);null!=r&&h(t,["sdkHttpResponse"],r);let n=p(e,["predictions"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>eU(e))),h(t,["generatedImages"],e)}let i=p(e,["positivePromptSafetyAttributes"]);return null!=i&&h(t,["positivePromptSafetyAttributes"],e$(i)),t}(e),r=new _;return Object.assign(r,t),r})}{let t,r,o,u,c=(s=this.apiClient,t={},null!=(r=p(e,["model"]))&&h(t,["_url","model"],U(s,r)),null!=(o=p(e,["prompt"]))&&h(t,["instances[0]","prompt"],o),null!=(u=p(e,["config"]))&&function(e,t){if(void 0!==p(e,["outputGcsUri"]))throw Error("outputGcsUri parameter is not supported in Gemini API.");if(void 0!==p(e,["negativePrompt"]))throw Error("negativePrompt parameter is not supported in Gemini API.");let r=p(e,["numberOfImages"]);void 0!==t&&null!=r&&h(t,["parameters","sampleCount"],r);let n=p(e,["aspectRatio"]);void 0!==t&&null!=n&&h(t,["parameters","aspectRatio"],n);let i=p(e,["guidanceScale"]);if(void 0!==t&&null!=i&&h(t,["parameters","guidanceScale"],i),void 0!==p(e,["seed"]))throw Error("seed parameter is not supported in Gemini API.");let o=p(e,["safetyFilterLevel"]);void 0!==t&&null!=o&&h(t,["parameters","safetySetting"],o);let s=p(e,["personGeneration"]);void 0!==t&&null!=s&&h(t,["parameters","personGeneration"],s);let a=p(e,["includeSafetyAttributes"]);void 0!==t&&null!=a&&h(t,["parameters","includeSafetyAttributes"],a);let l=p(e,["includeRaiReason"]);void 0!==t&&null!=l&&h(t,["parameters","includeRaiReason"],l);let u=p(e,["language"]);void 0!==t&&null!=u&&h(t,["parameters","language"],u);let c=p(e,["outputMimeType"]);void 0!==t&&null!=c&&h(t,["parameters","outputOptions","mimeType"],c);let d=p(e,["outputCompressionQuality"]);if(void 0!==t&&null!=d&&h(t,["parameters","outputOptions","compressionQuality"],d),void 0!==p(e,["addWatermark"]))throw Error("addWatermark parameter is not supported in Gemini API.");if(void 0!==p(e,["labels"]))throw Error("labels parameter is not supported in Gemini API.");let f=p(e,["imageSize"]);if(void 0!==t&&null!=f&&h(t,["parameters","sampleImageSize"],f),void 0!==p(e,["enhancePrompt"]))throw Error("enhancePrompt parameter is not supported in Gemini API.")}(u,t),t);return a=d("{model}:predict",c._url),l=c._query,delete c._url,delete c._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:null==(n=e.config)?void 0:n.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=p(e,["sdkHttpResponse"]);null!=r&&h(t,["sdkHttpResponse"],r);let n=p(e,["predictions"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t,r;let n,i,o,s,a,l,u;return n={},null!=(i=p(t=e,["_self"]))&&h(n,["image"],(o={},null!=(s=p(r=i,["bytesBase64Encoded"]))&&h(o,["imageBytes"],f(s)),null!=(a=p(r,["mimeType"]))&&h(o,["mimeType"],a),o)),null!=(l=p(t,["raiFilteredReason"]))&&h(n,["raiFilteredReason"],l),null!=(u=p(t,["_self"]))&&h(n,["safetyAttributes"],eH(u)),n})),h(t,["generatedImages"],e)}let i=p(e,["positivePromptSafetyAttributes"]);return null!=i&&h(t,["positivePromptSafetyAttributes"],eH(i)),t}(e),r=new _;return Object.assign(r,t),r})}}async editImageInternal(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI()){let o=function(e,t){let r,n,i,o,s,a,l,u,c,d,f,m,g,y,_,v,E,b={},S=p(t,["model"]);null!=S&&h(b,["_url","model"],U(e,S));let T=p(t,["prompt"]);null!=T&&h(b,["instances[0]","prompt"],T);let A=p(t,["referenceImages"]);if(null!=A){let e=A;Array.isArray(e)&&(e=e.map(e=>(function(e){let t,r,n,i,o,s,a,l={},u=p(e,["referenceImage"]);null!=u&&h(l,["referenceImage"],ej(u));let c=p(e,["referenceId"]);null!=c&&h(l,["referenceId"],c);let d=p(e,["referenceType"]);null!=d&&h(l,["referenceType"],d);let f=p(e,["maskImageConfig"]);null!=f&&h(l,["maskImageConfig"],(t={},null!=(r=p(f,["maskMode"]))&&h(t,["maskMode"],r),null!=(n=p(f,["segmentationClasses"]))&&h(t,["maskClasses"],n),null!=(i=p(f,["maskDilation"]))&&h(t,["dilation"],i),t));let m=p(e,["controlImageConfig"]);null!=m&&h(l,["controlImageConfig"],(o={},null!=(s=p(m,["controlType"]))&&h(o,["controlType"],s),null!=(a=p(m,["enableControlImageComputation"]))&&h(o,["computeControl"],a),o));let g=p(e,["styleImageConfig"]);null!=g&&h(l,["styleImageConfig"],g);let y=p(e,["subjectImageConfig"]);return null!=y&&h(l,["subjectImageConfig"],y),l})(e))),h(b,["instances[0]","referenceImages"],e)}let C=p(t,["config"]);return null!=C&&(r=p(C,["outputGcsUri"]),void 0!==b&&null!=r&&h(b,["parameters","storageUri"],r),n=p(C,["negativePrompt"]),void 0!==b&&null!=n&&h(b,["parameters","negativePrompt"],n),i=p(C,["numberOfImages"]),void 0!==b&&null!=i&&h(b,["parameters","sampleCount"],i),o=p(C,["aspectRatio"]),void 0!==b&&null!=o&&h(b,["parameters","aspectRatio"],o),s=p(C,["guidanceScale"]),void 0!==b&&null!=s&&h(b,["parameters","guidanceScale"],s),a=p(C,["seed"]),void 0!==b&&null!=a&&h(b,["parameters","seed"],a),l=p(C,["safetyFilterLevel"]),void 0!==b&&null!=l&&h(b,["parameters","safetySetting"],l),u=p(C,["personGeneration"]),void 0!==b&&null!=u&&h(b,["parameters","personGeneration"],u),c=p(C,["includeSafetyAttributes"]),void 0!==b&&null!=c&&h(b,["parameters","includeSafetyAttributes"],c),d=p(C,["includeRaiReason"]),void 0!==b&&null!=d&&h(b,["parameters","includeRaiReason"],d),f=p(C,["language"]),void 0!==b&&null!=f&&h(b,["parameters","language"],f),m=p(C,["outputMimeType"]),void 0!==b&&null!=m&&h(b,["parameters","outputOptions","mimeType"],m),g=p(C,["outputCompressionQuality"]),void 0!==b&&null!=g&&h(b,["parameters","outputOptions","compressionQuality"],g),y=p(C,["addWatermark"]),void 0!==b&&null!=y&&h(b,["parameters","addWatermark"],y),_=p(C,["labels"]),void 0!==b&&null!=_&&h(b,["labels"],_),v=p(C,["editMode"]),void 0!==b&&null!=v&&h(b,["parameters","editMode"],v),E=p(C,["baseSteps"]),void 0!==b&&null!=E&&h(b,["parameters","editConfig","baseSteps"],E)),b}(this.apiClient,e);return n=d("{model}:predict",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=p(e,["sdkHttpResponse"]);null!=r&&h(t,["sdkHttpResponse"],r);let n=p(e,["predictions"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>eU(e))),h(t,["generatedImages"],e)}return t}(e),r=new v;return Object.assign(r,t),r})}throw Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,r,n;let i="",o={};if(this.apiClient.isVertexAI()){let s,a,l,u,c,f,m,g,y,_,v,b,S,T,A=(n=this.apiClient,s={},null!=(a=p(e,["model"]))&&h(s,["_url","model"],U(n,a)),null!=(l=p(e,["image"]))&&h(s,["instances[0]","image"],ej(l)),null!=(u=p(e,["upscaleFactor"]))&&h(s,["parameters","upscaleConfig","upscaleFactor"],u),null!=(c=p(e,["config"]))&&(f=p(c,["outputGcsUri"]),void 0!==s&&null!=f&&h(s,["parameters","storageUri"],f),m=p(c,["includeRaiReason"]),void 0!==s&&null!=m&&h(s,["parameters","includeRaiReason"],m),g=p(c,["outputMimeType"]),void 0!==s&&null!=g&&h(s,["parameters","outputOptions","mimeType"],g),y=p(c,["outputCompressionQuality"]),void 0!==s&&null!=y&&h(s,["parameters","outputOptions","compressionQuality"],y),_=p(c,["enhanceInputImage"]),void 0!==s&&null!=_&&h(s,["parameters","upscaleConfig","enhanceInputImage"],_),v=p(c,["imagePreservationFactor"]),void 0!==s&&null!=v&&h(s,["parameters","upscaleConfig","imagePreservationFactor"],v),b=p(c,["labels"]),void 0!==s&&null!=b&&h(s,["labels"],b),S=p(c,["numberOfImages"]),void 0!==s&&null!=S&&h(s,["parameters","sampleCount"],S),T=p(c,["mode"]),void 0!==s&&null!=T&&h(s,["parameters","mode"],T)),s);return i=d("{model}:predict",A._url),o=A._query,delete A._url,delete A._query,this.apiClient.request({path:i,queryParams:o,body:JSON.stringify(A),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=p(e,["sdkHttpResponse"]);null!=r&&h(t,["sdkHttpResponse"],r);let n=p(e,["predictions"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>eU(e))),h(t,["generatedImages"],e)}return t}(e),r=new E;return Object.assign(r,t),r})}throw Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,r,n;let i="",o={};if(this.apiClient.isVertexAI()){let s,a,l,u,c,f,m,g,y,_,v,E,S,T,A,C=(n=this.apiClient,s={},null!=(a=p(e,["model"]))&&h(s,["_url","model"],U(n,a)),null!=(l=p(e,["source"]))&&function(e,t){let r=p(e,["prompt"]);void 0!==t&&null!=r&&h(t,["instances[0]","prompt"],r);let n=p(e,["personImage"]);void 0!==t&&null!=n&&h(t,["instances[0]","personImage","image"],ej(n));let i=p(e,["productImages"]);if(void 0!==t&&null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>{let t,r;return t={},null!=(r=p(e,["productImage"]))&&h(t,["image"],ej(r)),t})),h(t,["instances[0]","productImages"],e)}}(l,s),null!=(u=p(e,["config"]))&&(c=p(u,["numberOfImages"]),void 0!==s&&null!=c&&h(s,["parameters","sampleCount"],c),f=p(u,["baseSteps"]),void 0!==s&&null!=f&&h(s,["parameters","editConfig","baseSteps"],f),m=p(u,["outputGcsUri"]),void 0!==s&&null!=m&&h(s,["parameters","storageUri"],m),g=p(u,["seed"]),void 0!==s&&null!=g&&h(s,["parameters","seed"],g),y=p(u,["safetyFilterLevel"]),void 0!==s&&null!=y&&h(s,["parameters","safetySetting"],y),_=p(u,["personGeneration"]),void 0!==s&&null!=_&&h(s,["parameters","personGeneration"],_),v=p(u,["addWatermark"]),void 0!==s&&null!=v&&h(s,["parameters","addWatermark"],v),E=p(u,["outputMimeType"]),void 0!==s&&null!=E&&h(s,["parameters","outputOptions","mimeType"],E),S=p(u,["outputCompressionQuality"]),void 0!==s&&null!=S&&h(s,["parameters","outputOptions","compressionQuality"],S),T=p(u,["enhancePrompt"]),void 0!==s&&null!=T&&h(s,["parameters","enhancePrompt"],T),A=p(u,["labels"]),void 0!==s&&null!=A&&h(s,["labels"],A)),s);return i=d("{model}:predict",C._url),o=C._query,delete C._url,delete C._query,this.apiClient.request({path:i,queryParams:o,body:JSON.stringify(C),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},r=p(e,["predictions"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>eU(e))),h(t,["generatedImages"],e)}return t}(e),r=new b;return Object.assign(r,t),r})}throw Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var t,r,n,i,o;let s="",a={};if(this.apiClient.isVertexAI()){let l,u,c,f,m,g,y,_,v,E,b,T,A,C,O,w=(n=this.apiClient,g={},null!=(y=p(e,["model"]))&&h(g,["_url","model"],U(n,y)),null!=(_=p(e,["source"]))&&(i=_,o=g,c=p(i,["prompt"]),void 0!==o&&null!=c&&h(o,["instances[0]","prompt"],c),f=p(i,["image"]),void 0!==o&&null!=f&&h(o,["instances[0]","image"],ej(f)),m=p(i,["scribbleImage"]),void 0!==o&&null!=m&&h(o,["instances[0]","scribble"],(l={},null!=(u=p(m,["image"]))&&h(l,["image"],ej(u)),l))),null!=(v=p(e,["config"]))&&(E=p(v,["mode"]),void 0!==g&&null!=E&&h(g,["parameters","mode"],E),b=p(v,["maxPredictions"]),void 0!==g&&null!=b&&h(g,["parameters","maxPredictions"],b),T=p(v,["confidenceThreshold"]),void 0!==g&&null!=T&&h(g,["parameters","confidenceThreshold"],T),A=p(v,["maskDilation"]),void 0!==g&&null!=A&&h(g,["parameters","maskDilation"],A),C=p(v,["binaryColorThreshold"]),void 0!==g&&null!=C&&h(g,["parameters","binaryColorThreshold"],C),O=p(v,["labels"]),void 0!==g&&null!=O&&h(g,["labels"],O)),g);return s=d("{model}:predict",w._url),a=w._query,delete w._url,delete w._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(w),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},r=p(e,["predictions"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=p(e,["_self"]);null!=r&&h(t,["mask"],eB(r));let n=p(e,["labels"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),h(t,["labels"],e)}return t})(e))),h(t,["generatedMasks"],e)}return t}(e),r=new S;return Object.assign(r,t),r})}throw Error("This method is only supported by the Vertex AI.")}async get(e){var t,r,n,i,o,s;let a="",l={};if(this.apiClient.isVertexAI()){let n,i,s=(o=this.apiClient,n={},null!=(i=p(e,["model"]))&&h(n,["_url","name"],U(o,i)),n);return a=d("{name}",s._url),l=s._query,delete s._url,delete s._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json()).then(e=>eG(e))}{let t,r,o=(s=this.apiClient,t={},null!=(r=p(e,["model"]))&&h(t,["_url","name"],U(s,r)),t);return a=d("{name}",o._url),l=o._query,delete o._url,delete o._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null==(n=e.config)?void 0:n.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json()).then(e=>eF(e))}}async listInternal(e){var t,r,n,i,o,s;let a="",l={};if(this.apiClient.isVertexAI()){let n,i,s,u,c,f,m=(o=this.apiClient,n={},null!=(i=p(e,["config"]))&&(s=p(i,["pageSize"]),void 0!==n&&null!=s&&h(n,["_query","pageSize"],s),u=p(i,["pageToken"]),void 0!==n&&null!=u&&h(n,["_query","pageToken"],u),c=p(i,["filter"]),void 0!==n&&null!=c&&h(n,["_query","filter"],c),f=p(i,["queryBase"]),void 0!==n&&null!=f&&h(n,["_url","models_url"],ea(o,f))),n);return a=d("{models_url}",m._url),l=m._query,delete m._url,delete m._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(m),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=p(e,["sdkHttpResponse"]);null!=r&&h(t,["sdkHttpResponse"],r);let n=p(e,["nextPageToken"]);null!=n&&h(t,["nextPageToken"],n);let i=p(e,["_self"]);if(null!=i){let e=el(i);Array.isArray(e)&&(e=e.map(e=>eG(e))),h(t,["models"],e)}return t}(e),r=new T;return Object.assign(r,t),r})}{let t,r,o,u,c,f,m=(s=this.apiClient,t={},null!=(r=p(e,["config"]))&&(o=p(r,["pageSize"]),void 0!==t&&null!=o&&h(t,["_query","pageSize"],o),u=p(r,["pageToken"]),void 0!==t&&null!=u&&h(t,["_query","pageToken"],u),c=p(r,["filter"]),void 0!==t&&null!=c&&h(t,["_query","filter"],c),f=p(r,["queryBase"]),void 0!==t&&null!=f&&h(t,["_url","models_url"],ea(s,f))),t);return a=d("{models_url}",m._url),l=m._query,delete m._url,delete m._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(m),httpMethod:"GET",httpOptions:null==(n=e.config)?void 0:n.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=p(e,["sdkHttpResponse"]);null!=r&&h(t,["sdkHttpResponse"],r);let n=p(e,["nextPageToken"]);null!=n&&h(t,["nextPageToken"],n);let i=p(e,["_self"]);if(null!=i){let e=el(i);Array.isArray(e)&&(e=e.map(e=>eF(e))),h(t,["models"],e)}return t}(e),r=new T;return Object.assign(r,t),r})}}async update(e){var t,r,n,i,o,s;let a="",l={};if(this.apiClient.isVertexAI()){let n,i,s,u,c,f,m=(o=this.apiClient,n={},null!=(i=p(e,["model"]))&&h(n,["_url","model"],U(o,i)),null!=(s=p(e,["config"]))&&(u=p(s,["displayName"]),void 0!==n&&null!=u&&h(n,["displayName"],u),c=p(s,["description"]),void 0!==n&&null!=c&&h(n,["description"],c),f=p(s,["defaultCheckpointId"]),void 0!==n&&null!=f&&h(n,["defaultCheckpointId"],f)),n);return a=d("{model}",m._url),l=m._query,delete m._url,delete m._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(m),httpMethod:"PATCH",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json()).then(e=>eG(e))}{let t,r,o,u,c,f,m=(s=this.apiClient,t={},null!=(r=p(e,["model"]))&&h(t,["_url","name"],U(s,r)),null!=(o=p(e,["config"]))&&(u=p(o,["displayName"]),void 0!==t&&null!=u&&h(t,["displayName"],u),c=p(o,["description"]),void 0!==t&&null!=c&&h(t,["description"],c),f=p(o,["defaultCheckpointId"]),void 0!==t&&null!=f&&h(t,["defaultCheckpointId"],f)),t);return a=d("{name}",m._url),l=m._query,delete m._url,delete m._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(m),httpMethod:"PATCH",httpOptions:null==(n=e.config)?void 0:n.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json()).then(e=>eF(e))}}async delete(e){var t,r,n,i,o,s;let a="",l={};if(this.apiClient.isVertexAI()){let n,i,s=(o=this.apiClient,n={},null!=(i=p(e,["model"]))&&h(n,["_url","name"],U(o,i)),n);return a=d("{name}",s._url),l=s._query,delete s._url,delete s._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,r,n=(t={},null!=(r=p(e,["sdkHttpResponse"]))&&h(t,["sdkHttpResponse"],r),t),i=new A;return Object.assign(i,n),i})}{let t,r,o=(s=this.apiClient,t={},null!=(r=p(e,["model"]))&&h(t,["_url","name"],U(s,r)),t);return a=d("{name}",o._url),l=o._query,delete o._url,delete o._query,this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:null==(n=e.config)?void 0:n.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,r,n=(t={},null!=(r=p(e,["sdkHttpResponse"]))&&h(t,["sdkHttpResponse"],r),t),i=new A;return Object.assign(i,n),i})}}async countTokens(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e,t){let r={},n=p(t,["model"]);null!=n&&h(r,["_url","model"],U(e,n));let i=p(t,["contents"]);if(null!=i){let e=Q(i);Array.isArray(e)&&(e=e.map(e=>e)),h(r,["contents"],e)}let o=p(t,["config"]);return null!=o&&function(e,t){let r=p(e,["systemInstruction"]);void 0!==t&&null!=r&&h(t,["systemInstruction"],K(r));let n=p(e,["tools"]);if(void 0!==t&&null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>eW(e))),h(t,["tools"],e)}let i=p(e,["generationConfig"]);void 0!==t&&null!=i&&h(t,["generationConfig"],function(e){let t={},r=p(e,["modelSelectionConfig"]);null!=r&&h(t,["modelConfig"],r);let n=p(e,["audioTimestamp"]);null!=n&&h(t,["audioTimestamp"],n);let i=p(e,["candidateCount"]);null!=i&&h(t,["candidateCount"],i);let o=p(e,["enableAffectiveDialog"]);null!=o&&h(t,["enableAffectiveDialog"],o);let s=p(e,["frequencyPenalty"]);null!=s&&h(t,["frequencyPenalty"],s);let a=p(e,["logprobs"]);null!=a&&h(t,["logprobs"],a);let l=p(e,["maxOutputTokens"]);null!=l&&h(t,["maxOutputTokens"],l);let u=p(e,["mediaResolution"]);null!=u&&h(t,["mediaResolution"],u);let c=p(e,["presencePenalty"]);null!=c&&h(t,["presencePenalty"],c);let d=p(e,["responseJsonSchema"]);null!=d&&h(t,["responseJsonSchema"],d);let f=p(e,["responseLogprobs"]);null!=f&&h(t,["responseLogprobs"],f);let m=p(e,["responseMimeType"]);null!=m&&h(t,["responseMimeType"],m);let g=p(e,["responseModalities"]);null!=g&&h(t,["responseModalities"],g);let y=p(e,["responseSchema"]);null!=y&&h(t,["responseSchema"],y);let _=p(e,["routingConfig"]);null!=_&&h(t,["routingConfig"],_);let v=p(e,["seed"]);null!=v&&h(t,["seed"],v);let E=p(e,["speechConfig"]);null!=E&&h(t,["speechConfig"],eV(E));let b=p(e,["stopSequences"]);null!=b&&h(t,["stopSequences"],b);let S=p(e,["temperature"]);null!=S&&h(t,["temperature"],S);let T=p(e,["thinkingConfig"]);null!=T&&h(t,["thinkingConfig"],T);let A=p(e,["topK"]);null!=A&&h(t,["topK"],A);let C=p(e,["topP"]);if(null!=C&&h(t,["topP"],C),void 0!==p(e,["enableEnhancedCivicAnswers"]))throw Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}(i))}(o,r),r}(this.apiClient,e);return o=d("{model}:countTokens",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,r,n,i=(t={},null!=(r=p(e,["sdkHttpResponse"]))&&h(t,["sdkHttpResponse"],r),null!=(n=p(e,["totalTokens"]))&&h(t,["totalTokens"],n),t),o=new C;return Object.assign(o,i),o})}{let t=function(e,t){let r={},n=p(t,["model"]);null!=n&&h(r,["_url","model"],U(e,n));let i=p(t,["contents"]);if(null!=i){let e=Q(i);Array.isArray(e)&&(e=e.map(e=>eN(e))),h(r,["contents"],e)}let o=p(t,["config"]);return null!=o&&function(e){if(void 0!==p(e,["systemInstruction"]))throw Error("systemInstruction parameter is not supported in Gemini API.");if(void 0!==p(e,["tools"]))throw Error("tools parameter is not supported in Gemini API.");if(void 0!==p(e,["generationConfig"]))throw Error("generationConfig parameter is not supported in Gemini API.")}(o),r}(this.apiClient,e);return o=d("{model}:countTokens",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(n=e.config)?void 0:n.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,r,n,i,o=(t={},null!=(r=p(e,["sdkHttpResponse"]))&&h(t,["sdkHttpResponse"],r),null!=(n=p(e,["totalTokens"]))&&h(t,["totalTokens"],n),null!=(i=p(e,["cachedContentTokenCount"]))&&h(t,["cachedContentTokenCount"],i),t),s=new C;return Object.assign(s,o),s})}}async computeTokens(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI()){let o=function(e,t){let r={},n=p(t,["model"]);null!=n&&h(r,["_url","model"],U(e,n));let i=p(t,["contents"]);if(null!=i){let e=Q(i);Array.isArray(e)&&(e=e.map(e=>e)),h(r,["contents"],e)}return r}(this.apiClient,e);return n=d("{model}:computeTokens",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=p(e,["sdkHttpResponse"]);null!=r&&h(t,["sdkHttpResponse"],r);let n=p(e,["tokensInfo"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),h(t,["tokensInfo"],e)}return t}(e),r=new O;return Object.assign(r,t),r})}throw Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,r,n,i,o,s,a,l,u,c;let m="",g={};if(this.apiClient.isVertexAI()){let n,i,s,u,c,y,_,v,E,b,S=(o=this.apiClient,u={},null!=(c=p(e,["model"]))&&h(u,["_url","model"],U(o,c)),null!=(y=p(e,["prompt"]))&&h(u,["instances[0]","prompt"],y),null!=(_=p(e,["image"]))&&h(u,["instances[0]","image"],ej(_)),null!=(v=p(e,["video"]))&&h(u,["instances[0]","video"],eK(v)),null!=(E=p(e,["source"]))&&(a=E,l=u,n=p(a,["prompt"]),void 0!==l&&null!=n&&h(l,["instances[0]","prompt"],n),i=p(a,["image"]),void 0!==l&&null!=i&&h(l,["instances[0]","image"],ej(i)),s=p(a,["video"]),void 0!==l&&null!=s&&h(l,["instances[0]","video"],eK(s))),null!=(b=p(e,["config"]))&&function(e,t){var r;let n,i,o,s=p(e,["numberOfVideos"]);void 0!==t&&null!=s&&h(t,["parameters","sampleCount"],s);let a=p(e,["outputGcsUri"]);void 0!==t&&null!=a&&h(t,["parameters","storageUri"],a);let l=p(e,["fps"]);void 0!==t&&null!=l&&h(t,["parameters","fps"],l);let u=p(e,["durationSeconds"]);void 0!==t&&null!=u&&h(t,["parameters","durationSeconds"],u);let c=p(e,["seed"]);void 0!==t&&null!=c&&h(t,["parameters","seed"],c);let d=p(e,["aspectRatio"]);void 0!==t&&null!=d&&h(t,["parameters","aspectRatio"],d);let f=p(e,["resolution"]);void 0!==t&&null!=f&&h(t,["parameters","resolution"],f);let m=p(e,["personGeneration"]);void 0!==t&&null!=m&&h(t,["parameters","personGeneration"],m);let g=p(e,["pubsubTopic"]);void 0!==t&&null!=g&&h(t,["parameters","pubsubTopic"],g);let y=p(e,["negativePrompt"]);void 0!==t&&null!=y&&h(t,["parameters","negativePrompt"],y);let _=p(e,["enhancePrompt"]);void 0!==t&&null!=_&&h(t,["parameters","enhancePrompt"],_);let v=p(e,["generateAudio"]);void 0!==t&&null!=v&&h(t,["parameters","generateAudio"],v);let E=p(e,["lastFrame"]);void 0!==t&&null!=E&&h(t,["instances[0]","lastFrame"],ej(E));let b=p(e,["referenceImages"]);if(void 0!==t&&null!=b){let e=b;Array.isArray(e)&&(e=e.map(e=>{var t;let r,n,i;return r={},null!=(n=p(t=e,["image"]))&&h(r,["image"],ej(n)),null!=(i=p(t,["referenceType"]))&&h(r,["referenceType"],i),r})),h(t,["instances[0]","referenceImages"],e)}let S=p(e,["mask"]);void 0!==t&&null!=S&&h(t,["instances[0]","mask"],(n={},null!=(i=p(r=S,["image"]))&&h(n,["_self"],ej(i)),null!=(o=p(r,["maskMode"]))&&h(n,["maskMode"],o),n));let T=p(e,["compressionQuality"]);void 0!==t&&null!=T&&h(t,["parameters","compressionQuality"],T)}(b,u),u);return m=d("{model}:predictLongRunning",S._url),g=S._query,delete S._url,delete S._query,this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(S),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json()).then(e=>{let t,r,n,i,o,s,a=(t={},null!=(r=p(e,["name"]))&&h(t,["name"],r),null!=(n=p(e,["metadata"]))&&h(t,["metadata"],n),null!=(i=p(e,["done"]))&&h(t,["done"],i),null!=(o=p(e,["error"]))&&h(t,["error"],o),null!=(s=p(e,["response"]))&&h(t,["response"],function(e){let t={},r=p(e,["videos"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>{var t;let r,n,i,o,s,a;return r={},null!=(n=p(e,["_self"]))&&h(r,["video"],(i={},null!=(o=p(t=n,["gcsUri"]))&&h(i,["uri"],o),null!=(s=p(t,["bytesBase64Encoded"]))&&h(i,["videoBytes"],f(s)),null!=(a=p(t,["mimeType"]))&&h(i,["mimeType"],a),i)),r})),h(t,["generatedVideos"],e)}let n=p(e,["raiMediaFilteredCount"]);null!=n&&h(t,["raiMediaFilteredCount"],n);let i=p(e,["raiMediaFilteredReasons"]);return null!=i&&h(t,["raiMediaFilteredReasons"],i),t}(s)),t),l=new w;return Object.assign(l,a),l})}{let t,r,o,a,l,y,_,v,E,b,S=(s=this.apiClient,a={},null!=(l=p(e,["model"]))&&h(a,["_url","model"],U(s,l)),null!=(y=p(e,["prompt"]))&&h(a,["instances[0]","prompt"],y),null!=(_=p(e,["image"]))&&h(a,["instances[0]","image"],eq(_)),null!=(v=p(e,["video"]))&&h(a,["instances[0]","video"],eJ(v)),null!=(E=p(e,["source"]))&&(u=E,c=a,t=p(u,["prompt"]),void 0!==c&&null!=t&&h(c,["instances[0]","prompt"],t),r=p(u,["image"]),void 0!==c&&null!=r&&h(c,["instances[0]","image"],eq(r)),o=p(u,["video"]),void 0!==c&&null!=o&&h(c,["instances[0]","video"],eJ(o))),null!=(b=p(e,["config"]))&&function(e,t){let r=p(e,["numberOfVideos"]);if(void 0!==t&&null!=r&&h(t,["parameters","sampleCount"],r),void 0!==p(e,["outputGcsUri"]))throw Error("outputGcsUri parameter is not supported in Gemini API.");if(void 0!==p(e,["fps"]))throw Error("fps parameter is not supported in Gemini API.");let n=p(e,["durationSeconds"]);if(void 0!==t&&null!=n&&h(t,["parameters","durationSeconds"],n),void 0!==p(e,["seed"]))throw Error("seed parameter is not supported in Gemini API.");let i=p(e,["aspectRatio"]);void 0!==t&&null!=i&&h(t,["parameters","aspectRatio"],i);let o=p(e,["resolution"]);void 0!==t&&null!=o&&h(t,["parameters","resolution"],o);let s=p(e,["personGeneration"]);if(void 0!==t&&null!=s&&h(t,["parameters","personGeneration"],s),void 0!==p(e,["pubsubTopic"]))throw Error("pubsubTopic parameter is not supported in Gemini API.");let a=p(e,["negativePrompt"]);void 0!==t&&null!=a&&h(t,["parameters","negativePrompt"],a);let l=p(e,["enhancePrompt"]);if(void 0!==t&&null!=l&&h(t,["parameters","enhancePrompt"],l),void 0!==p(e,["generateAudio"]))throw Error("generateAudio parameter is not supported in Gemini API.");let u=p(e,["lastFrame"]);void 0!==t&&null!=u&&h(t,["instances[0]","lastFrame"],eq(u));let c=p(e,["referenceImages"]);if(void 0!==t&&null!=c){let e=c;Array.isArray(e)&&(e=e.map(e=>{var t;let r,n,i;return r={},null!=(n=p(t=e,["image"]))&&h(r,["image"],eq(n)),null!=(i=p(t,["referenceType"]))&&h(r,["referenceType"],i),r})),h(t,["instances[0]","referenceImages"],e)}if(void 0!==p(e,["mask"]))throw Error("mask parameter is not supported in Gemini API.");if(void 0!==p(e,["compressionQuality"]))throw Error("compressionQuality parameter is not supported in Gemini API.")}(b,a),a);return m=d("{model}:predictLongRunning",S._url),g=S._query,delete S._url,delete S._query,this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(S),httpMethod:"POST",httpOptions:null==(n=e.config)?void 0:n.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json()).then(e=>{let t,r,n,i,o,s,a=(t={},null!=(r=p(e,["name"]))&&h(t,["name"],r),null!=(n=p(e,["metadata"]))&&h(t,["metadata"],n),null!=(i=p(e,["done"]))&&h(t,["done"],i),null!=(o=p(e,["error"]))&&h(t,["error"],o),null!=(s=p(e,["response","generateVideoResponse"]))&&h(t,["response"],function(e){let t={},r=p(e,["generatedSamples"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>{var t;let r,n,i,o,s,a;return r={},null!=(n=p(e,["video"]))&&h(r,["video"],(i={},null!=(o=p(t=n,["uri"]))&&h(i,["uri"],o),null!=(s=p(t,["encodedVideo"]))&&h(i,["videoBytes"],f(s)),null!=(a=p(t,["encoding"]))&&h(i,["mimeType"],a),i)),r})),h(t,["generatedVideos"],e)}let n=p(e,["raiMediaFilteredCount"]);null!=n&&h(t,["raiMediaFilteredCount"],n);let i=p(e,["raiMediaFilteredReasons"]);return null!=i&&h(t,["raiMediaFilteredReasons"],i),t}(s)),t),l=new w;return Object.assign(l,a),l})}}}class tn extends c{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){let t=e.operation,r=e.config;if(void 0===t.name||""===t.name)throw Error("Operation name is required.");if(this.apiClient.isVertexAI()){let e,n=t.name.split("/operations/")[0];r&&"httpOptions"in r&&(e=r.httpOptions);let i=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:n,config:{httpOptions:e}});return t._fromAPIResponse({apiResponse:i,isVertexAI:!0})}{let e=await this.getVideosOperationInternal({operationName:t.name,config:r});return t._fromAPIResponse({apiResponse:e,isVertexAI:!1})}}async get(e){let t=e.operation,r=e.config;if(void 0===t.name||""===t.name)throw Error("Operation name is required.");if(this.apiClient.isVertexAI()){let e,n=t.name.split("/operations/")[0];r&&"httpOptions"in r&&(e=r.httpOptions);let i=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:n,config:{httpOptions:e}});return t._fromAPIResponse({apiResponse:i,isVertexAI:!0})}{let e=await this.getVideosOperationInternal({operationName:t.name,config:r});return t._fromAPIResponse({apiResponse:e,isVertexAI:!1})}}async getVideosOperationInternal(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n,i,a=(n={},null!=(i=p(e,["operationName"]))&&h(n,["_url","operationName"],i),n);return o=d("{operationName}",a._url),s=a._query,delete a._url,delete a._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(a),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json())}{let t,r,a=(t={},null!=(r=p(e,["operationName"]))&&h(t,["_url","operationName"],r),t);return o=d("{operationName}",a._url),s=a._query,delete a._url,delete a._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(a),httpMethod:"GET",httpOptions:null==(n=e.config)?void 0:n.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json())}}async fetchPredictVideosOperationInternal(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI()){let o,s,a,l=(o={},null!=(s=p(e,["operationName"]))&&h(o,["operationName"],s),null!=(a=p(e,["resourceName"]))&&h(o,["_url","resourceName"],a),o);return n=d("{resourceName}:fetchPredictOperation",l._url),i=l._query,delete l._url,delete l._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(l),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json())}throw Error("This method is only supported by the Vertex AI.")}}class ti extends c{constructor(e){super(),this.apiClient=e}async create(e){var t,r,n,i,o;let s="",a={};if(this.apiClient.isVertexAI())throw Error("The client.tokens.create method is only supported by the Gemini Developer API.");{let l,u,c,f,m,g,y,_,v,E,b=(n=this.apiClient,f={},null!=(m=p(e,["config"]))&&h(f,["config"],(g=p(m,["expireTime"]),void 0!==f&&null!=g&&h(f,["expireTime"],g),y=p(m,["newSessionExpireTime"]),void 0!==f&&null!=y&&h(f,["newSessionExpireTime"],y),_=p(m,["uses"]),void 0!==f&&null!=_&&h(f,["uses"],_),v=p(m,["liveConnectConstraints"]),void 0!==f&&null!=v&&h(f,["bidiGenerateContentSetup"],(i=n,l={},null!=(u=p(o=v,["model"]))&&h(l,["setup","model"],U(i,u)),null!=(c=p(o,["config"]))&&h(l,["config"],function(e,t){let r=p(e,["generationConfig"]);void 0!==t&&null!=r&&h(t,["setup","generationConfig"],r);let n=p(e,["responseModalities"]);void 0!==t&&null!=n&&h(t,["setup","generationConfig","responseModalities"],n);let i=p(e,["temperature"]);void 0!==t&&null!=i&&h(t,["setup","generationConfig","temperature"],i);let o=p(e,["topP"]);void 0!==t&&null!=o&&h(t,["setup","generationConfig","topP"],o);let s=p(e,["topK"]);void 0!==t&&null!=s&&h(t,["setup","generationConfig","topK"],s);let a=p(e,["maxOutputTokens"]);void 0!==t&&null!=a&&h(t,["setup","generationConfig","maxOutputTokens"],a);let l=p(e,["mediaResolution"]);void 0!==t&&null!=l&&h(t,["setup","generationConfig","mediaResolution"],l);let u=p(e,["seed"]);void 0!==t&&null!=u&&h(t,["setup","generationConfig","seed"],u);let c=p(e,["speechConfig"]);void 0!==t&&null!=c&&h(t,["setup","generationConfig","speechConfig"],Z(c));let d=p(e,["thinkingConfig"]);void 0!==t&&null!=d&&h(t,["setup","generationConfig","thinkingConfig"],d);let f=p(e,["enableAffectiveDialog"]);void 0!==t&&null!=f&&h(t,["setup","generationConfig","enableAffectiveDialog"],f);let m=p(e,["systemInstruction"]);void 0!==t&&null!=m&&h(t,["setup","systemInstruction"],function(e){let t={},r=p(e,["parts"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>{var t;let r,n,i,o,s,a,l,u,c,d,f;return r={},null!=(n=p(t=e,["videoMetadata"]))&&h(r,["videoMetadata"],n),null!=(i=p(t,["thought"]))&&h(r,["thought"],i),null!=(o=p(t,["inlineData"]))&&h(r,["inlineData"],function(e){let t={};if(void 0!==p(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=p(e,["data"]);null!=r&&h(t,["data"],r);let n=p(e,["mimeType"]);return null!=n&&h(t,["mimeType"],n),t}(o)),null!=(s=p(t,["fileData"]))&&h(r,["fileData"],function(e){let t={};if(void 0!==p(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=p(e,["fileUri"]);null!=r&&h(t,["fileUri"],r);let n=p(e,["mimeType"]);return null!=n&&h(t,["mimeType"],n),t}(s)),null!=(a=p(t,["thoughtSignature"]))&&h(r,["thoughtSignature"],a),null!=(l=p(t,["functionCall"]))&&h(r,["functionCall"],l),null!=(u=p(t,["codeExecutionResult"]))&&h(r,["codeExecutionResult"],u),null!=(c=p(t,["executableCode"]))&&h(r,["executableCode"],c),null!=(d=p(t,["functionResponse"]))&&h(r,["functionResponse"],d),null!=(f=p(t,["text"]))&&h(r,["text"],f),r})),h(t,["parts"],e)}let n=p(e,["role"]);return null!=n&&h(t,["role"],n),t}(K(m)));let g=p(e,["tools"]);if(void 0!==t&&null!=g){let e=et(g);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=p(e,["functionDeclarations"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),h(t,["functionDeclarations"],e)}if(void 0!==p(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let n=p(e,["googleSearch"]);null!=n&&h(t,["googleSearch"],function(e){let t={},r=p(e,["timeRangeFilter"]);if(null!=r&&h(t,["timeRangeFilter"],r),void 0!==p(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");return t}(n));let i=p(e,["googleSearchRetrieval"]);if(null!=i&&h(t,["googleSearchRetrieval"],i),void 0!==p(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let o=p(e,["googleMaps"]);null!=o&&h(t,["googleMaps"],function(e){let t={};if(void 0!==p(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let r=p(e,["enableWidget"]);return null!=r&&h(t,["enableWidget"],r),t}(o));let s=p(e,["urlContext"]);null!=s&&h(t,["urlContext"],s);let a=p(e,["computerUse"]);null!=a&&h(t,["computerUse"],a);let l=p(e,["codeExecution"]);return null!=l&&h(t,["codeExecution"],l),t})(ee(e)))),h(t,["setup","tools"],e)}let y=p(e,["sessionResumption"]);void 0!==t&&null!=y&&h(t,["setup","sessionResumption"],function(e){let t={},r=p(e,["handle"]);if(null!=r&&h(t,["handle"],r),void 0!==p(e,["transparent"]))throw Error("transparent parameter is not supported in Gemini API.");return t}(y));let _=p(e,["inputAudioTranscription"]);void 0!==t&&null!=_&&h(t,["setup","inputAudioTranscription"],_);let v=p(e,["outputAudioTranscription"]);void 0!==t&&null!=v&&h(t,["setup","outputAudioTranscription"],v);let E=p(e,["realtimeInputConfig"]);void 0!==t&&null!=E&&h(t,["setup","realtimeInputConfig"],E);let b=p(e,["contextWindowCompression"]);void 0!==t&&null!=b&&h(t,["setup","contextWindowCompression"],b);let S=p(e,["proactivity"]);return void 0!==t&&null!=S&&h(t,["setup","proactivity"],S),{}}(c,l)),l)),E=p(m,["lockAdditionalFields"]),void 0!==f&&null!=E&&h(f,["fieldMask"],E),{})),f);s=d("auth_tokens",b._url),a=b._query,delete b.config,delete b._url,delete b._query;let S=function(e,t){let r=null,n=e.bidiGenerateContentSetup;if("object"==typeof n&&null!==n&&"setup"in n){let t=n.setup;"object"==typeof t&&null!==t?(e.bidiGenerateContentSetup=t,r=t):delete e.bidiGenerateContentSetup}else void 0!==n&&delete e.bidiGenerateContentSetup;let i=e.fieldMask;if(r){let n=function(e){let t=[];for(let r in e)if(Object.prototype.hasOwnProperty.call(e,r)){let n=e[r];if("object"==typeof n&&null!=n&&Object.keys(n).length>0){let e=Object.keys(n).map(e=>`${r}.${e}`);t.push(...e)}else t.push(r)}return t.join(",")}(r);if(Array.isArray(null==t?void 0:t.lockAdditionalFields)&&(null==t?void 0:t.lockAdditionalFields.length)===0)n?e.fieldMask=n:delete e.fieldMask;else if((null==t?void 0:t.lockAdditionalFields)&&t.lockAdditionalFields.length>0&&null!==i&&Array.isArray(i)&&i.length>0){let t=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"],r=[];i.length>0&&(r=i.map(e=>t.includes(e)?`generationConfig.${e}`:e));let o=[];n&&o.push(n),r.length>0&&o.push(...r),o.length>0?e.fieldMask=o.join(","):delete e.fieldMask}else delete e.fieldMask}else null!==i&&Array.isArray(i)&&i.length>0?e.fieldMask=i.join(","):delete e.fieldMask;return e}(b,e.config);return this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(S),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json()).then(e=>e)}}}let to="x-goog-api-key",ts="https://www.googleapis.com/auth/cloud-platform";class ta{constructor(e){if(void 0!==e.apiKey){this.apiKey=e.apiKey;return}const t=function(e){let t;if(!e)return{scopes:[ts]};if((t=e).scopes){if("string"==typeof t.scopes&&t.scopes!==ts||Array.isArray(t.scopes)&&0>t.scopes.indexOf(ts))throw Error(`Invalid auth scopes. Scopes must include: ${ts}`)}else t.scopes=[ts];return t}(e.googleAuthOptions);this.googleAuth=new o.GoogleAuth(t)}async addAuthHeaders(e,t){if(void 0!==this.apiKey){if(this.apiKey.startsWith("auth_tokens/"))throw Error("Ephemeral tokens are only supported by the live API.");this.addKeyHeader(e);return}return this.addGoogleAuthHeaders(e,t)}addKeyHeader(e){if(null===e.get(to)){if(void 0===this.apiKey)throw Error("Trying to set API key header but apiKey is not set");e.append(to,this.apiKey)}}async addGoogleAuthHeaders(e,t){if(void 0===this.googleAuth)throw Error("Trying to set google-auth headers but googleAuth is unset");for(let[r,n]of(await this.googleAuth.getRequestHeaders(t)))null===e.get(r)&&e.append(r,n)}}class tl{async download(e,t){if(e.downloadPath){let r=await tu(e,t);if(r instanceof m){let t=(0,s.createWriteStream)(e.downloadPath);a.Readable.fromWeb(r.responseInternal.body).pipe(t)}else(0,s.writeFile)(e.downloadPath,r,{encoding:"base64"},t=>{if(t)throw Error(`Failed to write file to ${e.downloadPath}: ${t}`)})}}}async function tu(e,t){var r,n,i;let o=es(e.file);if(void 0!==o)return await t.request({path:`files/${o}:download`,httpMethod:"GET",queryParams:{alt:"media"},httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal});if(ei(e.file)){let t=null==(i=e.file.video)?void 0:i.videoBytes;if("string"==typeof t)return t;throw Error("Failed to download generated video, Uri or videoBytes not found.")}if(eo(e.file)){let t=e.file.videoBytes;if("string"==typeof t)return t;throw Error("Failed to download video, Uri or videoBytes not found.")}throw Error("Unsupported file type")}class tc{create(e,t,r){return new td(e,t,r)}}class td{constructor(e,t,r){this.url=e,this.headers=t,this.callbacks=r}connect(){this.ws=new l.default(this.url,{headers:this.headers}),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(void 0===this.ws)throw Error("WebSocket is not connected");this.ws.send(e)}close(){if(void 0===this.ws)throw Error("WebSocket is not connected");this.ws.close()}}function th(e,t){let r,n,i,o={},s=p(e,["sdkHttpResponse"]);null!=s&&h(o,["sdkHttpResponse"],s);let a=p(e,["name"]);null!=a&&h(o,["name"],a);let l=p(e,["state"]);null!=l&&h(o,["state"],en(l));let u=p(e,["createTime"]);null!=u&&h(o,["createTime"],u);let c=p(e,["tuningTask","startTime"]);null!=c&&h(o,["startTime"],c);let d=p(e,["tuningTask","completeTime"]);null!=d&&h(o,["endTime"],d);let f=p(e,["updateTime"]);null!=f&&h(o,["updateTime"],f);let m=p(e,["description"]);null!=m&&h(o,["description"],m);let g=p(e,["baseModel"]);null!=g&&h(o,["baseModel"],g);let y=p(e,["_self"]);return null!=y&&h(o,["tunedModel"],(r={},null!=(n=p(y,["name"]))&&h(r,["model"],n),null!=(i=p(y,["name"]))&&h(r,["endpoint"],i),r)),o}function tp(e,t){let r={},n=p(e,["sdkHttpResponse"]);null!=n&&h(r,["sdkHttpResponse"],n);let i=p(e,["name"]);null!=i&&h(r,["name"],i);let o=p(e,["state"]);null!=o&&h(r,["state"],en(o));let s=p(e,["createTime"]);null!=s&&h(r,["createTime"],s);let a=p(e,["startTime"]);null!=a&&h(r,["startTime"],a);let l=p(e,["endTime"]);null!=l&&h(r,["endTime"],l);let u=p(e,["updateTime"]);null!=u&&h(r,["updateTime"],u);let c=p(e,["error"]);null!=c&&h(r,["error"],c);let d=p(e,["description"]);null!=d&&h(r,["description"],d);let f=p(e,["baseModel"]);null!=f&&h(r,["baseModel"],f);let m=p(e,["tunedModel"]);null!=m&&h(r,["tunedModel"],m);let g=p(e,["preTunedModel"]);null!=g&&h(r,["preTunedModel"],g);let y=p(e,["supervisedTuningSpec"]);null!=y&&h(r,["supervisedTuningSpec"],y);let _=p(e,["tuningDataStats"]);null!=_&&h(r,["tuningDataStats"],_);let v=p(e,["encryptionSpec"]);null!=v&&h(r,["encryptionSpec"],v);let E=p(e,["partnerModelTuningSpec"]);null!=E&&h(r,["partnerModelTuningSpec"],E);let b=p(e,["customBaseModel"]);null!=b&&h(r,["customBaseModel"],b);let S=p(e,["experiment"]);null!=S&&h(r,["experiment"],S);let T=p(e,["labels"]);null!=T&&h(r,["labels"],T);let A=p(e,["outputUri"]);null!=A&&h(r,["outputUri"],A);let C=p(e,["pipelineJob"]);null!=C&&h(r,["pipelineJob"],C);let O=p(e,["serviceAccount"]);null!=O&&h(r,["serviceAccount"],O);let w=p(e,["tunedModelDisplayName"]);null!=w&&h(r,["tunedModelDisplayName"],w);let I=p(e,["veoTuningSpec"]);return null!=I&&h(r,["veoTuningSpec"],I),r}class tf extends c{constructor(e){super(),this.apiClient=e,this.get=async e=>await this.getInternal(e),this.list=async(e={})=>new ey(r5.PAGED_ITEM_TUNING_JOBS,e=>this.listInternal(e),await this.listInternal(e),e),this.tune=async e=>{var t;if(this.apiClient.isVertexAI())if(e.baseModel.startsWith("projects/")){let r={tunedModelName:e.baseModel};(null==(t=e.config)?void 0:t.preTunedModelCheckpointId)&&(r.checkpointId=e.config.preTunedModelCheckpointId);let n=Object.assign(Object.assign({},e),{preTunedModel:r});return n.baseModel=void 0,await this.tuneInternal(n)}else{let t=Object.assign({},e);return await this.tuneInternal(t)}{let t=Object.assign({},e),r=await this.tuneMldevInternal(t),n="";return void 0!==r.metadata&&void 0!==r.metadata.tunedModel?n=r.metadata.tunedModel:void 0!==r.name&&r.name.includes("/operations/")&&(n=r.name.split("/operations/")[0]),{name:n,state:rR.JOB_STATE_QUEUED}}}}async getInternal(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n,i,a=(n={},null!=(i=p(e,["name"]))&&h(n,["_url","name"],i),n);return o=d("{name}",a._url),s=a._query,delete a._url,delete a._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(a),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>tp(e))}{let t,r,a=(t={},null!=(r=p(e,["name"]))&&h(t,["_url","name"],r),t);return o=d("{name}",a._url),s=a._query,delete a._url,delete a._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(a),httpMethod:"GET",httpOptions:null==(n=e.config)?void 0:n.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>th(e))}}async listInternal(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n,i,a,l,u,c=(n={},null!=(i=p(e,["config"]))&&(a=p(i,["pageSize"]),void 0!==n&&null!=a&&h(n,["_query","pageSize"],a),l=p(i,["pageToken"]),void 0!==n&&null!=l&&h(n,["_query","pageToken"],l),u=p(i,["filter"]),void 0!==n&&null!=u&&h(n,["_query","filter"],u)),n);return o=d("tuningJobs",c._url),s=c._query,delete c._url,delete c._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(c),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e,t){let r={},n=p(e,["sdkHttpResponse"]);null!=n&&h(r,["sdkHttpResponse"],n);let i=p(e,["nextPageToken"]);null!=i&&h(r,["nextPageToken"],i);let o=p(e,["tuningJobs"]);if(null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>tp(e))),h(r,["tuningJobs"],e)}return r}(e),r=new I;return Object.assign(r,t),r})}{let t,r,a,l,u,c=(t={},null!=(r=p(e,["config"]))&&(a=p(r,["pageSize"]),void 0!==t&&null!=a&&h(t,["_query","pageSize"],a),l=p(r,["pageToken"]),void 0!==t&&null!=l&&h(t,["_query","pageToken"],l),u=p(r,["filter"]),void 0!==t&&null!=u&&h(t,["_query","filter"],u)),t);return o=d("tunedModels",c._url),s=c._query,delete c._url,delete c._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(c),httpMethod:"GET",httpOptions:null==(n=e.config)?void 0:n.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e,t){let r={},n=p(e,["sdkHttpResponse"]);null!=n&&h(r,["sdkHttpResponse"],n);let i=p(e,["nextPageToken"]);null!=i&&h(r,["nextPageToken"],i);let o=p(e,["tunedModels"]);if(null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>th(e))),h(r,["tuningJobs"],e)}return r}(e),r=new I;return Object.assign(r,t),r})}}async cancel(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n,i,a=(n={},null!=(i=p(e,["name"]))&&h(n,["_url","name"],i),n);o=d("{name}:cancel",a._url),s=a._query,delete a._url,delete a._query,await this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal})}else{let t,r,a=(t={},null!=(r=p(e,["name"]))&&h(t,["_url","name"],r),t);o=d("{name}:cancel",a._url),s=a._query,delete a._url,delete a._query,await this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:null==(n=e.config)?void 0:n.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal})}}async tuneInternal(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI()){let o,s,a,l,u,c=(o={},null!=(s=p(e,["baseModel"]))&&h(o,["baseModel"],s),null!=(a=p(e,["preTunedModel"]))&&h(o,["preTunedModel"],a),null!=(l=p(e,["trainingDataset"]))&&function(e,t,r){let n=p(e,["gcsUri"]);void 0!==t&&null!=n&&h(t,["supervisedTuningSpec","trainingDatasetUri"],n);let i=p(e,["vertexDatasetResource"]);if(void 0!==t&&null!=i&&h(t,["supervisedTuningSpec","trainingDatasetUri"],i),void 0!==p(e,["examples"]))throw Error("examples parameter is not supported in Vertex AI.")}(l,o),null!=(u=p(e,["config"]))&&function(e,t,r){var n;let i,o,s,a=p(e,["validationDataset"]);void 0!==t&&null!=a&&h(t,["supervisedTuningSpec"],(i={},null!=(o=p(n=a,["gcsUri"]))&&h(i,["validationDatasetUri"],o),null!=(s=p(n,["vertexDatasetResource"]))&&h(i,["validationDatasetUri"],s),i));let l=p(e,["tunedModelDisplayName"]);void 0!==t&&null!=l&&h(t,["tunedModelDisplayName"],l);let u=p(e,["description"]);void 0!==t&&null!=u&&h(t,["description"],u);let c=p(e,["epochCount"]);void 0!==t&&null!=c&&h(t,["supervisedTuningSpec","hyperParameters","epochCount"],c);let d=p(e,["learningRateMultiplier"]);void 0!==t&&null!=d&&h(t,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],d);let f=p(e,["exportLastCheckpointOnly"]);void 0!==t&&null!=f&&h(t,["supervisedTuningSpec","exportLastCheckpointOnly"],f);let m=p(e,["adapterSize"]);if(void 0!==t&&null!=m&&h(t,["supervisedTuningSpec","hyperParameters","adapterSize"],m),void 0!==p(e,["batchSize"]))throw Error("batchSize parameter is not supported in Vertex AI.");if(void 0!==p(e,["learningRate"]))throw Error("learningRate parameter is not supported in Vertex AI.");let g=p(e,["labels"]);void 0!==t&&null!=g&&h(t,["labels"],g)}(u,o),o);return n=d("tuningJobs",c._url),i=c._query,delete c._url,delete c._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(c),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>tp(e))}throw Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o,s,a,l,u,c=(o={},null!=(s=p(e,["baseModel"]))&&h(o,["baseModel"],s),null!=(a=p(e,["preTunedModel"]))&&h(o,["preTunedModel"],a),null!=(l=p(e,["trainingDataset"]))&&h(o,["tuningTask","trainingData"],function(e,t){let r={};if(void 0!==p(e,["gcsUri"]))throw Error("gcsUri parameter is not supported in Gemini API.");if(void 0!==p(e,["vertexDatasetResource"]))throw Error("vertexDatasetResource parameter is not supported in Gemini API.");let n=p(e,["examples"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),h(r,["examples","examples"],e)}return r}(l)),null!=(u=p(e,["config"]))&&function(e,t,r){if(void 0!==p(e,["validationDataset"]))throw Error("validationDataset parameter is not supported in Gemini API.");let n=p(e,["tunedModelDisplayName"]);if(void 0!==t&&null!=n&&h(t,["displayName"],n),void 0!==p(e,["description"]))throw Error("description parameter is not supported in Gemini API.");let i=p(e,["epochCount"]);void 0!==t&&null!=i&&h(t,["tuningTask","hyperparameters","epochCount"],i);let o=p(e,["learningRateMultiplier"]);if(null!=o&&h({},["tuningTask","hyperparameters","learningRateMultiplier"],o),void 0!==p(e,["exportLastCheckpointOnly"]))throw Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(void 0!==p(e,["preTunedModelCheckpointId"]))throw Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(void 0!==p(e,["adapterSize"]))throw Error("adapterSize parameter is not supported in Gemini API.");let s=p(e,["batchSize"]);void 0!==t&&null!=s&&h(t,["tuningTask","hyperparameters","batchSize"],s);let a=p(e,["learningRate"]);if(void 0!==t&&null!=a&&h(t,["tuningTask","hyperparameters","learningRate"],a),void 0!==p(e,["labels"]))throw Error("labels parameter is not supported in Gemini API.")}(u,o),o);return n=d("tunedModels",c._url),i=c._query,delete c._url,delete c._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(c),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,r,n,i,o,s;return t={},null!=(r=p(e,["sdkHttpResponse"]))&&h(t,["sdkHttpResponse"],r),null!=(n=p(e,["name"]))&&h(t,["name"],n),null!=(i=p(e,["metadata"]))&&h(t,["metadata"],i),null!=(o=p(e,["done"]))&&h(t,["done"],o),null!=(s=p(e,["error"]))&&h(t,["error"],s),t})}}}let tm="x-goog-upload-status";async function tg(e,t,r){var n,i,o;let s=0,a=0,l=new m(new Response),u="upload";for(s=e.size;a<s;){let o=Math.min(8388608,s-a),c=e.slice(a,a+o);a+o>=s&&(u+=", finalize");let d=0,h=1e3;for(;d<3&&(null==(n=null==(l=await r.request({path:"",body:c,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:t,headers:{"X-Goog-Upload-Command":u,"X-Goog-Upload-Offset":String(a),"Content-Length":String(o)}}}))?void 0:l.headers)||!n[tm]);)d++,await t_(h),h*=2;if(a+=o,(null==(i=null==l?void 0:l.headers)?void 0:i[tm])!=="active")break;if(s<=a)throw Error("All content has been uploaded, but the upload status is not finalized.")}let c=await (null==l?void 0:l.json());if((null==(o=null==l?void 0:l.headers)?void 0:o[tm])!=="final")throw Error("Failed to upload file: Upload status is not finalized.");return c.file}async function ty(e){return{size:e.size,type:e.type}}function t_(e){return new Promise(t=>setTimeout(t,e))}class tv{async stat(e){let t={size:0,type:void 0};return"string"==typeof e?(t.size=(await u.stat(e)).size,t.type=this.inferMimeType(e),t):await ty(e)}async upload(e,t,r){return"string"==typeof e?await this.uploadFileFromPath(e,t,r):tg(e,t,r)}inferMimeType(e){return({aac:"audio/aac",abw:"application/x-abiword",arc:"application/x-freearc",avi:"video/x-msvideo",azw:"application/vnd.amazon.ebook",bin:"application/octet-stream",bmp:"image/bmp",bz:"application/x-bzip",bz2:"application/x-bzip2",csh:"application/x-csh",css:"text/css",csv:"text/csv",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",gz:"application/gzip",gif:"image/gif",htm:"text/html",html:"text/html",ico:"image/vnd.microsoft.icon",ics:"text/calendar",jar:"application/java-archive",jpeg:"image/jpeg",jpg:"image/jpeg",js:"text/javascript",json:"application/json",jsonld:"application/ld+json",kml:"application/vnd.google-earth.kml+xml",kmz:"application/vnd.google-earth.kmz+xml",mjs:"text/javascript",mp3:"audio/mpeg",mp4:"video/mp4",mpeg:"video/mpeg",mpkg:"application/vnd.apple.installer+xml",odt:"application/vnd.oasis.opendocument.text",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",opus:"audio/opus",otf:"font/otf",png:"image/png",pdf:"application/pdf",php:"application/x-httpd-php",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",rar:"application/vnd.rar",rtf:"application/rtf",sh:"application/x-sh",svg:"image/svg+xml",swf:"application/x-shockwave-flash",tar:"application/x-tar",tif:"image/tiff",tiff:"image/tiff",ts:"video/mp2t",ttf:"font/ttf",txt:"text/plain",vsd:"application/vnd.visio",wav:"audio/wav",weba:"audio/webm",webm:"video/webm",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xml:"application/xml",xul:"application/vnd.mozilla.xul+xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2","7z":"application/x-7z-compressed"})[e.slice(e.lastIndexOf(".")+1).toLowerCase()]}async uploadFileFromPath(e,t,r){var n,i,o;let s,a=0,l=0,c=new m(new Response),d="upload";try{if(!(s=await u.open(e,"r")))throw Error("Failed to open file");for(a=(await s.stat()).size;l<a;){let e=Math.min(8388608,a-l);l+e>=a&&(d+=", finalize");let o=new Uint8Array(e),{bytesRead:u}=await s.read(o,0,e,l);if(u!==e)throw Error(`Failed to read ${e} bytes from file at offset ${l}. bytes actually read: ${u}`);let h=new Blob([o]),p=0,f=1e3;for(;p<3&&(null==(n=null==(c=await r.request({path:"",body:h,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:t,headers:{"X-Goog-Upload-Command":d,"X-Goog-Upload-Offset":String(l),"Content-Length":String(u)}}}))?void 0:c.headers)||!n[tm]);)p++,await t_(f),f*=2;if(l+=u,(null==(i=null==c?void 0:c.headers)?void 0:i[tm])!=="active")break;if(a<=l)throw Error("All content has been uploaded, but the upload status is not finalized.")}let h=await (null==c?void 0:c.json());if((null==(o=null==c?void 0:c.headers)?void 0:o[tm])!=="final")throw Error("Failed to upload file: Upload status is not finalized.");return h.file}finally{s&&await s.close()}}}function tE(e){var t,r,n;return null!=(n=null==(r=null==(t=null==process?void 0:process.env)?void 0:t[e])?void 0:r.trim())?n:void 0}process.env.GEMINI_API_KEY?console.log(" [GeminiService] GEMINI_API_KEY detectada com sucesso."):console.error(" [GeminiService] Varivel de ambiente GEMINI_API_KEY no configurada!");let tb=new class{constructor(e){var n,i,o,s,a,l;if((e.project||e.location)&&e.apiKey)throw Error("Project/location and API key are mutually exclusive in the client initializer.");this.vertexai=null!=(i=null!=(n=e.vertexai)?n:function(e){var t;return void 0!==(t=tE(e))&&"true"===t.toLowerCase()}("GOOGLE_GENAI_USE_VERTEXAI"))&&i;const u=function(){let e=tE("GOOGLE_API_KEY"),t=tE("GEMINI_API_KEY");return e&&t&&console.warn("Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY."),e||t||void 0}(),c=tE("GOOGLE_CLOUD_PROJECT"),d=tE("GOOGLE_CLOUD_LOCATION");this.apiKey=null!=(o=e.apiKey)?o:u,this.project=null!=(s=e.project)?s:c,this.location=null!=(a=e.location)?a:d,e.vertexai&&((null==(l=e.googleAuthOptions)?void 0:l.credentials)&&(console.debug("The user provided Google Cloud credentials will take precedence over the API key from the environment variable."),this.apiKey=void 0),(c||d)&&e.apiKey?(console.debug("The user provided Vertex AI API key will take precedence over the project/location from the environment variables."),this.project=void 0,this.location=void 0):(e.project||e.location)&&u?(console.debug("The user provided project/location will take precedence over the API key from the environment variables."),this.apiKey=void 0):(c||d)&&u&&(console.debug("The project/location from the environment variables will take precedence over the API key from the environment variables."),this.apiKey=void 0));const h=function(e,n,i,o){return(null==e?void 0:e.baseUrl)?e.baseUrl:n?null!=r?r:i:null!=t?t:o}(e.httpOptions,e.vertexai,tE("GOOGLE_VERTEX_BASE_URL"),tE("GOOGLE_GEMINI_BASE_URL"));h&&(e.httpOptions?e.httpOptions.baseUrl=h:e.httpOptions={baseUrl:h}),this.apiVersion=e.apiVersion;const p=new ta({apiKey:this.apiKey,googleAuthOptions:e.googleAuthOptions});this.apiClient=new ez({auth:p,project:this.project,location:this.location,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:"gl-node/"+process.version,uploader:new tv,downloader:new tl}),this.models=new tr(this.apiClient),this.live=new e5(this.apiClient,p,new tc),this.batches=new e_(this.apiClient),this.chats=new eO(this.models,this.apiClient),this.caches=new eE(this.apiClient),this.files=new eR(this.apiClient),this.operations=new tn(this.apiClient),this.authTokens=new ti(this.apiClient),this.tunings=new tf(this.apiClient)}}({apiKey:process.env.GEMINI_API_KEY});process.env.REMOTE_POST_URL,process.env.REMOTE_POST_API_KEY;let tS=async(e,t,r)=>{console.log(" [writeNewsArticle] Iniciando gerao do artigo..."),console.log(`[writeNewsArticle] Tema: ${e}`),console.log(`[writeNewsArticle] Idioma: ${t}`),console.log(`[writeNewsArticle] Palavras-chave: ${r}`);try{let n=`
Voc\xea \xe9 um jornalista cat\xf3lico de aproximadamente 25 anos, com um dom especial para contar hist\xf3rias inspiradoras sobre os Santos da Igreja Cat\xf3lica. 
Voc\xea escreve para o Blog Tio Ben  um blog cat\xf3lico jovem e envolvente, que busca evangelizar e inspirar seus leitores atrav\xe9s da vida dos Santos. 

Seu estilo \xe9 leve, natural e empolgante  como um amigo que sabe muito sobre a f\xe9 e compartilha hist\xf3rias de forma calorosa e verdadeira. 
N\xe3o use g\xedrias ou express\xf5es populares demais, mas evite tamb\xe9m a linguagem excessivamente formal. 
Seu texto deve soar aut\xeantico, humano e profundamente cat\xf3lico. 

 **Fontes e Verdade Doutrinal:**
- Suas refer\xeancias principais s\xe3o documentos e fontes oficiais da Igreja Cat\xf3lica, especialmente o site do Vaticano (vatican.va), o Missal Romano e o Diret\xf3rio dos Santos.
- Nunca invente fatos. Se n\xe3o houver informa\xe7\xe3o sobre algum aspecto, apenas omita. 
- Toda a narrativa deve estar em plena comunh\xe3o com o Magist\xe9rio e a Tradi\xe7\xe3o da Igreja.

 **Estrutura do Artigo (SEO e Conte\xfado):**
O artigo deve ter:
1. **T\xedtulo** criativo e inspirador.
2. **Subt\xedtulo** curto e cativante.
3. **Se\xe7\xe3o do Dia de Celebra\xe7\xe3o**  contendo a **Liturgia do Dia** (1\xaa Leitura, 2\xaa Leitura  se houver , Salmo e Evangelho).
4. **Introdu\xe7\xe3o envolvente**, que desperte a curiosidade do leitor e o conecte espiritualmente com o Santo.
5. **Corpo do texto** dividido em se\xe7\xf5es com subt\xedtulos claros:
   -  *Origem e nascimento*: onde e quando nasceu, contexto hist\xf3rico.
   -  *Caminho de f\xe9 e miss\xe3o*: principais fatos da vida, voca\xe7\xe3o, virtudes.
   -  *Milagres e testemunhos*: fatos reconhecidos pela Igreja ou pela tradi\xe7\xe3o.
   -  *Dia de celebra\xe7\xe3o*: data lit\xfargica e sentido espiritual.
   -  *Padroeiro e devo\xe7\xf5es*: se for padroeiro de algo, explique com clareza.
   -  *Ora\xe7\xe3o ao Santo* (caso exista oficialmente na tradi\xe7\xe3o).
   -  *Li\xe7\xe3o de vida*: o que sua hist\xf3ria ensina para os crist\xe3os de hoje, especialmente os jovens.
6. **Conclus\xe3o inspiradora**, que motive o leitor a buscar uma vida mais santa e pr\xf3xima de Deus.

 **Recursos estil\xedsticos:**
- Use **emojis** com modera\xe7\xe3o para dar leveza e simpatia ao texto (ex: , , , , , ).
- Use **listas e t\xf3picos** quando fizer sentido.
- Destaque palavras-chave importantes com **negrito**.
- Os subt\xedtulos devem ser marcados com '##' (Markdown) para SEO e clareza visual.
- O texto deve ter uma **densidade equilibrada de palavras-chave** e uma **meta description natural**.

 **SEO e Palavras-chave:**
Durante a escrita, tente incorporar de forma natural e relevante as seguintes palavras-chave: ${r}. 
N\xe3o force a inclus\xe3o se n\xe3o parecer natural; priorize a fluidez e o sentido espiritual do texto.

 **Instru\xe7\xe3o de Escrita:**
Escreva um artigo cativante e detalhado sobre "${e}". 
O artigo deve ter um t\xedtulo claro, uma introdu\xe7\xe3o envolvente, subt\xedtulos tem\xe1ticos, corpo bem estruturado e uma conclus\xe3o edificante. 
O tom deve ser inspirador e pr\xf3ximo, adequado para jovens cat\xf3licos que buscam crescer na f\xe9. 
O idioma do artigo deve ser: ${t}.
`;console.log(" [writeNewsArticle] Enviando prompt para o modelo gemini-2.5-pro...");let i=await tb.models.generateContent({model:"gemini-2.0-flash",contents:[{parts:[{text:n}]}]});return console.log(" [writeNewsArticle] Artigo gerado com sucesso."),i.text}catch(e){throw console.error(" [writeNewsArticle] Erro:",e),Error("Falha ao gerar o artigo de notcia pela IA.")}},tT=async e=>{console.log(" [formatArticleToHtml] Iniciando formatao do artigo..."),console.log("[formatArticleToHtml] Tamanho do texto recebido:",e.length);try{let t=`
Voc\xea \xe9 um assistente editorial e web designer cat\xf3lico especializado em formata\xe7\xe3o de artigos para o Blog Tio Ben. 
Seu papel \xe9 receber um texto em linguagem natural  uma mat\xe9ria sobre a vida de um santo  e convert\xea-la em um artigo HTML completo, elegante e semanticamente otimizado para SEO e responsividade.

O texto da mat\xe9ria chega no seguinte par\xe2metro:  
${e}

 **Contexto:**
O artigo original foi escrito por outro agente (um jornalista cat\xf3lico) e j\xe1 segue as tradi\xe7\xf5es da Igreja e o tom espiritual do Blog Tio Ben. 
Sua tarefa N\xc3O \xe9 reescrever o conte\xfado, mas format\xe1-lo em HTML conforme o modelo abaixo, adaptando t\xedtulos, subt\xedtulos e se\xe7\xf5es com estrutura sem\xe2ntica e estiliza\xe7\xe3o coerente com TailwindCSS, conforme o padr\xe3o do site.

---

 **ESTRUTURA BASE (modelo obrigat\xf3rio):**
O HTML deve sempre seguir este esqueleto principal:

<article class="post-santo max-w-3xl mx-auto p-4 sm lg bg-white font-sans text-gray-800 leading-relaxed min-h-screen">

  <!--  Bloco SEO: Data da Celebra\xe7\xe3o e Link para Liturgia -->
  <section id="data-celebracao" class="mb-8 p-4 bg-indigo-50 border border-indigo-100 rounded-lg">
    <h1 class="text-3xl font-extrabold text-indigo-700 mb-2">[Nome do Santo]  [Data de Celebra\xe7\xe3o]</h1>
    <p class="text-gray-700 text-base mb-3">
      No dia <time datetime="[aaaa-mm-dd]">[data por extenso]</time>, a Igreja celebra 
      <strong class="text-indigo-600">[Nome do Santo]</strong>. 
      [Breve resumo sobre o santo e o significado do dia.]
      Acompanhe tamb\xe9m a 
      <a href="https://www.iatioben.com.br/liturgia-diaria/[dd-mm-yyyy]" 
         class="text-indigo-600 font-semibold hover:underline" 
         target="_blank" 
         rel="noopener noreferrer">
        Liturgia Di\xe1ria de [data]
      </a>.
    </p>
  </section>

  <header class="mb-10 border-b border-indigo-200 pb-4">
    <h2 class="text-3xl sm font-extrabold text-indigo-700 mb-2 leading-tight">[T\xedtulo principal do artigo]</h2>
    <p class="introducao text-lg text-gray-600 italic">[Par\xe1grafo introdut\xf3rio]</p>
  </header>

  <!-- Se\xe7\xf5es tem\xe1ticas -->
  <section id="[slug-secao]" aria-labelledby="[titulo-secao]" class="mb-10 pt-4 border-b border-gray-100 pb-6">
    <h3 id="[titulo-secao]" class="dia-liturgia text-2xl font-bold text-gray-900 mb-3 sm">
      <span class="text-indigo-500 mr-2">[emoji]</span> [T\xedtulo da se\xe7\xe3o]
    </h3>
    <p class="mb-4">[Par\xe1grafo 1]</p>
    <p class="mb-4">[Par\xe1grafo 2]</p>
  </section>

  <!-- Se\xe7\xf5es finais -->
  <section id="resumo-seo" aria-labelledby="titulo-resumo" class="resumo-post p-5 border border-indigo-100 rounded-lg mb-10 bg-indigo-50">
    <h3 id="titulo-resumo" class="text-xl font-bold text-indigo-700 mb-3"> Ficha T\xe9cnica (SEO)</h3>
    <ul class="lista-resumo space-y-2 text-sm">
      <li><strong class="font-semibold text-gray-700">Tema central:</strong> [resumo do tema]</li>
      <li><strong class="font-semibold text-gray-700">Foco:</strong> [descri\xe7\xe3o resumida do foco]</li>
    </ul>
  </section>

  <footer class="rodape-post mt-10 pt-6 border-t border-gray-200">
    <h3 class="chamada-acao text-xl font-bold text-gray-900 mb-3"> Conecte F\xe9 e Humanismo</h3>
    <p class="text-gray-600">
      Inspire-se em <strong class="text-indigo-600">[Nome do Santo]</strong> e viva sua f\xe9 com coragem, esperan\xe7a e amor.
    </p>
  </footer>
</article>

---

 **INSTRU\xc7\xd5ES DE CONVERS\xc3O E FORMATA\xc7\xc3O:**

1. Use o conte\xfado recebido em \`${e}\` para preencher todas as se\xe7\xf5es do modelo.
2. Identifique automaticamente introdu\xe7\xe3o, corpo e conclus\xe3o e distribua em se\xe7\xf5es coerentes.
3. Utilize **emojis tem\xe1ticos cat\xf3licos** nos t\xedtulos ().
4. Gere **IDs sem\xe2nticos** para cada se\xe7\xe3o (ex: infancia-formacao, milagres, legado, oracao, li\xe7\xe3o-de-vida etc.).
5. As classes Tailwind devem ser **mantidas exatamente como no modelo.**
6. O HTML deve ser **responsivo, mobile first e semanticamente estruturado.**
7. Todos os links externos devem usar **target="_blank" e rel="noopener noreferrer".**
8. Formate datas com o atributo \`datetime="yyyy-mm-dd"\`.
9. Destaque termos importantes com **<strong>** e **<em>**.
10. Crie uma se\xe7\xe3o **"Ficha T\xe9cnica (SEO)"** ao final com resumo e foco do texto.

---

 **LINKS DE CONTEXTO INTELIGENTES (IA Tio Ben):**
Durante a formata\xe7\xe3o, **identifique express\xf5es, nomes ou fatos que possam despertar curiosidade** e converta-os em links que direcionem para a pesquisa na IA Tio Ben.  
Use o formato:

<a href="https://www.iatioben.com.br/?texto=[texto%20codificado]" 
   class="text-indigo-600 hover:underline font-medium" 
   target="_blank" 
   rel="noopener noreferrer">
   [express\xe3o clic\xe1vel]
</a>

Exemplo:  
Transforme Conc\xedlio Vaticano II em  
<a href="https://www.iatioben.com.br/?texto=Conc\xedlio%20Vaticano%20II" ...>Conc\xedlio Vaticano II</a>

Crie **entre 3 e 5 links** desse tipo por artigo, de forma natural e fluida, sem quebrar o contexto.

---

 **Boas pr\xe1ticas de SEO:**
- T\xedtulo principal \xfanico e envolvente (\`<h1>\`).  
- Subt\xedtulos hier\xe1rquicos (\`<h2>\`, \`<h3>\`).  
- Tags sem\xe2nticas corretas (\`<strong>\`, \`<em>\`, \`<time>\`, \`<a>\`).  
- Estrutura HTML limpa e validada.  
- Par\xe1grafos curtos e escane\xe1veis.  
- Palavras-chave mantidas naturalmente.

---

 **Instru\xe7\xe3o final:**
Receba o conte\xfado no par\xe2metro \`${e}\` e retorne **somente o HTML final completo e formatado** no padr\xe3o acima, pronto para publica\xe7\xe3o no site www.iatioben.com.br.  
N\xe3o adicione explica\xe7\xf5es nem coment\xe1rios  apenas gere o HTML final.
`,r=(await tb.models.generateContent({model:"gemini-2.0-flash",contents:[{parts:[{text:t}]}]})).text||"";return r.startsWith("```html")&&(r=r.slice(7)),r.endsWith("```")&&(r=r.slice(0,-3)),console.log(" [formatArticleToHtml] HTML gerado com sucesso. Tamanho:",r.length),r.trim()}catch(e){throw console.error(" [formatArticleToHtml] Erro ao gerar HTML:",e),Error("Falha ao formatar o artigo para HTML.")}},tA=async(e,t)=>{console.log(" [analyzeSeoAndExtractMetadata] Iniciando anlise SEO...");try{let r=`
Voc\xea \xe9 um editor cat\xf3lico do Blog Tio Ben, respons\xe1vel por revisar artigos espirituais sobre a vida dos Santos e otimizar seu conte\xfado para SEO  sem jamais perder o tom humano, devocional e inspirador do texto original.

 Sua miss\xe3o \xe9 analisar o artigo abaixo e gerar um **objeto JSON** com duas chaves:
- "keywords": uma lista com 5 a 10 palavras-chave que melhor representam o artigo e sua espiritualidade, valorizando temas cat\xf3licos e express\xf5es de f\xe9.
- "metaDescription": uma breve descri\xe7\xe3o (m\xe1x. 160 caracteres) que resuma a ess\xeancia do artigo de forma cativante, fiel \xe0 mensagem e ao estilo do texto, como se fosse o resumo que aparece no Google.  
  Ela deve soar natural, acolhedora e levemente po\xe9tica  como uma frase que desperta f\xe9 e curiosidade, sem parecer comercial.

 Dicas de estilo:
- Mantenha o mesmo tom usado no artigo: devocional, alegre, pr\xf3ximo e cheio de esperan\xe7a.
- Prefira frases que transmitam luz, f\xe9, virtude e exemplo de vida.
- N\xe3o use linguagem t\xe9cnica ou publicit\xe1ria.
- Inspire o leitor a clicar, mas sem perder a rever\xeancia e autenticidade.

Palavras-chave foco do blog: ${t}

 Artigo a analisar:
---
${e}
---

Retorne **somente o JSON** no formato:
{
  "keywords": ["palavra1", "palavra2", ...],
  "metaDescription": "texto descritivo cativante"
}
`,n=await tb.models.generateContent({model:"gemini-2.0-flash",contents:[{parts:[{text:r}]}],config:{responseMimeType:"application/json",responseSchema:{type:rf.OBJECT,properties:{keywords:{type:rf.ARRAY,items:{type:rf.STRING}},metaDescription:{type:rf.STRING}}}}}),i=JSON.parse(n.text);return console.log(" [analyzeSeoAndExtractMetadata] SEO extrado:",i),{keywords:i.keywords||[],metaDescription:i.metaDescription||""}}catch(e){return console.error(" [analyzeSeoAndExtractMetadata] Erro SEO:",e),{keywords:[],metaDescription:"No foi possvel gerar a meta descrio."}}};e.s(["analyzeSeoAndExtractMetadata",0,tA,"formatArticleToHtml",0,tT,"writeNewsArticle",0,tS],94943);var tC,tO,tw,tI,tR,tx,tP,tN,tM,tD,tk,tL,tU,tB,tq,tj,tF,tG,tH,t$,tV,tW,tJ,tK,tY,tQ,tz,tX,tZ,t0,t1,t2,t6,t3,t8,t5,t4,t9,t7,re,rt,rr,rn,ri,ro,rs,ra,rl,ru,rc,rd,rh,rp,rf,rm,rg,ry,r_,rv,rE,rb,rS,rT,rA,rC,rO,rw,rI,rR,rx,rP,rN,rM,rD,rk,rL,rU,rB,rq,rj,rF,rG,rH,r$,rV,rW,rJ,rK,rY,rQ,rz,rX,rZ,r0,r1,r2,r6,r3,r8,r5,r4,r9,r7,ne,nt,nr=Object.create,nn=Object.defineProperty,ni=Object.getOwnPropertyDescriptor,no=Object.getOwnPropertyNames,ns=Object.getPrototypeOf,na=Object.prototype.hasOwnProperty,nl=(e,t)=>nn(e,"name",{value:t,configurable:!0}),nu=(e,t)=>()=>(e&&(t=e(e=0)),t),nc=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),nd=(e,t)=>{for(var r in t)nn(e,r,{get:t[r],enumerable:!0})},nh=(e,t,r,n)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let i of no(t))na.call(e,i)||i===r||nn(e,i,{get:()=>t[i],enumerable:!(n=ni(t,i))||n.enumerable});return e},np=(e,t,r)=>(r=null!=e?nr(ns(e)):{},nh(!t&&e&&e.__esModule?r:nn(r,"default",{value:e,enumerable:!0}),e)),nf=e=>nh(nn({},"__esModule",{value:!0}),e),nm=(e,t,r)=>{let n;return(n="symbol"!=typeof t?t+"":t)in e?nn(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r},ng=nc(e=>{nv(),e.byteLength=l,e.toByteArray=c,e.fromByteArray=p;var t,r,n=[],i=[],o="u">typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(t=0,r=s.length;t<r;++t)n[t]=s[t],i[s.charCodeAt(t)]=t;function a(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var n=r===t?0:4-r%4;return[r,n]}function l(e){var t=a(e),r=t[0],n=t[1];return(r+n)*3/4-n}function u(e,t,r){return(t+r)*3/4-r}function c(e){var t,r,n=a(e),s=n[0],l=n[1],c=new o(u(e,s,l)),d=0,h=l>0?s-4:s;for(r=0;r<h;r+=4)t=i[e.charCodeAt(r)]<<18|i[e.charCodeAt(r+1)]<<12|i[e.charCodeAt(r+2)]<<6|i[e.charCodeAt(r+3)],c[d++]=t>>16&255,c[d++]=t>>8&255,c[d++]=255&t;return 2===l&&(t=i[e.charCodeAt(r)]<<2|i[e.charCodeAt(r+1)]>>4,c[d++]=255&t),1===l&&(t=i[e.charCodeAt(r)]<<10|i[e.charCodeAt(r+1)]<<4|i[e.charCodeAt(r+2)]>>2,c[d++]=t>>8&255,c[d++]=255&t),c}function d(e){return n[e>>18&63]+n[e>>12&63]+n[e>>6&63]+n[63&e]}function h(e,t,r){for(var n=[],i=t;i<r;i+=3)n.push(d((e[i]<<16&0xff0000)+(e[i+1]<<8&65280)+(255&e[i+2])));return n.join("")}function p(e){for(var t,r=e.length,i=r%3,o=[],s=0,a=r-i;s<a;s+=16383)o.push(h(e,s,s+16383>a?a:s+16383));return 1===i?o.push(n[(t=e[r-1])>>2]+n[t<<4&63]+"=="):2===i&&o.push(n[(t=(e[r-2]<<8)+e[r-1])>>10]+n[t>>4&63]+n[t<<2&63]+"="),o.join("")}i[45]=62,i[95]=63,nl(a,"getLens"),nl(l,"byteLength"),nl(u,"_byteLength"),nl(c,"toByteArray"),nl(d,"tripletToBase64"),nl(h,"encodeChunk"),nl(p,"fromByteArray")}),ny=nc(e=>{nv(),e.read=function(e,t,r,n,i){var o,s,a=8*i-n-1,l=(1<<a)-1,u=l>>1,c=-7,d=r?i-1:0,h=r?-1:1,p=e[t+d];for(d+=h,o=p&(1<<-c)-1,p>>=-c,c+=a;c>0;o=256*o+e[t+d],d+=h,c-=8);for(s=o&(1<<-c)-1,o>>=-c,c+=n;c>0;s=256*s+e[t+d],d+=h,c-=8);if(0===o)o=1-u;else{if(o===l)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,n),o-=u}return(p?-1:1)*s*Math.pow(2,o-n)},e.write=function(e,t,r,n,i,o){var s,a,l,u=8*o-i-1,c=(1<<u)-1,d=c>>1,h=5960464477539062e-23*(23===i),p=n?0:o-1,f=n?1:-1,m=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(a=+!!isNaN(t),s=c):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),s+d>=1?t+=h/l:t+=h*Math.pow(2,1-d),t*l>=2&&(s++,l/=2),s+d>=c?(a=0,s=c):s+d>=1?(a=(t*l-1)*Math.pow(2,i),s+=d):(a=t*Math.pow(2,d-1)*Math.pow(2,i),s=0));i>=8;e[r+p]=255&a,p+=f,a/=256,i-=8);for(s=s<<i|a,u+=i;u>0;e[r+p]=255&s,p+=f,s/=256,u-=8);e[r+p-f]|=128*m}}),n_=nc(e=>{nv();var t=ng(),r=ny(),n="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function i(){try{let e=new Uint8Array(1),t={foo:nl(function(){return 42},"foo")};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch{return!1}}function o(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');let t=new Uint8Array(e);return Object.setPrototypeOf(t,s.prototype),t}function s(e,t,r){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return c(e)}return a(e,t,r)}function a(e,t,r){if("string"==typeof e)return d(e,t);if(ArrayBuffer.isView(e))return p(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(er(e,ArrayBuffer)||e&&er(e.buffer,ArrayBuffer)||"u">typeof SharedArrayBuffer&&(er(e,SharedArrayBuffer)||e&&er(e.buffer,SharedArrayBuffer)))return f(e,t,r);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');let n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return s.from(n,t,r);let i=m(e);if(i)return i;if("u">typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return s.from(e[Symbol.toPrimitive]("string"),t,r);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function l(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function u(e,t,r){return l(e),e<=0?o(e):void 0!==t?"string"==typeof r?o(e).fill(t,r):o(e).fill(t):o(e)}function c(e){return l(e),o(e<0?0:0|g(e))}function d(e,t){if(("string"!=typeof t||""===t)&&(t="utf8"),!s.isEncoding(t))throw TypeError("Unknown encoding: "+t);let r=0|_(e,t),n=o(r),i=n.write(e,t);return i!==r&&(n=n.slice(0,i)),n}function h(e){let t=e.length<0?0:0|g(e.length),r=o(t);for(let n=0;n<t;n+=1)r[n]=255&e[n];return r}function p(e){if(er(e,Uint8Array)){let t=new Uint8Array(e);return f(t.buffer,t.byteOffset,t.byteLength)}return h(e)}function f(e,t,r){let n;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),s.prototype),n}function m(e){if(s.isBuffer(e)){let t=0|g(e.length),r=o(t);return 0===r.length||e.copy(r,0,0,t),r}return void 0!==e.length?"number"!=typeof e.length||en(e.length)?o(0):h(e):"Buffer"===e.type&&Array.isArray(e.data)?h(e.data):void 0}function g(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function y(e){return+e!=e&&(e=0),s.alloc(+e)}function _(e,t){if(s.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||er(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);let r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;let i=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return z(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return ee(e).length;default:if(i)return n?-1:z(e).length;t=(""+t).toLowerCase(),i=!0}}function v(e,t,r){let n=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0)||(r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return M(this,t,r);case"utf8":case"utf-8":return R(this,t,r);case"ascii":return P(this,t,r);case"latin1":case"binary":return N(this,t,r);case"base64":return I(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return D(this,t,r);default:if(n)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function E(e,t,r){let n=e[t];e[t]=e[r],e[r]=n}function b(e,t,r,n,i){if(0===e.length)return -1;if("string"==typeof r?(n=r,r=0):r>0x7fffffff?r=0x7fffffff:r<-0x80000000&&(r=-0x80000000),en(r*=1)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return -1;r=e.length-1}else if(r<0)if(!i)return -1;else r=0;if("string"==typeof t&&(t=s.from(t,n)),s.isBuffer(t))return 0===t.length?-1:S(e,t,r,n,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):S(e,[t],r,n,i);throw TypeError("val must be string, number or Buffer")}function S(e,t,r,n,i){let o,s=1,a=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return -1;s=2,a/=2,l/=2,r/=2}function u(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(nl(u,"read"),i){let n=-1;for(o=r;o<a;o++)if(u(e,o)===u(t,-1===n?0:o-n)){if(-1===n&&(n=o),o-n+1===l)return n*s}else -1!==n&&(o-=o-n),n=-1}else for(r+l>a&&(r=a-l),o=r;o>=0;o--){let r=!0;for(let n=0;n<l;n++)if(u(e,o+n)!==u(t,n)){r=!1;break}if(r)return o}return -1}function T(e,t,r,n){let i;r=Number(r)||0;let o=e.length-r;n?(n=Number(n))>o&&(n=o):n=o;let s=t.length;for(n>s/2&&(n=s/2),i=0;i<n;++i){let n=parseInt(t.substr(2*i,2),16);if(en(n))break;e[r+i]=n}return i}function A(e,t,r,n){return et(z(t,e.length-r),e,r,n)}function C(e,t,r,n){return et(X(t),e,r,n)}function O(e,t,r,n){return et(ee(t),e,r,n)}function w(e,t,r,n){return et(Z(t,e.length-r),e,r,n)}function I(e,r,n){return 0===r&&n===e.length?t.fromByteArray(e):t.fromByteArray(e.slice(r,n))}function R(e,t,r){r=Math.min(e.length,r);let n=[],i=t;for(;i<r;){let t=e[i],o=null,s=t>239?4:t>223?3:t>191?2:1;if(i+s<=r){let r,n,a,l;switch(s){case 1:t<128&&(o=t);break;case 2:(192&(r=e[i+1]))==128&&(l=(31&t)<<6|63&r)>127&&(o=l);break;case 3:r=e[i+1],n=e[i+2],(192&r)==128&&(192&n)==128&&(l=(15&t)<<12|(63&r)<<6|63&n)>2047&&(l<55296||l>57343)&&(o=l);break;case 4:r=e[i+1],n=e[i+2],a=e[i+3],(192&r)==128&&(192&n)==128&&(192&a)==128&&(l=(15&t)<<18|(63&r)<<12|(63&n)<<6|63&a)>65535&&l<1114112&&(o=l)}}null===o?(o=65533,s=1):o>65535&&(o-=65536,n.push(o>>>10&1023|55296),o=56320|1023&o),n.push(o),i+=s}return x(n)}function x(e){let t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=4096));return r}function P(e,t,r){let n="";r=Math.min(e.length,r);for(let i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function N(e,t,r){let n="";r=Math.min(e.length,r);for(let i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function M(e,t,r){let n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);let i="";for(let n=t;n<r;++n)i+=ei[e[n]];return i}function D(e,t,r){let n=e.slice(t,r),i="";for(let e=0;e<n.length-1;e+=2)i+=String.fromCharCode(n[e]+256*n[e+1]);return i}function k(e,t,r){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>r)throw RangeError("Trying to access beyond buffer length")}function L(e,t,r,n,i,o){if(!s.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw RangeError('"value" argument is out of bounds');if(r+n>e.length)throw RangeError("Index out of range")}function U(e,t,r,n,i){W(t,n,i,e,r,7);let o=Number(t&BigInt(0xffffffff));e[r++]=o,o>>=8,e[r++]=o,o>>=8,e[r++]=o,o>>=8,e[r++]=o;let s=Number(t>>BigInt(32)&BigInt(0xffffffff));return e[r++]=s,s>>=8,e[r++]=s,s>>=8,e[r++]=s,s>>=8,e[r++]=s,r}function B(e,t,r,n,i){W(t,n,i,e,r,7);let o=Number(t&BigInt(0xffffffff));e[r+7]=o,o>>=8,e[r+6]=o,o>>=8,e[r+5]=o,o>>=8,e[r+4]=o;let s=Number(t>>BigInt(32)&BigInt(0xffffffff));return e[r+3]=s,s>>=8,e[r+2]=s,s>>=8,e[r+1]=s,s>>=8,e[r]=s,r+8}function q(e,t,r,n,i,o){if(r+n>e.length||r<0)throw RangeError("Index out of range")}function j(e,t,n,i,o){return t*=1,n>>>=0,o||q(e,t,n,4,34028234663852886e22,-34028234663852886e22),r.write(e,t,n,i,23,4),n+4}function F(e,t,n,i,o){return t*=1,n>>>=0,o||q(e,t,n,8,17976931348623157e292,-17976931348623157e292),r.write(e,t,n,i,52,8),n+8}e.Buffer=s,e.SlowBuffer=y,e.INSPECT_MAX_BYTES=50,e.kMaxLength=0x7fffffff,s.TYPED_ARRAY_SUPPORT=i(),!s.TYPED_ARRAY_SUPPORT&&"u">typeof console&&"function"==typeof console.error&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),nl(i,"typedArraySupport"),Object.defineProperty(s.prototype,"parent",{enumerable:!0,get:nl(function(){if(s.isBuffer(this))return this.buffer},"get")}),Object.defineProperty(s.prototype,"offset",{enumerable:!0,get:nl(function(){if(s.isBuffer(this))return this.byteOffset},"get")}),nl(o,"createBuffer"),nl(s,"Buffer"),s.poolSize=8192,nl(a,"from"),s.from=function(e,t,r){return a(e,t,r)},Object.setPrototypeOf(s.prototype,Uint8Array.prototype),Object.setPrototypeOf(s,Uint8Array),nl(l,"assertSize"),nl(u,"alloc"),s.alloc=function(e,t,r){return u(e,t,r)},nl(c,"allocUnsafe"),s.allocUnsafe=function(e){return c(e)},s.allocUnsafeSlow=function(e){return c(e)},nl(d,"fromString"),nl(h,"fromArrayLike"),nl(p,"fromArrayView"),nl(f,"fromArrayBuffer"),nl(m,"fromObject"),nl(g,"checked"),nl(y,"SlowBuffer"),s.isBuffer=nl(function(e){return null!=e&&!0===e._isBuffer&&e!==s.prototype},"isBuffer"),s.compare=nl(function(e,t){if(er(e,Uint8Array)&&(e=s.from(e,e.offset,e.byteLength)),er(t,Uint8Array)&&(t=s.from(t,t.offset,t.byteLength)),!s.isBuffer(e)||!s.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let r=e.length,n=t.length;for(let i=0,o=Math.min(r,n);i<o;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:+(n<r)},"compare"),s.isEncoding=nl(function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},"isEncoding"),s.concat=nl(function(e,t){let r;if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return s.alloc(0);if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;let n=s.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){let t=e[r];if(er(t,Uint8Array))i+t.length>n.length?(s.isBuffer(t)||(t=s.from(t)),t.copy(n,i)):Uint8Array.prototype.set.call(n,t,i);else if(s.isBuffer(t))t.copy(n,i);else throw TypeError('"list" argument must be an Array of Buffers');i+=t.length}return n},"concat"),nl(_,"byteLength"),s.byteLength=_,nl(v,"slowToString"),s.prototype._isBuffer=!0,nl(E,"swap"),s.prototype.swap16=nl(function(){let e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)E(this,t,t+1);return this},"swap16"),s.prototype.swap32=nl(function(){let e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)E(this,t,t+3),E(this,t+1,t+2);return this},"swap32"),s.prototype.swap64=nl(function(){let e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)E(this,t,t+7),E(this,t+1,t+6),E(this,t+2,t+5),E(this,t+3,t+4);return this},"swap64"),s.prototype.toString=nl(function(){let e=this.length;return 0===e?"":0==arguments.length?R(this,0,e):v.apply(this,arguments)},"toString"),s.prototype.toLocaleString=s.prototype.toString,s.prototype.equals=nl(function(e){if(!s.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===s.compare(this,e)},"equals"),s.prototype.inspect=nl(function(){let t="",r=e.INSPECT_MAX_BYTES;return t=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(t+=" ... "),"<Buffer "+t+">"},"inspect"),n&&(s.prototype[n]=s.prototype.inspect),s.prototype.compare=nl(function(e,t,r,n,i){if(er(e,Uint8Array)&&(e=s.from(e,e.offset,e.byteLength)),!s.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return -1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,i>>>=0,this===e)return 0;let o=i-n,a=r-t,l=Math.min(o,a),u=this.slice(n,i),c=e.slice(t,r);for(let e=0;e<l;++e)if(u[e]!==c[e]){o=u[e],a=c[e];break}return o<a?-1:+(a<o)},"compare"),nl(b,"bidirectionalIndexOf"),nl(S,"arrayIndexOf"),s.prototype.includes=nl(function(e,t,r){return -1!==this.indexOf(e,t,r)},"includes"),s.prototype.indexOf=nl(function(e,t,r){return b(this,e,t,r,!0)},"indexOf"),s.prototype.lastIndexOf=nl(function(e,t,r){return b(this,e,t,r,!1)},"lastIndexOf"),nl(T,"hexWrite"),nl(A,"utf8Write"),nl(C,"asciiWrite"),nl(O,"base64Write"),nl(w,"ucs2Write"),s.prototype.write=nl(function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");n||(n="utf8");let o=!1;for(;;)switch(n){case"hex":return T(this,e,t,r);case"utf8":case"utf-8":return A(this,e,t,r);case"ascii":case"latin1":case"binary":return C(this,e,t,r);case"base64":return O(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return w(this,e,t,r);default:if(o)throw TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},"write"),s.prototype.toJSON=nl(function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},"toJSON"),nl(I,"base64Slice"),nl(R,"utf8Slice"),nl(x,"decodeCodePointsArray"),nl(P,"asciiSlice"),nl(N,"latin1Slice"),nl(M,"hexSlice"),nl(D,"utf16leSlice"),s.prototype.slice=nl(function(e,t){let r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);let n=this.subarray(e,t);return Object.setPrototypeOf(n,s.prototype),n},"slice"),nl(k,"checkOffset"),s.prototype.readUintLE=s.prototype.readUIntLE=nl(function(e,t,r){e>>>=0,t>>>=0,r||k(e,t,this.length);let n=this[e],i=1,o=0;for(;++o<t&&(i*=256);)n+=this[e+o]*i;return n},"readUIntLE"),s.prototype.readUintBE=s.prototype.readUIntBE=nl(function(e,t,r){e>>>=0,t>>>=0,r||k(e,t,this.length);let n=this[e+--t],i=1;for(;t>0&&(i*=256);)n+=this[e+--t]*i;return n},"readUIntBE"),s.prototype.readUint8=s.prototype.readUInt8=nl(function(e,t){return e>>>=0,t||k(e,1,this.length),this[e]},"readUInt8"),s.prototype.readUint16LE=s.prototype.readUInt16LE=nl(function(e,t){return e>>>=0,t||k(e,2,this.length),this[e]|this[e+1]<<8},"readUInt16LE"),s.prototype.readUint16BE=s.prototype.readUInt16BE=nl(function(e,t){return e>>>=0,t||k(e,2,this.length),this[e]<<8|this[e+1]},"readUInt16BE"),s.prototype.readUint32LE=s.prototype.readUInt32LE=nl(function(e,t){return e>>>=0,t||k(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},"readUInt32LE"),s.prototype.readUint32BE=s.prototype.readUInt32BE=nl(function(e,t){return e>>>=0,t||k(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},"readUInt32BE"),s.prototype.readBigUInt64LE=eo(nl(function(e){J(e>>>=0,"offset");let t=this[e],r=this[e+7];(void 0===t||void 0===r)&&K(e,this.length-8);let n=t+256*this[++e]+65536*this[++e]+0x1000000*this[++e],i=this[++e]+256*this[++e]+65536*this[++e]+0x1000000*r;return BigInt(n)+(BigInt(i)<<BigInt(32))},"readBigUInt64LE")),s.prototype.readBigUInt64BE=eo(nl(function(e){J(e>>>=0,"offset");let t=this[e],r=this[e+7];(void 0===t||void 0===r)&&K(e,this.length-8);let n=0x1000000*t+65536*this[++e]+256*this[++e]+this[++e],i=0x1000000*this[++e]+65536*this[++e]+256*this[++e]+r;return(BigInt(n)<<BigInt(32))+BigInt(i)},"readBigUInt64BE")),s.prototype.readIntLE=nl(function(e,t,r){e>>>=0,t>>>=0,r||k(e,t,this.length);let n=this[e],i=1,o=0;for(;++o<t&&(i*=256);)n+=this[e+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},"readIntLE"),s.prototype.readIntBE=nl(function(e,t,r){e>>>=0,t>>>=0,r||k(e,t,this.length);let n=t,i=1,o=this[e+--n];for(;n>0&&(i*=256);)o+=this[e+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},"readIntBE"),s.prototype.readInt8=nl(function(e,t){return e>>>=0,t||k(e,1,this.length),128&this[e]?-((255-this[e]+1)*1):this[e]},"readInt8"),s.prototype.readInt16LE=nl(function(e,t){e>>>=0,t||k(e,2,this.length);let r=this[e]|this[e+1]<<8;return 32768&r?0xffff0000|r:r},"readInt16LE"),s.prototype.readInt16BE=nl(function(e,t){e>>>=0,t||k(e,2,this.length);let r=this[e+1]|this[e]<<8;return 32768&r?0xffff0000|r:r},"readInt16BE"),s.prototype.readInt32LE=nl(function(e,t){return e>>>=0,t||k(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},"readInt32LE"),s.prototype.readInt32BE=nl(function(e,t){return e>>>=0,t||k(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},"readInt32BE"),s.prototype.readBigInt64LE=eo(nl(function(e){J(e>>>=0,"offset");let t=this[e],r=this[e+7];return(void 0===t||void 0===r)&&K(e,this.length-8),(BigInt(this[e+4]+256*this[e+5]+65536*this[e+6]+(r<<24))<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+0x1000000*this[++e])},"readBigInt64LE")),s.prototype.readBigInt64BE=eo(nl(function(e){J(e>>>=0,"offset");let t=this[e],r=this[e+7];return(void 0===t||void 0===r)&&K(e,this.length-8),(BigInt((t<<24)+65536*this[++e]+256*this[++e]+this[++e])<<BigInt(32))+BigInt(0x1000000*this[++e]+65536*this[++e]+256*this[++e]+r)},"readBigInt64BE")),s.prototype.readFloatLE=nl(function(e,t){return e>>>=0,t||k(e,4,this.length),r.read(this,e,!0,23,4)},"readFloatLE"),s.prototype.readFloatBE=nl(function(e,t){return e>>>=0,t||k(e,4,this.length),r.read(this,e,!1,23,4)},"readFloatBE"),s.prototype.readDoubleLE=nl(function(e,t){return e>>>=0,t||k(e,8,this.length),r.read(this,e,!0,52,8)},"readDoubleLE"),s.prototype.readDoubleBE=nl(function(e,t){return e>>>=0,t||k(e,8,this.length),r.read(this,e,!1,52,8)},"readDoubleBE"),nl(L,"checkInt"),s.prototype.writeUintLE=s.prototype.writeUIntLE=nl(function(e,t,r,n){if(e*=1,t>>>=0,r>>>=0,!n){let n=Math.pow(2,8*r)-1;L(this,e,t,r,n,0)}let i=1,o=0;for(this[t]=255&e;++o<r&&(i*=256);)this[t+o]=e/i&255;return t+r},"writeUIntLE"),s.prototype.writeUintBE=s.prototype.writeUIntBE=nl(function(e,t,r,n){if(e*=1,t>>>=0,r>>>=0,!n){let n=Math.pow(2,8*r)-1;L(this,e,t,r,n,0)}let i=r-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+r},"writeUIntBE"),s.prototype.writeUint8=s.prototype.writeUInt8=nl(function(e,t,r){return e*=1,t>>>=0,r||L(this,e,t,1,255,0),this[t]=255&e,t+1},"writeUInt8"),s.prototype.writeUint16LE=s.prototype.writeUInt16LE=nl(function(e,t,r){return e*=1,t>>>=0,r||L(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},"writeUInt16LE"),s.prototype.writeUint16BE=s.prototype.writeUInt16BE=nl(function(e,t,r){return e*=1,t>>>=0,r||L(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},"writeUInt16BE"),s.prototype.writeUint32LE=s.prototype.writeUInt32LE=nl(function(e,t,r){return e*=1,t>>>=0,r||L(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},"writeUInt32LE"),s.prototype.writeUint32BE=s.prototype.writeUInt32BE=nl(function(e,t,r){return e*=1,t>>>=0,r||L(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},"writeUInt32BE"),nl(U,"wrtBigUInt64LE"),nl(B,"wrtBigUInt64BE"),s.prototype.writeBigUInt64LE=eo(nl(function(e,t=0){return U(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))},"writeBigUInt64LE")),s.prototype.writeBigUInt64BE=eo(nl(function(e,t=0){return B(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))},"writeBigUInt64BE")),s.prototype.writeIntLE=nl(function(e,t,r,n){if(e*=1,t>>>=0,!n){let n=Math.pow(2,8*r-1);L(this,e,t,r,n-1,-n)}let i=0,o=1,s=0;for(this[t]=255&e;++i<r&&(o*=256);)e<0&&0===s&&0!==this[t+i-1]&&(s=1),this[t+i]=(e/o|0)-s&255;return t+r},"writeIntLE"),s.prototype.writeIntBE=nl(function(e,t,r,n){if(e*=1,t>>>=0,!n){let n=Math.pow(2,8*r-1);L(this,e,t,r,n-1,-n)}let i=r-1,o=1,s=0;for(this[t+i]=255&e;--i>=0&&(o*=256);)e<0&&0===s&&0!==this[t+i+1]&&(s=1),this[t+i]=(e/o|0)-s&255;return t+r},"writeIntBE"),s.prototype.writeInt8=nl(function(e,t,r){return e*=1,t>>>=0,r||L(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},"writeInt8"),s.prototype.writeInt16LE=nl(function(e,t,r){return e*=1,t>>>=0,r||L(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},"writeInt16LE"),s.prototype.writeInt16BE=nl(function(e,t,r){return e*=1,t>>>=0,r||L(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},"writeInt16BE"),s.prototype.writeInt32LE=nl(function(e,t,r){return e*=1,t>>>=0,r||L(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},"writeInt32LE"),s.prototype.writeInt32BE=nl(function(e,t,r){return e*=1,t>>>=0,r||L(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},"writeInt32BE"),s.prototype.writeBigInt64LE=eo(nl(function(e,t=0){return U(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))},"writeBigInt64LE")),s.prototype.writeBigInt64BE=eo(nl(function(e,t=0){return B(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))},"writeBigInt64BE")),nl(q,"checkIEEE754"),nl(j,"writeFloat"),s.prototype.writeFloatLE=nl(function(e,t,r){return j(this,e,t,!0,r)},"writeFloatLE"),s.prototype.writeFloatBE=nl(function(e,t,r){return j(this,e,t,!1,r)},"writeFloatBE"),nl(F,"writeDouble"),s.prototype.writeDoubleLE=nl(function(e,t,r){return F(this,e,t,!0,r)},"writeDoubleLE"),s.prototype.writeDoubleBE=nl(function(e,t,r){return F(this,e,t,!1,r)},"writeDoubleBE"),s.prototype.copy=nl(function(e,t,r,n){if(!s.isBuffer(e))throw TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw RangeError("Index out of range");if(n<0)throw RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);let i=n-r;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,r,n):Uint8Array.prototype.set.call(e,this.subarray(r,n),t),i},"copy"),s.prototype.fill=nl(function(e,t,r,n){let i;if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw TypeError("encoding must be a string");if("string"==typeof n&&!s.isEncoding(n))throw TypeError("Unknown encoding: "+n);if(1===e.length){let t=e.charCodeAt(0);("utf8"===n&&t<128||"latin1"===n)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw RangeError("Out of range index");if(r<=t)return this;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{let o=s.isBuffer(e)?e:s.from(e,n),a=o.length;if(0===a)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<r-t;++i)this[i+t]=o[i%a]}return this},"fill");var G={};function H(e,t,r){var n;G[e]=(nl(n=class extends r{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}},"NodeError"),n)}function $(e){let t="",r=e.length,n=+("-"===e[0]);for(;r>=n+4;r-=3)t=`_${e.slice(r-3,r)}${t}`;return`${e.slice(0,r)}${t}`}function V(e,t,r){J(t,"offset"),(void 0===e[t]||void 0===e[t+r])&&K(t,e.length-(r+1))}function W(e,t,r,n,i,o){if(e>r||e<t){let n="bigint"==typeof t?"n":"",i;throw i=o>3?0===t||t===BigInt(0)?`>= 0${n} and < 2${n} ** ${(o+1)*8}${n}`:`>= -(2${n} ** ${(o+1)*8-1}${n}) and \
< 2 ** ${(o+1)*8-1}${n}`:`>= ${t}${n} and <= ${r}${n}`,new G.ERR_OUT_OF_RANGE("value",i,e)}V(n,i,o)}function J(e,t){if("number"!=typeof e)throw new G.ERR_INVALID_ARG_TYPE(t,"number",e)}function K(e,t,r){throw Math.floor(e)!==e?(J(e,r),new G.ERR_OUT_OF_RANGE(r||"offset","an integer",e)):t<0?new G.ERR_BUFFER_OUT_OF_BOUNDS:new G.ERR_OUT_OF_RANGE(r||"offset",`>= ${+!!r} and <= ${t}`,e)}nl(H,"E"),H("ERR_BUFFER_OUT_OF_BOUNDS",function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),H("ERR_INVALID_ARG_TYPE",function(e,t){return`The "${e}" argum\
ent must be of type number. Received type ${typeof t}`},TypeError),H("ERR_OUT_OF_RANGE",function(e,t,r){let n=`The value of "${e}" is out of range.`,i=r;return Number.isInteger(r)&&Math.abs(r)>0x100000000?i=$(String(r)):"bigint"==typeof r&&(i=String(r),(r>BigInt(2)**BigInt(32)||r<-(BigInt(2)**BigInt(32)))&&(i=$(i)),i+="n"),n+=` It\
 must be ${t}. Received ${i}`},RangeError),nl($,"addNumericalSeparator"),nl(V,"checkBounds"),nl(W,"checkIntBI"),nl(J,"validateNumber"),nl(K,"boundsError");var Y=/[^+/0-9A-Za-z-_]/g;function Q(e){if((e=(e=e.split("=")[0]).trim().replace(Y,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}function z(e,t){t=t||1/0;let r,n=e.length,i=null,o=[];for(let s=0;s<n;++s){if((r=e.charCodeAt(s))>55295&&r<57344){if(!i){if(r>56319||s+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=(i-55296<<10|r-56320)+65536}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else if(r<1114112){if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else throw Error("Invalid code point")}return o}function X(e){let t=[];for(let r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}function Z(e,t){let r,n,i=[];for(let o=0;o<e.length&&!((t-=2)<0);++o)n=(r=e.charCodeAt(o))>>8,i.push(r%256),i.push(n);return i}function ee(e){return t.toByteArray(Q(e))}function et(e,t,r,n){let i;for(i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function er(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function en(e){return e!=e}nl(Q,"base64clean"),nl(z,"utf8ToBytes"),nl(X,"asciiToBytes"),nl(Z,"utf16leToBytes"),nl(ee,"base64ToBytes"),nl(et,"blitBuffer"),nl(er,"isInstance"),nl(en,"numberIsNaN");var ei=function(){let e="0123456789abcdef",t=Array(256);for(let r=0;r<16;++r){let n=16*r;for(let i=0;i<16;++i)t[n+i]=e[r]+e[i]}return t}();function eo(e){return typeof BigInt>"u"?es:e}function es(){throw Error("BigInt not supported")}nl(eo,"defineBigIntMethod"),nl(es,"BufferBigIntNotDefined")}),nv=nu(()=>{r4=globalThis,r9=globalThis.setImmediate??(e=>setTimeout(e,0)),globalThis.clearImmediate??(e=>clearTimeout(e)),(r7=globalThis.crypto??{}).subtle??(r7.subtle={}),ne="function"==typeof globalThis.Buffer&&"function"==typeof globalThis.Buffer.allocUnsafe?globalThis.Buffer:n_().Buffer,(nt=globalThis.process??{}).env??(nt.env={});try{nt.nextTick(()=>{})}catch{let e=Promise.resolve();nt.nextTick=e.then.bind(e)}}),nE=nc((e,t)=>{nv();var r,n="object"==typeof Reflect?Reflect:null,i=n&&"function"==typeof n.apply?n.apply:nl(function(e,t,r){return Function.prototype.apply.call(e,t,r)},"ReflectApply");function o(e){console&&console.warn&&console.warn(e)}r=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?nl(function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))},"ReflectOwnKeys"):nl(function(e){return Object.getOwnPropertyNames(e)},"ReflectOwnKeys"),nl(o,"ProcessEmitWarning");var s=Number.isNaN||nl(function(e){return e!=e},"NumberIsNaN");function a(){a.init.call(this)}nl(a,"EventEmitter"),t.exports=a,t.exports.once=v,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var l=10;function u(e){if("function"!=typeof e)throw TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function d(e,t,r,n){var i,s,a;if(u(r),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),s=e._events),a=s[t]),void 0===a)a=s[t]=r,++e._eventsCount;else if("function"==typeof a?a=s[t]=n?[r,a]:[a,r]:n?a.unshift(r):a.push(r),(i=c(e))>0&&a.length>i&&!a.warned){a.warned=!0;var l=Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=a.length,o(l)}return e}function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0==arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=h.bind(n);return i.listener=r,n.wrapFn=i,i}function f(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?_(i):g(i,i.length)}function m(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function g(e,t){for(var r=Array(t),n=0;n<t;++n)r[n]=e[n];return r}function y(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function _(e){for(var t=Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}function v(e,t){return new Promise(function(r,n){function i(r){e.removeListener(t,o),n(r)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),r([].slice.call(arguments))}nl(i,"errorListener"),nl(o,"resolver"),b(e,t,o,{once:!0}),"error"!==t&&E(e,i,{once:!0})})}function E(e,t,r){"function"==typeof e.on&&b(e,"error",t,r)}function b(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else if("function"==typeof e.addEventListener)e.addEventListener(t,nl(function i(o){n.once&&e.removeEventListener(t,i),r(o)},"wrapListener"));else throw TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}nl(u,"checkListener"),Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:nl(function(){return l},"get"),set:nl(function(e){if("number"!=typeof e||e<0||s(e))throw RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");l=e},"set")}),a.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=nl(function(e){if("number"!=typeof e||e<0||s(e))throw RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},"setMaxListeners"),nl(c,"_getMaxListeners"),a.prototype.getMaxListeners=nl(function(){return c(this)},"getMaxListeners"),a.prototype.emit=nl(function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,o=this._events;if(void 0!==o)n=n&&void 0===o.error;else if(!n)return!1;if(n){if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var s,a=Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var l=o[e];if(void 0===l)return!1;if("function"==typeof l)i(l,this,t);else for(var u=l.length,c=g(l,u),r=0;r<u;++r)i(c[r],this,t);return!0},"emit"),nl(d,"_addListener"),a.prototype.addListener=nl(function(e,t){return d(this,e,t,!1)},"addListener"),a.prototype.on=a.prototype.addListener,a.prototype.prependListener=nl(function(e,t){return d(this,e,t,!0)},"prependListener"),nl(h,"onceWrapper"),nl(p,"_onceWrap"),a.prototype.once=nl(function(e,t){return u(t),this.on(e,p(this,e,t)),this},"once"),a.prototype.prependOnceListener=nl(function(e,t){return u(t),this.prependListener(e,p(this,e,t)),this},"prependOnceListener"),a.prototype.removeListener=nl(function(e,t){var r,n,i,o,s;if(u(t),void 0===(n=this._events)||void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,o=r.length-1;o>=0;o--)if(r[o]===t||r[o].listener===t){s=r[o].listener,i=o;break}if(i<0)return this;0===i?r.shift():y(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,s||t)}return this},"removeListener"),a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=nl(function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0==arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0==arguments.length){var i,o=Object.keys(r);for(n=0;n<o.length;++n)"removeListener"!==(i=o[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},"removeAllListeners"),nl(f,"_listeners"),a.prototype.listeners=nl(function(e){return f(this,e,!0)},"listeners"),a.prototype.rawListeners=nl(function(e){return f(this,e,!1)},"rawListeners"),a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},a.prototype.listenerCount=m,nl(m,"listenerCount"),a.prototype.eventNames=nl(function(){return this._eventsCount>0?r(this._events):[]},"eventNames"),nl(g,"arrayClone"),nl(y,"spliceOne"),nl(_,"unwrapListeners"),nl(v,"once"),nl(E,"addErrorHandlerIfEventEmitter"),nl(b,"eventTargetAgnosticAddListener")}),nb={};nd(nb,{default:()=>nS});var nS,nT=nu(()=>{nv(),nS={}});function nA(e){let t=0x6a09e667,r=0xbb67ae85,n=0x3c6ef372,i=0xa54ff53a,o=0x510e527f,s=0x9b05688c,a=0x1f83d9ab,l=0x5be0cd19,u=0,c=0,d=[0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2],h=nl((e,t)=>e>>>t|e<<32-t,"rrot"),p=new Uint32Array(64),f=new Uint8Array(64),m=nl(()=>{for(let e=0,t=0;e<16;e++,t+=4)p[e]=f[t]<<24|f[t+1]<<16|f[t+2]<<8|f[t+3];for(let e=16;e<64;e++){let t=h(p[e-15],7)^h(p[e-15],18)^p[e-15]>>>3,r=h(p[e-2],17)^h(p[e-2],19)^p[e-2]>>>10;p[e]=p[e-16]+t+p[e-7]+r|0}let e=t,u=r,m=n,g=i,y=o,_=s,v=a,E=l;for(let t=0;t<64;t++){let r=E+(h(y,6)^h(y,11)^h(y,25))+(y&_^~y&v)+d[t]+p[t]|0,n=(h(e,2)^h(e,13)^h(e,22))+(e&u^e&m^u&m)|0;E=v,v=_,_=y,y=g+r|0,g=m,m=u,u=e,e=r+n|0}t=t+e|0,r=r+u|0,n=n+m|0,i=i+g|0,o=o+y|0,s=s+_|0,a=a+v|0,l=l+E|0,c=0},"process"),g=nl(e=>{"string"==typeof e&&(e=new TextEncoder().encode(e));for(let t=0;t<e.length;t++)f[c++]=e[t],64===c&&m();u+=e.length},"add"),y=nl(()=>{if(f[c++]=128,64==c&&m(),c+8>64){for(;c<64;)f[c++]=0;m()}for(;c<58;)f[c++]=0;let e=8*u;f[c++]=e/0x10000000000&255,f[c++]=e/0x100000000&255,f[c++]=e>>>24,f[c++]=e>>>16&255,f[c++]=e>>>8&255,f[c++]=255&e,m();let d=new Uint8Array(32);return d[0]=t>>>24,d[1]=t>>>16&255,d[2]=t>>>8&255,d[3]=255&t,d[4]=r>>>24,d[5]=r>>>16&255,d[6]=r>>>8&255,d[7]=255&r,d[8]=n>>>24,d[9]=n>>>16&255,d[10]=n>>>8&255,d[11]=255&n,d[12]=i>>>24,d[13]=i>>>16&255,d[14]=i>>>8&255,d[15]=255&i,d[16]=o>>>24,d[17]=o>>>16&255,d[18]=o>>>8&255,d[19]=255&o,d[20]=s>>>24,d[21]=s>>>16&255,d[22]=s>>>8&255,d[23]=255&s,d[24]=a>>>24,d[25]=a>>>16&255,d[26]=a>>>8&255,d[27]=255&a,d[28]=l>>>24,d[29]=l>>>16&255,d[30]=l>>>8&255,d[31]=255&l,d},"digest");return void 0===e?{add:g,digest:y}:(g(e),y())}var nC,nO,nw=nu(()=>{nv(),nl(nA,"sha256")}),nI=nu(()=>{nv(),nl(nC=class e{constructor(){nm(this,"_dataLength",0),nm(this,"_bufferLength",0),nm(this,"_state",new Int32Array(4)),nm(this,"_buffer",new ArrayBuffer(68)),nm(this,"_buffer8"),nm(this,"_buffer32"),this._buffer8=new Uint8Array(this._buffer,0,68),this._buffer32=new Uint32Array(this._buffer,0,17),this.start()}static hashByteArray(e,t=!1){return this.onePassHasher.start().appendByteArray(e).end(t)}static hashStr(e,t=!1){return this.onePassHasher.start().appendStr(e).end(t)}static hashAsciiStr(e,t=!1){return this.onePassHasher.start().appendAsciiStr(e).end(t)}static _hex(t){let r=e.hexChars,n=e.hexOut,i,o,s,a;for(a=0;a<4;a+=1)for(o=8*a,i=t[a],s=0;s<8;s+=2)n[o+1+s]=r.charAt(15&i),i>>>=4,n[o+0+s]=r.charAt(15&i),i>>>=4;return n.join("")}static _md5cycle(e,t){let r=e[0],n=e[1],i=e[2],o=e[3];r+=(n&i|~n&o)+t[0]-0x28955b88|0,o+=((r=(r<<7|r>>>25)+n|0)&n|~r&i)+t[1]-0x173848aa|0,i+=((o=(o<<12|o>>>20)+r|0)&r|~o&n)+t[2]+0x242070db|0,n+=((i=(i<<17|i>>>15)+o|0)&o|~i&r)+t[3]-0x3e423112|0,r+=((n=(n<<22|n>>>10)+i|0)&i|~n&o)+t[4]-0xa83f051|0,o+=((r=(r<<7|r>>>25)+n|0)&n|~r&i)+t[5]+0x4787c62a|0,i+=((o=(o<<12|o>>>20)+r|0)&r|~o&n)+t[6]-0x57cfb9ed|0,n+=((i=(i<<17|i>>>15)+o|0)&o|~i&r)+t[7]-0x2b96aff|0,r+=((n=(n<<22|n>>>10)+i|0)&i|~n&o)+t[8]+0x698098d8|0,o+=((r=(r<<7|r>>>25)+n|0)&n|~r&i)+t[9]-0x74bb0851|0,i+=((o=(o<<12|o>>>20)+r|0)&r|~o&n)+t[10]-42063|0,n+=((i=(i<<17|i>>>15)+o|0)&o|~i&r)+t[11]-0x76a32842|0,r+=((n=(n<<22|n>>>10)+i|0)&i|~n&o)+t[12]+0x6b901122|0,o+=((r=(r<<7|r>>>25)+n|0)&n|~r&i)+t[13]-0x2678e6d|0,i+=((o=(o<<12|o>>>20)+r|0)&r|~o&n)+t[14]-0x5986bc72|0,n+=((i=(i<<17|i>>>15)+o|0)&o|~i&r)+t[15]+0x49b40821|0,r+=((n=(n<<22|n>>>10)+i|0)&o|i&~o)+t[1]-0x9e1da9e|0,o+=((r=(r<<5|r>>>27)+n|0)&i|n&~i)+t[6]-0x3fbf4cc0|0,i+=((o=(o<<9|o>>>23)+r|0)&n|r&~n)+t[11]+0x265e5a51|0,n+=((i=(i<<14|i>>>18)+o|0)&r|o&~r)+t[0]-0x16493856|0,r+=((n=(n<<20|n>>>12)+i|0)&o|i&~o)+t[5]-0x29d0efa3|0,o+=((r=(r<<5|r>>>27)+n|0)&i|n&~i)+t[10]+0x2441453|0,i+=((o=(o<<9|o>>>23)+r|0)&n|r&~n)+t[15]-0x275e197f|0,n+=((i=(i<<14|i>>>18)+o|0)&r|o&~r)+t[4]-0x182c0438|0,r+=((n=(n<<20|n>>>12)+i|0)&o|i&~o)+t[9]+0x21e1cde6|0,o+=((r=(r<<5|r>>>27)+n|0)&i|n&~i)+t[14]-0x3cc8f82a|0,i+=((o=(o<<9|o>>>23)+r|0)&n|r&~n)+t[3]-0xb2af279|0,n+=((i=(i<<14|i>>>18)+o|0)&r|o&~r)+t[8]+0x455a14ed|0,r+=((n=(n<<20|n>>>12)+i|0)&o|i&~o)+t[13]-0x561c16fb|0,o+=((r=(r<<5|r>>>27)+n|0)&i|n&~i)+t[2]-0x3105c08|0,i+=((o=(o<<9|o>>>23)+r|0)&n|r&~n)+t[7]+0x676f02d9|0,n+=((i=(i<<14|i>>>18)+o|0)&r|o&~r)+t[12]-0x72d5b376|0,r+=((n=(n<<20|n>>>12)+i|0)^i^o)+t[5]-378558|0,o+=((r=(r<<4|r>>>28)+n|0)^n^i)+t[8]-0x788e097f|0,i+=((o=(o<<11|o>>>21)+r|0)^r^n)+t[11]+0x6d9d6122|0,n+=((i=(i<<16|i>>>16)+o|0)^o^r)+t[14]-0x21ac7f4|0,r+=((n=(n<<23|n>>>9)+i|0)^i^o)+t[1]-0x5b4115bc|0,o+=((r=(r<<4|r>>>28)+n|0)^n^i)+t[4]+0x4bdecfa9|0,i+=((o=(o<<11|o>>>21)+r|0)^r^n)+t[7]-0x944b4a0|0,n+=((i=(i<<16|i>>>16)+o|0)^o^r)+t[10]-0x41404390|0,r+=((n=(n<<23|n>>>9)+i|0)^i^o)+t[13]+0x289b7ec6|0,o+=((r=(r<<4|r>>>28)+n|0)^n^i)+t[0]-0x155ed806|0,i+=((o=(o<<11|o>>>21)+r|0)^r^n)+t[3]-0x2b10cf7b|0,n+=((i=(i<<16|i>>>16)+o|0)^o^r)+t[6]+0x4881d05|0,r+=((n=(n<<23|n>>>9)+i|0)^i^o)+t[9]-0x262b2fc7|0,o+=((r=(r<<4|r>>>28)+n|0)^n^i)+t[12]-0x1924661b|0,i+=((o=(o<<11|o>>>21)+r|0)^r^n)+t[15]+0x1fa27cf8|0,n+=((i=(i<<16|i>>>16)+o|0)^o^r)+t[2]-0x3b53a99b|0,n=(n<<23|n>>>9)+i|0,r+=(i^(n|~o))+t[0]-0xbd6ddbc|0,r=(r<<6|r>>>26)+n|0,o+=(n^(r|~i))+t[7]+0x432aff97|0,o=(o<<10|o>>>22)+r|0,i+=(r^(o|~n))+t[14]-0x546bdc59|0,i=(i<<15|i>>>17)+o|0,n+=(o^(i|~r))+t[5]-0x36c5fc7|0,n=(n<<21|n>>>11)+i|0,r+=(i^(n|~o))+t[12]+0x655b59c3|0,r=(r<<6|r>>>26)+n|0,o+=(n^(r|~i))+t[3]-0x70f3336e|0,o=(o<<10|o>>>22)+r|0,i+=(r^(o|~n))+t[10]-1051523|0,i=(i<<15|i>>>17)+o|0,n+=(o^(i|~r))+t[1]-0x7a7ba22f|0,n=(n<<21|n>>>11)+i|0,r+=(i^(n|~o))+t[8]+0x6fa87e4f|0,r=(r<<6|r>>>26)+n|0,o+=(n^(r|~i))+t[15]-0x1d31920|0,o=(o<<10|o>>>22)+r|0,i+=(r^(o|~n))+t[6]-0x5cfebcec|0,i=(i<<15|i>>>17)+o|0,n+=(o^(i|~r))+t[13]+0x4e0811a1|0,n=(n<<21|n>>>11)+i|0,r+=(i^(n|~o))+t[4]-0x8ac817e|0,r=(r<<6|r>>>26)+n|0,o+=(n^(r|~i))+t[11]-0x42c50dcb|0,o=(o<<10|o>>>22)+r|0,i+=(r^(o|~n))+t[2]+0x2ad7d2bb|0,i=(i<<15|i>>>17)+o|0,n+=(o^(i|~r))+t[9]-0x14792c6f|0,n=(n<<21|n>>>11)+i|0,e[0]=r+e[0]|0,e[1]=n+e[1]|0,e[2]=i+e[2]|0,e[3]=o+e[3]|0}start(){return this._dataLength=0,this._bufferLength=0,this._state.set(e.stateIdentity),this}appendStr(t){let r=this._buffer8,n=this._buffer32,i=this._bufferLength,o,s;for(s=0;s<t.length;s+=1){if((o=t.charCodeAt(s))<128)r[i++]=o;else if(o<2048)r[i++]=(o>>>6)+192,r[i++]=63&o|128;else if(o<55296||o>56319)r[i++]=(o>>>12)+224,r[i++]=o>>>6&63|128,r[i++]=63&o|128;else{if((o=(o-55296)*1024+(t.charCodeAt(++s)-56320)+65536)>1114111)throw Error("Unicode standard supports code points up to U+10FFFF");r[i++]=(o>>>18)+240,r[i++]=o>>>12&63|128,r[i++]=o>>>6&63|128,r[i++]=63&o|128}i>=64&&(this._dataLength+=64,e._md5cycle(this._state,n),i-=64,n[0]=n[16])}return this._bufferLength=i,this}appendAsciiStr(t){let r=this._buffer8,n=this._buffer32,i=this._bufferLength,o,s=0;for(;;){for(o=Math.min(t.length-s,64-i);o--;)r[i++]=t.charCodeAt(s++);if(i<64)break;this._dataLength+=64,e._md5cycle(this._state,n),i=0}return this._bufferLength=i,this}appendByteArray(t){let r=this._buffer8,n=this._buffer32,i=this._bufferLength,o,s=0;for(;;){for(o=Math.min(t.length-s,64-i);o--;)r[i++]=t[s++];if(i<64)break;this._dataLength+=64,e._md5cycle(this._state,n),i=0}return this._bufferLength=i,this}getState(){let e=this._state;return{buffer:String.fromCharCode.apply(null,Array.from(this._buffer8)),buflen:this._bufferLength,length:this._dataLength,state:[e[0],e[1],e[2],e[3]]}}setState(e){let t=e.buffer,r=e.state,n=this._state,i;for(this._dataLength=e.length,this._bufferLength=e.buflen,n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],i=0;i<t.length;i+=1)this._buffer8[i]=t.charCodeAt(i)}end(t=!1){let r=this._bufferLength,n=this._buffer8,i=this._buffer32,o=(r>>2)+1;this._dataLength+=r;let s=8*this._dataLength;if(n[r]=128,n[r+1]=n[r+2]=n[r+3]=0,i.set(e.buffer32Identity.subarray(o),o),r>55&&(e._md5cycle(this._state,i),i.set(e.buffer32Identity)),s<=0xffffffff)i[14]=s;else{let e=s.toString(16).match(/(.*?)(.{0,8})$/);if(null===e)return;let t=parseInt(e[2],16),r=parseInt(e[1],16)||0;i[14]=t,i[15]=r}return e._md5cycle(this._state,i),t?this._state:e._hex(this._state)}},"Md5"),nm(nC,"stateIdentity",new Int32Array([0x67452301,-0x10325477,-0x67452302,0x10325476])),nm(nC,"buffer32Identity",new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])),nm(nC,"hexChars","0123456789abcdef"),nm(nC,"hexOut",[]),nm(nC,"onePassHasher",new nC),nO=nC}),nR={};function nx(e){return r7.getRandomValues(ne.alloc(e))}function nP(e){if("sha256"===e)return{update:nl(function(e){return{digest:nl(function(){return ne.from(nA(e))},"digest")}},"update")};if("md5"===e)return{update:nl(function(e){return{digest:nl(function(){return"string"==typeof e?nO.hashStr(e):nO.hashByteArray(e)},"digest")}},"update")};throw Error(`Hash type '${e}' not supported`)}function nN(e,t){if("sha256"!==e)throw Error(`Only sha256 is supported (requested: '${e}')`);return{update:nl(function(e){return{digest:nl(function(){"string"==typeof t&&(t=new TextEncoder().encode(t)),"string"==typeof e&&(e=new TextEncoder().encode(e));let r=t.length;if(r>64)t=nA(t);else if(r<64){let e=new Uint8Array(64);e.set(t),t=e}let n=new Uint8Array(64),i=new Uint8Array(64);for(let e=0;e<64;e++)n[e]=54^t[e],i[e]=92^t[e];let o=new Uint8Array(e.length+64);o.set(n,0),o.set(e,64);let s=new Uint8Array(96);return s.set(i,0),s.set(nA(o),64),ne.from(nA(s))},"digest")}},"update")}}nd(nR,{createHash:()=>nP,createHmac:()=>nN,randomBytes:()=>nx});var nM=nu(()=>{nv(),nw(),nI(),nl(nx,"randomBytes"),nl(nP,"createHash"),nl(nN,"createHmac")}),nD=nc(e=>{nv(),e.parse=function(e,t){return new r(e,t).parse()};var t=class e{constructor(e,t){this.source=e,this.transform=t||n,this.position=0,this.entries=[],this.recorded=[],this.dimension=0}isEof(){return this.position>=this.source.length}nextCharacter(){var e=this.source[this.position++];return"\\"===e?{value:this.source[this.position++],escaped:!0}:{value:e,escaped:!1}}record(e){this.recorded.push(e)}newEntry(e){var t;(this.recorded.length>0||e)&&("NULL"!==(t=this.recorded.join(""))||e||(t=null),null!==t&&(t=this.transform(t)),this.entries.push(t),this.recorded=[])}consumeDimensions(){if("["===this.source[0])for(;!this.isEof()&&"="!==this.nextCharacter().value;);}parse(t){var r,n,i;for(this.consumeDimensions();!this.isEof();)if("{"!==(r=this.nextCharacter()).value||i){if("}"!==r.value||i)'"'!==r.value||r.escaped?","!==r.value||i?this.record(r.value):this.newEntry():(i&&this.newEntry(!0),i=!i);else if(this.dimension--,!this.dimension&&(this.newEntry(),t))return this.entries}else this.dimension++,this.dimension>1&&(n=new e(this.source.substr(this.position-1),this.transform),this.entries.push(n.parse(!0)),this.position+=n.position-2);if(0!==this.dimension)throw Error("array dimension not balanced");return this.entries}};nl(t,"ArrayParser");var r=t;function n(e){return e}nl(n,"identity")}),nk=nc((e,t)=>{nv();var r=nD();t.exports={create:nl(function(e,t){return{parse:nl(function(){return r.parse(e,t)},"parse")}},"create")}}),nL=nc((e,t)=>{nv();var r=/(\d{1,})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})(\.\d{1,})?.*?( BC)?$/,n=/^(\d{1,})-(\d{2})-(\d{2})( BC)?$/,i=/([Z+-])(\d{2})?:?(\d{2})?:?(\d{2})?/,o=/^-?infinity$/;function s(e){var t=n.exec(e);if(t){var r=parseInt(t[1],10);t[4]&&(r=l(r));var i=new Date(r,parseInt(t[2],10)-1,t[3]);return u(r)&&i.setFullYear(r),i}}function a(e){if(e.endsWith("+00"))return 0;var t=i.exec(e.split(" ")[1]);if(t){var r=t[1];return"Z"===r?0:(3600*parseInt(t[2],10)+60*parseInt(t[3]||0,10)+parseInt(t[4]||0,10))*("-"===r?-1:1)*1e3}}function l(e){return-(e-1)}function u(e){return e>=0&&e<100}t.exports=nl(function(e){if(o.test(e))return Number(e.replace("i","I"));var t=r.exec(e);if(!t)return s(e)||null;var n=!!t[8],i=parseInt(t[1],10);n&&(i=l(i));var c=parseInt(t[2],10)-1,d=t[3],h=parseInt(t[4],10),p=parseInt(t[5],10),f=parseInt(t[6],10),m=t[7];m=m?1e3*parseFloat(m):0;var g,y=a(e);return null!=y?(g=new Date(Date.UTC(i,c,d,h,p,f,m)),u(i)&&g.setUTCFullYear(i),0!==y&&g.setTime(g.getTime()-y)):(g=new Date(i,c,d,h,p,f,m),u(i)&&g.setFullYear(i)),g},"parseDate"),nl(s,"getDate"),nl(a,"timeZoneOffset"),nl(l,"bcYearToNegativeYear"),nl(u,"is0To99")}),nU=nc((e,t)=>{nv(),t.exports=n;var r=Object.prototype.hasOwnProperty;function n(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)r.call(n,i)&&(e[i]=n[i])}return e}nl(n,"extend")}),nB=nc((e,t)=>{nv();var r=nU();function n(e){if(!(this instanceof n))return new n(e);r(this,p(e))}t.exports=n,nl(n,"PostgresInterval");var i=["seconds","minutes","hours","days","months","years"];n.prototype.toPostgres=function(){var e=i.filter(this.hasOwnProperty,this);return this.milliseconds&&0>e.indexOf("seconds")&&e.push("seconds"),0===e.length?"0":e.map(function(e){var t=this[e]||0;return"seconds"===e&&this.milliseconds&&(t=(t+this.milliseconds/1e3).toFixed(6).replace(/\.?0+$/,"")),t+" "+e},this).join(" ")};var o={years:"Y",months:"M",days:"D",hours:"H",minutes:"M",seconds:"S"},s=["years","months","days"],a=["hours","minutes","seconds"];n.prototype.toISOString=n.prototype.toISO=function(){return"P"+s.map(e,this).join("")+"T"+a.map(e,this).join("");function e(e){var t=this[e]||0;return"seconds"===e&&this.milliseconds&&(t=(t+this.milliseconds/1e3).toFixed(6).replace(/0+$/,"")),t+o[e]}};var l="([+-]?\\d+)",u=new RegExp([l+"\\s+years?",l+"\\s+mons?",l+"\\s+days?","([+-])?([\\d]*):(\\d\\d):(\\d\\d)\\.?(\\d{1,6})?"].map(function(e){return"("+e+")?"}).join("\\s*")),c={years:2,months:4,days:6,hours:9,minutes:10,seconds:11,milliseconds:12},d=["hours","minutes","seconds","milliseconds"];function h(e){return parseInt(e+"000000".slice(e.length),10)/1e3}function p(e){if(!e)return{};var t=u.exec(e),r="-"===t[8];return Object.keys(c).reduce(function(e,n){var i=t[c[n]];return i&&(i="milliseconds"===n?h(i):parseInt(i,10))&&(r&&~d.indexOf(n)&&(i*=-1),e[n]=i),e},{})}nl(h,"parseMilliseconds"),nl(p,"parse")}),nq=nc((e,t)=>{nv(),t.exports=nl(function(e){if(/^\\x/.test(e))return new ne(e.substr(2),"hex");for(var t="",r=0;r<e.length;)if("\\"!==e[r])t+=e[r],++r;else if(/[0-7]{3}/.test(e.substr(r+1,3)))t+=String.fromCharCode(parseInt(e.substr(r+1,3),8)),r+=4;else{for(var n=1;r+n<e.length&&"\\"===e[r+n];)n++;for(var i=0;i<Math.floor(n/2);++i)t+="\\";r+=2*Math.floor(n/2)}return new ne(t,"binary")},"parseBytea")}),nj=nc((e,t)=>{nv();var r=nD(),n=nk(),i=nL(),o=nB(),s=nq();function a(e){return nl(function(t){return null===t?t:e(t)},"nullAllowed")}function l(e){return null===e?e:"TRUE"===e||"t"===e||"true"===e||"y"===e||"yes"===e||"on"===e||"1"===e}function u(e){return e?r.parse(e,l):null}function c(e){return parseInt(e,10)}function d(e){return e?r.parse(e,a(c)):null}function h(e){return e?r.parse(e,a(function(e){return E(e).trim()})):null}nl(a,"allowNull"),nl(l,"parseBool"),nl(u,"parseBoolArray"),nl(c,"parseBaseTenInt"),nl(d,"parseIntegerArray"),nl(h,"parseBigIntegerArray");var p=nl(function(e){return e?n.create(e,function(e){return null!==e&&(e=S(e)),e}).parse():null},"parsePointArray"),f=nl(function(e){return e?n.create(e,function(e){return null!==e&&(e=parseFloat(e)),e}).parse():null},"parseFloatArray"),m=nl(function(e){return e?n.create(e).parse():null},"parseStringArray"),g=nl(function(e){return e?n.create(e,function(e){return null!==e&&(e=i(e)),e}).parse():null},"parseDateArray"),y=nl(function(e){return e?n.create(e,function(e){return null!==e&&(e=o(e)),e}).parse():null},"parseIntervalArray"),_=nl(function(e){return e?r.parse(e,a(s)):null},"parseByteAArray"),v=nl(function(e){return parseInt(e,10)},"parseInteger"),E=nl(function(e){var t=String(e);return/^\d+$/.test(t)?t:e},"parseBigInteger"),b=nl(function(e){return e?r.parse(e,a(JSON.parse)):null},"parseJsonArray"),S=nl(function(e){return"("!==e[0]?null:{x:parseFloat((e=e.substring(1,e.length-1).split(","))[0]),y:parseFloat(e[1])}},"parsePoint"),T=nl(function(e){if("<"!==e[0]&&"("!==e[1])return null;for(var t="(",r="",n=!1,i=2;i<e.length-1;i++){if(n||(t+=e[i]),")"===e[i]){n=!0;continue}n&&","!==e[i]&&(r+=e[i])}var o=S(t);return o.radius=parseFloat(r),o},"parseCircle");t.exports={init:nl(function(e){e(20,E),e(21,v),e(23,v),e(26,v),e(700,parseFloat),e(701,parseFloat),e(16,l),e(1082,i),e(1114,i),e(1184,i),e(600,S),e(651,m),e(718,T),e(1e3,u),e(1001,_),e(1005,d),e(1007,d),e(1028,d),e(1016,h),e(1017,p),e(1021,f),e(1022,f),e(1231,f),e(1014,m),e(1015,m),e(1008,m),e(1009,m),e(1040,m),e(1041,m),e(1115,g),e(1182,g),e(1185,g),e(1186,o),e(1187,y),e(17,s),e(114,JSON.parse.bind(JSON)),e(3802,JSON.parse.bind(JSON)),e(199,b),e(3807,b),e(3907,m),e(2951,m),e(791,m),e(1183,m),e(1270,m)},"init")}}),nF=nc((e,t)=>{function r(e){var t=e.readInt32BE(0),r=e.readUInt32BE(4),n="";t<0&&(t=~t+(0===r),r=~r+1>>>0,n="-");var i,o,s,a,l,u,c="";if(i=t%1e6,t=t/1e6>>>0,r=(o=0x100000000*i+r)/1e6>>>0,s=""+(o-1e6*r),0===r&&0===t)return n+s+c;for(a="",l=6-s.length,u=0;u<l;u++)a+="0";if(c=a+s+c,i=t%1e6,t=t/1e6>>>0,r=(o=0x100000000*i+r)/1e6>>>0,s=""+(o-1e6*r),0===r&&0===t)return n+s+c;for(a="",l=6-s.length,u=0;u<l;u++)a+="0";if(c=a+s+c,i=t%1e6,t=t/1e6>>>0,r=(o=0x100000000*i+r)/1e6>>>0,s=""+(o-1e6*r),0===r&&0===t)return n+s+c;for(a="",l=6-s.length,u=0;u<l;u++)a+="0";return c=a+s+c,n+(s=""+(o=0x100000000*(i=t%1e6)+r)%1e6)+c}nv(),nl(r,"readInt8"),t.exports=r}),nG=nc((e,t)=>{nv();var r=nF(),n=nl(function(e,t,r,n,i){r=r||0,n=n||!1,i=i||function(e,t,r){return e*Math.pow(2,r)+t};var o=r>>3,s=nl(function(e){return n?255&~e:e},"inv"),a=255,l=8-r%8;t<l&&(a=255<<8-t&255,l=t),r&&(a>>=r%8);var u=0;r%8+t>=8&&(u=i(0,s(e[o])&a,l));for(var c=t+r>>3,d=o+1;d<c;d++)u=i(u,s(e[d]),8);var h=(t+r)%8;return h>0&&(u=i(u,s(e[c])>>8-h,h)),u},"parseBits"),i=nl(function(e,t,r){var i=Math.pow(2,r-1)-1,o=n(e,1),s=n(e,r,1);if(0===s)return 0;var a=1,l=n(e,t,r+1,!1,nl(function(e,t,r){0===e&&(e=1);for(var n=1;n<=r;n++)a/=2,(t&1<<r-n)>0&&(e+=a);return e},"parsePrecisionBits"));return s==Math.pow(2,r+1)-1?0===l?0===o?1/0:-1/0:NaN:(0===o?1:-1)*Math.pow(2,s-i)*l},"parseFloatFromBits"),o=nl(function(e){return 1==n(e,1)?-1*(n(e,15,1,!0)+1):n(e,15,1)},"parseInt16"),s=nl(function(e){return 1==n(e,1)?-1*(n(e,31,1,!0)+1):n(e,31,1)},"parseInt32"),a=nl(function(e){return i(e,23,8)},"parseFloat32"),l=nl(function(e){return i(e,52,11)},"parseFloat64"),u=nl(function(e){var t=n(e,16,32);if(49152==t)return NaN;for(var r=Math.pow(1e4,n(e,16,16)),i=0,o=n(e,16),s=0;s<o;s++)i+=n(e,16,64+16*s)*r,r/=1e4;var a=Math.pow(10,n(e,16,48));return(0===t?1:-1)*Math.round(i*a)/a},"parseNumeric"),c=nl(function(e,t){var r=n(t,1),i=n(t,63,1),o=new Date((0===r?1:-1)*i/1e3+9466848e5);return e||o.setTime(o.getTime()+6e4*o.getTimezoneOffset()),o.usec=i%1e3,o.getMicroSeconds=function(){return this.usec},o.setMicroSeconds=function(e){this.usec=e},o.getUTCMicroSeconds=function(){return this.usec},o},"parseDate"),d=nl(function(e){for(var t=n(e,32),r=(n(e,32,32),n(e,32,64)),i=96,o=[],s=0;s<t;s++)o[s]=n(e,32,i),i+=64;var a=nl(function(t){var r,o=n(e,32,i);return(i+=32,0xffffffff==o)?null:23==t||20==t?(r=n(e,8*o,i),i+=8*o,r):25==t?e.toString(this.encoding,i>>3,(i+=o<<3)>>3):void console.log("ERROR: ElementType not implemented: "+t)},"parseElement"),l=nl(function(e,t){var r,n=[];if(e.length>1){var i=e.shift();for(r=0;r<i;r++)n[r]=l(e,t);e.unshift(i)}else for(r=0;r<e[0];r++)n[r]=a(t);return n},"parse");return l(o,r)},"parseArray"),h=nl(function(e){return e.toString("utf8")},"parseText"),p=nl(function(e){return null===e?null:n(e,8)>0},"parseBool");t.exports={init:nl(function(e){e(20,r),e(21,o),e(23,s),e(26,s),e(1700,u),e(700,a),e(701,l),e(16,p),e(1114,c.bind(null,!1)),e(1184,c.bind(null,!0)),e(1e3,d),e(1007,d),e(1016,d),e(1008,d),e(1009,d),e(25,h)},"init")}}),nH=nc((e,t)=>{nv(),t.exports={BOOL:16,BYTEA:17,CHAR:18,INT8:20,INT2:21,INT4:23,REGPROC:24,TEXT:25,OID:26,TID:27,XID:28,CID:29,JSON:114,XML:142,PG_NODE_TREE:194,SMGR:210,PATH:602,POLYGON:604,CIDR:650,FLOAT4:700,FLOAT8:701,ABSTIME:702,RELTIME:703,TINTERVAL:704,CIRCLE:718,MACADDR8:774,MONEY:790,MACADDR:829,INET:869,ACLITEM:1033,BPCHAR:1042,VARCHAR:1043,DATE:1082,TIME:1083,TIMESTAMP:1114,TIMESTAMPTZ:1184,INTERVAL:1186,TIMETZ:1266,BIT:1560,VARBIT:1562,NUMERIC:1700,REFCURSOR:1790,REGPROCEDURE:2202,REGOPER:2203,REGOPERATOR:2204,REGCLASS:2205,REGTYPE:2206,UUID:2950,TXID_SNAPSHOT:2970,PG_LSN:3220,PG_NDISTINCT:3361,PG_DEPENDENCIES:3402,TSVECTOR:3614,TSQUERY:3615,GTSVECTOR:3642,REGCONFIG:3734,REGDICTIONARY:3769,JSONB:3802,REGNAMESPACE:4089,REGROLE:4096}}),n$=nc(e=>{nv();var t=nj(),r=nG(),n=nk(),i=nH();e.getTypeParser=a,e.setTypeParser=l,e.arrayParser=n,e.builtins=i;var o={text:{},binary:{}};function s(e){return String(e)}function a(e,t){return o[t=t||"text"]&&o[t][e]||s}function l(e,t,r){"function"==typeof t&&(r=t,t="text"),o[t][e]=r}nl(s,"noParse"),nl(a,"getTypeParser"),nl(l,"setTypeParser"),t.init(function(e,t){o.text[e]=t}),r.init(function(e,t){o.binary[e]=t})}),nV=nc((e,t)=>{nv(),t.exports={host:"localhost",user:"win32"===nt.platform?nt.env.USERNAME:nt.env.USER,database:void 0,password:null,connectionString:void 0,port:5432,rows:0,binary:!1,max:10,idleTimeoutMillis:3e4,client_encoding:"",ssl:!1,application_name:void 0,fallback_application_name:void 0,options:void 0,parseInputDatesAsUTC:!1,statement_timeout:!1,lock_timeout:!1,idle_in_transaction_session_timeout:!1,query_timeout:!1,connect_timeout:0,keepalives:1,keepalives_idle:0};var r=n$(),n=r.getTypeParser(20,"text"),i=r.getTypeParser(1016,"text");t.exports.__defineSetter__("parseInt8",function(e){r.setTypeParser(20,"text",e?r.getTypeParser(23,"text"):n),r.setTypeParser(1016,"text",e?r.getTypeParser(1007,"text"):i)})}),nW=nc((e,t)=>{nv();var r=(nM(),nf(nR)),n=nV();function i(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'}function o(e){for(var t="{",r=0;r<e.length;r++)r>0&&(t+=","),null===e[r]||typeof e[r]>"u"?t+="NULL":Array.isArray(e[r])?t+=o(e[r]):e[r]instanceof ne?t+="\\\\x"+e[r].toString("hex"):t+=i(s(e[r]));return t+"}"}nl(i,"escapeElement"),nl(o,"arrayString");var s=nl(function(e,t){if(null==e)return null;if(e instanceof ne)return e;if(ArrayBuffer.isView(e)){var r=ne.from(e.buffer,e.byteOffset,e.byteLength);return r.length===e.byteLength?r:r.slice(e.byteOffset,e.byteOffset+e.byteLength)}return e instanceof Date?n.parseInputDatesAsUTC?c(e):u(e):Array.isArray(e)?o(e):"object"==typeof e?a(e,t):e.toString()},"prepareValue");function a(e,t){if(e&&"function"==typeof e.toPostgres){if(-1!==(t=t||[]).indexOf(e))throw Error('circular reference detected while preparing "'+e+'" for query');return t.push(e),s(e.toPostgres(s),t)}return JSON.stringify(e)}function l(e,t){for(e=""+e;e.length<t;)e="0"+e;return e}function u(e){var t=-e.getTimezoneOffset(),r=e.getFullYear(),n=r<1;n&&(r=Math.abs(r)+1);var i=l(r,4)+"-"+l(e.getMonth()+1,2)+"-"+l(e.getDate(),2)+"T"+l(e.getHours(),2)+":"+l(e.getMinutes(),2)+":"+l(e.getSeconds(),2)+"."+l(e.getMilliseconds(),3);return t<0?(i+="-",t*=-1):i+="+",i+=l(Math.floor(t/60),2)+":"+l(t%60,2),n&&(i+=" BC"),i}function c(e){var t=e.getUTCFullYear(),r=t<1;r&&(t=Math.abs(t)+1);var n=l(t,4)+"-"+l(e.getUTCMonth()+1,2)+"-"+l(e.getUTCDate(),2)+"T"+l(e.getUTCHours(),2)+":"+l(e.getUTCMinutes(),2)+":"+l(e.getUTCSeconds(),2)+"."+l(e.getUTCMilliseconds(),3);return n+="+00:00",r&&(n+=" BC"),n}function d(e,t,r){return e="string"==typeof e?{text:e}:e,t&&("function"==typeof t?e.callback=t:e.values=t),r&&(e.callback=r),e}nl(a,"prepareObject"),nl(l,"pad"),nl(u,"dateToString"),nl(c,"dateToStringUTC"),nl(d,"normalizeQueryConfig");var h=nl(function(e){return r.createHash("md5").update(e,"utf-8").digest("hex")},"md5"),p=nl(function(e,t,r){var n=h(t+e);return"md5"+h(ne.concat([ne.from(n),r]))},"postgresMd5PasswordHash");t.exports={prepareValue:nl(function(e){return s(e)},"prepareValueWrapper"),normalizeQueryConfig:d,postgresMd5PasswordHash:p,md5:h}}),nJ=nc((e,t)=>{nv();var r=(nM(),nf(nR));function n(e){if(-1===e.indexOf("SCRAM-SHA-256"))throw Error("SASL: Only mechanism SCRAM-SHA-256 is currently supported");let t=r.randomBytes(18).toString("base64");return{mechanism:"SCRAM-SHA-256",clientNonce:t,response:"n,,n=*,r="+t,message:"SASLInitialResponse"}}function i(e,t,r){if("SASLInitialResponse"!==e.message)throw Error("SASL: Last message was not SASLInitialResponse");if("string"!=typeof t)throw Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string");if("string"!=typeof r)throw Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: serverData must be a string");let n=u(r);if(n.nonce.startsWith(e.clientNonce)){if(n.nonce.length===e.clientNonce.length)throw Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce is too short")}else throw Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce does not start with client nonce");var i=f(t,ne.from(n.salt,"base64"),n.iteration),o=p(i,"Client Key"),s=h(o),a="n=*,r="+e.clientNonce,l="r="+n.nonce+",s="+n.salt+",i="+n.iteration,c="c=biws,r="+n.nonce,m=a+","+l+","+c,g=d(o,p(s,m)).toString("base64"),y=p(i,"Server Key"),_=p(y,m);e.message="SASLResponse",e.serverSignature=_.toString("base64"),e.response=c+",p="+g}function o(e,t){if("SASLResponse"!==e.message)throw Error("SASL: Last message was not SASLResponse");if("string"!=typeof t)throw Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: serverData must be a string");let{serverSignature:r}=c(t);if(r!==e.serverSignature)throw Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature does not match")}function s(e){if("string"!=typeof e)throw TypeError("SASL: text must be a string");return e.split("").map((t,r)=>e.charCodeAt(r)).every(e=>e>=33&&e<=43||e>=45&&e<=126)}function a(e){return/^(?:[a-zA-Z0-9+/]{4})*(?:[a-zA-Z0-9+/]{2}==|[a-zA-Z0-9+/]{3}=)?$/.test(e)}function l(e){if("string"!=typeof e)throw TypeError("SASL: attribute pairs text must be a string");return new Map(e.split(",").map(e=>{if(!/^.=/.test(e))throw Error("SASL: Invalid attribute pair entry");return[e[0],e.substring(2)]}))}function u(e){let t=l(e),r=t.get("r");if(r){if(!s(r))throw Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce must only contain printable characters")}else throw Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce missing");let n=t.get("s");if(n){if(!a(n))throw Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt must be base64")}else throw Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt missing");let i=t.get("i");if(i){if(!/^[1-9][0-9]*$/.test(i))throw Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: invalid iteration count")}else throw Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: iteration missing");return{nonce:r,salt:n,iteration:parseInt(i,10)}}function c(e){let t=l(e).get("v");if(t){if(!a(t))throw Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature must be base64")}else throw Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature is missing");return{serverSignature:t}}function d(e,t){if(!ne.isBuffer(e))throw TypeError("first argument must be a Buffer");if(!ne.isBuffer(t))throw TypeError("second argument must be a Buffer");if(e.length!==t.length)throw Error("Buffer lengths must match");if(0===e.length)throw Error("Buffers cannot be empty");return ne.from(e.map((r,n)=>e[n]^t[n]))}function h(e){return r.createHash("sha256").update(e).digest()}function p(e,t){return r.createHmac("sha256",e).update(t).digest()}function f(e,t,r){for(var n=p(e,ne.concat([t,ne.from([0,0,0,1])])),i=n,o=0;o<r-1;o++)i=d(i,n=p(e,n));return i}nl(n,"startSession"),nl(i,"continueSession"),nl(o,"finalizeSession"),nl(s,"isPrintableChars"),nl(a,"isBase64"),nl(l,"parseAttributePairs"),nl(u,"parseServerFirstMessage"),nl(c,"parseServerFinalMessage"),nl(d,"xorBuffers"),nl(h,"sha256"),nl(p,"hmacSha256"),nl(f,"Hi"),t.exports={startSession:n,continueSession:i,finalizeSession:o}}),nK={};function nY(...e){return e.join("/")}nd(nK,{join:()=>nY});var nQ=nu(()=>{nv(),nl(nY,"join")}),nz={};function nX(e,t){t(Error("No filesystem"))}nd(nz,{stat:()=>nX});var nZ=nu(()=>{nv(),nl(nX,"stat")}),n0={};nd(n0,{default:()=>n1});var n1,n2=nu(()=>{nv(),n1={}}),n6={};nd(n6,{StringDecoder:()=>n8});var n3,n8,n5=nu(()=>{nv(),nl(n3=class{constructor(e){nm(this,"td"),this.td=new TextDecoder(e)}write(e){return this.td.decode(e,{stream:!0})}end(e){return this.td.decode(e)}},"StringDecoder"),n8=n3}),n4=nc((e,t)=>{nv();var{Transform:r}=(n2(),nf(n0)),{StringDecoder:n}=(n5(),nf(n6)),i=Symbol("last"),o=Symbol("decoder");function s(e,t,r){let n;if(this.overflow){if(1===(n=this[o].write(e).split(this.matcher)).length)return r();n.shift(),this.overflow=!1}else this[i]+=this[o].write(e),n=this[i].split(this.matcher);this[i]=n.pop();for(let e=0;e<n.length;e++)try{l(this,this.mapper(n[e]))}catch(e){return r(e)}(this.overflow=this[i].length>this.maxLength,this.overflow&&!this.skipOverflow)?r(Error("maximum buffer reached")):r()}function a(e){if(this[i]+=this[o].end(),this[i])try{l(this,this.mapper(this[i]))}catch(t){return e(t)}e()}function l(e,t){void 0!==t&&e.push(t)}function u(e){return e}function c(e,t,l){switch(e=e||/\r?\n/,t=t||u,l=l||{},arguments.length){case 1:"function"==typeof e?(t=e,e=/\r?\n/):"object"!=typeof e||e instanceof RegExp||e[Symbol.split]||(l=e,e=/\r?\n/);break;case 2:"function"==typeof e?(l=t,t=e,e=/\r?\n/):"object"==typeof t&&(l=t,t=u)}(l=Object.assign({},l)).autoDestroy=!0,l.transform=s,l.flush=a,l.readableObjectMode=!0;let c=new r(l);return c[i]="",c[o]=new n("utf8"),c.matcher=e,c.mapper=t,c.maxLength=l.maxLength,c.skipOverflow=l.skipOverflow||!1,c.overflow=!1,c._destroy=function(e,t){this._writableState.errorEmitted=!1,t(e)},c}nl(s,"transform"),nl(a,"flush"),nl(l,"push"),nl(u,"noop"),nl(c,"split"),t.exports=c}),n9=nc((e,t)=>{nv();var r=(nQ(),nf(nK)),n=(n2(),nf(n0)).Stream,i=n4(),o=(nT(),nf(nb)),s="win32"===nt.platform,a=nt.stderr;function l(e){return(61440&e)==32768}nl(l,"isRegFile");var u=["host","port","database","user","password"],c=u.length,d=u[c-1];function h(){if(a instanceof n&&!0===a.writable){var e=Array.prototype.slice.call(arguments).concat(`
`);a.write(o.format.apply(o,e))}}nl(h,"warn"),Object.defineProperty(t.exports,"isWin",{get:nl(function(){return s},"get"),set:nl(function(e){s=e},"set")}),t.exports.warnTo=function(e){var t=a;return a=e,t},t.exports.getFileName=function(e){var t=e||nt.env;return t.PGPASSFILE||(s?r.join(t.APPDATA||"./","postgresql","pgpass.conf"):r.join(t.HOME||"./",".pgpass"))},t.exports.usePgPass=function(e,t){return!Object.prototype.hasOwnProperty.call(nt.env,"PGPASSWORD")&&(!!s||(t=t||"<unkn>",l(e.mode)?!(63&e.mode)||(h('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',t),!1):(h('WARNING: password file "%s" is not a plain file',t),!1)))};var p=t.exports.match=function(e,t){return u.slice(0,-1).reduce(function(r,n,i){return 1==i&&Number(e[n]||5432)===Number(t[n])?r&&!0:r&&("*"===t[n]||t[n]===e[n])},!0)};t.exports.getPassword=function(e,t,r){var n,o=t.pipe(i());function s(t){var r=f(t);r&&m(r)&&p(e,r)&&(n=r[d],o.end())}nl(s,"onLine");var a=nl(function(){t.destroy(),r(n)},"onEnd"),l=nl(function(e){t.destroy(),h("WARNING: error on reading file: %s",e),r(void 0)},"onErr");t.on("error",l),o.on("data",s).on("end",a).on("error",l)};var f=t.exports.parseLine=function(e){if(e.length<11||e.match(/^\s+#/))return null;for(var t="",r="",n=0,i=0,o={},s=nl(function(t,r,n){var i=e.substring(r,n);Object.hasOwnProperty.call(nt.env,"PGPASS_NO_DEESCAPE")||(i=i.replace(/\\([:\\])/g,"$1")),o[u[t]]=i},"addToObj"),a=0;a<e.length-1;a+=1){if(t=e.charAt(a+1),r=e.charAt(a),n==c-1){s(n,i);break}a>=0&&":"==t&&"\\"!==r&&(s(n,i,a+1),i=a+2,n+=1)}return o=Object.keys(o).length===c?o:null},m=t.exports.isValidEntry=function(e){for(var t={0:function(e){return e.length>0},1:function(e){return"*"===e||isFinite(e=Number(e))&&e>0&&e<0x20000000000000&&Math.floor(e)===e},2:function(e){return e.length>0},3:function(e){return e.length>0},4:function(e){return e.length>0}},r=0;r<u.length;r+=1)if(!(0,t[r])(e[u[r]]||""))return!1;return!0}}),n7=nc((e,t)=>{nv(),nQ(),nf(nK);var r=(nZ(),nf(nz)),n=n9();t.exports=function(e,t){var i=n.getFileName();r.stat(i,function(o,s){if(o||!n.usePgPass(s,i))return t(void 0);var a=r.createReadStream(i);n.getPassword(e,a,t)})},t.exports.warnTo=n.warnTo}),ie=nc((e,t)=>{nv();var r=n$();function n(e){this._types=e||r,this.text={},this.binary={}}nl(n,"TypeOverrides"),n.prototype.getOverrides=function(e){switch(e){case"text":return this.text;case"binary":return this.binary;default:return{}}},n.prototype.setTypeParser=function(e,t,r){"function"==typeof t&&(r=t,t="text"),this.getOverrides(t)[e]=r},n.prototype.getTypeParser=function(e,t){return t=t||"text",this.getOverrides(t)[e]||this._types.getTypeParser(e,t)},t.exports=n}),it={};nd(it,{default:()=>ir});var ir,ii=nu(()=>{nv(),ir={}}),io={};function is(e,t=!1){let{protocol:r}=new URL(e),{username:n,password:i,host:o,hostname:s,port:a,pathname:l,search:u,searchParams:c,hash:d}=new URL("http:"+e.substring(r.length));i=decodeURIComponent(i),n=decodeURIComponent(n),l=decodeURIComponent(l);let h=n+":"+i,p=t?Object.fromEntries(c.entries()):u;return{href:e,protocol:r,auth:h,username:n,password:i,host:o,hostname:s,port:a,pathname:l,search:u,query:p,hash:d}}nd(io,{parse:()=>is});var ia=nu(()=>{nv(),nl(is,"parse")}),il=nc((e,t)=>{nv();var r=(ia(),nf(io)),n=(nZ(),nf(nz));function i(e){if("/"===e.charAt(0)){var t=e.split(" ");return{host:t[0],database:t[1]}}var i=r.parse(/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(e)?encodeURI(e).replace(/\%25(\d\d)/g,"%$1"):e,!0),t=i.query;for(var o in t)Array.isArray(t[o])&&(t[o]=t[o][t[o].length-1]);var s=(i.auth||":").split(":");if(t.user=s[0],t.password=s.splice(1).join(":"),t.port=i.port,"socket:"==i.protocol)return t.host=decodeURI(i.pathname),t.database=i.query.db,t.client_encoding=i.query.encoding,t;t.host||(t.host=i.hostname);var a=i.pathname;if(!t.host&&a&&/^%2f/i.test(a)){var l=a.split("/");t.host=decodeURIComponent(l[0]),a=l.splice(1).join("/")}switch(a&&"/"===a.charAt(0)&&(a=a.slice(1)||null),t.database=a&&decodeURI(a),("true"===t.ssl||"1"===t.ssl)&&(t.ssl=!0),"0"===t.ssl&&(t.ssl=!1),(t.sslcert||t.sslkey||t.sslrootcert||t.sslmode)&&(t.ssl={}),t.sslcert&&(t.ssl.cert=n.readFileSync(t.sslcert).toString()),t.sslkey&&(t.ssl.key=n.readFileSync(t.sslkey).toString()),t.sslrootcert&&(t.ssl.ca=n.readFileSync(t.sslrootcert).toString()),t.sslmode){case"disable":t.ssl=!1;break;case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":t.ssl.rejectUnauthorized=!1}return t}nl(i,"parse"),t.exports=i,i.parse=i}),iu=nc((e,t)=>{nv();var r=(ii(),nf(it)),n=nV(),i=il().parse,o=nl(function(e,t,r){return void 0===r?r=nt.env["PG"+e.toUpperCase()]:!1===r||(r=nt.env[r]),t[e]||r||n[e]},"val"),s=nl(function(){switch(nt.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return n.ssl},"readSSLConfigFromEnvironment"),a=nl(function(e){return"'"+(""+e).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),l=nl(function(e,t,r){var n=t[r];null!=n&&e.push(r+"="+a(n))},"add"),u=class{constructor(e){(e="string"==typeof e?i(e):e||{}).connectionString&&(e=Object.assign({},e,i(e.connectionString))),this.user=o("user",e),this.database=o("database",e),void 0===this.database&&(this.database=this.user),this.port=parseInt(o("port",e),10),this.host=o("host",e),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:o("password",e)}),this.binary=o("binary",e),this.options=o("options",e),this.ssl=typeof e.ssl>"u"?s():e.ssl,"string"==typeof this.ssl&&"true"===this.ssl&&(this.ssl=!0),"no-verify"===this.ssl&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=o("client_encoding",e),this.replication=o("replication",e),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=o("application_name",e,"PGAPPNAME"),this.fallback_application_name=o("fallback_application_name",e,!1),this.statement_timeout=o("statement_timeout",e,!1),this.lock_timeout=o("lock_timeout",e,!1),this.idle_in_transaction_session_timeout=o("idle_in_transaction_session_timeout",e,!1),this.query_timeout=o("query_timeout",e,!1),void 0===e.connectionTimeoutMillis?this.connect_timeout=nt.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(e.connectionTimeoutMillis/1e3),!1===e.keepAlive?this.keepalives=0:!0===e.keepAlive&&(this.keepalives=1),"number"==typeof e.keepAliveInitialDelayMillis&&(this.keepalives_idle=Math.floor(e.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(e){var t=[];l(t,this,"user"),l(t,this,"password"),l(t,this,"port"),l(t,this,"application_name"),l(t,this,"fallback_application_name"),l(t,this,"connect_timeout"),l(t,this,"options");var n="object"==typeof this.ssl?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(l(t,n,"sslmode"),l(t,n,"sslca"),l(t,n,"sslkey"),l(t,n,"sslcert"),l(t,n,"sslrootcert"),this.database&&t.push("dbname="+a(this.database)),this.replication&&t.push("replication="+a(this.replication)),this.host&&t.push("host="+a(this.host)),this.isDomainSocket)return e(null,t.join(" "));this.client_encoding&&t.push("client_encoding="+a(this.client_encoding)),r.lookup(this.host,function(r,n){return r?e(r,null):(t.push("hostaddr="+a(n)),e(null,t.join(" ")))})}};nl(u,"ConnectionParameters"),t.exports=u}),ic=nc((e,t)=>{nv();var r=n$(),n=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,i=class{constructor(e,t){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=t,this.RowCtor=null,this.rowAsArray="array"===e,this.rowAsArray&&(this.parseRow=this._parseRowAsArray)}addCommandComplete(e){var t;(t=e.text?n.exec(e.text):n.exec(e.command))&&(this.command=t[1],t[3]?(this.oid=parseInt(t[2],10),this.rowCount=parseInt(t[3],10)):t[2]&&(this.rowCount=parseInt(t[2],10)))}_parseRowAsArray(e){for(var t=Array(e.length),r=0,n=e.length;r<n;r++){var i=e[r];null!==i?t[r]=this._parsers[r](i):t[r]=null}return t}parseRow(e){for(var t={},r=0,n=e.length;r<n;r++){var i=e[r],o=this.fields[r].name;null!==i?t[o]=this._parsers[r](i):t[o]=null}return t}addRow(e){this.rows.push(e)}addFields(e){this.fields=e,this.fields.length&&(this._parsers=Array(e.length));for(var t=0;t<e.length;t++){var n=e[t];this._types?this._parsers[t]=this._types.getTypeParser(n.dataTypeID,n.format||"text"):this._parsers[t]=r.getTypeParser(n.dataTypeID,n.format||"text")}}};nl(i,"Result"),t.exports=i}),id=nc((e,t)=>{nv();var{EventEmitter:r}=nE(),n=ic(),i=nW(),o=class extends r{constructor(e,t,r){super(),e=i.normalizeQueryConfig(e,t,r),this.text=e.text,this.values=e.values,this.rows=e.rows,this.types=e.types,this.name=e.name,this.binary=e.binary,this.portal=e.portal||"",this.callback=e.callback,this._rowMode=e.rowMode,nt.domain&&e.callback&&(this.callback=nt.domain.bind(e.callback)),this._result=new n(this._rowMode,this.types),this._results=this._result,this.isPreparedStatement=!1,this._canceledDueToError=!1,this._promise=null}requiresPreparation(){return!!this.name||!!this.rows||!!this.text&&!!this.values&&this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new n(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(e){this._checkForMultirow(),this._result.addFields(e.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(e){let t;if(!this._canceledDueToError){try{t=this._result.parseRow(e.fields)}catch(e){this._canceledDueToError=e;return}this.emit("row",t,this._result),this._accumulateRows&&this._result.addRow(t)}}handleCommandComplete(e,t){this._checkForMultirow(),this._result.addCommandComplete(e),this.rows&&t.sync()}handleEmptyQuery(e){this.rows&&e.sync()}handleError(e,t){if(this._canceledDueToError&&(e=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(e);this.emit("error",e)}handleReadyForQuery(e){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,e);if(this.callback)try{this.callback(null,this._results)}catch(e){nt.nextTick(()=>{throw e})}this.emit("end",this._results)}submit(e){if("string"!=typeof this.text&&"string"!=typeof this.name)return Error("A query must have either text or a name. Supplying neither is unsupported.");let t=e.parsedStatements[this.name];return this.text&&t&&this.text!==t?Error(`Prepared statements must be \
unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(e):e.query(this.text),null)}hasBeenParsed(e){return this.name&&e.parsedStatements[this.name]}handlePortalSuspended(e){this._getRows(e,this.rows)}_getRows(e,t){e.execute({portal:this.portal,rows:t}),t?e.flush():e.sync()}prepare(e){this.isPreparedStatement=!0,this.hasBeenParsed(e)||e.parse({text:this.text,name:this.name,types:this.types});try{e.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:i.prepareValue})}catch(t){this.handleError(t,e);return}e.describe({type:"P",name:this.portal||""}),this._getRows(e,this.rows)}handleCopyInResponse(e){e.sendCopyFail("No source stream defined")}handleCopyData(e,t){}};nl(o,"Query"),t.exports=o}),ih={};function ip(e){return 0}nd(ih,{Socket:()=>i_,isIP:()=>ip});var im,ig,iy,i_,iv=nu(()=>{nv(),im=np(nE(),1),nl(ip,"isIP"),ig=nl(e=>e.replace(/^[^.]+\./,"api."),"transformHost"),iy=class e extends im.EventEmitter{constructor(){super(...arguments),nm(this,"opts",{}),nm(this,"connecting",!1),nm(this,"pending",!0),nm(this,"writable",!0),nm(this,"encrypted",!1),nm(this,"authorized",!1),nm(this,"destroyed",!1),nm(this,"ws",null),nm(this,"writeBuffer"),nm(this,"tlsState",0),nm(this,"tlsRead"),nm(this,"tlsWrite")}static get poolQueryViaFetch(){return e.opts.poolQueryViaFetch??e.defaults.poolQueryViaFetch}static set poolQueryViaFetch(t){e.opts.poolQueryViaFetch=t}static get fetchEndpoint(){return e.opts.fetchEndpoint??e.defaults.fetchEndpoint}static set fetchEndpoint(t){e.opts.fetchEndpoint=t}static get fetchConnectionCache(){return!0}static set fetchConnectionCache(e){console.warn("The `fetchConnectionCache` option is deprecated (now always `true`)")}static get fetchFunction(){return e.opts.fetchFunction??e.defaults.fetchFunction}static set fetchFunction(t){e.opts.fetchFunction=t}static get webSocketConstructor(){return e.opts.webSocketConstructor??e.defaults.webSocketConstructor}static set webSocketConstructor(t){e.opts.webSocketConstructor=t}get webSocketConstructor(){return this.opts.webSocketConstructor??e.webSocketConstructor}set webSocketConstructor(e){this.opts.webSocketConstructor=e}static get wsProxy(){return e.opts.wsProxy??e.defaults.wsProxy}static set wsProxy(t){e.opts.wsProxy=t}get wsProxy(){return this.opts.wsProxy??e.wsProxy}set wsProxy(e){this.opts.wsProxy=e}static get coalesceWrites(){return e.opts.coalesceWrites??e.defaults.coalesceWrites}static set coalesceWrites(t){e.opts.coalesceWrites=t}get coalesceWrites(){return this.opts.coalesceWrites??e.coalesceWrites}set coalesceWrites(e){this.opts.coalesceWrites=e}static get useSecureWebSocket(){return e.opts.useSecureWebSocket??e.defaults.useSecureWebSocket}static set useSecureWebSocket(t){e.opts.useSecureWebSocket=t}get useSecureWebSocket(){return this.opts.useSecureWebSocket??e.useSecureWebSocket}set useSecureWebSocket(e){this.opts.useSecureWebSocket=e}static get forceDisablePgSSL(){return e.opts.forceDisablePgSSL??e.defaults.forceDisablePgSSL}static set forceDisablePgSSL(t){e.opts.forceDisablePgSSL=t}get forceDisablePgSSL(){return this.opts.forceDisablePgSSL??e.forceDisablePgSSL}set forceDisablePgSSL(e){this.opts.forceDisablePgSSL=e}static get disableSNI(){return e.opts.disableSNI??e.defaults.disableSNI}static set disableSNI(t){e.opts.disableSNI=t}get disableSNI(){return this.opts.disableSNI??e.disableSNI}set disableSNI(e){this.opts.disableSNI=e}static get pipelineConnect(){return e.opts.pipelineConnect??e.defaults.pipelineConnect}static set pipelineConnect(t){e.opts.pipelineConnect=t}get pipelineConnect(){return this.opts.pipelineConnect??e.pipelineConnect}set pipelineConnect(e){this.opts.pipelineConnect=e}static get subtls(){return e.opts.subtls??e.defaults.subtls}static set subtls(t){e.opts.subtls=t}get subtls(){return this.opts.subtls??e.subtls}set subtls(e){this.opts.subtls=e}static get pipelineTLS(){return e.opts.pipelineTLS??e.defaults.pipelineTLS}static set pipelineTLS(t){e.opts.pipelineTLS=t}get pipelineTLS(){return this.opts.pipelineTLS??e.pipelineTLS}set pipelineTLS(e){this.opts.pipelineTLS=e}static get rootCerts(){return e.opts.rootCerts??e.defaults.rootCerts}static set rootCerts(t){e.opts.rootCerts=t}get rootCerts(){return this.opts.rootCerts??e.rootCerts}set rootCerts(e){this.opts.rootCerts=e}wsProxyAddrForHost(e,t){let r=this.wsProxy;if(void 0===r)throw Error("No WebSocket proxy is configured. Please see https://github.com/neondatabase/serverless/blob/main/CONFIG.md#wsproxy-string--host-string-port-number--string--string");return"function"==typeof r?r(e,t):`${r}?address=${e}:${t}`}setNoDelay(){return this}setKeepAlive(){return this}ref(){return this}unref(){return this}connect(e,t,r){this.connecting=!0,r&&this.once("connect",r);let n=nl(()=>{this.connecting=!1,this.pending=!1,this.emit("connect"),this.emit("ready")},"handleWebSocketOpen"),i=nl((e,t=!1)=>{e.binaryType="arraybuffer",e.addEventListener("error",e=>{this.emit("error",e),this.emit("close")}),e.addEventListener("message",e=>{if(0===this.tlsState){let t=ne.from(e.data);this.emit("data",t)}}),e.addEventListener("close",()=>{this.emit("close")}),t?n():e.addEventListener("open",n)},"configureWebSocket"),o;try{o=this.wsProxyAddrForHost(t,"string"==typeof e?parseInt(e,10):e)}catch(e){this.emit("error",e),this.emit("close");return}try{let e=(this.useSecureWebSocket?"wss:":"ws:")+"//"+o;if(void 0!==this.webSocketConstructor)this.ws=new this.webSocketConstructor(e),i(this.ws);else try{this.ws=new WebSocket(e),i(this.ws)}catch{this.ws=new __unstable_WebSocket(e),i(this.ws)}}catch(e){fetch((this.useSecureWebSocket?"https:":"http:")+"//"+o,{headers:{Upgrade:"websocket"}}).then(t=>{if(this.ws=t.webSocket,null==this.ws)throw e;this.ws.accept(),i(this.ws,!0)}).catch(e=>{this.emit("error",Error(`All attempts to open a WebSocket to\
 connect to the database failed. Please refer to https://github.com/neondatabase\
/serverless/blob/main/CONFIG.md#websocketconstructor-typeof-websocket--undefined\
. Details: ${e.message}`)),this.emit("close")})}}async startTls(e){if(void 0===this.subtls)throw Error("For Postgres SSL connections, you must set `neonConfig.subtls` to the subtls library. See https://github.com/neondatabase/serverless/blob/main/CONFIG.md for more information.");this.tlsState=1;let t=this.subtls.TrustedCert.fromPEM(this.rootCerts),r=new this.subtls.WebSocketReadQueue(this.ws),n=r.read.bind(r),i=this.rawWrite.bind(this),[o,s]=await this.subtls.startTls(e,t,n,i,{useSNI:!this.disableSNI,expectPreData:this.pipelineTLS?new Uint8Array([83]):void 0});this.tlsRead=o,this.tlsWrite=s,this.tlsState=2,this.encrypted=!0,this.authorized=!0,this.emit("secureConnection",this),this.tlsReadLoop()}async tlsReadLoop(){for(;;){let e=await this.tlsRead();if(void 0===e)break;{let t=ne.from(e);this.emit("data",t)}}}rawWrite(e){if(!this.coalesceWrites)return void this.ws.send(e);if(void 0===this.writeBuffer)this.writeBuffer=e,setTimeout(()=>{this.ws.send(this.writeBuffer),this.writeBuffer=void 0},0);else{let t=new Uint8Array(this.writeBuffer.length+e.length);t.set(this.writeBuffer),t.set(e,this.writeBuffer.length),this.writeBuffer=t}}write(e,t="utf8",r=e=>{}){return 0===e.length?r():("string"==typeof e&&(e=ne.from(e,t)),0===this.tlsState?(this.rawWrite(e),r()):1===this.tlsState?this.once("secureConnection",()=>{this.write(e,t,r)}):(this.tlsWrite(e),r())),!0}end(e=ne.alloc(0),t="utf8",r=()=>{}){return this.write(e,t,()=>{this.ws.close(),r()}),this}destroy(){return this.destroyed=!0,this.end()}},nl(iy,"Socket"),nm(iy,"defaults",{poolQueryViaFetch:!1,fetchEndpoint:nl(e=>"https://"+ig(e)+"/sql","fetchEndpoint"),fetchConnectionCache:!0,fetchFunction:void 0,webSocketConstructor:void 0,wsProxy:nl(e=>e+"/v2","wsProxy"),useSecureWebSocket:!0,forceDisablePgSSL:!0,coalesceWrites:!0,pipelineConnect:"password",subtls:void 0,rootCerts:"",pipelineTLS:!1,disableSNI:!1}),nm(iy,"opts",{}),i_=iy}),iE=nc(e=>{nv(),Object.defineProperty(e,"__esModule",{value:!0}),e.NoticeMessage=e.DataRowMessage=e.CommandCompleteMessage=e.ReadyForQueryMessage=e.NotificationResponseMessage=e.BackendKeyDataMessage=e.AuthenticationMD5Password=e.ParameterStatusMessage=e.ParameterDescriptionMessage=e.RowDescriptionMessage=e.Field=e.CopyResponse=e.CopyDataMessage=e.DatabaseError=e.copyDone=e.emptyQuery=e.replicationStart=e.portalSuspended=e.noData=e.closeComplete=e.bindComplete=e.parseComplete=void 0,e.parseComplete={name:"parseComplete",length:5},e.bindComplete={name:"bindComplete",length:5},e.closeComplete={name:"closeComplete",length:5},e.noData={name:"noData",length:5},e.portalSuspended={name:"portalSuspended",length:5},e.replicationStart={name:"replicationStart",length:4},e.emptyQuery={name:"emptyQuery",length:4},e.copyDone={name:"copyDone",length:4};var t=class extends Error{constructor(e,t,r){super(e),this.length=t,this.name=r}};nl(t,"DatabaseError"),e.DatabaseError=t;var r=class{constructor(e,t){this.length=e,this.chunk=t,this.name="copyData"}};nl(r,"CopyDataMessage"),e.CopyDataMessage=r;var n=class{constructor(e,t,r,n){this.length=e,this.name=t,this.binary=r,this.columnTypes=Array(n)}};nl(n,"CopyResponse"),e.CopyResponse=n;var i=class{constructor(e,t,r,n,i,o,s){this.name=e,this.tableID=t,this.columnID=r,this.dataTypeID=n,this.dataTypeSize=i,this.dataTypeModifier=o,this.format=s}};nl(i,"Field"),e.Field=i;var o=class{constructor(e,t){this.length=e,this.fieldCount=t,this.name="rowDescription",this.fields=Array(this.fieldCount)}};nl(o,"RowDescriptionMessage"),e.RowDescriptionMessage=o;var s=class{constructor(e,t){this.length=e,this.parameterCount=t,this.name="parameterDescription",this.dataTypeIDs=Array(this.parameterCount)}};nl(s,"ParameterDescriptionMessage"),e.ParameterDescriptionMessage=s;var a=class{constructor(e,t,r){this.length=e,this.parameterName=t,this.parameterValue=r,this.name="parameterStatus"}};nl(a,"ParameterStatusMessage"),e.ParameterStatusMessage=a;var l=class{constructor(e,t){this.length=e,this.salt=t,this.name="authenticationMD5Password"}};nl(l,"AuthenticationMD5Password"),e.AuthenticationMD5Password=l;var u=class{constructor(e,t,r){this.length=e,this.processID=t,this.secretKey=r,this.name="backendKeyData"}};nl(u,"BackendKeyDataMessage"),e.BackendKeyDataMessage=u;var c=class{constructor(e,t,r,n){this.length=e,this.processId=t,this.channel=r,this.payload=n,this.name="notification"}};nl(c,"NotificationResponseMessage"),e.NotificationResponseMessage=c;var d=class{constructor(e,t){this.length=e,this.status=t,this.name="readyForQuery"}};nl(d,"ReadyForQueryMessage"),e.ReadyForQueryMessage=d;var h=class{constructor(e,t){this.length=e,this.text=t,this.name="commandComplete"}};nl(h,"CommandCompleteMessage"),e.CommandCompleteMessage=h;var p=class{constructor(e,t){this.length=e,this.fields=t,this.name="dataRow",this.fieldCount=t.length}};nl(p,"DataRowMessage"),e.DataRowMessage=p;var f=class{constructor(e,t){this.length=e,this.message=t,this.name="notice"}};nl(f,"NoticeMessage"),e.NoticeMessage=f}),ib=nc(e=>{nv(),Object.defineProperty(e,"__esModule",{value:!0}),e.Writer=void 0;var t=class{constructor(e=256){this.size=e,this.offset=5,this.headerPosition=0,this.buffer=ne.allocUnsafe(e)}ensure(e){if(this.buffer.length-this.offset<e){var t=this.buffer,r=t.length+(t.length>>1)+e;this.buffer=ne.allocUnsafe(r),t.copy(this.buffer)}}addInt32(e){return this.ensure(4),this.buffer[this.offset++]=e>>>24&255,this.buffer[this.offset++]=e>>>16&255,this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addInt16(e){return this.ensure(2),this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addCString(e){if(e){var t=ne.byteLength(e);this.ensure(t+1),this.buffer.write(e,this.offset,"utf-8"),this.offset+=t}else this.ensure(1);return this.buffer[this.offset++]=0,this}addString(e=""){var t=ne.byteLength(e);return this.ensure(t),this.buffer.write(e,this.offset),this.offset+=t,this}add(e){return this.ensure(e.length),e.copy(this.buffer,this.offset),this.offset+=e.length,this}join(e){if(e){this.buffer[this.headerPosition]=e;let t=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(t,this.headerPosition+1)}return this.buffer.slice(5*!e,this.offset)}flush(e){var t=this.join(e);return this.offset=5,this.headerPosition=0,this.buffer=ne.allocUnsafe(this.size),t}};nl(t,"Writer"),e.Writer=t}),iS=nc(e=>{nv(),Object.defineProperty(e,"__esModule",{value:!0}),e.serialize=void 0;var t=ib(),r=new t.Writer,n=nl(e=>{for(let t of(r.addInt16(3).addInt16(0),Object.keys(e)))r.addCString(t).addCString(e[t]);r.addCString("client_encoding").addCString("UTF8");var n=r.addCString("").flush(),i=n.length+4;return new t.Writer().addInt32(i).add(n).flush()},"startup"),i=nl(()=>{let e=ne.allocUnsafe(8);return e.writeInt32BE(8,0),e.writeInt32BE(0x4d2162f,4),e},"requestSsl"),o=nl(e=>r.addCString(e).flush(112),"password"),s=nl(function(e,t){return r.addCString(e).addInt32(ne.byteLength(t)).addString(t),r.flush(112)},"sendSASLInitialResponseMessage"),a=nl(function(e){return r.addString(e).flush(112)},"sendSCRAMClientFinalMessage"),l=nl(e=>r.addCString(e).flush(81),"query"),u=[],c=nl(e=>{let t=e.name||"";t.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",t,t.length),console.error("This can cause conflicts and silent errors executing queries"));let n=e.types||u;for(var i=n.length,o=r.addCString(t).addCString(e.text).addInt16(i),s=0;s<i;s++)o.addInt32(n[s]);return r.flush(80)},"parse"),d=new t.Writer,h=nl(function(e,t){for(let n=0;n<e.length;n++){let i=t?t(e[n],n):e[n];null==i?(r.addInt16(0),d.addInt32(-1)):i instanceof ne?(r.addInt16(1),d.addInt32(i.length),d.add(i)):(r.addInt16(0),d.addInt32(ne.byteLength(i)),d.addString(i))}},"writeValues"),p=nl((e={})=>{let t=e.portal||"",n=e.statement||"",i=e.binary||!1,o=e.values||u,s=o.length;return r.addCString(t).addCString(n),r.addInt16(s),h(o,e.valueMapper),r.addInt16(s),r.add(d.flush()),r.addInt16(+!!i),r.flush(66)},"bind"),f=ne.from([69,0,0,0,9,0,0,0,0,0]),m=nl(e=>{if(!e||!e.portal&&!e.rows)return f;let t=e.portal||"",r=e.rows||0,n=ne.byteLength(t),i=4+n+1+4,o=ne.allocUnsafe(1+i);return o[0]=69,o.writeInt32BE(i,1),o.write(t,5,"utf-8"),o[n+5]=0,o.writeUInt32BE(r,o.length-4),o},"execute"),g=nl((e,t)=>{let r=ne.allocUnsafe(16);return r.writeInt32BE(16,0),r.writeInt16BE(1234,4),r.writeInt16BE(5678,6),r.writeInt32BE(e,8),r.writeInt32BE(t,12),r},"cancel"),y=nl((e,t)=>{let r=4+ne.byteLength(t)+1,n=ne.allocUnsafe(1+r);return n[0]=e,n.writeInt32BE(r,1),n.write(t,5,"utf-8"),n[r]=0,n},"cstringMessage"),_=r.addCString("P").flush(68),v=r.addCString("S").flush(68),E=nl(e=>e.name?y(68,`${e.type}${e.name||""}`):"P"===e.type?_:v,"describe"),b=nl(e=>y(67,`${e.type}${e.name||""}`),"close"),S=nl(e=>r.add(e).flush(100),"copyData"),T=nl(e=>y(102,e),"copyFail"),A=nl(e=>ne.from([e,0,0,0,4]),"codeOnlyBuffer"),C=A(72),O=A(83),w=A(88),I=A(99);e.serialize={startup:n,password:o,requestSsl:i,sendSASLInitialResponseMessage:s,sendSCRAMClientFinalMessage:a,query:l,parse:c,bind:p,execute:m,describe:E,close:b,flush:nl(()=>C,"flush"),sync:nl(()=>O,"sync"),end:nl(()=>w,"end"),copyData:S,copyDone:nl(()=>I,"copyDone"),copyFail:T,cancel:g}}),iT=nc(e=>{nv(),Object.defineProperty(e,"__esModule",{value:!0}),e.BufferReader=void 0;var t=ne.allocUnsafe(0),r=class{constructor(e=0){this.offset=e,this.buffer=t,this.encoding="utf-8"}setBuffer(e,t){this.offset=e,this.buffer=t}int16(){let e=this.buffer.readInt16BE(this.offset);return this.offset+=2,e}byte(){let e=this.buffer[this.offset];return this.offset++,e}int32(){let e=this.buffer.readInt32BE(this.offset);return this.offset+=4,e}string(e){let t=this.buffer.toString(this.encoding,this.offset,this.offset+e);return this.offset+=e,t}cstring(){let e=this.offset,t=e;for(;0!==this.buffer[t++];);return this.offset=t,this.buffer.toString(this.encoding,e,t-1)}bytes(e){let t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}};nl(r,"BufferReader"),e.BufferReader=r}),iA=nc(e=>{nv(),Object.defineProperty(e,"__esModule",{value:!0}),e.Parser=void 0;var t=iE(),r=iT(),n=ne.allocUnsafe(0),i=class{constructor(e){if(this.buffer=n,this.bufferLength=0,this.bufferOffset=0,this.reader=new r.BufferReader,e?.mode==="binary")throw Error("Binary mode not supported yet");this.mode=e?.mode||"text"}parse(e,t){this.mergeBuffer(e);let r=this.bufferOffset+this.bufferLength,i=this.bufferOffset;for(;i+5<=r;){let e=this.buffer[i],n=this.buffer.readUInt32BE(i+1),o=1+n;if(o+i<=r)t(this.handlePacket(i+5,e,n,this.buffer)),i+=o;else break}i===r?(this.buffer=n,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=r-i,this.bufferOffset=i)}mergeBuffer(e){if(this.bufferLength>0){let t=this.bufferLength+e.byteLength;if(t+this.bufferOffset>this.buffer.byteLength){let e;if(t<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)e=this.buffer;else{let r=2*this.buffer.byteLength;for(;t>=r;)r*=2;e=ne.allocUnsafe(r)}this.buffer.copy(e,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=e,this.bufferOffset=0}e.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=t}else this.buffer=e,this.bufferOffset=0,this.bufferLength=e.byteLength}handlePacket(e,r,n,i){switch(r){case 50:return t.bindComplete;case 49:return t.parseComplete;case 51:return t.closeComplete;case 110:return t.noData;case 115:return t.portalSuspended;case 99:return t.copyDone;case 87:return t.replicationStart;case 73:return t.emptyQuery;case 68:return this.parseDataRowMessage(e,n,i);case 67:return this.parseCommandCompleteMessage(e,n,i);case 90:return this.parseReadyForQueryMessage(e,n,i);case 65:return this.parseNotificationMessage(e,n,i);case 82:return this.parseAuthenticationResponse(e,n,i);case 83:return this.parseParameterStatusMessage(e,n,i);case 75:return this.parseBackendKeyData(e,n,i);case 69:return this.parseErrorMessage(e,n,i,"error");case 78:return this.parseErrorMessage(e,n,i,"notice");case 84:return this.parseRowDescriptionMessage(e,n,i);case 116:return this.parseParameterDescriptionMessage(e,n,i);case 71:return this.parseCopyInMessage(e,n,i);case 72:return this.parseCopyOutMessage(e,n,i);case 100:return this.parseCopyData(e,n,i);default:return new t.DatabaseError("received invalid response: "+r.toString(16),n,"error")}}parseReadyForQueryMessage(e,r,n){this.reader.setBuffer(e,n);let i=this.reader.string(1);return new t.ReadyForQueryMessage(r,i)}parseCommandCompleteMessage(e,r,n){this.reader.setBuffer(e,n);let i=this.reader.cstring();return new t.CommandCompleteMessage(r,i)}parseCopyData(e,r,n){let i=n.slice(e,e+(r-4));return new t.CopyDataMessage(r,i)}parseCopyInMessage(e,t,r){return this.parseCopyMessage(e,t,r,"copyInResponse")}parseCopyOutMessage(e,t,r){return this.parseCopyMessage(e,t,r,"copyOutResponse")}parseCopyMessage(e,r,n,i){this.reader.setBuffer(e,n);let o=0!==this.reader.byte(),s=this.reader.int16(),a=new t.CopyResponse(r,i,o,s);for(let e=0;e<s;e++)a.columnTypes[e]=this.reader.int16();return a}parseNotificationMessage(e,r,n){this.reader.setBuffer(e,n);let i=this.reader.int32(),o=this.reader.cstring(),s=this.reader.cstring();return new t.NotificationResponseMessage(r,i,o,s)}parseRowDescriptionMessage(e,r,n){this.reader.setBuffer(e,n);let i=this.reader.int16(),o=new t.RowDescriptionMessage(r,i);for(let e=0;e<i;e++)o.fields[e]=this.parseField();return o}parseField(){let e=this.reader.cstring(),r=this.reader.int32(),n=this.reader.int16(),i=this.reader.int32(),o=this.reader.int16(),s=this.reader.int32(),a=0===this.reader.int16()?"text":"binary";return new t.Field(e,r,n,i,o,s,a)}parseParameterDescriptionMessage(e,r,n){this.reader.setBuffer(e,n);let i=this.reader.int16(),o=new t.ParameterDescriptionMessage(r,i);for(let e=0;e<i;e++)o.dataTypeIDs[e]=this.reader.int32();return o}parseDataRowMessage(e,r,n){this.reader.setBuffer(e,n);let i=this.reader.int16(),o=Array(i);for(let e=0;e<i;e++){let t=this.reader.int32();o[e]=-1===t?null:this.reader.string(t)}return new t.DataRowMessage(r,o)}parseParameterStatusMessage(e,r,n){this.reader.setBuffer(e,n);let i=this.reader.cstring(),o=this.reader.cstring();return new t.ParameterStatusMessage(r,i,o)}parseBackendKeyData(e,r,n){this.reader.setBuffer(e,n);let i=this.reader.int32(),o=this.reader.int32();return new t.BackendKeyDataMessage(r,i,o)}parseAuthenticationResponse(e,r,n){this.reader.setBuffer(e,n);let i=this.reader.int32(),o={name:"authenticationOk",length:r};switch(i){case 0:break;case 3:8===o.length&&(o.name="authenticationCleartextPassword");break;case 5:if(12===o.length){o.name="authenticationMD5Password";let e=this.reader.bytes(4);return new t.AuthenticationMD5Password(r,e)}break;case 10:let s;o.name="authenticationSASL",o.mechanisms=[];do(s=this.reader.cstring())&&o.mechanisms.push(s);while(s)break;case 11:o.name="authenticationSASLContinue",o.data=this.reader.string(r-8);break;case 12:o.name="authenticationSASLFinal",o.data=this.reader.string(r-8);break;default:throw Error("Unknown authenticationOk message type "+i)}return o}parseErrorMessage(e,r,n,i){this.reader.setBuffer(e,n);let o={},s=this.reader.string(1);for(;"\0"!==s;)o[s]=this.reader.cstring(),s=this.reader.string(1);let a=o.M,l="notice"===i?new t.NoticeMessage(r,a):new t.DatabaseError(a,r,i);return l.severity=o.S,l.code=o.C,l.detail=o.D,l.hint=o.H,l.position=o.P,l.internalPosition=o.p,l.internalQuery=o.q,l.where=o.W,l.schema=o.s,l.table=o.t,l.column=o.c,l.dataType=o.d,l.constraint=o.n,l.file=o.F,l.line=o.L,l.routine=o.R,l}};nl(i,"Parser"),e.Parser=i}),iC=nc(e=>{nv(),Object.defineProperty(e,"__esModule",{value:!0}),e.DatabaseError=e.serialize=e.parse=void 0;var t=iE();Object.defineProperty(e,"DatabaseError",{enumerable:!0,get:nl(function(){return t.DatabaseError},"get")});var r=iS();Object.defineProperty(e,"serialize",{enumerable:!0,get:nl(function(){return r.serialize},"get")});var n=iA();function i(e,t){let r=new n.Parser;return e.on("data",e=>r.parse(e,t)),new Promise(t=>e.on("end",()=>t()))}nl(i,"parse"),e.parse=i}),iO={};function iw({socket:e,servername:t}){return e.startTls(t),e}nd(iO,{connect:()=>iw});var iI=nu(()=>{nv(),nl(iw,"connect")}),iR=nc((e,t)=>{nv();var r=(iv(),nf(ih)),n=nE().EventEmitter,{parse:i,serialize:o}=iC(),s=o.flush(),a=o.sync(),l=o.end(),u=class extends n{constructor(e){super(),e=e||{},this.stream=e.stream||new r.Socket,this._keepAlive=e.keepAlive,this._keepAliveInitialDelayMillis=e.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=e.ssl||!1,this._ending=!1,this._emitMessage=!1;var t=this;this.on("newListener",function(e){"message"===e&&(t._emitMessage=!0)})}connect(e,t){var n=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(e,t),this.stream.once("connect",function(){n._keepAlive&&n.stream.setKeepAlive(!0,n._keepAliveInitialDelayMillis),n.emit("connect")});let i=nl(function(e){n._ending&&("ECONNRESET"===e.code||"EPIPE"===e.code)||n.emit("error",e)},"reportStreamError");if(this.stream.on("error",i),this.stream.on("close",function(){n.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(e){switch(e.toString("utf8")){case"S":break;case"N":return n.stream.end(),n.emit("error",Error("The server does not support SSL connections"));default:return n.stream.end(),n.emit("error",Error("There was an error establishing an SSL connection"))}var o=(iI(),nf(iO));let s={socket:n.stream};!0!==n.ssl&&(Object.assign(s,n.ssl),"key"in n.ssl&&(s.key=n.ssl.key)),0===r.isIP(t)&&(s.servername=t);try{n.stream=o.connect(s)}catch(e){return n.emit("error",e)}n.attachListeners(n.stream),n.stream.on("error",i),n.emit("sslconnect")})}attachListeners(e){e.on("end",()=>{this.emit("end")}),i(e,e=>{var t="error"===e.name?"errorMessage":e.name;this._emitMessage&&this.emit("message",e),this.emit(t,e)})}requestSsl(){this.stream.write(o.requestSsl())}startup(e){this.stream.write(o.startup(e))}cancel(e,t){this._send(o.cancel(e,t))}password(e){this._send(o.password(e))}sendSASLInitialResponseMessage(e,t){this._send(o.sendSASLInitialResponseMessage(e,t))}sendSCRAMClientFinalMessage(e){this._send(o.sendSCRAMClientFinalMessage(e))}_send(e){return!!this.stream.writable&&this.stream.write(e)}query(e){this._send(o.query(e))}parse(e){this._send(o.parse(e))}bind(e){this._send(o.bind(e))}execute(e){this._send(o.execute(e))}flush(){this.stream.writable&&this.stream.write(s)}sync(){this._ending=!0,this._send(s),this._send(a)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){return(this._ending=!0,this._connecting&&this.stream.writable)?this.stream.write(l,()=>{this.stream.end()}):void this.stream.end()}close(e){this._send(o.close(e))}describe(e){this._send(o.describe(e))}sendCopyFromChunk(e){this._send(o.copyData(e))}endCopyFrom(){this._send(o.copyDone())}sendCopyFail(e){this._send(o.copyFail(e))}};nl(u,"Connection"),t.exports=u}),ix=nc((e,t)=>{nv();var r=nE().EventEmitter,n=(nT(),nf(nb),nW()),i=nJ(),o=n7(),s=ie(),a=iu(),l=id(),u=nV(),c=iR(),d=class extends r{constructor(e){super(),this.connectionParameters=new a(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var t=e||{};this._Promise=t.Promise||r4.Promise,this._types=new s(t.types),this._ending=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=t.connection||new c({stream:t.stream,ssl:this.connectionParameters.ssl,keepAlive:t.keepAlive||!1,keepAliveInitialDelayMillis:t.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=t.binary||u.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=t.connectionTimeoutMillis||0}_errorAllQueries(e){let t=nl(t=>{nt.nextTick(()=>{t.handleError(e,this.connection)})},"enqueueError");this.activeQuery&&(t(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(t),this.queryQueue.length=0}_connect(e){var t=this,r=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let t=Error("Client has already been connected. You cannot reuse a client.");nt.nextTick(()=>{e(t)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{r._ending=!0,r.stream.destroy(Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&0===this.host.indexOf("/")?r.connect(this.host+"/.s.PGSQL."+this.port):r.connect(this.port,this.host),r.on("connect",function(){t.ssl?r.requestSsl():r.startup(t.getStartupConf())}),r.on("sslconnect",function(){r.startup(t.getStartupConf())}),this._attachListeners(r),r.once("end",()=>{let e=this._ending?Error("Connection terminated"):Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(e),this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(e):this._handleErrorEvent(e):this._connectionError||this._handleErrorEvent(e)),nt.nextTick(()=>{this.emit("end")})})}connect(e){return e?void this._connect(e):new this._Promise((e,t)=>{this._connect(r=>{r?t(r):e()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let t=this.connection;"function"==typeof this.password?this._Promise.resolve().then(()=>this.password()).then(r=>{if(void 0!==r){if("string"!=typeof r)return void t.emit("error",TypeError("Password must be a string"));this.connectionParameters.password=this.password=r}else this.connectionParameters.password=this.password=null;e()}).catch(e=>{t.emit("error",e)}):null!==this.password?e():o(this.connectionParameters,t=>{void 0!==t&&(this.connectionParameters.password=this.password=t),e()})}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(()=>{let t=n.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(t)})}_handleAuthSASL(e){this._checkPgPass(()=>{this.saslSession=i.startSession(e.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)})}_handleAuthSASLContinue(e){i.continueSession(this.saslSession,this.password,e.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}_handleAuthSASLFinal(e){i.finalizeSession(this.saslSession,e.data),this.saslSession=null}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:t}=this;this.activeQuery=null,this.readyForQuery=!0,t&&t.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let t=this.activeQuery;t?(this.activeQuery=null,t.handleError(e,this.connection)):this._handleErrorEvent(e)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(e){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){var e=this.connectionParameters,t={user:e.user,database:e.database},r=e.application_name||e.fallback_application_name;return r&&(t.application_name=r),e.replication&&(t.replication=""+e.replication),e.statement_timeout&&(t.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(t.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(t.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(t.options=e.options),t}cancel(e,t){if(e.activeQuery===t){var r=this.connection;this.host&&0===this.host.indexOf("/")?r.connect(this.host+"/.s.PGSQL."+this.port):r.connect(this.port,this.host),r.on("connect",function(){r.cancel(e.processID,e.secretKey)})}else -1!==e.queryQueue.indexOf(t)&&e.queryQueue.splice(e.queryQueue.indexOf(t),1)}setTypeParser(e,t,r){return this._types.setTypeParser(e,t,r)}getTypeParser(e,t){return this._types.getTypeParser(e,t)}escapeIdentifier(e){return'"'+e.replace(/"/g,'""')+'"'}escapeLiteral(e){for(var t=!1,r="'",n=0;n<e.length;n++){var i=e[n];"'"===i?r+=i+i:"\\"===i?(r+=i+i,t=!0):r+=i}return r+="'",!0===t&&(r=" E"+r),r}_pulseQueryQueue(){if(!0===this.readyForQuery)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&nt.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,t,r){var n,i,o,s,a;if(null==e)throw TypeError("Client was passed a null or undefined query");return"function"==typeof e.submit?(o=e.query_timeout||this.connectionParameters.query_timeout,i=n=e,"function"==typeof t&&(n.callback=n.callback||t)):(o=this.connectionParameters.query_timeout,(n=new l(e,t,r)).callback||(i=new this._Promise((e,t)=>{n.callback=(r,n)=>r?t(r):e(n)}))),o&&(a=n.callback,s=setTimeout(()=>{var e=Error("Query read timeout");nt.nextTick(()=>{n.handleError(e,this.connection)}),a(e),n.callback=()=>{};var t=this.queryQueue.indexOf(n);t>-1&&this.queryQueue.splice(t,1),this._pulseQueryQueue()},o),n.callback=(e,t)=>{clearTimeout(s),a(e,t)}),this.binary&&!n.binary&&(n.binary=!0),n._result&&!n._result._types&&(n._result._types=this._types),this._queryable?this._ending?nt.nextTick(()=>{n.handleError(Error("Client was closed and is not queryable"),this.connection)}):(this.queryQueue.push(n),this._pulseQueryQueue()):nt.nextTick(()=>{n.handleError(Error("Client has encountered a connection error and is not queryable"),this.connection)}),i}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting)if(!e)return this._Promise.resolve();else e();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),!e)return new this._Promise(e=>{this.connection.once("end",e)});this.connection.once("end",e)}};nl(d,"Client"),d.Query=l,t.exports=d}),iP=nc((e,t)=>{nv();var r=nE().EventEmitter,n=nl(function(){},"NOOP"),i=nl((e,t)=>{let r=e.findIndex(t);return -1===r?void 0:e.splice(r,1)[0]},"removeWhere"),o=class{constructor(e,t,r){this.client=e,this.idleListener=t,this.timeoutId=r}};nl(o,"IdleItem");var s=class{constructor(e){this.callback=e}};function a(){throw Error("Release called on client which has already been released to the pool.")}function l(e,t){let r,n;return t?{callback:t,result:void 0}:{callback:nl(function(e,t){e?r(e):n(t)},"cb"),result:new e(function(e,t){n=e,r=t}).catch(e=>{throw Error.captureStackTrace(e),e})}}function u(e,t){return nl(function r(n){n.client=t,t.removeListener("error",r),t.on("error",()=>{e.log("additional client error after disconnection due to error",n)}),e._remove(t),e.emit("error",n,t)},"idleListener")}nl(s,"PendingItem"),nl(a,"throwOnDoubleRelease"),nl(l,"promisify"),nl(u,"makeIdleListener");var c=class extends r{constructor(e,t){super(),this.options=Object.assign({},e),null!=e&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),null!=e&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||t||iq().Client,this.Promise=this.options.Promise||r4.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended)return void this.log("pulse queue ended");if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(e=>{this._remove(e.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length)return void this.log("no queued requests");if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let t=this._idle.pop();clearTimeout(t.timeoutId);let r=t.client;r.ref&&r.ref();let n=t.idleListener;return this._acquireClient(r,e,n,!1)}if(!this._isFull())return this.newClient(e);throw Error("unexpected condition")}_remove(e){let t=i(this._idle,t=>t.client===e);void 0!==t&&clearTimeout(t.timeoutId),this._clients=this._clients.filter(t=>t!==e),e.end(),this.emit("remove",e)}connect(e){if(this.ending){let t=Error("Cannot use a pool after calling end on the pool");return e?e(t):this.Promise.reject(t)}let t=l(this.Promise,e),r=t.result;if(this._isFull()||this._idle.length){if(this._idle.length&&nt.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new s(t.callback)),r;let e=nl((e,r,n)=>{clearTimeout(o),t.callback(e,r,n)},"queueCallback"),n=new s(e),o=setTimeout(()=>{i(this._pendingQueue,t=>t.callback===e),n.timedOut=!0,t.callback(Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(n),r}return this.newClient(new s(t.callback)),r}newClient(e){let t=new this.Client(this.options);this._clients.push(t);let r=u(this,t);this.log("checking client timeout");let i,o=!1;this.options.connectionTimeoutMillis&&(i=setTimeout(()=>{this.log("ending client due to timeout"),o=!0,t.connection?t.connection.stream.destroy():t.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),t.connect(a=>{if(i&&clearTimeout(i),t.on("error",r),a)this.log("client failed to connect",a),this._clients=this._clients.filter(e=>e!==t),o&&(a.message="Connection terminated due to connection timeout"),this._pulseQueue(),e.timedOut||e.callback(a,void 0,n);else{if(this.log("new client connected"),0!==this.options.maxLifetimeSeconds){let e=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(t),-1!==this._idle.findIndex(e=>e.client===t)&&this._acquireClient(t,new s((e,t,r)=>r()),r,!1)},1e3*this.options.maxLifetimeSeconds);e.unref(),t.once("end",()=>clearTimeout(e))}return this._acquireClient(t,e,r,!0)}})}_acquireClient(e,t,r,i){i&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,r),e.removeListener("error",r),t.timedOut?i&&this.options.verify?this.options.verify(e,e.release):e.release():i&&this.options.verify?this.options.verify(e,r=>{if(r)return e.release(r),t.callback(r,void 0,n);t.callback(void 0,e,e.release)}):t.callback(void 0,e,e.release)}_releaseOnce(e,t){let r=!1;return n=>{r&&a(),r=!0,this._release(e,t,n)}}_release(e,t,r){let n;if(e.on("error",t),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",r,e),r||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses){e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e),this._pulseQueue();return}if(this._expired.has(e)){this.log("remove expired client"),this._expired.delete(e),this._remove(e),this._pulseQueue();return}this.options.idleTimeoutMillis&&(n=setTimeout(()=>{this.log("remove idle client"),this._remove(e)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&n.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new o(e,t,n)),this._pulseQueue()}query(e,t,r){if("function"==typeof e){let t=l(this.Promise,e);return r9(function(){return t.callback(Error("Passing a function as the first parameter to pool.query is not supported"))}),t.result}"function"==typeof t&&(r=t,t=void 0);let n=l(this.Promise,r);return r=n.callback,this.connect((n,i)=>{if(n)return r(n);let o=!1,s=nl(e=>{o||(o=!0,i.release(e),r(e))},"onError");i.once("error",s),this.log("dispatching query");try{i.query(e,t,(e,t)=>{if(this.log("query dispatched"),i.removeListener("error",s),!o)return o=!0,i.release(e),e?r(e):r(void 0,t)})}catch(e){return i.release(e),r(e)}}),n.result}end(e){if(this.log("ending"),this.ending){let t=Error("Called end on pool more than once");return e?e(t):this.Promise.reject(t)}this.ending=!0;let t=l(this.Promise,e);return this._endCallback=t.callback,this._pulseQueue(),t.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,t)=>e+ +!!this._expired.has(t),0)}get totalCount(){return this._clients.length}};nl(c,"Pool"),t.exports=c}),iN={};nd(iN,{default:()=>iM});var iM,iD=nu(()=>{nv(),iM={}}),ik=nc((e,t)=>{t.exports={name:"pg",version:"8.8.0",description:"PostgreSQL client - pure javascript & libpq with the same API",keywords:["database","libpq","pg","postgre","postgres","postgresql","rdbms"],homepage:"https://github.com/brianc/node-postgres",repository:{type:"git",url:"git://github.com/brianc/node-postgres.git",directory:"packages/pg"},author:"Brian Carlson <brian.m.carlson@gmail.com>",main:"./lib",dependencies:{"buffer-writer":"2.0.0","packet-reader":"1.0.0","pg-connection-string":"^2.5.0","pg-pool":"^3.5.2","pg-protocol":"^1.5.0","pg-types":"^2.1.0",pgpass:"1.x"},devDependencies:{async:"2.6.4",bluebird:"3.5.2",co:"4.6.0","pg-copy-streams":"0.3.0"},peerDependencies:{"pg-native":">=3.0.1"},peerDependenciesMeta:{"pg-native":{optional:!0}},scripts:{test:"make test-all"},files:["lib","SPONSORS.md"],license:"MIT",engines:{node:">= 8.0.0"},gitHead:"c99fb2c127ddf8d712500db2c7b9a5491a178655"}}),iL=nc((e,t)=>{nv();var r=nE().EventEmitter,n=(nT(),nf(nb)),i=nW(),o=t.exports=function(e,t,n){r.call(this),e=i.normalizeQueryConfig(e,t,n),this.text=e.text,this.values=e.values,this.name=e.name,this.callback=e.callback,this.state="new",this._arrayMode="array"===e.rowMode,this._emitRowEvents=!1,this.on("newListener",(function(e){"row"===e&&(this._emitRowEvents=!0)}).bind(this))};n.inherits(o,r);var s={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};o.prototype.handleError=function(e){var t=this.native.pq.resultErrorFields();if(t)for(var r in t)e[s[r]||r]=t[r];this.callback?this.callback(e):this.emit("error",e),this.state="error"},o.prototype.then=function(e,t){return this._getPromise().then(e,t)},o.prototype.catch=function(e){return this._getPromise().catch(e)},o.prototype._getPromise=function(){return this._promise||(this._promise=new Promise((function(e,t){this._once("end",e),this._once("error",t)}).bind(this))),this._promise},o.prototype.submit=function(e){this.state="running";var t=this;this.native=e.native,e.native.arrayMode=this._arrayMode;var r=nl(function(r,n,i){if(e.native.arrayMode=!1,r9(function(){t.emit("_done")}),r)return t.handleError(r);t._emitRowEvents&&(i.length>1?n.forEach((e,r)=>{e.forEach(e=>{t.emit("row",e,i[r])})}):n.forEach(function(e){t.emit("row",e,i)})),t.state="end",t.emit("end",i),t.callback&&t.callback(null,i)},"after");if(nt.domain&&(r=nt.domain.bind(r)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var n=(this.values||[]).map(i.prepareValue);if(e.namedQueries[this.name]){if(this.text&&e.namedQueries[this.name]!==this.text){let e=Error(`Pre\
pared statements must be unique - '${this.name}' was used for a different statem\
ent`);return r(e)}return e.native.execute(this.name,n,r)}return e.native.prepare(this.name,this.text,n.length,function(i){return i?r(i):(e.namedQueries[t.name]=t.text,t.native.execute(t.name,n,r))})}if(this.values){if(!Array.isArray(this.values)){let e=Error("Query values must be an array");return r(e)}var o=this.values.map(i.prepareValue);e.native.query(this.text,o,r)}else e.native.query(this.text,r)}}),iU=nc((e,t)=>{nv();var r=(iD(),nf(iN)),n=ie(),i=(ik(),nE().EventEmitter),o=(nT(),nf(nb)),s=iu(),a=iL(),l=t.exports=function(e){i.call(this),e=e||{},this._Promise=e.Promise||r4.Promise,this._types=new n(e.types),this.native=new r({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var t=this.connectionParameters=new s(e);this.user=t.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:t.password}),this.database=t.database,this.host=t.host,this.port=t.port,this.namedQueries={}};l.Query=a,o.inherits(l,i),l.prototype._errorAllQueries=function(e){let t=nl(t=>{nt.nextTick(()=>{t.native=this.native,t.handleError(e)})},"enqueueError");this._hasActiveQuery()&&(t(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(t),this._queryQueue.length=0},l.prototype._connect=function(e){var t=this;this._connecting?nt.nextTick(()=>e(Error("Client has already been connected. You cannot reuse a client."))):(this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(r,n){if(r)return e(r);t.native.connect(n,function(r){if(r)return t.native.end(),e(r);t._connected=!0,t.native.on("error",function(e){t._queryable=!1,t._errorAllQueries(e),t.emit("error",e)}),t.native.on("notification",function(e){t.emit("notification",{channel:e.relname,payload:e.extra})}),t.emit("connect"),t._pulseQueryQueue(!0),e()})}))},l.prototype.connect=function(e){return e?void this._connect(e):new this._Promise((e,t)=>{this._connect(r=>{r?t(r):e()})})},l.prototype.query=function(e,t,r){var n,i,o,s,l;if(null==e)throw TypeError("Client was passed a null or undefined query");if("function"==typeof e.submit)o=e.query_timeout||this.connectionParameters.query_timeout,i=n=e,"function"==typeof t&&(e.callback=t);else if(o=this.connectionParameters.query_timeout,!(n=new a(e,t,r)).callback){let e,t;i=new this._Promise((r,n)=>{e=r,t=n}),n.callback=(r,n)=>r?t(r):e(n)}return o&&(l=n.callback,s=setTimeout(()=>{var e=Error("Query read timeout");nt.nextTick(()=>{n.handleError(e,this.connection)}),l(e),n.callback=()=>{};var t=this._queryQueue.indexOf(n);t>-1&&this._queryQueue.splice(t,1),this._pulseQueryQueue()},o),n.callback=(e,t)=>{clearTimeout(s),l(e,t)}),this._queryable?this._ending?(n.native=this.native,nt.nextTick(()=>{n.handleError(Error("Client was closed and is not queryable"))})):(this._queryQueue.push(n),this._pulseQueryQueue()):(n.native=this.native,nt.nextTick(()=>{n.handleError(Error("Client has encountered a connection error and is not queryable"))})),i},l.prototype.end=function(e){var t,r=this;return this._ending=!0,this._connected||this.once("connect",this.end.bind(this,e)),e||(t=new this._Promise(function(t,r){e=nl(e=>e?r(e):t(),"cb")})),this.native.end(function(){r._errorAllQueries(Error("Connection terminated")),nt.nextTick(()=>{r.emit("end"),e&&e()})}),t},l.prototype._hasActiveQuery=function(){return this._activeQuery&&"error"!==this._activeQuery.state&&"end"!==this._activeQuery.state},l.prototype._pulseQueryQueue=function(e){if(this._connected&&!this._hasActiveQuery()){var t=this._queryQueue.shift();if(!t){e||this.emit("drain");return}this._activeQuery=t,t.submit(this);var r=this;t.once("_done",function(){r._pulseQueryQueue()})}},l.prototype.cancel=function(e){this._activeQuery===e?this.native.cancel(function(){}):-1!==this._queryQueue.indexOf(e)&&this._queryQueue.splice(this._queryQueue.indexOf(e),1)},l.prototype.ref=function(){},l.prototype.unref=function(){},l.prototype.setTypeParser=function(e,t,r){return this._types.setTypeParser(e,t,r)},l.prototype.getTypeParser=function(e,t){return this._types.getTypeParser(e,t)}}),iB=nc((e,t)=>{nv(),t.exports=iU()}),iq=nc((e,t)=>{nv();var r=ix(),n=nV(),i=iR(),o=iP(),{DatabaseError:s}=iC(),a=nl(e=>{var t;return nl(t=class extends o{constructor(t){super(t,e)}},"BoundPool"),t},"poolFactory"),l=nl(function(e){this.defaults=n,this.Client=e,this.Query=this.Client.Query,this.Pool=a(this.Client),this._pools=[],this.Connection=i,this.types=n$(),this.DatabaseError=s},"PG");"u">typeof nt.env.NODE_PG_FORCE_NATIVE?t.exports=new l(iB()):(t.exports=new l(r),Object.defineProperty(t.exports,"native",{configurable:!0,enumerable:!1,get(){var e=null;try{e=new l(iB())}catch(e){if("MODULE_NOT_FOUND"!==e.code)throw e}return Object.defineProperty(t.exports,"native",{value:e}),e}}))});nv();var ij=np(iq());iv(),nv(),ia(),iv();var iF=np(nW()),iG=class extends Error{constructor(){super(...arguments),nm(this,"name","NeonDbError"),nm(this,"severity"),nm(this,"code"),nm(this,"detail"),nm(this,"hint"),nm(this,"position"),nm(this,"internalPosition"),nm(this,"internalQuery"),nm(this,"where"),nm(this,"schema"),nm(this,"table"),nm(this,"column"),nm(this,"dataType"),nm(this,"constraint"),nm(this,"file"),nm(this,"line"),nm(this,"routine"),nm(this,"sourceError")}};nl(iG,"NeonDbError");var iH="transaction() expects an array of queries, or a function returning an array of queries",i$=["severity","code","detail","hint","position","internalPosition","internalQuery","where","schema","table","column","dataType","constraint","file","line","routine"];function iV(e,{arrayMode:t,fullResults:r,fetchOptions:n,isolationLevel:i,readOnly:o,deferrable:s,queryCallback:a,resultCallback:l}={}){let u;if(!e)throw Error("No database connection string was provided to `neon()`. Perhaps an environment variable has not been set?");try{u=is(e)}catch{throw Error("Database connection string provided to `neon()` is not a valid URL. Connection string: "+String(e))}let{protocol:c,username:d,password:h,hostname:p,port:f,pathname:m}=u;if("postgres:"!==c&&"postgresql:"!==c||!d||!h||!p||!m)throw Error("Database connection string format for `neon()` should be: postgresql://user:password@host.tld/dbname?option=value");function g(e,...t){let r,n;if("string"==typeof e)r=e,n=t[1],t=t[0]??[];else{r="";for(let n=0;n<e.length;n++)r+=e[n],n<t.length&&(r+="$"+(n+1))}let i={query:r,params:t=t.map(e=>(0,iF.prepareValue)(e))};return a&&a(i),iW(y,i,n)}async function y(a,u,c){let d,{fetchEndpoint:h,fetchFunction:m}=i_,g="function"==typeof h?h(p,f):h,y=Array.isArray(a)?{queries:a}:a,_=n??{},v=t??!1,E=r??!1,b=i,S=o,T=s;void 0!==c&&(void 0!==c.fetchOptions&&(_={..._,...c.fetchOptions}),void 0!==c.arrayMode&&(v=c.arrayMode),void 0!==c.fullResults&&(E=c.fullResults),void 0!==c.isolationLevel&&(b=c.isolationLevel),void 0!==c.readOnly&&(S=c.readOnly),void 0!==c.deferrable&&(T=c.deferrable)),void 0===u||Array.isArray(u)||void 0===u.fetchOptions||(_={..._,...u.fetchOptions});let A={"Neon-Connection-String":e,"Neon-Raw-Text-Output":"true","Neon-Array-Mode":"true"};Array.isArray(a)&&(void 0!==b&&(A["Neon-Batch-Isolation-Level"]=b),void 0!==S&&(A["Neon-Batch-Read-Only"]=String(S)),void 0!==T&&(A["Neon-Batch-Deferrable"]=String(T)));try{d=await (m??fetch)(g,{method:"POST",body:JSON.stringify(y),headers:A,..._})}catch(t){let e=new iG(`Error connecting to database: ${t.message}`);throw e.sourceError=t,e}if(d.ok){let e=await d.json();if(Array.isArray(a)){let t=e.results;if(!Array.isArray(t))throw new iG("Neon internal error: unexpected result format");return t.map((e,t)=>{let r=u[t]??{};return iJ(e,{arrayMode:r.arrayMode??v,fullResults:r.fullResults??E,parameterizedQuery:a[t],resultCallback:l})})}{let t=u??{};return iJ(e,{arrayMode:t.arrayMode??v,fullResults:t.fullResults??E,parameterizedQuery:a,resultCallback:l})}}{let{status:e}=d;if(400===e){let e=await d.json(),t=new iG(e.message);for(let r of i$)t[r]=e[r]??void 0;throw t}{let t=await d.text();throw new iG(`Server error (HTTP status ${e}): ${t}`)}}}return nl(g,"resolve"),g.transaction=async(e,t)=>{if("function"==typeof e&&(e=e(g)),!Array.isArray(e))throw Error(iH);return e.forEach(e=>{if("NeonQueryPromise"!==e[Symbol.toStringTag])throw Error(iH)}),y(e.map(e=>e.parameterizedQuery),e.map(e=>e.opts??{}),t)},nl(y,"execute"),g}function iW(e,t,r){return{[Symbol.toStringTag]:"NeonQueryPromise",parameterizedQuery:t,opts:r,then:nl((n,i)=>e(t,r).then(n,i),"then"),catch:nl(n=>e(t,r).catch(n),"catch"),finally:nl(n=>e(t,r).finally(n),"finally")}}function iJ(e,{arrayMode:t,fullResults:r,parameterizedQuery:n,resultCallback:i}){let o=e.fields.map(e=>e.name),s=e.fields.map(e=>iY.types.getTypeParser(e.dataTypeID)),a=!0===t?e.rows.map(e=>e.map((e,t)=>null===e?null:s[t](e))):e.rows.map(e=>Object.fromEntries(e.map((e,t)=>[o[t],null===e?null:s[t](e)])));return i&&i(n,e,a,{arrayMode:t,fullResults:r}),r?(e.viaNeonFetch=!0,e.rowAsArray=t,e.rows=a,e):a}nl(iV,"neon"),nl(iW,"createNeonQueryPromise"),nl(iJ,"processQueryResult");var iK=np(iu()),iY=np(iq()),iQ=class extends ij.Client{constructor(e){super(e),this.config=e}get neonConfig(){return this.connection.stream}connect(e){let{neonConfig:t}=this;t.forceDisablePgSSL&&(this.ssl=this.connection.ssl=!1),this.ssl&&t.useSecureWebSocket&&console.warn("SSL is enabled for both Postgres (e.g. ?sslmode=require in the connection string + forceDisablePgSSL = false) and the WebSocket tunnel (useSecureWebSocket = true). Double encryption will increase latency and CPU usage. It may be appropriate to disable SSL in the Postgres connection parameters or set forceDisablePgSSL = true.");let r=this.config?.host!==void 0||this.config?.connectionString!==void 0||void 0!==nt.env.PGHOST,n=nt.env.USER??nt.env.USERNAME;if(!r&&"localhost"===this.host&&this.user===n&&this.database===n&&null===this.password)throw Error(`No datab\
ase host or connection string was set, and key parameters have default values (h\
ost: localhost, user: ${n}, db: ${n}, password: null). Is an environment variabl\
e missing? Alternatively, if you intended to connect with these parameters, plea\
se set the host to 'localhost' explicitly.`);let i=super.connect(e),o=t.pipelineTLS&&this.ssl,s="password"===t.pipelineConnect;if(!o&&!t.pipelineConnect)return i;let a=this.connection;if(o&&a.on("connect",()=>a.stream.emit("data","S")),s){a.removeAllListeners("authenticationCleartextPassword"),a.removeAllListeners("readyForQuery"),a.once("readyForQuery",()=>a.on("readyForQuery",this._handleReadyForQuery.bind(this)));let e=this.ssl?"sslconnect":"connect";a.on(e,()=>{this._handleAuthCleartextPassword(),this._handleReadyForQuery()})}return i}async _handleAuthSASLContinue(e){let t=this.saslSession,r=this.password,n=e.data;if("SASLInitialResponse"!==t.message||"string"!=typeof r||"string"!=typeof n)throw Error("SASL: protocol error");let i=Object.fromEntries(n.split(",").map(e=>{if(!/^.=/.test(e))throw Error("SASL: Invalid attribute pair entry");return[e[0],e.substring(2)]})),o=i.r,s=i.s,a=i.i;if(!o||!/^[!-+--~]+$/.test(o))throw Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce missing/unprintable");if(!s||!/^(?:[a-zA-Z0-9+/]{4})*(?:[a-zA-Z0-9+/]{2}==|[a-zA-Z0-9+/]{3}=)?$/.test(s))throw Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt missing/not base64");if(!a||!/^[1-9][0-9]*$/.test(a))throw Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: missing/invalid iteration count");if(!o.startsWith(t.clientNonce))throw Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce does not start with client nonce");if(o.length===t.clientNonce.length)throw Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce is too short");let l=parseInt(a,10),u=ne.from(s,"base64"),c=new TextEncoder,d=c.encode(r),h=await r7.subtle.importKey("raw",d,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),p=new Uint8Array(await r7.subtle.sign("HMAC",h,ne.concat([u,ne.from([0,0,0,1])]))),f=p;for(var m=0;m<l-1;m++)p=new Uint8Array(await r7.subtle.sign("HMAC",h,p)),f=ne.from(f.map((e,t)=>f[t]^p[t]));let g=f,y=await r7.subtle.importKey("raw",g,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),_=new Uint8Array(await r7.subtle.sign("HMAC",y,c.encode("Client Key"))),v=await r7.subtle.digest("SHA-256",_),E="n=*,r="+t.clientNonce,b="r="+o+",s="+s+",i="+l,S="c=biws,r="+o,T=E+","+b+","+S,A=await r7.subtle.importKey("raw",v,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);var C=new Uint8Array(await r7.subtle.sign("HMAC",A,c.encode(T))),O=ne.from(_.map((e,t)=>_[t]^C[t])).toString("base64");let w=await r7.subtle.importKey("raw",g,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),I=await r7.subtle.sign("HMAC",w,c.encode("Server Key")),R=await r7.subtle.importKey("raw",I,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);var x=ne.from(await r7.subtle.sign("HMAC",R,c.encode(T)));t.message="SASLResponse",t.serverSignature=x.toString("base64"),t.response=S+",p="+O,this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}};function iz(e,t){let r,n;return t?{callback:t,result:void 0}:{callback:nl(function(e,t){e?r(e):n(t)},"cb"),result:new e(function(e,t){n=e,r=t})}}if(nl(iQ,"NeonClient"),nl(iz,"promisify"),nl(class extends ij.Pool{constructor(){super(...arguments),nm(this,"Client",iQ),nm(this,"hasFetchUnsupportedListeners",!1)}on(e,t){return"error"!==e&&(this.hasFetchUnsupportedListeners=!0),super.on(e,t)}query(e,t,r){if(!i_.poolQueryViaFetch||this.hasFetchUnsupportedListeners||"function"==typeof e)return super.query(e,t,r);"function"==typeof t&&(r=t,t=void 0);let n=iz(this.Promise,r);r=n.callback;try{let n=new iK.default(this.options),i=encodeURIComponent,o=encodeURI,s=`postgresql://${i(n.user)}:${i(n.password)}@${i(n.host)}/${o(n.database)}`,a="string"==typeof e?e:e.text,l=t??e.values??[];iV(s,{fullResults:!0,arrayMode:"array"===e.rowMode})(a,l).then(e=>r(void 0,e)).catch(e=>r(e))}catch(e){r(e)}return n.result}},"NeonPool"),iY.ClientBase,iY.Connection,iY.DatabaseError,iY.Query,iY.defaults,iY.types,i_.fetchConnectionCache=!0,!process.env.POSTGRES_URL)throw Error("Varivel de ambiente POSTGRES_URL no definida.");let iX=iV(process.env.POSTGRES_URL),iZ=e=>({id:String(e.id),generationDate:e.generation_date,title:e.title,rawContent:e.raw_content,formattedContent:e.formatted_content||"",published:e.published,keywords:Array.isArray(e.keywords)?e.keywords:"string"==typeof e.keywords?e.keywords.split(",").map(e=>e.trim()):[],metaDescription:e.meta_description||""});async function i0(){try{await iX`
      CREATE TABLE IF NOT EXISTS articles (
        id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
        generation_date TIMESTAMPTZ NOT NULL,
        title TEXT NOT NULL,
        raw_content TEXT NOT NULL,
        formatted_content TEXT,
        published BOOLEAN NOT NULL DEFAULT false,
        keywords TEXT[],
        meta_description TEXT
      );
    `,console.log(" Tabela 'articles' verificada/criada com sucesso.")}catch(e){throw console.error(" Falha na configurao do banco de dados:",e),Error("Falha ao configurar a tabela do banco de dados.")}}async function i1(e){try{let t=await iX`
      INSERT INTO articles (
        generation_date, title, raw_content, formatted_content, published, keywords, meta_description
      )
      VALUES (
        ${e.generationDate},
        ${e.title},
        ${e.rawContent},
        ${e.formattedContent||""},
        ${e.published??!1},
        ${Array.isArray(e.keywords)?e.keywords:[e.keywords]},
        ${e.metaDescription||""}
      )
      RETURNING *;
    `,r=Array.isArray(t)?t[0]:t;return console.log(` Artigo salvo com sucesso (ID: ${r.id})`),iZ(r)}catch(e){throw console.error(" Erro ao salvar artigo:",e),Error("Falha ao salvar o artigo.")}}async function i2(e){try{let t=await iX`SELECT * FROM articles WHERE id = ${e} LIMIT 1;`,r=Array.isArray(t)?t[0]:t;if(!r)return null;return console.log("## retorno do select"),console.log(r),iZ(r)}catch(e){throw console.error(" Erro ao buscar artigo:",e),Error("Falha ao buscar o artigo por ID.")}}async function i6(e,t){try{let r=Object.keys(t);if(0===r.length)return;let n=r.map((e,t)=>`${e.replace(/([A-Z])/g,"_$1").toLowerCase()} = $${t+1}`).join(", "),i=Object.values(t),o=`
      UPDATE articles
      SET ${n}
      WHERE id = $${r.length+1};
    `;await iX(o,[...i,e]),console.log(` Artigo ${e} atualizado (${r.join(", ")})`)}catch(e){throw console.error(" Erro ao atualizar artigo:",e),Error("Falha ao atualizar o artigo.")}}async function i3(){try{let e=await iX`SELECT * FROM articles ORDER BY generation_date DESC;`;return(Array.isArray(e)?e:e?[e]:[]).map(iZ)}catch(e){throw console.error(" Erro ao buscar artigos:",e),Error("Falha ao buscar os artigos.")}}async function i8(e,t,r){try{let n=await tS(e,t,r),o=await tT(n),{keywords:s,metaDescription:a}=await tA(n,r),l={title:e,rawContent:n,formattedContent:o,generationDate:new Date().toISOString(),published:!1,keywords:s,metaDescription:a},u=await i1(l);return(0,i.revalidatePath)("/dashboard/history"),{...u,published:!0}}catch(e){throw console.error(" Erro em generateAndSaveArticleAction:",e),Error(`Falha ao gerar e salvar o artigo: ${e instanceof Error?e.message:String(e)}`)}}async function i5(e){try{let t={title:e.title,rawContent:e.content,formattedContent:"",generationDate:new Date().toISOString(),published:!1,keywords:[""],metaDescription:""},r=await i1(t);return console.log(` Rascunho salvo com ID: ${r.id}`),(0,i.revalidatePath)("/dashboard/history"),r}catch(e){throw console.error(" Erro ao salvar rascunho:",e),Error("Falha ao salvar rascunho.")}}async function i4(e){try{return await i2(e)}catch(e){return console.error(" Erro ao buscar artigo:",e),null}}async function i9(e,t){try{await i6(e,{formattedContent:t}),console.log(` HTML atualizado com sucesso para o artigo ${e}`),(0,i.revalidatePath)("/dashboard/history")}catch(e){throw console.error(" Erro ao atualizar HTML:",e),Error("Falha ao atualizar o HTML do artigo.")}}async function i7(e,t){try{await i6(e,{keywords:t.keywords,metaDescription:t.metaDescription,published:!0,generationDate:new Date().toISOString()}),console.log(` SEO atualizado e artigo ${e} publicado com sucesso.`),(0,i.revalidatePath)("/dashboard/history")}catch(e){throw console.error(" Erro ao atualizar SEO:",e),Error("Falha ao atualizar SEO do artigo.")}}async function oe(){try{return await i0(),await i3()}catch(e){return console.error(" Erro em getArticlesAction:",e),[]}}(0,e.i(95975).ensureServerEntryExports)([i8,i5,i4,i9,i7,oe]),(0,n.registerServerReference)(i8,"70f12876fc0e134895d97a7ded794efaca2a696c9b",null),(0,n.registerServerReference)(i5,"40beaf35ecbbfb8886c6be979c13bf3516a379c0e5",null),(0,n.registerServerReference)(i4,"400e61989097eb8b9f68c780e0d03ac63cfdf09c02",null),(0,n.registerServerReference)(i9,"600f1d6fd2e8bc63d9f50ada752da9b53c4faada57",null),(0,n.registerServerReference)(i7,"60b3884135d67f03b04d28d68149fff07fc9729e4b",null),(0,n.registerServerReference)(oe,"00fe0019f97a45ff59a91728708b782e5fa671df37",null),e.s(["generateAndSaveArticleAction",()=>i8,"getArticleById",()=>i4,"saveArticleDraft",()=>i5,"updateArticleHtml",()=>i9,"updateArticleSeo",()=>i7],7312)}];

//# sourceMappingURL=_d4f9e853._.js.map