module.exports=[97953,(e,t,r)=>{"use strict";t.exports=e.r(42315).vendored["react-rsc"].ReactServerDOMTurbopackServer},45015,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"registerServerReference",{enumerable:!0,get:function(){return n.registerServerReference}});let n=e.r(97953)},64839,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,s,a,i,o,l,c,u,d,h,f,p,m={AppRenderSpan:function(){return S},AppRouteRouteHandlersSpan:function(){return T},BaseServerSpan:function(){return _},LoadComponentsSpan:function(){return y},LogSpanAllowList:function(){return N},MiddlewareSpan:function(){return C},NextNodeServerSpan:function(){return v},NextServerSpan:function(){return b},NextVanillaSpanAllowlist:function(){return x},NodeSpan:function(){return O},RenderSpan:function(){return E},ResolveMetadataSpan:function(){return A},RouterSpan:function(){return R},StartServerSpan:function(){return w}};for(var g in m)Object.defineProperty(r,g,{enumerable:!0,get:m[g]});var _=((n=_||{}).handleRequest="BaseServer.handleRequest",n.run="BaseServer.run",n.pipe="BaseServer.pipe",n.getStaticHTML="BaseServer.getStaticHTML",n.render="BaseServer.render",n.renderToResponseWithComponents="BaseServer.renderToResponseWithComponents",n.renderToResponse="BaseServer.renderToResponse",n.renderToHTML="BaseServer.renderToHTML",n.renderError="BaseServer.renderError",n.renderErrorToResponse="BaseServer.renderErrorToResponse",n.renderErrorToHTML="BaseServer.renderErrorToHTML",n.render404="BaseServer.render404",n),y=((s=y||{}).loadDefaultErrorComponents="LoadComponents.loadDefaultErrorComponents",s.loadComponents="LoadComponents.loadComponents",s),b=((a=b||{}).getRequestHandler="NextServer.getRequestHandler",a.getRequestHandlerWithMetadata="NextServer.getRequestHandlerWithMetadata",a.getServer="NextServer.getServer",a.getServerRequestHandler="NextServer.getServerRequestHandler",a.createServer="createServer.createServer",a),v=((i=v||{}).compression="NextNodeServer.compression",i.getBuildId="NextNodeServer.getBuildId",i.createComponentTree="NextNodeServer.createComponentTree",i.clientComponentLoading="NextNodeServer.clientComponentLoading",i.getLayoutOrPageModule="NextNodeServer.getLayoutOrPageModule",i.generateStaticRoutes="NextNodeServer.generateStaticRoutes",i.generateFsStaticRoutes="NextNodeServer.generateFsStaticRoutes",i.generatePublicRoutes="NextNodeServer.generatePublicRoutes",i.generateImageRoutes="NextNodeServer.generateImageRoutes.route",i.sendRenderResult="NextNodeServer.sendRenderResult",i.proxyRequest="NextNodeServer.proxyRequest",i.runApi="NextNodeServer.runApi",i.render="NextNodeServer.render",i.renderHTML="NextNodeServer.renderHTML",i.imageOptimizer="NextNodeServer.imageOptimizer",i.getPagePath="NextNodeServer.getPagePath",i.getRoutesManifest="NextNodeServer.getRoutesManifest",i.findPageComponents="NextNodeServer.findPageComponents",i.getFontManifest="NextNodeServer.getFontManifest",i.getServerComponentManifest="NextNodeServer.getServerComponentManifest",i.getRequestHandler="NextNodeServer.getRequestHandler",i.renderToHTML="NextNodeServer.renderToHTML",i.renderError="NextNodeServer.renderError",i.renderErrorToHTML="NextNodeServer.renderErrorToHTML",i.render404="NextNodeServer.render404",i.startResponse="NextNodeServer.startResponse",i.route="route",i.onProxyReq="onProxyReq",i.apiResolver="apiResolver",i.internalFetch="internalFetch",i),w=((o=w||{}).startServer="startServer.startServer",o),E=((l=E||{}).getServerSideProps="Render.getServerSideProps",l.getStaticProps="Render.getStaticProps",l.renderToString="Render.renderToString",l.renderDocument="Render.renderDocument",l.createBodyResult="Render.createBodyResult",l),S=((c=S||{}).renderToString="AppRender.renderToString",c.renderToReadableStream="AppRender.renderToReadableStream",c.getBodyResult="AppRender.getBodyResult",c.fetch="AppRender.fetch",c),R=((u=R||{}).executeRoute="Router.executeRoute",u),O=((d=O||{}).runHandler="Node.runHandler",d),T=((h=T||{}).runHandler="AppRouteRouteHandlers.runHandler",h),A=((f=A||{}).generateMetadata="ResolveMetadata.generateMetadata",f.generateViewport="ResolveMetadata.generateViewport",f),C=((p=C||{}).execute="Middleware.execute",p);let x=["Middleware.execute","BaseServer.handleRequest","Render.getServerSideProps","Render.getStaticProps","AppRender.fetch","AppRender.getBodyResult","Render.renderDocument","Node.runHandler","AppRouteRouteHandlers.runHandler","ResolveMetadata.generateMetadata","ResolveMetadata.generateViewport","NextNodeServer.createComponentTree","NextNodeServer.findPageComponents","NextNodeServer.getLayoutOrPageModule","NextNodeServer.startResponse","NextNodeServer.clientComponentLoading"],N=["NextNodeServer.findPageComponents","NextNodeServer.createComponentTree","NextNodeServer.clientComponentLoading"]},31846,(e,t,r)=>{"use strict";function n(e){return null!==e&&"object"==typeof e&&"then"in e&&"function"==typeof e.then}Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"isThenable",{enumerable:!0,get:function(){return n}})},36851,(e,t,r)=>{"use strict";let n,s;Object.defineProperty(r,"__esModule",{value:!0});var a={BubbledError:function(){return m},SpanKind:function(){return f},SpanStatusCode:function(){return h},getTracer:function(){return E},isBubbledError:function(){return g}};for(var i in a)Object.defineProperty(r,i,{enumerable:!0,get:a[i]});let o=e.r(64839),l=e.r(31846);try{n=e.r(70406)}catch(t){n=e.r(17413)}let{context:c,propagation:u,trace:d,SpanStatusCode:h,SpanKind:f,ROOT_CONTEXT:p}=n;class m extends Error{constructor(e,t){super(),this.bubble=e,this.result=t}}function g(e){return"object"==typeof e&&null!==e&&e instanceof m}let _=(e,t)=>{g(t)&&t.bubble?e.setAttribute("next.bubble",!0):(t&&(e.recordException(t),e.setAttribute("error.type",t.name)),e.setStatus({code:h.ERROR,message:null==t?void 0:t.message})),e.end()},y=new Map,b=n.createContextKey("next.rootSpanId"),v=0,w={set(e,t,r){e.push({key:t,value:r})}},E=(s=new class e{getTracerInstance(){return d.getTracer("next.js","0.0.1")}getContext(){return c}getTracePropagationData(){let e=c.active(),t=[];return u.inject(e,t,w),t}getActiveScopeSpan(){return d.getSpan(null==c?void 0:c.active())}withPropagatedContext(e,t,r){let n=c.active();if(d.getSpanContext(n))return t();let s=u.extract(n,e,r);return c.with(s,t)}trace(...e){var t;let[r,n,s]=e,{fn:a,options:i}="function"==typeof n?{fn:n,options:{}}:{fn:s,options:{...n}},u=i.spanName??r;if(!o.NextVanillaSpanAllowlist.includes(r)&&"1"!==process.env.NEXT_OTEL_VERBOSE||i.hideSpan)return a();let h=this.getSpanContext((null==i?void 0:i.parentSpan)??this.getActiveScopeSpan()),f=!1;h?(null==(t=d.getSpanContext(h))?void 0:t.isRemote)&&(f=!0):(h=(null==c?void 0:c.active())??p,f=!0);let m=v++;return i.attributes={"next.span_name":u,"next.span_type":r,...i.attributes},c.with(h.setValue(b,m),()=>this.getTracerInstance().startActiveSpan(u,i,e=>{let t="performance"in globalThis&&"measure"in performance?globalThis.performance.now():void 0,n=()=>{y.delete(m),t&&process.env.NEXT_OTEL_PERFORMANCE_PREFIX&&o.LogSpanAllowList.includes(r||"")&&performance.measure(`${process.env.NEXT_OTEL_PERFORMANCE_PREFIX}:next-${(r.split(".").pop()||"").replace(/[A-Z]/g,e=>"-"+e.toLowerCase())}`,{start:t,end:performance.now()})};f&&y.set(m,new Map(Object.entries(i.attributes??{})));try{if(a.length>1)return a(e,t=>_(e,t));let t=a(e);if((0,l.isThenable)(t))return t.then(t=>(e.end(),t)).catch(t=>{throw _(e,t),t}).finally(n);return e.end(),n(),t}catch(t){throw _(e,t),n(),t}}))}wrap(...e){let t=this,[r,n,s]=3===e.length?e:[e[0],{},e[1]];return o.NextVanillaSpanAllowlist.includes(r)||"1"===process.env.NEXT_OTEL_VERBOSE?function(){let e=n;"function"==typeof e&&"function"==typeof s&&(e=e.apply(this,arguments));let a=arguments.length-1,i=arguments[a];if("function"!=typeof i)return t.trace(r,e,()=>s.apply(this,arguments));{let n=t.getContext().bind(c.active(),i);return t.trace(r,e,(e,t)=>(arguments[a]=function(e){return null==t||t(e),n.apply(this,arguments)},s.apply(this,arguments)))}}:s}startSpan(...e){let[t,r]=e,n=this.getSpanContext((null==r?void 0:r.parentSpan)??this.getActiveScopeSpan());return this.getTracerInstance().startSpan(t,r,n)}getSpanContext(e){return e?d.setSpan(c.active(),e):void 0}getRootSpanAttributes(){let e=c.active().getValue(b);return y.get(e)}setRootSpanAttribute(e,t){let r=c.active().getValue(b),n=y.get(r);n&&!n.has(e)&&n.set(e,t)}},()=>s)},66953,(e,t,r)=>{"use strict";let n;Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"cloneResponse",{enumerable:!0,get:function(){return a}});let s=()=>{};function a(e){if(!e.body)return[e,e];let[t,r]=e.body.tee(),s=new Response(t,{status:e.status,statusText:e.statusText,headers:e.headers});Object.defineProperty(s,"url",{value:e.url,configurable:!0,enumerable:!0,writable:!1}),n&&s.body&&n.register(s,new WeakRef(s.body));let a=new Response(r,{status:e.status,statusText:e.statusText,headers:e.headers});return Object.defineProperty(a,"url",{value:e.url,configurable:!0,enumerable:!0,writable:!1}),[s,a]}globalThis.FinalizationRegistry&&(n=new FinalizationRegistry(e=>{let t=e.deref();t&&!t.locked&&t.cancel("Response object has been garbage collected").then(s)}))},42966,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"createDedupeFetch",{enumerable:!0,get:function(){return l}});let n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(void 0);if(r&&r.has(e))return r.get(e);var n={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=s?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(e.r(47540)),s=e.r(66953),a=e.r(76414);function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}let o=new Set(["traceparent","tracestate"]);function l(e){let t=n.cache(e=>[]);return function(r,n){let i,l;if(n&&n.signal)return e(r,n);if("string"!=typeof r||n){let t,s="string"==typeof r||r instanceof URL?new Request(r,n):r;if("GET"!==s.method&&"HEAD"!==s.method||s.keepalive)return e(r,n);t=Array.from(s.headers.entries()).filter(([e])=>!o.has(e.toLowerCase())),l=JSON.stringify([s.method,t,s.mode,s.redirect,s.credentials,s.referrer,s.referrerPolicy,s.integrity]),i=s.url}else l='["GET",[],null,"follow",null,null,null,null]',i=r;let c=t(i);for(let e=0,t=c.length;e<t;e+=1){let[t,r]=c[e];if(t===l)return r.then(()=>{let t=c[e][2];if(!t)throw Object.defineProperty(new a.InvariantError("No cached response"),"__NEXT_ERROR_CODE",{value:"E579",enumerable:!1,configurable:!0});let[r,n]=(0,s.cloneResponse)(t);return c[e][2]=n,r})}let u=e(r,n),d=[l,u,null];return c.push(d),u.then(e=>{let[t,r]=(0,s.cloneResponse)(e);return d[2]=r,t})}}},86082,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,s,a={CachedRouteKind:function(){return o},IncrementalCacheKind:function(){return l}};for(var i in a)Object.defineProperty(r,i,{enumerable:!0,get:a[i]});var o=((n={}).APP_PAGE="APP_PAGE",n.APP_ROUTE="APP_ROUTE",n.PAGES="PAGES",n.FETCH="FETCH",n.REDIRECT="REDIRECT",n.IMAGE="IMAGE",n),l=((s={}).APP_PAGE="APP_PAGE",s.APP_ROUTE="APP_ROUTE",s.PAGES="PAGES",s.FETCH="FETCH",s.IMAGE="IMAGE",s)},98725,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"DetachedPromise",{enumerable:!0,get:function(){return n}});class n{constructor(){let e,t;this.promise=new Promise((r,n)=>{e=r,t=n}),this.resolve=e,this.reject=t}}},46518,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"Batcher",{enumerable:!0,get:function(){return s}});let n=e.r(98725);class s{constructor(e,t=e=>e()){this.cacheKeyFn=e,this.schedulerFn=t,this.pending=new Map}static create(e){return new s(null==e?void 0:e.cacheKeyFn,null==e?void 0:e.schedulerFn)}async batch(e,t){let r=this.cacheKeyFn?await this.cacheKeyFn(e):e;if(null===r)return t({resolve:e=>Promise.resolve(e),key:e});let s=this.pending.get(r);if(s)return s;let{promise:a,resolve:i,reject:o}=new n.DetachedPromise;return this.pending.set(r,a),this.schedulerFn(async()=>{try{let r=await t({resolve:i,key:e});i(r)}catch(e){o(e)}finally{this.pending.delete(r)}}),a}}},46177,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"ENCODED_TAGS",{enumerable:!0,get:function(){return n}});let n={OPENING:{HTML:new Uint8Array([60,104,116,109,108]),BODY:new Uint8Array([60,98,111,100,121])},CLOSED:{HEAD:new Uint8Array([60,47,104,101,97,100,62]),BODY:new Uint8Array([60,47,98,111,100,121,62]),HTML:new Uint8Array([60,47,104,116,109,108,62]),BODY_AND_HTML:new Uint8Array([60,47,98,111,100,121,62,60,47,104,116,109,108,62])},META:{ICON_MARK:new Uint8Array([60,109,101,116,97,32,110,97,109,101,61,34,194,171,110,120,116,45,105,99,111,110,194,187,34])}}},45144,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={indexOfUint8Array:function(){return a},isEquivalentUint8Arrays:function(){return i},removeFromUint8Array:function(){return o}};for(var s in n)Object.defineProperty(r,s,{enumerable:!0,get:n[s]});function a(e,t){if(0===t.length)return 0;if(0===e.length||t.length>e.length)return -1;for(let r=0;r<=e.length-t.length;r++){let n=!0;for(let s=0;s<t.length;s++)if(e[r+s]!==t[s]){n=!1;break}if(n)return r}return -1}function i(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function o(e,t){let r=a(e,t);if(0===r)return e.subarray(t.length);if(!(r>-1))return e;{let n=new Uint8Array(e.length-t.length);return n.set(e.slice(0,r)),n.set(e.slice(r+t.length),r),n}}},40724,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"MISSING_ROOT_TAGS_ERROR",{enumerable:!0,get:function(){return n}});let n="NEXT_MISSING_ROOT_TAGS";("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),t.exports=r.default)},8946,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={DOC_PREFETCH_RANGE_HEADER_VALUE:function(){return i},doesExportedHtmlMatchBuildId:function(){return c},insertBuildIdComment:function(){return l}};for(var s in n)Object.defineProperty(r,s,{enumerable:!0,get:n[s]});let a="<!DOCTYPE html>",i="bytes=0-63";function o(e){return e.slice(0,24).replace(/-/g,"_")}function l(e,t){return t.includes("-->")||!e.startsWith(a)?e:e.replace(a,a+"<!--"+o(t)+"-->")}function c(e,t){return e.startsWith(a+"<!--"+o(t)+"-->")}},64851,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={ACTION_HEADER:function(){return i},FLIGHT_HEADERS:function(){return p},NEXT_ACTION_NOT_FOUND_HEADER:function(){return w},NEXT_DID_POSTPONE_HEADER:function(){return _},NEXT_HMR_REFRESH_HASH_COOKIE:function(){return d},NEXT_HMR_REFRESH_HEADER:function(){return u},NEXT_HTML_REQUEST_ID_HEADER:function(){return S},NEXT_IS_PRERENDER_HEADER:function(){return v},NEXT_REQUEST_ID_HEADER:function(){return E},NEXT_REWRITTEN_PATH_HEADER:function(){return y},NEXT_REWRITTEN_QUERY_HEADER:function(){return b},NEXT_ROUTER_PREFETCH_HEADER:function(){return l},NEXT_ROUTER_SEGMENT_PREFETCH_HEADER:function(){return c},NEXT_ROUTER_STALE_TIME_HEADER:function(){return g},NEXT_ROUTER_STATE_TREE_HEADER:function(){return o},NEXT_RSC_UNION_QUERY:function(){return m},NEXT_URL:function(){return h},RSC_CONTENT_TYPE_HEADER:function(){return f},RSC_HEADER:function(){return a}};for(var s in n)Object.defineProperty(r,s,{enumerable:!0,get:n[s]});let a="rsc",i="next-action",o="next-router-state-tree",l="next-router-prefetch",c="next-router-segment-prefetch",u="next-hmr-refresh",d="__next_hmr_refresh_hash__",h="next-url",f="text/x-component",p=[a,o,l,u,c],m="_rsc",g="x-nextjs-stale-time",_="x-nextjs-postponed",y="x-nextjs-rewritten-path",b="x-nextjs-rewritten-query",v="x-nextjs-prerender",w="x-nextjs-action-not-found",E="x-nextjs-request-id",S="x-nextjs-html-request-id";("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),t.exports=r.default)},67510,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={djb2Hash:function(){return a},hexHash:function(){return i}};for(var s in n)Object.defineProperty(r,s,{enumerable:!0,get:n[s]});function a(e){let t=5381;for(let r=0;r<e.length;r++)t=(t<<5)+t+e.charCodeAt(r)|0;return t>>>0}function i(e){return a(e).toString(36).slice(0,5)}},60091,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"computeCacheBustingSearchParam",{enumerable:!0,get:function(){return s}});let n=e.r(67510);function s(e,t,r,s){return(void 0===e||"0"===e)&&void 0===t&&void 0===r&&void 0===s?"":(0,n.hexHash)([e||"0",t||"0",r||"0",s||"0"].join(","))}},56682,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={chainStreams:function(){return _},continueDynamicHTMLResume:function(){return M},continueDynamicPrerender:function(){return I},continueFizzStream:function(){return P},continueStaticFallbackPrerender:function(){return D},continueStaticPrerender:function(){return $},createBufferedTransformStream:function(){return E},createDocumentClosingStream:function(){return j},createRootLayoutValidatorStream:function(){return N},renderToInitialFizzStream:function(){return R},streamFromBuffer:function(){return b},streamFromString:function(){return y},streamToBuffer:function(){return v},streamToString:function(){return w}};for(var s in n)Object.defineProperty(r,s,{enumerable:!0,get:n[s]});let a=e.r(36851),i=e.r(64839),o=e.r(98725),l=e.r(38244),c=e.r(46177),u=e.r(45144),d=e.r(40724),h=e.r(8946),f=e.r(64851),p=e.r(60091);function m(){}let g=new TextEncoder;function _(...e){if(0===e.length)return new ReadableStream({start(e){e.close()}});if(1===e.length)return e[0];let{readable:t,writable:r}=new TransformStream,n=e[0].pipeTo(r,{preventClose:!0}),s=1;for(;s<e.length-1;s++){let t=e[s];n=n.then(()=>t.pipeTo(r,{preventClose:!0}))}let a=e[s];return(n=n.then(()=>a.pipeTo(r))).catch(m),t}function y(e){return new ReadableStream({start(t){t.enqueue(g.encode(e)),t.close()}})}function b(e){return new ReadableStream({start(t){t.enqueue(e),t.close()}})}async function v(e){let t=e.getReader(),r=[];for(;;){let{done:e,value:n}=await t.read();if(e)break;r.push(n)}return Buffer.concat(r)}async function w(e,t){let r=new TextDecoder("utf-8",{fatal:!0}),n="";for await(let s of e){if(null==t?void 0:t.aborted)return n;n+=r.decode(s,{stream:!0})}return n+r.decode()}function E(e={}){let t,{maxBufferByteLength:r=1/0}=e,n=[],s=0,a=e=>{try{if(0===n.length)return;let t=new Uint8Array(s),r=0;for(let e=0;e<n.length;e++){let s=n[e];t.set(s,r),r+=s.byteLength}n.length=0,s=0,e.enqueue(t)}catch{}};return new TransformStream({transform(e,i){n.push(e),(s+=e.byteLength)>=r?a(i):(e=>{if(t)return;let r=new o.DetachedPromise;t=r,(0,l.scheduleImmediate)(()=>{try{a(e)}finally{t=void 0,r.resolve()}})})(i)},flush:()=>null==t?void 0:t.promise})}function S(e,t){let r=!1;return new TransformStream({transform(n,s){if(e&&!r){r=!0;let e=new TextDecoder("utf-8",{fatal:!0}).decode(n,{stream:!0}),a=(0,h.insertBuildIdComment)(e,t);s.enqueue(g.encode(a));return}s.enqueue(n)}})}function R({ReactDOMServer:e,element:t,streamOptions:r}){return(0,a.getTracer)().trace(i.AppRenderSpan.renderToReadableStream,async()=>e.renderToReadableStream(t,r))}function O(e){let t=-1,r=!1;return new TransformStream({async transform(n,s){let a=-1,i=-1;if(t++,r)return void s.enqueue(n);let o=0;if(-1===a){if(-1===(a=(0,u.indexOfUint8Array)(n,c.ENCODED_TAGS.META.ICON_MARK)))return void s.enqueue(n);47===n[a+(o=c.ENCODED_TAGS.META.ICON_MARK.length)]?o+=2:o++}if(0===t){if(i=(0,u.indexOfUint8Array)(n,c.ENCODED_TAGS.CLOSED.HEAD),-1!==a){if(a<i){let e=new Uint8Array(n.length-o);e.set(n.subarray(0,a)),e.set(n.subarray(a+o),a),n=e}else{let t=await e(),r=g.encode(t),s=r.length,i=new Uint8Array(n.length-o+s);i.set(n.subarray(0,a)),i.set(r,a),i.set(n.subarray(a+o),a+s),n=i}r=!0}}else{let t=await e(),s=g.encode(t),i=s.length,l=new Uint8Array(n.length-o+i);l.set(n.subarray(0,a)),l.set(s,a),l.set(n.subarray(a+o),a+i),n=l,r=!0}s.enqueue(n)}})}function T(e){let t=!1,r=!1;return new TransformStream({async transform(n,s){r=!0;let a=await e();if(t){if(a){let e=g.encode(a);s.enqueue(e)}s.enqueue(n)}else{let e=(0,u.indexOfUint8Array)(n,c.ENCODED_TAGS.CLOSED.HEAD);if(-1!==e){if(a){let t=g.encode(a),r=new Uint8Array(n.length+t.length);r.set(n.slice(0,e)),r.set(t,e),r.set(n.slice(e),e+t.length),s.enqueue(r)}else s.enqueue(n);t=!0}else a&&s.enqueue(g.encode(a)),s.enqueue(n),t=!0}},async flush(t){if(r){let r=await e();r&&t.enqueue(g.encode(r))}}})}function A(e,t){let r=!1,n=null,s=!1;function a(e){return n||(n=i(e)),n}async function i(n){let a=e.getReader();t&&await (0,l.atLeastOneTask)();try{for(;;){let{done:e,value:i}=await a.read();if(e){s=!0;return}t||r||await (0,l.atLeastOneTask)(),n.enqueue(i)}}catch(e){n.error(e)}}return new TransformStream({start(e){t||a(e)},transform(e,r){r.enqueue(e),t&&a(r)},flush(e){if(r=!0,!s)return a(e)}})}let C="</body></html>";function x(){let e=!1;return new TransformStream({transform(t,r){if(e)return r.enqueue(t);let n=(0,u.indexOfUint8Array)(t,c.ENCODED_TAGS.CLOSED.BODY_AND_HTML);if(n>-1){if(e=!0,t.length===c.ENCODED_TAGS.CLOSED.BODY_AND_HTML.length)return;let s=t.slice(0,n);if(r.enqueue(s),t.length>c.ENCODED_TAGS.CLOSED.BODY_AND_HTML.length+n){let e=t.slice(n+c.ENCODED_TAGS.CLOSED.BODY_AND_HTML.length);r.enqueue(e)}}else r.enqueue(t)},flush(e){e.enqueue(c.ENCODED_TAGS.CLOSED.BODY_AND_HTML)}})}function N(){let e=!1,t=!1;return new TransformStream({async transform(r,n){!e&&(0,u.indexOfUint8Array)(r,c.ENCODED_TAGS.OPENING.HTML)>-1&&(e=!0),!t&&(0,u.indexOfUint8Array)(r,c.ENCODED_TAGS.OPENING.BODY)>-1&&(t=!0),n.enqueue(r)},flush(r){let n=[];e||n.push("html"),t||n.push("body"),n.length&&r.enqueue(g.encode(`<html id="__next_error__">
            <template
              data-next-error-message="Missing ${n.map(e=>`<${e}>`).join(n.length>1?" and ":"")} tags in the root layout.
Read more at https://nextjs.org/docs/messages/missing-root-layout-tags"
              data-next-error-digest="${d.MISSING_ROOT_TAGS_ERROR}"
              data-next-error-stack=""
            ></template>
          `))}})}async function P(e,{suffix:t,inlinedDataStream:r,isStaticGeneration:n,isBuildTimePrerendering:s,buildId:a,getServerInsertedHTML:i,getServerInsertedMetadata:c,validateRootLayout:u}){let d,h,f=t?t.split(C,1)[0]:null;n&&await e.allReady;var p=[E(),S(s,a),O(c),null!=f&&f.length>0?(h=!1,new TransformStream({transform(e,t){if(t.enqueue(e),!h){let e;h=!0,d=e=new o.DetachedPromise,(0,l.scheduleImmediate)(()=>{try{t.enqueue(g.encode(f))}catch{}finally{d=void 0,e.resolve()}})}},flush(e){if(d)return d.promise;h||e.enqueue(g.encode(f))}})):null,r?A(r,!0):null,u?N():null,x(),T(i)];let m=e;for(let e of p)e&&(m=m.pipeThrough(e));return m}async function I(e,{getServerInsertedHTML:t,getServerInsertedMetadata:r}){return e.pipeThrough(E()).pipeThrough(new TransformStream({transform(e,t){(0,u.isEquivalentUint8Arrays)(e,c.ENCODED_TAGS.CLOSED.BODY_AND_HTML)||(0,u.isEquivalentUint8Arrays)(e,c.ENCODED_TAGS.CLOSED.BODY)||(0,u.isEquivalentUint8Arrays)(e,c.ENCODED_TAGS.CLOSED.HTML)||(e=(0,u.removeFromUint8Array)(e,c.ENCODED_TAGS.CLOSED.BODY),e=(0,u.removeFromUint8Array)(e,c.ENCODED_TAGS.CLOSED.HTML),t.enqueue(e))}})).pipeThrough(T(t)).pipeThrough(O(r))}async function $(e,{inlinedDataStream:t,getServerInsertedHTML:r,getServerInsertedMetadata:n,isBuildTimePrerendering:s,buildId:a}){return e.pipeThrough(E()).pipeThrough(S(s,a)).pipeThrough(T(r)).pipeThrough(O(n)).pipeThrough(A(t,!0)).pipeThrough(x())}async function D(e,{inlinedDataStream:t,getServerInsertedHTML:r,getServerInsertedMetadata:n,isBuildTimePrerendering:s,buildId:a}){let i,o,l,d;return e.pipeThrough(E()).pipeThrough(S(s,a)).pipeThrough(T(r)).pipeThrough((i=(0,p.computeCacheBustingSearchParam)("1","/_full",void 0,void 0),o=`${f.NEXT_RSC_UNION_QUERY}=${i}`,l=`<script>__NEXT_CLIENT_RESUME=fetch(location.pathname+'?${o}',{credentials:'same-origin',headers:{'${f.RSC_HEADER}': '1','${f.NEXT_ROUTER_PREFETCH_HEADER}': '1','${f.NEXT_ROUTER_SEGMENT_PREFETCH_HEADER}': '/_full'}})</script>`,d=!1,new TransformStream({transform(e,t){if(d)return void t.enqueue(e);let r=(0,u.indexOfUint8Array)(e,c.ENCODED_TAGS.CLOSED.HEAD);if(-1===r)return void t.enqueue(e);let n=g.encode(l),s=new Uint8Array(e.length+n.length);s.set(e.slice(0,r)),s.set(n,r),s.set(e.slice(r),r+n.length),t.enqueue(s),d=!0}}))).pipeThrough(O(n)).pipeThrough(A(t,!0)).pipeThrough(x())}async function M(e,{delayDataUntilFirstHtmlChunk:t,inlinedDataStream:r,getServerInsertedHTML:n,getServerInsertedMetadata:s}){return e.pipeThrough(E()).pipeThrough(T(n)).pipeThrough(O(s)).pipeThrough(A(r,t)).pipeThrough(x())}function j(){return y(C)}},13472,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={NEXT_REQUEST_META:function(){return a},addRequestMeta:function(){return l},getRequestMeta:function(){return i},removeRequestMeta:function(){return c},setRequestMeta:function(){return o}};for(var s in n)Object.defineProperty(r,s,{enumerable:!0,get:n[s]});let a=Symbol.for("NextInternalRequestMeta");function i(e,t){let r=e[a]||{};return"string"==typeof t?r[t]:r}function o(e,t){return e[a]=t,t}function l(e,t,r){let n=i(e);return n[t]=r,o(e,n)}function c(e,t){let r=i(e);return delete r[t],o(e,r)}},20557,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={isNodeNextRequest:function(){return o},isNodeNextResponse:function(){return l},isWebNextRequest:function(){return a},isWebNextResponse:function(){return i}};for(var s in n)Object.defineProperty(r,s,{enumerable:!0,get:n[s]});let a=e=>!1,i=e=>!1,o=e=>!0,l=e=>!0},4649,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={NextRequestAdapter:function(){return f},ResponseAborted:function(){return u},ResponseAbortedName:function(){return c},createAbortController:function(){return d},signalFromNodeResponse:function(){return h}};for(var s in n)Object.defineProperty(r,s,{enumerable:!0,get:n[s]});let a=e.r(13472),i=e.r(80333),o=e.r(29666),l=e.r(20557),c="ResponseAborted";class u extends Error{constructor(...e){super(...e),this.name=c}}function d(e){let t=new AbortController;return e.once("close",()=>{e.writableFinished||t.abort(new u)}),t}function h(e){let{errored:t,destroyed:r}=e;if(t||r)return AbortSignal.abort(t??new u);let{signal:n}=d(e);return n}class f{static fromBaseNextRequest(e,t){if((0,l.isNodeNextRequest)(e))return f.fromNodeNextRequest(e,t);throw Object.defineProperty(Error("Invariant: Unsupported NextRequest type"),"__NEXT_ERROR_CODE",{value:"E345",enumerable:!1,configurable:!0})}static fromNodeNextRequest(e,t){let r,n=null;if("GET"!==e.method&&"HEAD"!==e.method&&e.body&&(n=e.body),e.url.startsWith("http"))r=new URL(e.url);else{let t=(0,a.getRequestMeta)(e,"initURL");r=t&&t.startsWith("http")?new URL(e.url,t):new URL(e.url,"http://n")}return new o.NextRequest(r,{method:e.method,headers:(0,i.fromNodeOutgoingHttpHeaders)(e.headers),duplex:"half",signal:t,...t.aborted?{}:{body:n}})}static fromWebNextRequest(e){let t=null;return"GET"!==e.method&&"HEAD"!==e.method&&(t=e.body),new o.NextRequest(e.url,{method:e.method,headers:(0,i.fromNodeOutgoingHttpHeaders)(e.headers),duplex:"half",signal:e.request.signal,...e.request.signal.aborted?{}:{body:t}})}}},61136,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={getClientComponentLoaderMetrics:function(){return c},wrapClientComponentLoader:function(){return l}};for(var s in n)Object.defineProperty(r,s,{enumerable:!0,get:n[s]});let a=0,i=0,o=0;function l(e){return"performance"in globalThis?{require:(...t)=>{let r=performance.now();0===a&&(a=r);try{return o+=1,e.__next_app__.require(...t)}finally{i+=performance.now()-r}},loadChunk:(...t)=>{let r=performance.now(),n=e.__next_app__.loadChunk(...t);return n.finally(()=>{i+=performance.now()-r}),n}}:e.__next_app__}function c(e={}){let t=0===a?void 0:{clientComponentLoadStart:a,clientComponentLoadTimes:i,clientComponentLoadCount:o};return e.reset&&(a=0,i=0,o=0),t}},78544,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={isAbortError:function(){return u},pipeToNodeResponse:function(){return d}};for(var s in n)Object.defineProperty(r,s,{enumerable:!0,get:n[s]});let a=e.r(4649),i=e.r(98725),o=e.r(36851),l=e.r(64839),c=e.r(61136);function u(e){return(null==e?void 0:e.name)==="AbortError"||(null==e?void 0:e.name)===a.ResponseAbortedName}async function d(e,t,r){try{let{errored:n,destroyed:s}=t;if(n||s)return;let u=(0,a.createAbortController)(t),d=function(e,t){let r=!1,n=new i.DetachedPromise;function s(){n.resolve()}e.on("drain",s),e.once("close",()=>{e.off("drain",s),n.resolve()});let a=new i.DetachedPromise;return e.once("finish",()=>{a.resolve()}),new WritableStream({write:async t=>{if(!r){if(r=!0,"performance"in globalThis&&process.env.NEXT_OTEL_PERFORMANCE_PREFIX){let e=(0,c.getClientComponentLoaderMetrics)();e&&performance.measure(`${process.env.NEXT_OTEL_PERFORMANCE_PREFIX}:next-client-component-loading`,{start:e.clientComponentLoadStart,end:e.clientComponentLoadStart+e.clientComponentLoadTimes})}e.flushHeaders(),(0,o.getTracer)().trace(l.NextNodeServerSpan.startResponse,{spanName:"start response"},()=>void 0)}try{let r=e.write(t);"flush"in e&&"function"==typeof e.flush&&e.flush(),r||(await n.promise,n=new i.DetachedPromise)}catch(t){throw e.end(),Object.defineProperty(Error("failed to write chunk to response",{cause:t}),"__NEXT_ERROR_CODE",{value:"E321",enumerable:!1,configurable:!0})}},abort:t=>{e.writableFinished||e.destroy(t)},close:async()=>{if(t&&await t,!e.writableFinished)return e.end(),a.promise}})}(t,r);await e.pipeTo(d,{signal:u.signal})}catch(e){if(u(e))return;throw Object.defineProperty(Error("failed to pipe response",{cause:e}),"__NEXT_ERROR_CODE",{value:"E180",enumerable:!1,configurable:!0})}}},82490,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"default",{enumerable:!0,get:function(){return i}});let n=e.r(56682),s=e.r(78544),a=e.r(76414);class i{static #e=this.EMPTY=new i(null,{metadata:{},contentType:null});static fromStatic(e,t){return new i(e,{metadata:{},contentType:t})}constructor(e,{contentType:t,waitUntil:r,metadata:n}){this.response=e,this.contentType=t,this.metadata=n,this.waitUntil=r}assignMetadata(e){Object.assign(this.metadata,e)}get isNull(){return null===this.response}get isDynamic(){return"string"!=typeof this.response}toUnchunkedString(e=!1){if(null===this.response)return"";if("string"!=typeof this.response){if(!e)throw Object.defineProperty(new a.InvariantError("dynamic responses cannot be unchunked. This is a bug in Next.js"),"__NEXT_ERROR_CODE",{value:"E732",enumerable:!1,configurable:!0});return(0,n.streamToString)(this.readable)}return this.response}get readable(){return null===this.response?new ReadableStream({start(e){e.close()}}):"string"==typeof this.response?(0,n.streamFromString)(this.response):Buffer.isBuffer(this.response)?(0,n.streamFromBuffer)(this.response):Array.isArray(this.response)?(0,n.chainStreams)(...this.response):this.response}coerce(){return null===this.response?[]:"string"==typeof this.response?[(0,n.streamFromString)(this.response)]:Array.isArray(this.response)?this.response:Buffer.isBuffer(this.response)?[(0,n.streamFromBuffer)(this.response)]:[this.response]}unshift(e){this.response=this.coerce(),this.response.unshift(e)}push(e){this.response=this.coerce(),this.response.push(e)}async pipeTo(e){try{await this.readable.pipeTo(e,{preventClose:!0}),this.waitUntil&&await this.waitUntil,await e.close()}catch(t){if((0,s.isAbortError)(t))return void await e.abort(t);throw t}}async pipeToNodeResponse(e){await (0,s.pipeToNodeResponse)(this.readable,e,this.waitUntil)}}},2222,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"RouteKind",{enumerable:!0,get:function(){return s}});var n,s=((n={}).PAGES="PAGES",n.PAGES_API="PAGES_API",n.APP_PAGE="APP_PAGE",n.APP_ROUTE="APP_ROUTE",n.IMAGE="IMAGE",n)},22536,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,s={fromResponseCacheEntry:function(){return u},routeKindToIncrementalCacheKind:function(){return h},toResponseCacheEntry:function(){return d}};for(var a in s)Object.defineProperty(r,a,{enumerable:!0,get:s[a]});let i=e.r(86082),o=(n=e.r(82490))&&n.__esModule?n:{default:n},l=e.r(2222),c=e.r(91401);async function u(e){var t,r;return{...e,value:(null==(t=e.value)?void 0:t.kind)===i.CachedRouteKind.PAGES?{kind:i.CachedRouteKind.PAGES,html:await e.value.html.toUnchunkedString(!0),pageData:e.value.pageData,headers:e.value.headers,status:e.value.status}:(null==(r=e.value)?void 0:r.kind)===i.CachedRouteKind.APP_PAGE?{kind:i.CachedRouteKind.APP_PAGE,html:await e.value.html.toUnchunkedString(!0),postponed:e.value.postponed,rscData:e.value.rscData,headers:e.value.headers,status:e.value.status,segmentData:e.value.segmentData}:e.value}}async function d(e){var t,r;return e?{isMiss:e.isMiss,isStale:e.isStale,cacheControl:e.cacheControl,value:(null==(t=e.value)?void 0:t.kind)===i.CachedRouteKind.PAGES?{kind:i.CachedRouteKind.PAGES,html:o.default.fromStatic(e.value.html,c.HTML_CONTENT_TYPE_HEADER),pageData:e.value.pageData,headers:e.value.headers,status:e.value.status}:(null==(r=e.value)?void 0:r.kind)===i.CachedRouteKind.APP_PAGE?{kind:i.CachedRouteKind.APP_PAGE,html:o.default.fromStatic(e.value.html,c.HTML_CONTENT_TYPE_HEADER),rscData:e.value.rscData,headers:e.value.headers,status:e.value.status,postponed:e.value.postponed,segmentData:e.value.segmentData}:e.value}:null}function h(e){switch(e){case l.RouteKind.PAGES:return i.IncrementalCacheKind.PAGES;case l.RouteKind.APP_PAGE:return i.IncrementalCacheKind.APP_PAGE;case l.RouteKind.IMAGE:return i.IncrementalCacheKind.IMAGE;case l.RouteKind.APP_ROUTE:return i.IncrementalCacheKind.APP_ROUTE;case l.RouteKind.PAGES_API:throw Object.defineProperty(Error(`Unexpected route kind ${e}`),"__NEXT_ERROR_CODE",{value:"E64",enumerable:!1,configurable:!0});default:return e}}},88119,(e,t,r)=>{"use strict";var n,s;Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"default",{enumerable:!0,get:function(){return l}});let a=e.r(46518),i=e.r(38244),o=e.r(22536);n=e.r(86082),s=r,Object.keys(n).forEach(function(e){"default"===e||Object.prototype.hasOwnProperty.call(s,e)||Object.defineProperty(s,e,{enumerable:!0,get:function(){return n[e]}})});class l{constructor(e){this.getBatcher=a.Batcher.create({cacheKeyFn:({key:e,isOnDemandRevalidate:t})=>`${e}-${t?"1":"0"}`,schedulerFn:i.scheduleOnNextTick}),this.revalidateBatcher=a.Batcher.create({schedulerFn:i.scheduleOnNextTick}),this.minimal_mode=e}async get(e,t,r){var n;if(!e)return t({hasResolved:!1,previousCacheEntry:null});if(this.minimal_mode&&(null==(n=this.previousCacheItem)?void 0:n.key)===e&&this.previousCacheItem.expiresAt>Date.now())return(0,o.toResponseCacheEntry)(this.previousCacheItem.entry);let{incrementalCache:s,isOnDemandRevalidate:a=!1,isFallback:i=!1,isRoutePPREnabled:l=!1,isPrefetch:c=!1,waitUntil:u,routeKind:d}=r,h=await this.getBatcher.batch({key:e,isOnDemandRevalidate:a},({resolve:r})=>{let n=this.handleGet(e,t,{incrementalCache:s,isOnDemandRevalidate:a,isFallback:i,isRoutePPREnabled:l,isPrefetch:c,routeKind:d},r);return u&&u(n),n});return(0,o.toResponseCacheEntry)(h)}async handleGet(e,t,r,n){let s=null,a=!1;try{if((s=this.minimal_mode?null:await r.incrementalCache.get(e,{kind:(0,o.routeKindToIncrementalCacheKind)(r.routeKind),isRoutePPREnabled:r.isRoutePPREnabled,isFallback:r.isFallback}))&&!r.isOnDemandRevalidate&&(n(s),a=!0,!s.isStale||r.isPrefetch))return s;let i=await this.revalidate(e,r.incrementalCache,r.isRoutePPREnabled,r.isFallback,t,s,null!==s&&!r.isOnDemandRevalidate);if(!i)return this.minimal_mode&&(this.previousCacheItem=void 0),null;return r.isOnDemandRevalidate,i}catch(e){if(a)return console.error(e),null;throw e}}async revalidate(e,t,r,n,s,a,i,o){return this.revalidateBatcher.batch(e,()=>{let l=this.handleRevalidate(e,t,r,n,s,a,i);return o&&o(l),l})}async handleRevalidate(e,t,r,n,s,a,i){try{let l=await s({hasResolved:i,previousCacheEntry:a,isRevalidating:!0});if(!l)return null;let c=await (0,o.fromResponseCacheEntry)({...l,isMiss:!a});return c.cacheControl&&(this.minimal_mode?this.previousCacheItem={key:e,entry:c,expiresAt:Date.now()+1e3}:await t.set(e,c.value,{cacheControl:c.cacheControl,isRoutePPREnabled:r,isFallback:n})),c}catch(s){if(null==a?void 0:a.cacheControl){let s=Math.min(Math.max(a.cacheControl.revalidate||3,3),30),i=void 0===a.cacheControl.expire?void 0:Math.max(s+3,a.cacheControl.expire);await t.set(e,a.value,{cacheControl:{revalidate:s,expire:i},isRoutePPREnabled:r,isFallback:n})}throw s}}}},16899,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={NEXT_PATCH_SYMBOL:function(){return p},createPatchedFetcher:function(){return v},patchFetch:function(){return w},validateRevalidate:function(){return m},validateTags:function(){return g}};for(var s in n)Object.defineProperty(r,s,{enumerable:!0,get:n[s]});let a=e.r(64839),i=e.r(36851),o=e.r(91401),l=e.r(68665),c=e.r(4642),u=e.r(42966),d=e.r(32319),h=e.r(88119),f=e.r(66953);e.r(18185);let p=Symbol.for("next-patch");function m(e,t){try{let r;if(!1===e)r=o.INFINITE_CACHE;else if("number"==typeof e&&!isNaN(e)&&e>-1)r=e;else if(void 0!==e)throw Object.defineProperty(Error(`Invalid revalidate value "${e}" on "${t}", must be a non-negative number or false`),"__NEXT_ERROR_CODE",{value:"E179",enumerable:!1,configurable:!0});return r}catch(e){if(e instanceof Error&&e.message.includes("Invalid revalidate"))throw e;return}}function g(e,t){let r=[],n=[];for(let s=0;s<e.length;s++){let a=e[s];if("string"!=typeof a?n.push({tag:a,reason:"invalid type, must be a string"}):a.length>o.NEXT_CACHE_TAG_MAX_LENGTH?n.push({tag:a,reason:`exceeded max length of ${o.NEXT_CACHE_TAG_MAX_LENGTH}`}):r.push(a),r.length>o.NEXT_CACHE_TAG_MAX_ITEMS){console.warn(`Warning: exceeded max tag count for ${t}, dropped tags:`,e.slice(s).join(", "));break}}if(n.length>0)for(let{tag:e,reason:r}of(console.warn(`Warning: invalid tags passed to ${t}: `),n))console.log(`tag: "${e}" ${r}`);return r}function _(e,t){e.shouldTrackFetchMetrics&&(e.fetchMetrics??=[],e.fetchMetrics.push({...t,end:performance.timeOrigin+performance.now(),idx:e.nextFetchId||0}))}async function y(e,t,r,n,s,a){let i=await e.arrayBuffer(),o={headers:Object.fromEntries(e.headers.entries()),body:Buffer.from(i).toString("base64"),status:e.status,url:e.url};return r&&await n.set(t,{kind:h.CachedRouteKind.FETCH,data:o,revalidate:s},r),await a(),new Response(i,{headers:e.headers,status:e.status,statusText:e.statusText})}async function b(e,t,r,n,s,a,i,o,l){let[c,u]=(0,f.cloneResponse)(t),d=c.arrayBuffer().then(async e=>{let t=Buffer.from(e),o={headers:Object.fromEntries(c.headers.entries()),body:t.toString("base64"),status:c.status,url:c.url};null==a||a.set(r,o),n&&await s.set(r,{kind:h.CachedRouteKind.FETCH,data:o,revalidate:i},n)}).catch(e=>console.warn("Failed to set fetch cache",o,e)).finally(l),p=`cache-set-${r}`;return e.pendingRevalidates??={},p in e.pendingRevalidates&&await e.pendingRevalidates[p],e.pendingRevalidates[p]=d.finally(()=>{var t;(null==(t=e.pendingRevalidates)?void 0:t[p])&&delete e.pendingRevalidates[p]}),u}function v(e,{workAsyncStorage:t,workUnitAsyncStorage:r}){let n=async function(n,s){var u,p;let v;try{(v=new URL(n instanceof Request?n.url:n)).username="",v.password=""}catch{v=void 0}let w=(null==v?void 0:v.href)??"",S=(null==s||null==(u=s.method)?void 0:u.toUpperCase())||"GET",R=(null==s||null==(p=s.next)?void 0:p.internal)===!0,O="1"===process.env.NEXT_OTEL_FETCH_DISABLED,T=R?void 0:performance.timeOrigin+performance.now(),A=t.getStore(),C=r.getStore(),x=C?(0,d.getCacheSignal)(C):null;x&&x.beginRead();let N=(0,i.getTracer)().trace(R?a.NextNodeServerSpan.internalFetch:a.AppRenderSpan.fetch,{hideSpan:O,kind:i.SpanKind.CLIENT,spanName:["fetch",S,w].filter(Boolean).join(" "),attributes:{"http.url":w,"http.method":S,"net.peer.name":null==v?void 0:v.hostname,"net.peer.port":(null==v?void 0:v.port)||void 0}},async()=>{var t;let r,a,i,u,d,p;if(R||!A||A.isDraftMode)return e(n,s);let v=n&&"object"==typeof n&&"string"==typeof n.method,S=e=>(null==s?void 0:s[e])||(v?n[e]:null),O=e=>{var t,r,a;return void 0!==(null==s||null==(t=s.next)?void 0:t[e])?null==s||null==(r=s.next)?void 0:r[e]:v?null==(a=n.next)?void 0:a[e]:void 0},N=O("revalidate"),P=N,I=g(O("tags")||[],`fetch ${n.toString()}`);if(C)switch(C.type){case"prerender":case"prerender-runtime":case"prerender-client":case"prerender-ppr":case"prerender-legacy":case"cache":case"private-cache":r=C}if(r&&Array.isArray(I)){let e=r.tags??(r.tags=[]);for(let t of I)e.includes(t)||e.push(t)}let $=null==C?void 0:C.implicitTags,D=A.fetchCache;C&&"unstable-cache"===C.type&&(D="force-no-store");let M=!!A.isUnstableNoStore,j=S("cache"),k="";"string"==typeof j&&void 0!==P&&("force-cache"===j&&0===P||"no-store"===j&&(P>0||!1===P))&&(a=`Specified "cache: ${j}" and "revalidate: ${P}", only one should be specified.`,j=void 0,P=void 0);let L="no-cache"===j||"no-store"===j||"force-no-store"===D||"only-no-store"===D,H=!D&&!j&&!P&&A.forceDynamic;"force-cache"===j&&void 0===P?P=!1:(L||H)&&(P=0),("no-cache"===j||"no-store"===j)&&(k=`cache: ${j}`),p=m(P,A.route);let F=S("headers"),U="function"==typeof(null==F?void 0:F.get)?F:new Headers(F||{}),B=U.get("authorization")||U.get("cookie"),q=!["get","head"].includes((null==(t=S("method"))?void 0:t.toLowerCase())||"get"),G=void 0==D&&(void 0==j||"default"===j)&&void 0==P,X=!!((B||q)&&(null==r?void 0:r.revalidate)===0),W=!1;if(!X&&G&&(A.isBuildTimePrerendering?W=!0:X=!0),G&&void 0!==C)switch(C.type){case"prerender":case"prerender-runtime":case"prerender-client":return x&&(x.endRead(),x=null),(0,c.makeHangingPromise)(C.renderSignal,A.route,"fetch()")}switch(D){case"force-no-store":k="fetchCache = force-no-store";break;case"only-no-store":if("force-cache"===j||void 0!==p&&p>0)throw Object.defineProperty(Error(`cache: 'force-cache' used on fetch for ${w} with 'export const fetchCache = 'only-no-store'`),"__NEXT_ERROR_CODE",{value:"E448",enumerable:!1,configurable:!0});k="fetchCache = only-no-store";break;case"only-cache":if("no-store"===j)throw Object.defineProperty(Error(`cache: 'no-store' used on fetch for ${w} with 'export const fetchCache = 'only-cache'`),"__NEXT_ERROR_CODE",{value:"E521",enumerable:!1,configurable:!0});break;case"force-cache":(void 0===P||0===P)&&(k="fetchCache = force-cache",p=o.INFINITE_CACHE)}if(void 0===p?"default-cache"!==D||M?"default-no-store"===D?(p=0,k="fetchCache = default-no-store"):M?(p=0,k="noStore call"):X?(p=0,k="auto no cache"):(k="auto cache",p=r?r.revalidate:o.INFINITE_CACHE):(p=o.INFINITE_CACHE,k="fetchCache = default-cache"):k||(k=`revalidate: ${p}`),!(A.forceStatic&&0===p)&&!X&&r&&p<r.revalidate){if(0===p){if(C)switch(C.type){case"prerender":case"prerender-client":case"prerender-runtime":return x&&(x.endRead(),x=null),(0,c.makeHangingPromise)(C.renderSignal,A.route,"fetch()")}(0,l.markCurrentScopeAsDynamic)(A,C,`revalidate: 0 fetch ${n} ${A.route}`)}r&&N===p&&(r.revalidate=p)}let K="number"==typeof p&&p>0,{incrementalCache:Y}=A,J=!1;if(C)switch(C.type){case"request":case"cache":case"private-cache":J=C.isHmrRefresh??!1,u=C.serverComponentsHmrCache}if(Y&&(K||u))try{i=await Y.generateCacheKey(w,v?n:s)}catch(e){console.error("Failed to generate cache key for",n)}let V=A.nextFetchId??1;A.nextFetchId=V+1;let z=()=>{},Q=async(t,r)=>{let l=["cache","credentials","headers","integrity","keepalive","method","mode","redirect","referrer","referrerPolicy","window","duplex",...t?[]:["signal"]];if(v){let e=n,t={body:e._ogBody||e.body};for(let r of l)t[r]=e[r];n=new Request(e.url,t)}else if(s){let{_ogBody:e,body:r,signal:n,...a}=s;s={...a,body:e||r,signal:t?void 0:n}}let c={...s,next:{...null==s?void 0:s.next,fetchType:"origin",fetchIdx:V}};return e(n,c).then(async e=>{if(!t&&T&&_(A,{start:T,url:w,cacheReason:r||k,cacheStatus:0===p||r?"skip":"miss",cacheWarning:a,status:e.status,method:c.method||"GET"}),200===e.status&&Y&&i&&(K||u)){let t=p>=o.INFINITE_CACHE?o.CACHE_ONE_YEAR:p,r=K?{fetchCache:!0,fetchUrl:w,fetchIdx:V,tags:I,isImplicitBuildTimeCache:W}:void 0;switch(null==C?void 0:C.type){case"prerender":case"prerender-client":case"prerender-runtime":return y(e,i,r,Y,t,z);case"request":case"prerender-ppr":case"prerender-legacy":case"cache":case"private-cache":case"unstable-cache":case void 0:return b(A,e,i,r,Y,u,t,n,z)}}return await z(),e}).catch(e=>{throw z(),e})},Z=!1,ee=!1;if(i&&Y){let e;if(J&&u&&(e=u.get(i),ee=!0),K&&!e){z=await Y.lock(i);let t=A.isOnDemandRevalidate?null:await Y.get(i,{kind:h.IncrementalCacheKind.FETCH,revalidate:p,fetchUrl:w,fetchIdx:V,tags:I,softTags:null==$?void 0:$.tags});if(G&&C)switch(C.type){case"prerender":case"prerender-client":case"prerender-runtime":await (E||(E=new Promise(e=>{setTimeout(()=>{E=null,e()},0)})),E)}if(t?await z():d="cache-control: no-cache (hard refresh)",(null==t?void 0:t.value)&&t.value.kind===h.CachedRouteKind.FETCH)if(A.isStaticGeneration&&t.isStale)Z=!0;else{if(t.isStale&&(A.pendingRevalidates??={},!A.pendingRevalidates[i])){let e=Q(!0).then(async e=>({body:await e.arrayBuffer(),headers:e.headers,status:e.status,statusText:e.statusText})).finally(()=>{A.pendingRevalidates??={},delete A.pendingRevalidates[i||""]});e.catch(console.error),A.pendingRevalidates[i]=e}e=t.value.data}}if(e){T&&_(A,{start:T,url:w,cacheReason:k,cacheStatus:ee?"hmr":"hit",cacheWarning:a,status:e.status||200,method:(null==s?void 0:s.method)||"GET"});let t=new Response(Buffer.from(e.body,"base64"),{headers:e.headers,status:e.status});return Object.defineProperty(t,"url",{value:e.url}),t}}if(A.isStaticGeneration&&s&&"object"==typeof s){let{cache:e}=s;if("no-store"===e){if(C)switch(C.type){case"prerender":case"prerender-client":case"prerender-runtime":return x&&(x.endRead(),x=null),(0,c.makeHangingPromise)(C.renderSignal,A.route,"fetch()")}(0,l.markCurrentScopeAsDynamic)(A,C,`no-store fetch ${n} ${A.route}`)}let t="next"in s,{next:a={}}=s;if("number"==typeof a.revalidate&&r&&a.revalidate<r.revalidate){if(0===a.revalidate){if(C)switch(C.type){case"prerender":case"prerender-client":case"prerender-runtime":return(0,c.makeHangingPromise)(C.renderSignal,A.route,"fetch()")}(0,l.markCurrentScopeAsDynamic)(A,C,`revalidate: 0 fetch ${n} ${A.route}`)}A.forceStatic&&0===a.revalidate||(r.revalidate=a.revalidate)}t&&delete s.next}if(!i||!Z)return Q(!1,d);{let e=i;A.pendingRevalidates??={};let t=A.pendingRevalidates[e];if(t){let e=await t;return new Response(e.body,{headers:e.headers,status:e.status,statusText:e.statusText})}let r=Q(!0,d).then(f.cloneResponse);return(t=r.then(async e=>{let t=e[0];return{body:await t.arrayBuffer(),headers:t.headers,status:t.status,statusText:t.statusText}}).finally(()=>{var t;(null==(t=A.pendingRevalidates)?void 0:t[e])&&delete A.pendingRevalidates[e]})).catch(()=>{}),A.pendingRevalidates[e]=t,r.then(e=>e[1])}});if(x)try{return await N}finally{x&&x.endRead()}return N};return n.__nextPatched=!0,n.__nextGetStaticStore=()=>t,n._nextOriginalFetch=e,globalThis[p]=!0,Object.defineProperty(n,"name",{value:"fetch",writable:!1}),n}function w(e){if(!0===globalThis[p])return;let t=(0,u.createDedupeFetch)(globalThis.fetch);globalThis.fetch=v(t,e)}let E=null},32533,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"unstable_cache",{enumerable:!0,get:function(){return u}});let n=e.r(91401),s=e.r(16899),a=e.r(56704),i=e.r(32319),o=e.r(88119),l=0;async function c(e,t,r,s,a,i,l){await t.set(r,{kind:o.CachedRouteKind.FETCH,data:{headers:{},body:JSON.stringify(e),status:200,url:""},revalidate:"number"!=typeof a?n.CACHE_ONE_YEAR:a},{fetchCache:!0,tags:s,fetchIdx:i,fetchUrl:l})}function u(e,t,r={}){if(0===r.revalidate)throw Object.defineProperty(Error(`Invariant revalidate: 0 can not be passed to unstable_cache(), must be "false" or "> 0" ${e.toString()}`),"__NEXT_ERROR_CODE",{value:"E57",enumerable:!1,configurable:!0});let n=r.tags?(0,s.validateTags)(r.tags,`unstable_cache ${e.toString()}`):[];(0,s.validateRevalidate)(r.revalidate,`unstable_cache ${e.name||e.toString()}`);let d=`${e.toString()}-${Array.isArray(t)&&t.join(",")}`;return async(...t)=>{let s=a.workAsyncStorage.getStore(),u=i.workUnitAsyncStorage.getStore(),h=(null==s?void 0:s.incrementalCache)||globalThis.__incrementalCache;if(!h)throw Object.defineProperty(Error(`Invariant: incrementalCache missing in unstable_cache ${e.toString()}`),"__NEXT_ERROR_CODE",{value:"E469",enumerable:!1,configurable:!0});let f=u?(0,i.getCacheSignal)(u):null;f&&f.beginRead();try{let a=s&&u?function(e,t){switch(t.type){case"request":let r=t.url.pathname,n=new URLSearchParams(t.url.search),s=[...n.keys()].sort((e,t)=>e.localeCompare(t)).map(e=>`${e}=${n.get(e)}`).join("&");return`${r}${s.length?"?":""}${s}`;case"prerender":case"prerender-client":case"prerender-runtime":case"prerender-ppr":case"prerender-legacy":case"cache":case"private-cache":case"unstable-cache":return e.route;default:return t}}(s,u):"",f=`${d}-${JSON.stringify(t)}`,p=await h.generateCacheKey(f),m=`unstable_cache ${a} ${e.name?` ${e.name}`:p}`,g=(s?s.nextFetchId:l)??1,_=null==u?void 0:u.implicitTags,y={type:"unstable-cache",phase:"render",implicitTags:_,draftMode:u&&s&&(0,i.getDraftModeProviderForCacheScope)(s,u)};if(s){s.nextFetchId=g+1;let a=!1;if(u)switch(u.type){case"cache":case"private-cache":case"prerender":case"prerender-runtime":case"prerender-ppr":case"prerender-legacy":"number"==typeof r.revalidate&&(u.revalidate<r.revalidate||(u.revalidate=r.revalidate));let l=u.tags;if(null===l)u.tags=n.slice();else for(let e of n)l.includes(e)||l.push(e);break;case"unstable-cache":a=!0}if(!a&&"force-no-store"!==s.fetchCache&&!s.isOnDemandRevalidate&&!h.isOnDemandRevalidate&&!s.isDraftMode){let a=await h.get(p,{kind:o.IncrementalCacheKind.FETCH,revalidate:r.revalidate,tags:n,softTags:null==_?void 0:_.tags,fetchIdx:g,fetchUrl:m});if(a&&a.value)if(a.value.kind!==o.CachedRouteKind.FETCH)console.error(`Invariant invalid cacheEntry returned for ${f}`);else{let o=void 0!==a.value.data.body?JSON.parse(a.value.data.body):void 0;if(a.isStale){if(s.pendingRevalidates||(s.pendingRevalidates={}),!s.pendingRevalidates[f]){let a=i.workUnitAsyncStorage.run(y,e,...t).then(async e=>(await c(e,h,p,n,r.revalidate,g,m),e)).catch(e=>(console.error(`revalidating cache with key: ${f}`,e),o));s.isStaticGeneration&&a.catch(()=>{}),s.pendingRevalidates[f]=a}if(s.isStaticGeneration)return s.pendingRevalidates[f]}return o}}let d=await i.workUnitAsyncStorage.run(y,e,...t);return s.isDraftMode||(s.pendingRevalidates||(s.pendingRevalidates={}),s.pendingRevalidates[f]=c(d,h,p,n,r.revalidate,g,m)),d}{if(l+=1,!h.isOnDemandRevalidate){let e=await h.get(p,{kind:o.IncrementalCacheKind.FETCH,revalidate:r.revalidate,tags:n,fetchIdx:g,fetchUrl:m,softTags:null==_?void 0:_.tags});if(e&&e.value){if(e.value.kind!==o.CachedRouteKind.FETCH)console.error(`Invariant invalid cacheEntry returned for ${f}`);else if(!e.isStale)return void 0!==e.value.data.body?JSON.parse(e.value.data.body):void 0}}let s=await i.workUnitAsyncStorage.run(y,e,...t);return await c(s,h,p,n,r.revalidate,g,m),s}}finally{f&&f.endRead()}}}},31551,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={getSortedRouteObjects:function(){return o},getSortedRoutes:function(){return i}};for(var s in n)Object.defineProperty(r,s,{enumerable:!0,get:n[s]});class a{insert(e){this._insert(e.split("/").filter(Boolean),[],!1)}smoosh(){return this._smoosh()}_smoosh(e="/"){let t=[...this.children.keys()].sort();null!==this.slugName&&t.splice(t.indexOf("[]"),1),null!==this.restSlugName&&t.splice(t.indexOf("[...]"),1),null!==this.optionalRestSlugName&&t.splice(t.indexOf("[[...]]"),1);let r=t.map(t=>this.children.get(t)._smoosh(`${e}${t}/`)).reduce((e,t)=>[...e,...t],[]);if(null!==this.slugName&&r.push(...this.children.get("[]")._smoosh(`${e}[${this.slugName}]/`)),!this.placeholder){let t="/"===e?"/":e.slice(0,-1);if(null!=this.optionalRestSlugName)throw Object.defineProperty(Error(`You cannot define a route with the same specificity as a optional catch-all route ("${t}" and "${t}[[...${this.optionalRestSlugName}]]").`),"__NEXT_ERROR_CODE",{value:"E458",enumerable:!1,configurable:!0});r.unshift(t)}return null!==this.restSlugName&&r.push(...this.children.get("[...]")._smoosh(`${e}[...${this.restSlugName}]/`)),null!==this.optionalRestSlugName&&r.push(...this.children.get("[[...]]")._smoosh(`${e}[[...${this.optionalRestSlugName}]]/`)),r}_insert(e,t,r){if(0===e.length){this.placeholder=!1;return}if(r)throw Object.defineProperty(Error("Catch-all must be the last part of the URL."),"__NEXT_ERROR_CODE",{value:"E392",enumerable:!1,configurable:!0});let n=e[0];if(n.startsWith("[")&&n.endsWith("]")){let a=n.slice(1,-1),i=!1;if(a.startsWith("[")&&a.endsWith("]")&&(a=a.slice(1,-1),i=!0),a.startsWith(""))throw Object.defineProperty(Error(`Detected a three-dot character ('') at ('${a}'). Did you mean ('...')?`),"__NEXT_ERROR_CODE",{value:"E147",enumerable:!1,configurable:!0});if(a.startsWith("...")&&(a=a.substring(3),r=!0),a.startsWith("[")||a.endsWith("]"))throw Object.defineProperty(Error(`Segment names may not start or end with extra brackets ('${a}').`),"__NEXT_ERROR_CODE",{value:"E421",enumerable:!1,configurable:!0});if(a.startsWith("."))throw Object.defineProperty(Error(`Segment names may not start with erroneous periods ('${a}').`),"__NEXT_ERROR_CODE",{value:"E288",enumerable:!1,configurable:!0});function s(e,r){if(null!==e&&e!==r)throw Object.defineProperty(Error(`You cannot use different slug names for the same dynamic path ('${e}' !== '${r}').`),"__NEXT_ERROR_CODE",{value:"E337",enumerable:!1,configurable:!0});t.forEach(e=>{if(e===r)throw Object.defineProperty(Error(`You cannot have the same slug name "${r}" repeat within a single dynamic path`),"__NEXT_ERROR_CODE",{value:"E247",enumerable:!1,configurable:!0});if(e.replace(/\W/g,"")===n.replace(/\W/g,""))throw Object.defineProperty(Error(`You cannot have the slug names "${e}" and "${r}" differ only by non-word symbols within a single dynamic path`),"__NEXT_ERROR_CODE",{value:"E499",enumerable:!1,configurable:!0})}),t.push(r)}if(r)if(i){if(null!=this.restSlugName)throw Object.defineProperty(Error(`You cannot use both an required and optional catch-all route at the same level ("[...${this.restSlugName}]" and "${e[0]}" ).`),"__NEXT_ERROR_CODE",{value:"E299",enumerable:!1,configurable:!0});s(this.optionalRestSlugName,a),this.optionalRestSlugName=a,n="[[...]]"}else{if(null!=this.optionalRestSlugName)throw Object.defineProperty(Error(`You cannot use both an optional and required catch-all route at the same level ("[[...${this.optionalRestSlugName}]]" and "${e[0]}").`),"__NEXT_ERROR_CODE",{value:"E300",enumerable:!1,configurable:!0});s(this.restSlugName,a),this.restSlugName=a,n="[...]"}else{if(i)throw Object.defineProperty(Error(`Optional route parameters are not yet supported ("${e[0]}").`),"__NEXT_ERROR_CODE",{value:"E435",enumerable:!1,configurable:!0});s(this.slugName,a),this.slugName=a,n="[]"}}this.children.has(n)||this.children.set(n,new a),this.children.get(n)._insert(e.slice(1),t,r)}constructor(){this.placeholder=!0,this.children=new Map,this.slugName=null,this.restSlugName=null,this.optionalRestSlugName=null}}function i(e){let t=new a;return e.forEach(e=>t.insert(e)),t.smoosh()}function o(e,t){let r={},n=[];for(let s=0;s<e.length;s++){let a=t(e[s]);r[a]=s,n[s]=a}return i(n).map(t=>e[r[t]])}},64033,(e,t,r)=>{"use strict";function n(e){return e.startsWith("/")?e:`/${e}`}Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"ensureLeadingSlash",{enumerable:!0,get:function(){return n}})},60426,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={DEFAULT_SEGMENT_KEY:function(){return d},PAGE_SEGMENT_KEY:function(){return u},addSearchParamsIfPageSegment:function(){return l},computeSelectedLayoutSegment:function(){return c},getSegmentValue:function(){return a},getSelectedLayoutSegmentPath:function(){return function e(t,r,n=!0,s=[]){let i;if(n)i=t[1][r];else{let e=t[1];i=e.children??Object.values(e)[0]}if(!i)return s;let o=a(i[0]);return!o||o.startsWith(u)?s:(s.push(o),e(i,r,!1,s))}},isGroupSegment:function(){return i},isParallelRouteSegment:function(){return o}};for(var s in n)Object.defineProperty(r,s,{enumerable:!0,get:n[s]});function a(e){return Array.isArray(e)?e[1]:e}function i(e){return"("===e[0]&&e.endsWith(")")}function o(e){return e.startsWith("@")&&"@children"!==e}function l(e,t){if(e.includes(u)){let e=JSON.stringify(t);return"{}"!==e?u+"?"+e:u}return e}function c(e,t){if(!e||0===e.length)return null;let r="children"===t?e[0]:e[e.length-1];return r===d?null:r}let u="__PAGE__",d="__DEFAULT__"},65618,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={normalizeAppPath:function(){return o},normalizeRscURL:function(){return l}};for(var s in n)Object.defineProperty(r,s,{enumerable:!0,get:n[s]});let a=e.r(64033),i=e.r(60426);function o(e){return(0,a.ensureLeadingSlash)(e.split("/").reduce((e,t,r,n)=>!t||(0,i.isGroupSegment)(t)||"@"===t[0]||("page"===t||"route"===t)&&r===n.length-1?e:`${e}/${t}`,""))}function l(e){return e.replace(/\.rsc($|\?)/,"$1")}},41417,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={INTERCEPTION_ROUTE_MARKERS:function(){return i},extractInterceptionRouteInformation:function(){return l},isInterceptionRouteAppPath:function(){return o}};for(var s in n)Object.defineProperty(r,s,{enumerable:!0,get:n[s]});let a=e.r(65618),i=["(..)(..)","(.)","(..)","(...)"];function o(e){return void 0!==e.split("/").find(e=>i.find(t=>e.startsWith(t)))}function l(e){let t,r,n;for(let s of e.split("/"))if(r=i.find(e=>s.startsWith(e))){[t,n]=e.split(r,2);break}if(!t||!r||!n)throw Object.defineProperty(Error(`Invalid interception route: ${e}. Must be in the format /<intercepting route>/(..|...|..)(..)/<intercepted route>`),"__NEXT_ERROR_CODE",{value:"E269",enumerable:!1,configurable:!0});switch(t=(0,a.normalizeAppPath)(t),r){case"(.)":n="/"===t?`/${n}`:t+"/"+n;break;case"(..)":if("/"===t)throw Object.defineProperty(Error(`Invalid interception route: ${e}. Cannot use (..) marker at the root level, use (.) instead.`),"__NEXT_ERROR_CODE",{value:"E207",enumerable:!1,configurable:!0});n=t.split("/").slice(0,-1).concat(n).join("/");break;case"(...)":n="/"+n;break;case"(..)(..)":let s=t.split("/");if(s.length<=2)throw Object.defineProperty(Error(`Invalid interception route: ${e}. Cannot use (..)(..) marker at the root level or one level up.`),"__NEXT_ERROR_CODE",{value:"E486",enumerable:!1,configurable:!0});n=s.slice(0,-2).concat(n).join("/");break;default:throw Object.defineProperty(Error("Invariant: unexpected marker"),"__NEXT_ERROR_CODE",{value:"E112",enumerable:!1,configurable:!0})}return{interceptingRoute:t,interceptedRoute:n}}},58499,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"isDynamicRoute",{enumerable:!0,get:function(){return i}});let n=e.r(41417),s=/\/[^/]*\[[^/]+\][^/]*(?=\/|$)/,a=/\/\[[^/]+\](?=\/|$)/;function i(e,t=!0){return((0,n.isInterceptionRouteAppPath)(e)&&(e=(0,n.extractInterceptionRouteInformation)(e).interceptedRoute),t)?a.test(e):s.test(e)}},54692,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={getSortedRouteObjects:function(){return a.getSortedRouteObjects},getSortedRoutes:function(){return a.getSortedRoutes},isDynamicRoute:function(){return i.isDynamicRoute}};for(var s in n)Object.defineProperty(r,s,{enumerable:!0,get:n[s]});let a=e.r(31551),i=e.r(58499)},86240,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={refresh:function(){return p},revalidatePath:function(){return m},revalidateTag:function(){return h},updateTag:function(){return f}};for(var s in n)Object.defineProperty(r,s,{enumerable:!0,get:n[s]});let a=e.r(68665),i=e.r(54692),o=e.r(91401),l=e.r(56704),c=e.r(32319),u=e.r(65252),d=e.r(76414);function h(e,t){return t||console.warn('"revalidateTag" without the second argument is now deprecated, add second argument of "max" or use "updateTag". See more info here: https://nextjs.org/docs/messages/revalidate-tag-single-arg'),g([e],`revalidateTag ${e}`,t)}function f(e){let t=l.workAsyncStorage.getStore();if(!t||t.page.endsWith("/route"))throw Object.defineProperty(Error("updateTag can only be called from within a Server Action. To invalidate cache tags in Route Handlers or other contexts, use revalidateTag instead. See more info here: https://nextjs.org/docs/app/api-reference/functions/updateTag"),"__NEXT_ERROR_CODE",{value:"E872",enumerable:!1,configurable:!0});return g([e],`updateTag ${e}`,void 0)}function p(){let e=l.workAsyncStorage.getStore(),t=c.workUnitAsyncStorage.getStore();if(!e||e.page.endsWith("/route")||(null==t?void 0:t.phase)!=="action")throw Object.defineProperty(Error("refresh can only be called from within a Server Action. See more info here: https://nextjs.org/docs/app/api-reference/functions/refresh"),"__NEXT_ERROR_CODE",{value:"E870",enumerable:!1,configurable:!0});e&&(e.pathWasRevalidated=!0)}function m(e,t){if(e.length>o.NEXT_CACHE_SOFT_TAG_MAX_LENGTH)return void console.warn(`Warning: revalidatePath received "${e}" which exceeded max length of ${o.NEXT_CACHE_SOFT_TAG_MAX_LENGTH}. See more info here https://nextjs.org/docs/app/api-reference/functions/revalidatePath`);let r=`${o.NEXT_CACHE_IMPLICIT_TAG_ID}${e||"/"}`;t?r+=`${r.endsWith("/")?"":"/"}${t}`:(0,i.isDynamicRoute)(e)&&console.warn(`Warning: a dynamic page path "${e}" was passed to "revalidatePath", but the "type" parameter is missing. This has no effect by default, see more info here https://nextjs.org/docs/app/api-reference/functions/revalidatePath`);let n=[r];return r===`${o.NEXT_CACHE_IMPLICIT_TAG_ID}/`?n.push(`${o.NEXT_CACHE_IMPLICIT_TAG_ID}/index`):r===`${o.NEXT_CACHE_IMPLICIT_TAG_ID}/index`&&n.push(`${o.NEXT_CACHE_IMPLICIT_TAG_ID}/`),g(n,`revalidatePath ${e}`)}function g(e,t,r){var n;let s=l.workAsyncStorage.getStore();if(!s||!s.incrementalCache)throw Object.defineProperty(Error(`Invariant: static generation store missing in ${t}`),"__NEXT_ERROR_CODE",{value:"E263",enumerable:!1,configurable:!0});let i=c.workUnitAsyncStorage.getStore();if(i){if("render"===i.phase)throw Object.defineProperty(Error(`Route ${s.route} used "${t}" during render which is unsupported. To ensure revalidation is performed consistently it must always happen outside of renders and cached functions. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`),"__NEXT_ERROR_CODE",{value:"E7",enumerable:!1,configurable:!0});switch(i.type){case"cache":case"private-cache":throw Object.defineProperty(Error(`Route ${s.route} used "${t}" inside a "use cache" which is unsupported. To ensure revalidation is performed consistently it must always happen outside of renders and cached functions. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`),"__NEXT_ERROR_CODE",{value:"E181",enumerable:!1,configurable:!0});case"unstable-cache":throw Object.defineProperty(Error(`Route ${s.route} used "${t}" inside a function cached with "unstable_cache(...)" which is unsupported. To ensure revalidation is performed consistently it must always happen outside of renders and cached functions. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`),"__NEXT_ERROR_CODE",{value:"E306",enumerable:!1,configurable:!0});case"prerender":case"prerender-runtime":let e=Object.defineProperty(Error(`Route ${s.route} used ${t} without first calling \`await connection()\`.`),"__NEXT_ERROR_CODE",{value:"E406",enumerable:!1,configurable:!0});return(0,a.abortAndThrowOnSynchronousRequestDataAccess)(s.route,t,e,i);case"prerender-client":throw Object.defineProperty(new d.InvariantError(`${t} must not be used within a client component. Next.js should be preventing ${t} from being included in client components statically, but did not in this case.`),"__NEXT_ERROR_CODE",{value:"E693",enumerable:!1,configurable:!0});case"prerender-ppr":return(0,a.postponeWithTracking)(s.route,t,i.dynamicTracking);case"prerender-legacy":i.revalidate=0;let r=Object.defineProperty(new u.DynamicServerError(`Route ${s.route} couldn't be rendered statically because it used \`${t}\`. See more info here: https://nextjs.org/docs/messages/dynamic-server-error`),"__NEXT_ERROR_CODE",{value:"E558",enumerable:!1,configurable:!0});throw s.dynamicUsageDescription=t,s.dynamicUsageStack=r.stack,r}}for(let t of(s.pendingRevalidatedTags||(s.pendingRevalidatedTags=[]),e))-1===s.pendingRevalidatedTags.findIndex(e=>e.tag===t&&("string"==typeof e.profile&&"string"==typeof r?e.profile===r:"object"==typeof e.profile&&"object"==typeof r?JSON.stringify(e.profile)===JSON.stringify(r):e.profile===r))&&s.pendingRevalidatedTags.push({tag:t,profile:r});let o=r&&"object"==typeof r?r:r&&"string"==typeof r&&(null==s||null==(n=s.cacheLifeProfiles)?void 0:n[r])?s.cacheLifeProfiles[r]:void 0;r&&(null==o?void 0:o.expire)!==0||(s.pathWasRevalidated=!0)}},60951,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"unstable_noStore",{enumerable:!0,get:function(){return i}});let n=e.r(56704),s=e.r(32319),a=e.r(68665);function i(){let e=n.workAsyncStorage.getStore(),t=s.workUnitAsyncStorage.getStore();if(e){if(!e.forceStatic){if(e.isUnstableNoStore=!0,t)switch(t.type){case"prerender":case"prerender-client":case"prerender-runtime":return}(0,a.markCurrentScopeAsDynamic)(e,t,"unstable_noStore()")}}}},53540,(e,t,r)=>{"use strict";function n(e){throw Object.defineProperty(Error("`cacheLife()` is only available with the `cacheComponents` config."),"__NEXT_ERROR_CODE",{value:"E887",enumerable:!1,configurable:!0})}Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"cacheLife",{enumerable:!0,get:function(){return n}}),e.r(76414),e.r(56704),e.r(32319)},88819,(e,t,r)=>{"use strict";function n(){throw Object.defineProperty(Error("`cacheTag()` is only available with the `cacheComponents` config."),"__NEXT_ERROR_CODE",{value:"E886",enumerable:!1,configurable:!0})}Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"cacheTag",{enumerable:!0,get:function(){return n}}),e.r(32319),e.r(16899)},65044,(e,t,r)=>{let n={unstable_cache:e.r(32533).unstable_cache,updateTag:e.r(86240).updateTag,revalidateTag:e.r(86240).revalidateTag,revalidatePath:e.r(86240).revalidatePath,refresh:e.r(86240).refresh,unstable_noStore:e.r(60951).unstable_noStore,cacheLife:e.r(53540).cacheLife,cacheTag:e.r(88819).cacheTag},s=!1,a=!1;n.unstable_cacheLife=function(){return s||(s=!0,console.error(Error("`unstable_cacheLife` was recently stabilized and should be imported as `cacheLife`. The `unstable` prefixed form will be removed in a future version of Next.js."))),n.cacheLife.apply(this,arguments)},n.unstable_cacheTag=function(){return a||(a=!0,console.error(Error("`unstable_cacheTag` was recently stabilized and should be imported as `cacheTag`. The `unstable` prefixed form will be removed in a future version of Next.js."))),n.cacheTag.apply(this,arguments)},t.exports=n,r.unstable_cache=n.unstable_cache,r.revalidatePath=n.revalidatePath,r.revalidateTag=n.revalidateTag,r.updateTag=n.updateTag,r.unstable_noStore=n.unstable_noStore,r.cacheLife=n.cacheLife,r.unstable_cacheLife=n.unstable_cacheLife,r.cacheTag=n.cacheTag,r.unstable_cacheTag=n.unstable_cacheTag,r.refresh=n.refresh},95975,(e,t,r)=>{"use strict";function n(e){for(let t=0;t<e.length;t++){let r=e[t];if("function"!=typeof r)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof r}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"ensureServerEntryExports",{enumerable:!0,get:function(){return n}})},7312,94943,e=>{"use strict";let t,r,n,s;var a,i,o,l,c,u,d,h,f,p,m,g,_,y,b,v,w,E,S,R,O,T,A,C,x,N,P,I,$,D,M,j,k,L,H,F,U,B,q,G,X,W,K,Y,J,V,z,Q,Z,ee,et,er,en,es,ea,ei,eo,el,ec,eu,ed,eh,ef,ep,em,eg,e_,ey,eb,ev,ew,eE,eS,eR,eO,eT,eA,eC,ex,eN,eP,eI,e$,eD,eM,ej,ek,eL,eH,eF,eU,eB,eq,eG,eX,eW,eK,eY,eJ,eV,ez=e.i(45015),eQ=e.i(65044);(a=_||(_={})).STRING="string",a.NUMBER="number",a.INTEGER="integer",a.BOOLEAN="boolean",a.ARRAY="array",a.OBJECT="object",(i=y||(y={})).LANGUAGE_UNSPECIFIED="language_unspecified",i.PYTHON="python",(o=b||(b={})).OUTCOME_UNSPECIFIED="outcome_unspecified",o.OUTCOME_OK="outcome_ok",o.OUTCOME_FAILED="outcome_failed",o.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded";let eZ=["user","model","function","system"];(l=v||(v={})).HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",l.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",l.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",l.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",l.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",l.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",(c=w||(w={})).HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",c.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",c.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",c.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",c.BLOCK_NONE="BLOCK_NONE",(u=E||(E={})).HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",u.NEGLIGIBLE="NEGLIGIBLE",u.LOW="LOW",u.MEDIUM="MEDIUM",u.HIGH="HIGH",(d=S||(S={})).BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",d.SAFETY="SAFETY",d.OTHER="OTHER",(h=R||(R={})).FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",h.STOP="STOP",h.MAX_TOKENS="MAX_TOKENS",h.SAFETY="SAFETY",h.RECITATION="RECITATION",h.LANGUAGE="LANGUAGE",h.BLOCKLIST="BLOCKLIST",h.PROHIBITED_CONTENT="PROHIBITED_CONTENT",h.SPII="SPII",h.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",h.OTHER="OTHER",(f=O||(O={})).TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",f.RETRIEVAL_QUERY="RETRIEVAL_QUERY",f.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",f.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",f.CLASSIFICATION="CLASSIFICATION",f.CLUSTERING="CLUSTERING",(p=T||(T={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",p.AUTO="AUTO",p.ANY="ANY",p.NONE="NONE",(m=A||(A={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",m.MODE_DYNAMIC="MODE_DYNAMIC";class e0 extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class e1 extends e0{constructor(e,t){super(e),this.response=t}}class e2 extends e0{constructor(e,t,r,n){super(e),this.status=t,this.statusText=r,this.errorDetails=n}}class e4 extends e0{}class e6 extends e0{}(g=C||(C={})).GENERATE_CONTENT="generateContent",g.STREAM_GENERATE_CONTENT="streamGenerateContent",g.COUNT_TOKENS="countTokens",g.EMBED_CONTENT="embedContent",g.BATCH_EMBED_CONTENTS="batchEmbedContents";class e8{constructor(e,t,r,n,s){this.model=e,this.task=t,this.apiKey=r,this.stream=n,this.requestOptions=s}toString(){var e,t;let r=(null==(e=this.requestOptions)?void 0:e.apiVersion)||"v1beta",n=(null==(t=this.requestOptions)?void 0:t.baseUrl)||"https://generativelanguage.googleapis.com",s=`${n}/${r}/${this.model}:${this.task}`;return this.stream&&(s+="?alt=sse"),s}}async function e3(e){var t,r;let n,s=new Headers;s.append("Content-Type","application/json"),s.append("x-goog-api-client",(r=e.requestOptions,n=[],(null==r?void 0:r.apiClient)&&n.push(r.apiClient),n.push("genai-js/0.24.1"),n.join(" "))),s.append("x-goog-api-key",e.apiKey);let a=null==(t=e.requestOptions)?void 0:t.customHeaders;if(a){if(!(a instanceof Headers))try{a=new Headers(a)}catch(e){throw new e4(`unable to convert customHeaders value ${JSON.stringify(a)} to Headers: ${e.message}`)}for(let[e,t]of a.entries()){if("x-goog-api-key"===e)throw new e4(`Cannot set reserved header name ${e}`);if("x-goog-api-client"===e)throw new e4(`Header name ${e} can only be set using the apiClient field`);s.append(e,t)}}return s}async function e5(e,t,r,n,s,a){let i=new e8(e,t,r,n,a);return{url:i.toString(),fetchOptions:Object.assign(Object.assign({},function(e){let t={};if((null==e?void 0:e.signal)!==void 0||(null==e?void 0:e.timeout)>=0){let r=new AbortController;(null==e?void 0:e.timeout)>=0&&setTimeout(()=>r.abort(),e.timeout),(null==e?void 0:e.signal)&&e.signal.addEventListener("abort",()=>{r.abort()}),t.signal=r.signal}return t}(a)),{method:"POST",headers:await e3(i),body:s})}}async function e9(e,t,r,n,s,a={},i=fetch){let{url:o,fetchOptions:l}=await e5(e,t,r,n,s,a);return e7(o,l,i)}async function e7(e,t,r=fetch){let n;try{n=await r(e,t)}catch(r){var s=r,a=e;let t=s;throw"AbortError"===t.name?(t=new e6(`Request aborted when fetching ${a.toString()}: ${s.message}`)).stack=s.stack:s instanceof e2||s instanceof e4||((t=new e0(`Error fetching from ${a.toString()}: ${s.message}`)).stack=s.stack),t}return n.ok||await te(n,e),n}async function te(e,t){let r,n="";try{let t=await e.json();n=t.error.message,t.error.details&&(n+=` ${JSON.stringify(t.error.details)}`,r=t.error.details)}catch(e){}throw new e2(`Error fetching from ${t.toString()}: [${e.status} ${e.statusText}] ${n}`,e.status,e.statusText,r)}function tt(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),ts(e.candidates[0]))throw new e1(`${ta(e)}`,e);return function(e){var t,r,n,s;let a=[];if(null==(r=null==(t=e.candidates)?void 0:t[0].content)?void 0:r.parts)for(let t of null==(s=null==(n=e.candidates)?void 0:n[0].content)?void 0:s.parts)t.text&&a.push(t.text),t.executableCode&&a.push("\n```"+t.executableCode.language+"\n"+t.executableCode.code+"\n```\n"),t.codeExecutionResult&&a.push("\n```\n"+t.codeExecutionResult.output+"\n```\n");return a.length>0?a.join(""):""}(e)}if(e.promptFeedback)throw new e1(`Text not available. ${ta(e)}`,e);return""},e.functionCall=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),ts(e.candidates[0]))throw new e1(`${ta(e)}`,e);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),tr(e)[0]}if(e.promptFeedback)throw new e1(`Function call not available. ${ta(e)}`,e)},e.functionCalls=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),ts(e.candidates[0]))throw new e1(`${ta(e)}`,e);return tr(e)}if(e.promptFeedback)throw new e1(`Function call not available. ${ta(e)}`,e)},e}function tr(e){var t,r,n,s;let a=[];if(null==(r=null==(t=e.candidates)?void 0:t[0].content)?void 0:r.parts)for(let t of null==(s=null==(n=e.candidates)?void 0:n[0].content)?void 0:s.parts)t.functionCall&&a.push(t.functionCall);return a.length>0?a:void 0}let tn=[R.RECITATION,R.SAFETY,R.LANGUAGE];function ts(e){return!!e.finishReason&&tn.includes(e.finishReason)}function ta(e){var t,r,n;let s="";if((!e.candidates||0===e.candidates.length)&&e.promptFeedback)s+="Response was blocked",(null==(t=e.promptFeedback)?void 0:t.blockReason)&&(s+=` due to ${e.promptFeedback.blockReason}`),(null==(r=e.promptFeedback)?void 0:r.blockReasonMessage)&&(s+=`: ${e.promptFeedback.blockReasonMessage}`);else if(null==(n=e.candidates)?void 0:n[0]){let t=e.candidates[0];ts(t)&&(s+=`Candidate was blocked due to ${t.finishReason}`,t.finishMessage&&(s+=`: ${t.finishMessage}`))}return s}function ti(e){return this instanceof ti?(this.v=e,this):new ti(e)}"function"==typeof SuppressedError&&SuppressedError;let to=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;async function tl(e){let t=[],r=e.getReader();for(;;){let{done:e,value:n}=await r.read();if(e)return tt(function(e){let t=e[e.length-1],r={promptFeedback:null==t?void 0:t.promptFeedback};for(let t of e){if(t.candidates){let e=0;for(let n of t.candidates)if(r.candidates||(r.candidates=[]),r.candidates[e]||(r.candidates[e]={index:e}),r.candidates[e].citationMetadata=n.citationMetadata,r.candidates[e].groundingMetadata=n.groundingMetadata,r.candidates[e].finishReason=n.finishReason,r.candidates[e].finishMessage=n.finishMessage,r.candidates[e].safetyRatings=n.safetyRatings,n.content&&n.content.parts){r.candidates[e].content||(r.candidates[e].content={role:n.content.role||"user",parts:[]});let t={};for(let s of n.content.parts)s.text&&(t.text=s.text),s.functionCall&&(t.functionCall=s.functionCall),s.executableCode&&(t.executableCode=s.executableCode),s.codeExecutionResult&&(t.codeExecutionResult=s.codeExecutionResult),0===Object.keys(t).length&&(t.text=""),r.candidates[e].content.parts.push(t)}e++}t.usageMetadata&&(r.usageMetadata=t.usageMetadata)}return r}(t));t.push(n)}}async function tc(e,t,r,n){return function(e){let t,[r,n]=(t=e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})).getReader(),new ReadableStream({start(e){let r="";return function n(){return t.read().then(({value:t,done:s})=>{let a;if(s)return r.trim()?void e.error(new e0("Failed to parse stream")):void e.close();let i=(r+=t).match(to);for(;i;){try{a=JSON.parse(i[1])}catch(t){e.error(new e0(`Error parsing JSON response: "${i[1]}"`));return}e.enqueue(a),i=(r=r.substring(i[0].length)).match(to)}return n()}).catch(e=>{let t=e;throw t.stack=e.stack,t="AbortError"===t.name?new e6("Request aborted when reading from the stream"):new e0("Error reading from the stream")})}()}})).tee();return{stream:function(e){return function(e,t,r){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var n,s=r.apply(e,t||[]),a=[];return n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n;function i(e){s[e]&&(n[e]=function(t){return new Promise(function(r,n){a.push([e,t,r,n])>1||o(e,t)})})}function o(e,t){try{var r;(r=s[e](t)).value instanceof ti?Promise.resolve(r.value.v).then(l,c):u(a[0][2],r)}catch(e){u(a[0][3],e)}}function l(e){o("next",e)}function c(e){o("throw",e)}function u(e,t){e(t),a.shift(),a.length&&o(a[0][0],a[0][1])}}(this,arguments,function*(){let t=e.getReader();for(;;){let{value:e,done:r}=yield ti(t.read());if(r)break;yield yield ti(tt(e))}})}(r),response:tl(n)}}(await e9(t,C.STREAM_GENERATE_CONTENT,e,!0,JSON.stringify(r),n))}async function tu(e,t,r,n){let s=await e9(t,C.GENERATE_CONTENT,e,!1,JSON.stringify(r),n);return{response:tt(await s.json())}}function td(e){if(null!=e){if("string"==typeof e)return{role:"system",parts:[{text:e}]};if(e.text)return{role:"system",parts:[e]};if(e.parts)if(!e.role)return{role:"system",parts:e.parts};else return e}}function th(e){let t=[];if("string"==typeof e)t=[{text:e}];else for(let r of e)"string"==typeof r?t.push({text:r}):t.push(r);var r=t;let n={role:"user",parts:[]},s={role:"function",parts:[]},a=!1,i=!1;for(let e of r)"functionResponse"in e?(s.parts.push(e),i=!0):(n.parts.push(e),a=!0);if(a&&i)throw new e0("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!a&&!i)throw new e0("No content is provided for sending chat message.");return a?n:s}function tf(e){let t;return t=e.contents?e:{contents:[th(e)]},e.systemInstruction&&(t.systemInstruction=td(e.systemInstruction)),t}let tp=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],tm={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function tg(e){var t;if(void 0===e.candidates||0===e.candidates.length)return!1;let r=null==(t=e.candidates[0])?void 0:t.content;if(void 0===r||void 0===r.parts||0===r.parts.length)return!1;for(let e of r.parts)if(void 0===e||0===Object.keys(e).length||void 0!==e.text&&""===e.text)return!1;return!0}let t_="SILENT_ERROR";class ty{constructor(e,t,r,n={}){this.model=t,this.params=r,this._requestOptions=n,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,(null==r?void 0:r.history)&&(!function(e){let t=!1;for(let r of e){let{role:e,parts:n}=r;if(!t&&"user"!==e)throw new e0(`First content should be with role 'user', got ${e}`);if(!eZ.includes(e))throw new e0(`Each item should include role field. Got ${e} but valid roles are: ${JSON.stringify(eZ)}`);if(!Array.isArray(n))throw new e0("Content should have 'parts' property with an array of Parts");if(0===n.length)throw new e0("Each Content should have at least one part");let s={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(let e of n)for(let t of tp)t in e&&(s[t]+=1);let a=tm[e];for(let t of tp)if(!a.includes(t)&&s[t]>0)throw new e0(`Content with role '${e}' can't contain '${t}' part`);t=!0}}(r.history),this._history=r.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,t={}){var r,n,s,a,i,o;let l;await this._sendPromise;let c=th(e),u={safetySettings:null==(r=this.params)?void 0:r.safetySettings,generationConfig:null==(n=this.params)?void 0:n.generationConfig,tools:null==(s=this.params)?void 0:s.tools,toolConfig:null==(a=this.params)?void 0:a.toolConfig,systemInstruction:null==(i=this.params)?void 0:i.systemInstruction,cachedContent:null==(o=this.params)?void 0:o.cachedContent,contents:[...this._history,c]},d=Object.assign(Object.assign({},this._requestOptions),t);return this._sendPromise=this._sendPromise.then(()=>tu(this._apiKey,this.model,u,d)).then(e=>{var t;if(tg(e.response)){this._history.push(c);let r=Object.assign({parts:[],role:"model"},null==(t=e.response.candidates)?void 0:t[0].content);this._history.push(r)}else{let t=ta(e.response);t&&console.warn(`sendMessage() was unsuccessful. ${t}. Inspect response object for details.`)}l=e}).catch(e=>{throw this._sendPromise=Promise.resolve(),e}),await this._sendPromise,l}async sendMessageStream(e,t={}){var r,n,s,a,i,o;await this._sendPromise;let l=th(e),c={safetySettings:null==(r=this.params)?void 0:r.safetySettings,generationConfig:null==(n=this.params)?void 0:n.generationConfig,tools:null==(s=this.params)?void 0:s.tools,toolConfig:null==(a=this.params)?void 0:a.toolConfig,systemInstruction:null==(i=this.params)?void 0:i.systemInstruction,cachedContent:null==(o=this.params)?void 0:o.cachedContent,contents:[...this._history,l]},u=Object.assign(Object.assign({},this._requestOptions),t),d=tc(this._apiKey,this.model,c,u);return this._sendPromise=this._sendPromise.then(()=>d).catch(e=>{throw Error(t_)}).then(e=>e.response).then(e=>{if(tg(e)){this._history.push(l);let t=Object.assign({},e.candidates[0].content);t.role||(t.role="model"),this._history.push(t)}else{let t=ta(e);t&&console.warn(`sendMessageStream() was unsuccessful. ${t}. Inspect response object for details.`)}}).catch(e=>{e.message!==t_&&console.error(e)}),d}}async function tb(e,t,r,n){return(await e9(t,C.COUNT_TOKENS,e,!1,JSON.stringify(r),n)).json()}async function tv(e,t,r,n){return(await e9(t,C.EMBED_CONTENT,e,!1,JSON.stringify(r),n)).json()}async function tw(e,t,r,n){let s=r.requests.map(e=>Object.assign(Object.assign({},e),{model:t}));return(await e9(t,C.BATCH_EMBED_CONTENTS,e,!1,JSON.stringify({requests:s}),n)).json()}class tE{constructor(e,t,r={}){this.apiKey=e,this._requestOptions=r,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=td(t.systemInstruction),this.cachedContent=t.cachedContent}async generateContent(e,t={}){var r;let n=tf(e),s=Object.assign(Object.assign({},this._requestOptions),t);return tu(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null==(r=this.cachedContent)?void 0:r.name},n),s)}async generateContentStream(e,t={}){var r;let n=tf(e),s=Object.assign(Object.assign({},this._requestOptions),t);return tc(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null==(r=this.cachedContent)?void 0:r.name},n),s)}startChat(e){var t;return new ty(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null==(t=this.cachedContent)?void 0:t.name},e),this._requestOptions)}async countTokens(e,t={}){let r=function(e,t){var r;let n={model:null==t?void 0:t.model,generationConfig:null==t?void 0:t.generationConfig,safetySettings:null==t?void 0:t.safetySettings,tools:null==t?void 0:t.tools,toolConfig:null==t?void 0:t.toolConfig,systemInstruction:null==t?void 0:t.systemInstruction,cachedContent:null==(r=null==t?void 0:t.cachedContent)?void 0:r.name,contents:[]},s=null!=e.generateContentRequest;if(e.contents){if(s)throw new e4("CountTokensRequest must have one of contents or generateContentRequest, not both.");n.contents=e.contents}else if(s)n=Object.assign(Object.assign({},n),e.generateContentRequest);else{let t=th(e);n.contents=[t]}return{generateContentRequest:n}}(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),n=Object.assign(Object.assign({},this._requestOptions),t);return tb(this.apiKey,this.model,r,n)}async embedContent(e,t={}){let r="string"==typeof e||Array.isArray(e)?{content:th(e)}:e,n=Object.assign(Object.assign({},this._requestOptions),t);return tv(this.apiKey,this.model,r,n)}async batchEmbedContents(e,t={}){let r=Object.assign(Object.assign({},this._requestOptions),t);return tw(this.apiKey,this.model,e,r)}}function tS(e,t,r,n,s){if("m"===n)throw TypeError("Private method is not writable");if("a"===n&&!s)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(e,r):s?s.value=r:t.set(e,r),r}function tR(e,t,r,n){if("a"===r&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)}let tO=function(){let{crypto:e}=globalThis;if(e?.randomUUID)return tO=e.randomUUID.bind(e),e.randomUUID();let t=new Uint8Array(1),r=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(e^r()&15>>e/4).toString(16))};function tT(e){return"object"==typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}let tA=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){let t=Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return Error(JSON.stringify(e))}catch{}}return Error(e)};class tC extends Error{}class tx extends tC{constructor(e,t,r,n){super(`${tx.makeMessage(e,t,r)}`),this.status=e,this.headers=n,this.requestID=n?.get("x-request-id"),this.error=t,this.code=t?.code,this.param=t?.param,this.type=t?.type}static makeMessage(e,t,r){let n=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&n?`${e} ${n}`:e?`${e} status code (no body)`:n||"(no status code or body)"}static generate(e,t,r,n){if(!e||!n)return new tP({message:r,cause:tA(t)});let s=t?.error;return 400===e?new t$(e,s,r,n):401===e?new tD(e,s,r,n):403===e?new tM(e,s,r,n):404===e?new tj(e,s,r,n):409===e?new tk(e,s,r,n):422===e?new tL(e,s,r,n):429===e?new tH(e,s,r,n):e>=500?new tF(e,s,r,n):new tx(e,s,r,n)}}class tN extends tx{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class tP extends tx{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class tI extends tP{constructor({message:e}={}){super({message:e??"Request timed out."})}}class t$ extends tx{}class tD extends tx{}class tM extends tx{}class tj extends tx{}class tk extends tx{}class tL extends tx{}class tH extends tx{}class tF extends tx{}class tU extends tC{constructor(){super("Could not parse response content as the length limit was reached")}}class tB extends tC{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class tq extends Error{constructor(e){super(e)}}let tG=/^[a-z][a-z0-9+.-]*:/i,tX=e=>(tX=Array.isArray)(e),tW=tX;function tK(e){return"object"!=typeof e?{}:e??{}}function tY(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}let tJ=e=>new Promise(t=>setTimeout(t,e)),tV="6.8.1",tz=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",tQ=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";function tZ(...e){let t=globalThis.ReadableStream;if(void 0===t)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function t0(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return tZ({start(){},async pull(e){let{done:r,value:n}=await t.next();r?e.close():e.enqueue(n)},async cancel(){await t.return?.()}})}function t1(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function t2(e){if(null===e||"object"!=typeof e)return;if(e[Symbol.asyncIterator])return void await e[Symbol.asyncIterator]().return?.();let t=e.getReader(),r=t.cancel();t.releaseLock(),await r}let t4=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)}),t6="RFC3986",t8=e=>String(e),t3={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:t8},t5=(e,t)=>(t5=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty))(e,t),t9=(()=>{let e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})();function t7(e,t){if(tX(e)){let r=[];for(let n=0;n<e.length;n+=1)r.push(t(e[n]));return r}return t(e)}let re={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},rt=function(e,t){Array.prototype.push.apply(e,tX(t)?t:[t])},rr={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,r,n,s)=>{if(0===e.length)return e;let a=e;if("symbol"==typeof e?a=Symbol.prototype.toString.call(e):"string"!=typeof e&&(a=String(e)),"iso-8859-1"===r)return escape(a).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});let i="";for(let e=0;e<a.length;e+=1024){let t=a.length>=1024?a.slice(e,e+1024):a,r=[];for(let e=0;e<t.length;++e){let n=t.charCodeAt(e);if(45===n||46===n||95===n||126===n||n>=48&&n<=57||n>=65&&n<=90||n>=97&&n<=122||"RFC1738"===s&&(40===n||41===n)){r[r.length]=t.charAt(e);continue}if(n<128){r[r.length]=t9[n];continue}if(n<2048){r[r.length]=t9[192|n>>6]+t9[128|63&n];continue}if(n<55296||n>=57344){r[r.length]=t9[224|n>>12]+t9[128|n>>6&63]+t9[128|63&n];continue}e+=1,n=65536+((1023&n)<<10|1023&t.charCodeAt(e)),r[r.length]=t9[240|n>>18]+t9[128|n>>12&63]+t9[128|n>>6&63]+t9[128|63&n]}i+=r.join("")}return i},encodeValuesOnly:!1,format:t6,formatter:t8,indices:!1,serializeDate:e=>(r??(r=Function.prototype.call.bind(Date.prototype.toISOString)))(e),skipNulls:!1,strictNullHandling:!1},rn={};function rs(e){let t;return(n??(n=(t=new globalThis.TextEncoder).encode.bind(t)))(e)}function ra(e){let t;return(s??(s=(t=new globalThis.TextDecoder).decode.bind(t)))(e)}class ri{constructor(){x.set(this,void 0),N.set(this,void 0),tS(this,x,new Uint8Array,"f"),tS(this,N,null,"f")}decode(e){let t;if(null==e)return[];let r=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?rs(e):e;tS(this,x,function(e){let t=0;for(let r of e)t+=r.length;let r=new Uint8Array(t),n=0;for(let t of e)r.set(t,n),n+=t.length;return r}([tR(this,x,"f"),r]),"f");let n=[];for(;null!=(t=function(e,t){for(let r=t??0;r<e.length;r++){if(10===e[r])return{preceding:r,index:r+1,carriage:!1};if(13===e[r])return{preceding:r,index:r+1,carriage:!0}}return null}(tR(this,x,"f"),tR(this,N,"f")));){if(t.carriage&&null==tR(this,N,"f")){tS(this,N,t.index,"f");continue}if(null!=tR(this,N,"f")&&(t.index!==tR(this,N,"f")+1||t.carriage)){n.push(ra(tR(this,x,"f").subarray(0,tR(this,N,"f")-1))),tS(this,x,tR(this,x,"f").subarray(tR(this,N,"f")),"f"),tS(this,N,null,"f");continue}let e=null!==tR(this,N,"f")?t.preceding-1:t.preceding,r=ra(tR(this,x,"f").subarray(0,e));n.push(r),tS(this,x,tR(this,x,"f").subarray(t.index),"f"),tS(this,N,null,"f")}return n}flush(){return tR(this,x,"f").length?this.decode("\n"):[]}}x=new WeakMap,N=new WeakMap,ri.NEWLINE_CHARS=new Set(["\n","\r"]),ri.NEWLINE_REGEXP=/\r\n|[\n\r]/g;let ro={off:0,error:200,warn:300,info:400,debug:500},rl=(e,t,r)=>{if(e){if(Object.prototype.hasOwnProperty.call(ro,e))return e;rf(r).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(ro))}`)}};function rc(){}function ru(e,t,r){return!t||ro[e]>ro[r]?rc:t[e].bind(t)}let rd={error:rc,warn:rc,info:rc,debug:rc},rh=new WeakMap;function rf(e){let t=e.logger,r=e.logLevel??"off";if(!t)return rd;let n=rh.get(t);if(n&&n[0]===r)return n[1];let s={error:ru("error",t,r),warn:ru("warn",t,r),info:ru("info",t,r),debug:ru("debug",t,r)};return rh.set(t,[r,s]),s}let rp=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,"authorization"===e.toLowerCase()||"cookie"===e.toLowerCase()||"set-cookie"===e.toLowerCase()?"***":t]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);class rm{constructor(e,t,r){this.iterator=e,P.set(this,void 0),this.controller=t,tS(this,P,r,"f")}static fromSSEResponse(e,t,r){let n=!1,s=r?rf(r):console;async function*a(){if(n)throw new tC("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let r=!1;try{for await(let n of rg(e,t))if(!r){if(n.data.startsWith("[DONE]")){r=!0;continue}if(null!==n.event&&n.event.startsWith("thread.")){let e;try{e=JSON.parse(n.data)}catch(e){throw console.error("Could not parse message into JSON:",n.data),console.error("From chunk:",n.raw),e}if("error"==n.event)throw new tx(void 0,e.error,e.message,void 0);yield{event:n.event,data:e}}else{let t;try{t=JSON.parse(n.data)}catch(e){throw s.error("Could not parse message into JSON:",n.data),s.error("From chunk:",n.raw),e}if(t&&t.error)throw new tx(void 0,t.error,void 0,e.headers);yield t}}r=!0}catch(e){if(tT(e))return;throw e}finally{r||t.abort()}}return new rm(a,t,r)}static fromReadableStream(e,t,r){let n=!1;async function*s(){let t=new ri;for await(let r of t1(e))for(let e of t.decode(r))yield e;for(let e of t.flush())yield e}return new rm(async function*(){if(n)throw new tC("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let e=!1;try{for await(let t of s())!e&&t&&(yield JSON.parse(t));e=!0}catch(e){if(tT(e))return;throw e}finally{e||t.abort()}},t,r)}[(P=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let e=[],t=[],r=this.iterator(),n=n=>({next:()=>{if(0===n.length){let n=r.next();e.push(n),t.push(n)}return n.shift()}});return[new rm(()=>n(e),this.controller,tR(this,P,"f")),new rm(()=>n(t),this.controller,tR(this,P,"f"))]}toReadableStream(){let e,t=this;return tZ({async start(){e=t[Symbol.asyncIterator]()},async pull(t){try{let{value:r,done:n}=await e.next();if(n)return t.close();let s=rs(JSON.stringify(r)+"\n");t.enqueue(s)}catch(e){t.error(e)}},async cancel(){await e.return?.()}})}}async function*rg(e,t){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new tC("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new tC("Attempted to iterate over a response with no body")}let r=new ry,n=new ri;for await(let t of r_(t1(e.body)))for(let e of n.decode(t)){let t=r.decode(e);t&&(yield t)}for(let e of n.flush()){let t=r.decode(e);t&&(yield t)}}async function*r_(e){let t=new Uint8Array;for await(let r of e){let e;if(null==r)continue;let n=r instanceof ArrayBuffer?new Uint8Array(r):"string"==typeof r?rs(r):r,s=new Uint8Array(t.length+n.length);for(s.set(t),s.set(n,t.length),t=s;-1!==(e=function(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1]||13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return -1}(t));)yield t.slice(0,e),t=t.slice(e)}t.length>0&&(yield t)}class ry{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){var t;let r;if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[n,s,a]=-1!==(r=(t=e).indexOf(":"))?[t.substring(0,r),":",t.substring(r+1)]:[t,"",""];return a.startsWith(" ")&&(a=a.substring(1)),"event"===n?this.event=a:"data"===n&&this.data.push(a),null}}async function rb(e,t){let{response:r,requestLogID:n,retryOfRequestLogID:s,startTime:a}=t,i=await (async()=>{if(t.options.stream)return(rf(e).debug("response",r.status,r.url,r.headers,r.body),t.options.__streamClass)?t.options.__streamClass.fromSSEResponse(r,t.controller,e):rm.fromSSEResponse(r,t.controller,e);if(204===r.status)return null;if(t.options.__binaryResponse)return r;let n=r.headers.get("content-type"),s=n?.split(";")[0]?.trim();return s?.includes("application/json")||s?.endsWith("+json")?rv(await r.json(),r):await r.text()})();return rf(e).debug(`[${n}] response parsed`,rp({retryOfRequestLogID:s,url:r.url,status:r.status,body:i,durationMs:Date.now()-a})),i}function rv(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}class rw extends Promise{constructor(e,t,r=rb){super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=r,I.set(this,void 0),tS(this,I,e,"f")}_thenUnwrap(e){return new rw(tR(this,I,"f"),this.responsePromise,async(t,r)=>rv(e(await this.parseResponse(t,r),r),r.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(tR(this,I,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}I=new WeakMap;class rE{constructor(e,t,r,n){$.set(this,void 0),tS(this,$,e,"f"),this.options=n,this.response=t,this.body=r}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new tC("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await tR(this,$,"f").requestAPIList(this.constructor,e)}async *iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async *[($=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}}class rS extends rw{constructor(e,t,r){super(e,t,async(e,t)=>new r(e,t.response,await rb(e,t),t.options))}async *[Symbol.asyncIterator](){for await(let e of(await this))yield e}}class rR extends rE{constructor(e,t,r,n){super(e,t,r,n),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class rO extends rE{constructor(e,t,r,n){super(e,t,r,n),this.data=r.data||[],this.has_more=r.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){let e=this.getPaginatedItems(),t=e[e.length-1]?.id;return t?{...this.options,query:{...tK(this.options.query),after:t}}:null}}class rT extends rE{constructor(e,t,r,n){super(e,t,r,n),this.data=r.data||[],this.has_more=r.has_more||!1,this.last_id=r.last_id||""}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){let e=this.last_id;return e?{...this.options,query:{...tK(this.options.query),after:e}}:null}}let rA=()=>{if("undefined"==typeof File){let{process:e}=globalThis;throw Error("`File` is not defined as a global, which is required for file uploads."+("string"==typeof e?.versions?.node&&20>parseInt(e.versions.node.split("."))?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function rC(e,t,r){return rA(),new File(e,t??"unknown_file",r)}function rx(e){return("object"==typeof e&&null!==e&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}let rN=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],rP=async(e,t)=>rj(e.body)?{...e,body:await rD(e.body,t)}:e,rI=async(e,t)=>({...e,body:await rD(e.body,t)}),r$=new WeakMap,rD=async(e,t)=>{if(!await function(e){let t="function"==typeof e?e:e.fetch,r=r$.get(t);if(r)return r;let n=(async()=>{try{let e="Response"in t?t.Response:(await t("data:,")).constructor,r=new FormData;if(r.toString()===await new e(r).text())return!1;return!0}catch{return!0}})();return r$.set(t,n),n}(t))throw TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let r=new FormData;return await Promise.all(Object.entries(e||{}).map(([e,t])=>rk(r,e,t))),r},rM=e=>e instanceof Blob&&"name"in e,rj=e=>{if("object"==typeof e&&null!==e&&(e instanceof Response||rN(e)||rM(e)))return!0;if(Array.isArray(e))return e.some(rj);if(e&&"object"==typeof e){for(let t in e)if(rj(e[t]))return!0}return!1},rk=async(e,t,r)=>{if(void 0!==r){if(null==r)throw TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof r||"number"==typeof r||"boolean"==typeof r)e.append(t,String(r));else if(r instanceof Response)e.append(t,rC([await r.blob()],rx(r)));else if(rN(r))e.append(t,rC([await new Response(t0(r)).blob()],rx(r)));else if(rM(r))e.append(t,r,rx(r));else if(Array.isArray(r))await Promise.all(r.map(r=>rk(e,t+"[]",r)));else if("object"==typeof r)await Promise.all(Object.entries(r).map(([r,n])=>rk(e,`${t}[${r}]`,n)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${r} instead`)}},rL=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer;async function rH(e,t,r){let n,s;if(rA(),null!=(n=e=await e)&&"object"==typeof n&&"string"==typeof n.name&&"number"==typeof n.lastModified&&rL(n))return e instanceof File?e:rC([await e.arrayBuffer()],e.name);if(null!=(s=e)&&"object"==typeof s&&"string"==typeof s.url&&"function"==typeof s.blob){let n=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),rC(await rF(n),t,r)}let a=await rF(e);if(t||(t=rx(e)),!r?.type){let e=a.find(e=>"object"==typeof e&&"type"in e&&e.type);"string"==typeof e&&(r={...r,type:e})}return rC(a,t,r)}async function rF(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(rL(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else if(rN(e))for await(let r of e)t.push(...await rF(r));else{let t=e?.constructor?.name;throw Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:""}${function(e){if("object"!=typeof e||null===e)return"";let t=Object.getOwnPropertyNames(e);return`; props: [${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`)}return t}class rU{constructor(e){this._client=e}}function rB(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}let rq=Object.freeze(Object.create(null)),rG=((e=rB)=>function(t,...r){let n;if(1===t.length)return t[0];let s=!1,a=[],i=t.reduce((t,n,i)=>{/[?#]/.test(n)&&(s=!0);let o=r[i],l=(s?encodeURIComponent:e)(""+o);return i!==r.length&&(null==o||"object"==typeof o&&o.toString===Object.getPrototypeOf(Object.getPrototypeOf(o.hasOwnProperty??rq)??rq)?.toString)&&(l=o+"",a.push({start:t.length+n.length,length:l.length,error:`Value of type ${Object.prototype.toString.call(o).slice(8,-1)} is not a valid path parameter`})),t+n+(i===r.length?"":l)},""),o=i.split(/[?#]/,1)[0],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;for(;null!==(n=l.exec(o));)a.push({start:n.index,length:n[0].length,error:`Value "${n[0]}" can't be safely passed as a path parameter`});if(a.sort((e,t)=>e.start-t.start),a.length>0){let e=0,t=a.reduce((t,r)=>{let n=" ".repeat(r.start-e),s="^".repeat(r.length);return e=r.start+r.length,t+n+s},"");throw new tC(`Path parameters result in path with invalid segments:
${a.map(e=>e.error).join("\n")}
${i}
${t}`)}return i})(rB);class rX extends rU{list(e,t={},r){return this._client.getAPIList(rG`/chat/completions/${e}/messages`,rO,{query:t,...r})}}function rW(e){return void 0!==e&&"function"in e&&void 0!==e.function}function rK(e){return e?.$brand==="auto-parseable-response-format"}function rY(e){return e?.$brand==="auto-parseable-tool"}function rJ(e,t){let r=e.choices.map(e=>{var r,n;if("length"===e.finish_reason)throw new tU;if("content_filter"===e.finish_reason)throw new tB;return rz(e.message.tool_calls),{...e,message:{...e.message,...e.message.tool_calls?{tool_calls:e.message.tool_calls?.map(e=>{var r,n;let s;return r=t,n=e,s=r.tools?.find(e=>rW(e)&&e.function?.name===n.function.name),{...n,function:{...n.function,parsed_arguments:rY(s)?s.$parseRaw(n.function.arguments):s?.function.strict?JSON.parse(n.function.arguments):null}}})??void 0}:void 0,parsed:e.message.content&&!e.message.refusal?(r=t,n=e.message.content,r.response_format?.type!=="json_schema"?null:r.response_format?.type==="json_schema"?"$parseRaw"in r.response_format?r.response_format.$parseRaw(n):JSON.parse(n):null):null}}});return{...e,choices:r}}function rV(e){return!!rK(e.response_format)||(e.tools?.some(e=>rY(e)||"function"===e.type&&!0===e.function.strict)??!1)}function rz(e){for(let t of e||[])if("function"!==t.type)throw new tC(`Currently only \`function\` tool calls are supported; Received \`${t.type}\``)}let rQ=e=>e?.role==="assistant",rZ=e=>e?.role==="tool";class r0{constructor(){D.add(this),this.controller=new AbortController,M.set(this,void 0),j.set(this,()=>{}),k.set(this,()=>{}),L.set(this,void 0),H.set(this,()=>{}),F.set(this,()=>{}),U.set(this,{}),B.set(this,!1),q.set(this,!1),G.set(this,!1),X.set(this,!1),tS(this,M,new Promise((e,t)=>{tS(this,j,e,"f"),tS(this,k,t,"f")}),"f"),tS(this,L,new Promise((e,t)=>{tS(this,H,e,"f"),tS(this,F,t,"f")}),"f"),tR(this,M,"f").catch(()=>{}),tR(this,L,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},tR(this,D,"m",W).bind(this))},0)}_connected(){this.ended||(tR(this,j,"f").call(this),this._emit("connect"))}get ended(){return tR(this,B,"f")}get errored(){return tR(this,q,"f")}get aborted(){return tR(this,G,"f")}abort(){this.controller.abort()}on(e,t){return(tR(this,U,"f")[e]||(tR(this,U,"f")[e]=[])).push({listener:t}),this}off(e,t){let r=tR(this,U,"f")[e];if(!r)return this;let n=r.findIndex(e=>e.listener===t);return n>=0&&r.splice(n,1),this}once(e,t){return(tR(this,U,"f")[e]||(tR(this,U,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{tS(this,X,!0,"f"),"error"!==e&&this.once("error",r),this.once(e,t)})}async done(){tS(this,X,!0,"f"),await tR(this,L,"f")}_emit(e,...t){if(tR(this,B,"f"))return;"end"===e&&(tS(this,B,!0,"f"),tR(this,H,"f").call(this));let r=tR(this,U,"f")[e];if(r&&(tR(this,U,"f")[e]=r.filter(e=>!e.once),r.forEach(({listener:e})=>e(...t))),"abort"===e){let e=t[0];tR(this,X,"f")||r?.length||Promise.reject(e),tR(this,k,"f").call(this,e),tR(this,F,"f").call(this,e),this._emit("end");return}if("error"===e){let e=t[0];tR(this,X,"f")||r?.length||Promise.reject(e),tR(this,k,"f").call(this,e),tR(this,F,"f").call(this,e),this._emit("end")}}_emitFinal(){}}M=new WeakMap,j=new WeakMap,k=new WeakMap,L=new WeakMap,H=new WeakMap,F=new WeakMap,U=new WeakMap,B=new WeakMap,q=new WeakMap,G=new WeakMap,X=new WeakMap,D=new WeakSet,W=function(e){if(tS(this,q,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new tN),e instanceof tN)return tS(this,G,!0,"f"),this._emit("abort",e);if(e instanceof tC)return this._emit("error",e);if(e instanceof Error){let t=new tC(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new tC(String(e)))};class r1 extends r0{constructor(){super(...arguments),K.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),rZ(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(rQ(e)&&e.tool_calls)for(let t of e.tool_calls)"function"===t.type&&this._emit("functionToolCall",t.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new tC("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),tR(this,K,"m",Y).call(this)}async finalMessage(){return await this.done(),tR(this,K,"m",J).call(this)}async finalFunctionToolCall(){return await this.done(),tR(this,K,"m",V).call(this)}async finalFunctionToolCallResult(){return await this.done(),tR(this,K,"m",z).call(this)}async totalUsage(){return await this.done(),tR(this,K,"m",Q).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=tR(this,K,"m",J).call(this);t&&this._emit("finalMessage",t);let r=tR(this,K,"m",Y).call(this);r&&this._emit("finalContent",r);let n=tR(this,K,"m",V).call(this);n&&this._emit("finalFunctionToolCall",n);let s=tR(this,K,"m",z).call(this);null!=s&&this._emit("finalFunctionToolCallResult",s),this._chatCompletions.some(e=>e.usage)&&this._emit("totalUsage",tR(this,K,"m",Q).call(this))}async _createChatCompletion(e,t,r){let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),tR(this,K,"m",Z).call(this,t);let s=await e.chat.completions.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(rJ(s,t))}async _runChatCompletion(e,t,r){for(let e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,r)}async _runTools(e,t,r){let n="tool",{tool_choice:s="auto",stream:a,...i}=t,o="string"!=typeof s&&"function"===s.type&&s?.function?.name,{maxChatCompletions:l=10}=r||{},c=t.tools.map(e=>{if(rY(e)){if(!e.$callback)throw new tC("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e}),u={};for(let e of c)"function"===e.type&&(u[e.function.name||e.function.function.name]=e.function);let d="tools"in t?c.map(e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e):void 0;for(let e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){let t=await this._createChatCompletion(e,{...i,tool_choice:s,tools:d,messages:[...this.messages]},r),a=t.choices[0]?.message;if(!a)throw new tC("missing message in ChatCompletion response");if(!a.tool_calls?.length)break;for(let e of a.tool_calls){let t;if("function"!==e.type)continue;let r=e.id,{name:s,arguments:a}=e.function,i=u[s];if(i){if(o&&o!==s){let e=`Invalid tool_call: ${JSON.stringify(s)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:n,tool_call_id:r,content:e});continue}}else{let e=`Invalid tool_call: ${JSON.stringify(s)}. Available options are: ${Object.keys(u).map(e=>JSON.stringify(e)).join(", ")}. Please try again`;this._addMessage({role:n,tool_call_id:r,content:e});continue}try{t="function"==typeof i.parse?await i.parse(a):a}catch(t){let e=t instanceof Error?t.message:String(t);this._addMessage({role:n,tool_call_id:r,content:e});continue}let l=await i.function(t,this),c=tR(this,K,"m",ee).call(this,l);if(this._addMessage({role:n,tool_call_id:r,content:c}),o)return}}}}K=new WeakSet,Y=function(){return tR(this,K,"m",J).call(this).content??null},J=function(){let e=this.messages.length;for(;e-- >0;){let t=this.messages[e];if(rQ(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new tC("stream ended without producing a ChatCompletionMessage with role=assistant")},V=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(rQ(t)&&t?.tool_calls?.length)return t.tool_calls.filter(e=>"function"===e.type).at(-1)?.function}},z=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(rZ(t)&&null!=t.content&&"string"==typeof t.content&&this.messages.some(e=>"assistant"===e.role&&e.tool_calls?.some(e=>"function"===e.type&&e.id===t.tool_call_id)))return t.content}},Q=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},Z=function(e){if(null!=e.n&&e.n>1)throw new tC("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},ee=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class r2 extends r1{static runTools(e,t,r){let n=new r2,s={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,s)),n}_addMessage(e,t=!0){super._addMessage(e,t),rQ(e)&&e.content&&this._emit("content",e.content)}}let r4=511;class r6 extends Error{}class r8 extends Error{}let r3=e=>(function(e,t=r4){var r,n;let s,a,i,o,l,c,u,d,h,f;if("string"!=typeof e)throw TypeError(`expecting str, got ${typeof e}`);if(!e.trim())throw Error(`${e} is empty`);return r=e.trim(),n=t,s=r.length,a=0,i=e=>{throw new r6(`${e} at position ${a}`)},o=e=>{throw new r8(`${e} at position ${a}`)},l=()=>(f(),a>=s&&i("Unexpected end of input"),'"'===r[a])?c():"{"===r[a]?u():"["===r[a]?d():"null"===r.substring(a,a+4)||16&n&&s-a<4&&"null".startsWith(r.substring(a))?(a+=4,null):"true"===r.substring(a,a+4)||32&n&&s-a<4&&"true".startsWith(r.substring(a))?(a+=4,!0):"false"===r.substring(a,a+5)||32&n&&s-a<5&&"false".startsWith(r.substring(a))?(a+=5,!1):"Infinity"===r.substring(a,a+8)||128&n&&s-a<8&&"Infinity".startsWith(r.substring(a))?(a+=8,1/0):"-Infinity"===r.substring(a,a+9)||256&n&&1<s-a&&s-a<9&&"-Infinity".startsWith(r.substring(a))?(a+=9,-1/0):"NaN"===r.substring(a,a+3)||64&n&&s-a<3&&"NaN".startsWith(r.substring(a))?(a+=3,NaN):h(),c=()=>{let e=a,t=!1;for(a++;a<s&&('"'!==r[a]||t&&"\\"===r[a-1]);)t="\\"===r[a]&&!t,a++;if('"'==r.charAt(a))try{return JSON.parse(r.substring(e,++a-Number(t)))}catch(e){o(String(e))}else if(1&n)try{return JSON.parse(r.substring(e,a-Number(t))+'"')}catch(t){return JSON.parse(r.substring(e,r.lastIndexOf("\\"))+'"')}i("Unterminated string literal")},u=()=>{a++,f();let e={};try{for(;"}"!==r[a];){if(f(),a>=s&&8&n)return e;let t=c();f(),a++;try{let r=l();Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!0,configurable:!0})}catch(t){if(8&n)return e;throw t}f(),","===r[a]&&a++}}catch(t){if(8&n)return e;i("Expected '}' at end of object")}return a++,e},d=()=>{a++;let e=[];try{for(;"]"!==r[a];)e.push(l()),f(),","===r[a]&&a++}catch(t){if(4&n)return e;i("Expected ']' at end of array")}return a++,e},h=()=>{if(0===a){"-"===r&&2&n&&i("Not sure what '-' is");try{return JSON.parse(r)}catch(e){if(2&n)try{if("."===r[r.length-1])return JSON.parse(r.substring(0,r.lastIndexOf(".")));return JSON.parse(r.substring(0,r.lastIndexOf("e")))}catch(e){}o(String(e))}}let e=a;for("-"===r[a]&&a++;r[a]&&!",]}".includes(r[a]);)a++;a!=s||2&n||i("Unterminated number literal");try{return JSON.parse(r.substring(e,a))}catch(t){"-"===r.substring(e,a)&&2&n&&i("Not sure what '-' is");try{return JSON.parse(r.substring(e,r.lastIndexOf("e")))}catch(e){o(String(e))}}},f=()=>{for(;a<s&&" \n\r	".includes(r[a]);)a++},l()})(e,2^r4);class r5 extends r1{constructor(e){super(),et.add(this),er.set(this,void 0),en.set(this,void 0),es.set(this,void 0),tS(this,er,e,"f"),tS(this,en,[],"f")}get currentChatCompletionSnapshot(){return tR(this,es,"f")}static fromReadableStream(e){let t=new r5(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){let n=new r5(t);return n._run(()=>n._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createChatCompletion(e,t,r){super._createChatCompletion;let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),tR(this,et,"m",ea).call(this);let s=await e.chat.completions.create({...t,stream:!0},{...r,signal:this.controller.signal});for await(let e of(this._connected(),s))tR(this,et,"m",eo).call(this,e);if(s.controller.signal?.aborted)throw new tN;return this._addChatCompletion(tR(this,et,"m",eu).call(this))}async _fromReadableStream(e,t){let r,n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),tR(this,et,"m",ea).call(this),this._connected();let s=rm.fromReadableStream(e,this.controller);for await(let e of s)r&&r!==e.id&&this._addChatCompletion(tR(this,et,"m",eu).call(this)),tR(this,et,"m",eo).call(this,e),r=e.id;if(s.controller.signal?.aborted)throw new tN;return this._addChatCompletion(tR(this,et,"m",eu).call(this))}[(er=new WeakMap,en=new WeakMap,es=new WeakMap,et=new WeakSet,ea=function(){this.ended||tS(this,es,void 0,"f")},ei=function(e){let t=tR(this,en,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},tR(this,en,"f")[e.index]=t),t},eo=function(e){if(this.ended)return;let t=tR(this,et,"m",eh).call(this,e);for(let r of(this._emit("chunk",e,t),e.choices)){let e=t.choices[r.index];null!=r.delta.content&&e.message?.role==="assistant"&&e.message?.content&&(this._emit("content",r.delta.content,e.message.content),this._emit("content.delta",{delta:r.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=r.delta.refusal&&e.message?.role==="assistant"&&e.message?.refusal&&this._emit("refusal.delta",{delta:r.delta.refusal,snapshot:e.message.refusal}),r.logprobs?.content!=null&&e.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:r.logprobs?.content,snapshot:e.logprobs?.content??[]}),r.logprobs?.refusal!=null&&e.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:r.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]});let n=tR(this,et,"m",ei).call(this,e);for(let t of(e.finish_reason&&(tR(this,et,"m",ec).call(this,e),null!=n.current_tool_call_index&&tR(this,et,"m",el).call(this,e,n.current_tool_call_index)),r.delta.tool_calls??[]))n.current_tool_call_index!==t.index&&(tR(this,et,"m",ec).call(this,e),null!=n.current_tool_call_index&&tR(this,et,"m",el).call(this,e,n.current_tool_call_index)),n.current_tool_call_index=t.index;for(let t of r.delta.tool_calls??[]){let r=e.message.tool_calls?.[t.index];r?.type&&(r?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:r.function?.name,index:t.index,arguments:r.function.arguments,parsed_arguments:r.function.parsed_arguments,arguments_delta:t.function?.arguments??""}):ne(r?.type))}}},el=function(e,t){if(tR(this,et,"m",ei).call(this,e).done_tool_calls.has(t))return;let r=e.message.tool_calls?.[t];if(!r)throw Error("no tool call snapshot");if(!r.type)throw Error("tool call snapshot missing `type`");if("function"===r.type){let e=tR(this,er,"f")?.tools?.find(e=>rW(e)&&e.function.name===r.function.name);this._emit("tool_calls.function.arguments.done",{name:r.function.name,index:t,arguments:r.function.arguments,parsed_arguments:rY(e)?e.$parseRaw(r.function.arguments):e?.function.strict?JSON.parse(r.function.arguments):null})}else ne(r.type)},ec=function(e){let t=tR(this,et,"m",ei).call(this,e);if(e.message.content&&!t.content_done){t.content_done=!0;let r=tR(this,et,"m",ed).call(this);this._emit("content.done",{content:e.message.content,parsed:r?r.$parseRaw(e.message.content):null})}e.message.refusal&&!t.refusal_done&&(t.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),e.logprobs?.content&&!t.logprobs_content_done&&(t.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),e.logprobs?.refusal&&!t.logprobs_refusal_done&&(t.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},eu=function(){if(this.ended)throw new tC("stream has ended, this shouldn't happen");let e=tR(this,es,"f");if(!e)throw new tC("request ended without sending any chunks");return tS(this,es,void 0,"f"),tS(this,en,[],"f"),function(e,t){var r;let{id:n,choices:s,created:a,model:i,system_fingerprint:o,...l}=e;return r={...l,id:n,choices:s.map(({message:t,finish_reason:r,index:n,logprobs:s,...a})=>{if(!r)throw new tC(`missing finish_reason for choice ${n}`);let{content:i=null,function_call:o,tool_calls:l,...c}=t,u=t.role;if(!u)throw new tC(`missing role for choice ${n}`);if(o){let{arguments:e,name:l}=o;if(null==e)throw new tC(`missing function_call.arguments for choice ${n}`);if(!l)throw new tC(`missing function_call.name for choice ${n}`);return{...a,message:{content:i,function_call:{arguments:e,name:l},role:u,refusal:t.refusal??null},finish_reason:r,index:n,logprobs:s}}return l?{...a,index:n,finish_reason:r,logprobs:s,message:{...c,role:u,content:i,refusal:t.refusal??null,tool_calls:l.map((t,r)=>{let{function:s,type:a,id:i,...o}=t,{arguments:l,name:c,...u}=s||{};if(null==i)throw new tC(`missing choices[${n}].tool_calls[${r}].id
${r9(e)}`);if(null==a)throw new tC(`missing choices[${n}].tool_calls[${r}].type
${r9(e)}`);if(null==c)throw new tC(`missing choices[${n}].tool_calls[${r}].function.name
${r9(e)}`);if(null==l)throw new tC(`missing choices[${n}].tool_calls[${r}].function.arguments
${r9(e)}`);return{...o,id:i,type:a,function:{...u,name:c,arguments:l}}})}}:{...a,message:{...c,content:i,role:u,refusal:t.refusal??null},finish_reason:r,index:n,logprobs:s}}),created:a,model:i,object:"chat.completion",...o?{system_fingerprint:o}:{}},t&&rV(t)?rJ(r,t):{...r,choices:r.choices.map(e=>(rz(e.message.tool_calls),{...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}}))}}(e,tR(this,er,"f"))},ed=function(){let e=tR(this,er,"f")?.response_format;return rK(e)?e:null},eh=function(e){var t,r,n,s;let a=tR(this,es,"f"),{choices:i,...o}=e;for(let{delta:i,finish_reason:l,index:c,logprobs:u=null,...d}of(a?Object.assign(a,o):a=tS(this,es,{...o,choices:[]},"f"),e.choices)){let e=a.choices[c];if(e||(e=a.choices[c]={finish_reason:l,index:c,message:{},logprobs:u,...d}),u)if(e.logprobs){let{content:n,refusal:s,...a}=u;r7(a),Object.assign(e.logprobs,a),n&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...n)),s&&((r=e.logprobs).refusal??(r.refusal=[]),e.logprobs.refusal.push(...s))}else e.logprobs=Object.assign({},u);if(l&&(e.finish_reason=l,tR(this,er,"f")&&rV(tR(this,er,"f")))){if("length"===l)throw new tU;if("content_filter"===l)throw new tB}if(Object.assign(e,d),!i)continue;let{content:o,refusal:h,function_call:f,role:p,tool_calls:m,...g}=i;if(r7(g),Object.assign(e.message,g),h&&(e.message.refusal=(e.message.refusal||"")+h),p&&(e.message.role=p),f&&(e.message.function_call?(f.name&&(e.message.function_call.name=f.name),f.arguments&&((n=e.message.function_call).arguments??(n.arguments=""),e.message.function_call.arguments+=f.arguments)):e.message.function_call=f),o&&(e.message.content=(e.message.content||"")+o,!e.message.refusal&&tR(this,et,"m",ed).call(this)&&(e.message.parsed=r3(e.message.content))),m)for(let{index:t,id:r,type:n,function:a,...i}of(e.message.tool_calls||(e.message.tool_calls=[]),m)){let o=(s=e.message.tool_calls)[t]??(s[t]={});Object.assign(o,i),r&&(o.id=r),n&&(o.type=n),a&&(o.function??(o.function={name:a.name??"",arguments:""})),a?.name&&(o.function.name=a.name),a?.arguments&&(o.function.arguments+=a.arguments,function(e,t){if(!e||!("tools"in e)||!e.tools)return!1;let r=e.tools?.find(e=>rW(e)&&e.function?.name===t.function.name);return rW(r)&&(rY(r)||r?.function.strict||!1)}(tR(this,er,"f"),o)&&(o.function.parsed_arguments=r3(o.function.arguments)))}}return a},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("chunk",r=>{let n=t.shift();n?n.resolve(r):e.push(r)}),this.on("end",()=>{for(let e of(r=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(r=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(r=!0,t))n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((e,r)=>t.push({resolve:e,reject:r})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new rm(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function r9(e){return JSON.stringify(e)}function r7(e){}function ne(e){}class nt extends r5{static fromReadableStream(e){let t=new nt(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,r){let n=new nt(t),s={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,s)),n}}class nr extends rU{constructor(){super(...arguments),this.messages=new rX(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(rG`/chat/completions/${e}`,t)}update(e,t,r){return this._client.post(rG`/chat/completions/${e}`,{body:t,...r})}list(e={},t){return this._client.getAPIList("/chat/completions",rO,{query:e,...t})}delete(e,t){return this._client.delete(rG`/chat/completions/${e}`,t)}parse(e,t){for(let t of e.tools??[]){if("function"!==t.type)throw new tC(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new tC(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}return this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(t=>rJ(t,e))}runTools(e,t){return e.stream?nt.runTools(this._client,e,t):r2.runTools(this._client,e,t)}stream(e,t){return r5.createChatCompletion(this._client,e,t)}}nr.Messages=rX;class nn extends rU{constructor(){super(...arguments),this.completions=new nr(this._client)}}nn.Completions=nr,e.s([],98546);let ns=Symbol("brand.privateNullableHeaders"),na=e=>{let t=new Headers,r=new Set;for(let n of e){let e=new Set;for(let[s,a]of function*(e){let t;if(!e)return;if(ns in e){let{values:t,nulls:r}=e;for(let e of(yield*t.entries(),r))yield[e,null];return}let r=!1;for(let n of(e instanceof Headers?t=e.entries():tW(e)?t=e:(r=!0,t=Object.entries(e??{})),t)){let e=n[0];if("string"!=typeof e)throw TypeError("expected header name to be a string");let t=tW(n[1])?n[1]:[n[1]],s=!1;for(let n of t)void 0!==n&&(r&&!s&&(s=!0,yield[e,null]),yield[e,n])}}(n)){let n=s.toLowerCase();e.has(n)||(t.delete(s),e.add(n)),null===a?(t.delete(s),r.add(n)):(t.append(s,a),r.delete(n))}}return{[ns]:!0,values:t,nulls:r}};class ni extends rU{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:na([{Accept:"application/octet-stream"},t?.headers]),__binaryResponse:!0})}}class no extends rU{create(e,t){return this._client.post("/audio/transcriptions",rI({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}class nl extends rU{create(e,t){return this._client.post("/audio/translations",rI({body:e,...t,__metadata:{model:e.model}},this._client))}}class nc extends rU{constructor(){super(...arguments),this.transcriptions=new no(this._client),this.translations=new nl(this._client),this.speech=new ni(this._client)}}nc.Transcriptions=no,nc.Translations=nl,nc.Speech=ni;class nu extends rU{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(rG`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",rO,{query:e,...t})}cancel(e,t){return this._client.post(rG`/batches/${e}/cancel`,t)}}class nd extends rU{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:na([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(rG`/assistants/${e}`,{...t,headers:na([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,r){return this._client.post(rG`/assistants/${e}`,{body:t,...r,headers:na([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e={},t){return this._client.getAPIList("/assistants",rO,{query:e,...t,headers:na([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(rG`/assistants/${e}`,{...t,headers:na([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class nh extends rU{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:na([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class nf extends rU{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:na([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class np extends rU{constructor(){super(...arguments),this.sessions=new nh(this._client),this.transcriptionSessions=new nf(this._client)}}np.Sessions=nh,np.TranscriptionSessions=nf;class nm extends rU{create(e,t){return this._client.post("/chatkit/sessions",{body:e,...t,headers:na([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}cancel(e,t){return this._client.post(rG`/chatkit/sessions/${e}/cancel`,{...t,headers:na([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}}class ng extends rU{retrieve(e,t){return this._client.get(rG`/chatkit/threads/${e}`,{...t,headers:na([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}list(e={},t){return this._client.getAPIList("/chatkit/threads",rT,{query:e,...t,headers:na([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}delete(e,t){return this._client.delete(rG`/chatkit/threads/${e}`,{...t,headers:na([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}listItems(e,t={},r){return this._client.getAPIList(rG`/chatkit/threads/${e}/items`,rT,{query:t,...r,headers:na([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}}class n_ extends rU{constructor(){super(...arguments),this.sessions=new nm(this._client),this.threads=new ng(this._client)}}n_.Sessions=nm,n_.Threads=ng;class ny extends rU{create(e,t,r){return this._client.post(rG`/threads/${e}/messages`,{body:t,...r,headers:na([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,t,r){let{thread_id:n}=t;return this._client.get(rG`/threads/${n}/messages/${e}`,{...r,headers:na([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,t,r){let{thread_id:n,...s}=t;return this._client.post(rG`/threads/${n}/messages/${e}`,{body:s,...r,headers:na([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e,t={},r){return this._client.getAPIList(rG`/threads/${e}/messages`,rO,{query:t,...r,headers:na([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,t,r){let{thread_id:n}=t;return this._client.delete(rG`/threads/${n}/messages/${e}`,{...r,headers:na([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}}class nb extends rU{retrieve(e,t,r){let{thread_id:n,run_id:s,...a}=t;return this._client.get(rG`/threads/${n}/runs/${s}/steps/${e}`,{query:a,...r,headers:na([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e,t,r){let{thread_id:n,...s}=t;return this._client.getAPIList(rG`/threads/${n}/runs/${e}/steps`,rO,{query:s,...r,headers:na([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}}let nv=e=>void 0!==globalThis.process?globalThis.process.env?.[e]?.trim()??void 0:void 0!==globalThis.Deno?globalThis.Deno.env?.get?.(e)?.trim():void 0;class nw extends r0{constructor(){super(...arguments),ef.add(this),em.set(this,[]),eg.set(this,{}),e_.set(this,{}),ey.set(this,void 0),eb.set(this,void 0),ev.set(this,void 0),ew.set(this,void 0),eE.set(this,void 0),eS.set(this,void 0),eR.set(this,void 0),eO.set(this,void 0),eT.set(this,void 0)}[(em=new WeakMap,eg=new WeakMap,e_=new WeakMap,ey=new WeakMap,eb=new WeakMap,ev=new WeakMap,ew=new WeakMap,eE=new WeakMap,eS=new WeakMap,eR=new WeakMap,eO=new WeakMap,eT=new WeakMap,ef=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("event",r=>{let n=t.shift();n?n.resolve(r):e.push(r)}),this.on("end",()=>{for(let e of(r=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(r=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(r=!0,t))n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((e,r)=>t.push({resolve:e,reject:r})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new ep;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){let r=t?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();let n=rm.fromReadableStream(e,this.controller);for await(let e of n)tR(this,ef,"m",eA).call(this,e);if(n.controller.signal?.aborted)throw new tN;return this._addRun(tR(this,ef,"m",eC).call(this))}toReadableStream(){return new rm(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,r,n){let s=new ep;return s._run(()=>s._runToolAssistantStream(e,t,r,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createToolAssistantStream(e,t,r,n){let s=n?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));let a={...r,stream:!0},i=await e.submitToolOutputs(t,a,{...n,signal:this.controller.signal});for await(let e of(this._connected(),i))tR(this,ef,"m",eA).call(this,e);if(i.controller.signal?.aborted)throw new tN;return this._addRun(tR(this,ef,"m",eC).call(this))}static createThreadAssistantStream(e,t,r){let n=new ep;return n._run(()=>n._threadAssistantStream(e,t,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),n}static createAssistantStream(e,t,r,n){let s=new ep;return s._run(()=>s._runAssistantStream(e,t,r,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),s}currentEvent(){return tR(this,eR,"f")}currentRun(){return tR(this,eO,"f")}currentMessageSnapshot(){return tR(this,ey,"f")}currentRunStepSnapshot(){return tR(this,eT,"f")}async finalRunSteps(){return await this.done(),Object.values(tR(this,eg,"f"))}async finalMessages(){return await this.done(),Object.values(tR(this,e_,"f"))}async finalRun(){if(await this.done(),!tR(this,eb,"f"))throw Error("Final run was not received.");return tR(this,eb,"f")}async _createThreadAssistantStream(e,t,r){let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort()));let s={...t,stream:!0},a=await e.createAndRun(s,{...r,signal:this.controller.signal});for await(let e of(this._connected(),a))tR(this,ef,"m",eA).call(this,e);if(a.controller.signal?.aborted)throw new tN;return this._addRun(tR(this,ef,"m",eC).call(this))}async _createAssistantStream(e,t,r,n){let s=n?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));let a={...r,stream:!0},i=await e.create(t,a,{...n,signal:this.controller.signal});for await(let e of(this._connected(),i))tR(this,ef,"m",eA).call(this,e);if(i.controller.signal?.aborted)throw new tN;return this._addRun(tR(this,ef,"m",eC).call(this))}static accumulateDelta(e,t){for(let[r,n]of Object.entries(t)){if(!e.hasOwnProperty(r)){e[r]=n;continue}let t=e[r];if(null==t||"index"===r||"type"===r){e[r]=n;continue}if("string"==typeof t&&"string"==typeof n)t+=n;else if("number"==typeof t&&"number"==typeof n)t+=n;else if(tY(t)&&tY(n))t=this.accumulateDelta(t,n);else if(Array.isArray(t)&&Array.isArray(n)){if(t.every(e=>"string"==typeof e||"number"==typeof e)){t.push(...n);continue}for(let e of n){if(!tY(e))throw Error(`Expected array delta entry to be an object but got: ${e}`);let r=e.index;if(null==r)throw console.error(e),Error("Expected array delta entry to have an `index` property");if("number"!=typeof r)throw Error(`Expected array delta entry \`index\` property to be a number but got ${r}`);let n=t[r];null==n?t.push(e):t[r]=this.accumulateDelta(n,e)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${n}, accValue: ${t}`);e[r]=t}return e}_addRun(e){return e}async _threadAssistantStream(e,t,r){return await this._createThreadAssistantStream(t,e,r)}async _runAssistantStream(e,t,r,n){return await this._createAssistantStream(t,e,r,n)}async _runToolAssistantStream(e,t,r,n){return await this._createToolAssistantStream(t,e,r,n)}}ep=nw,eA=function(e){if(!this.ended)switch(tS(this,eR,e,"f"),tR(this,ef,"m",eP).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":tR(this,ef,"m",eM).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":tR(this,ef,"m",eN).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":tR(this,ef,"m",ex).call(this,e);break;case"error":throw Error("Encountered an error event in event processing - errors should be processed earlier")}},eC=function(){if(this.ended)throw new tC("stream has ended, this shouldn't happen");if(!tR(this,eb,"f"))throw Error("Final run has not been received");return tR(this,eb,"f")},ex=function(e){let[t,r]=tR(this,ef,"m",e$).call(this,e,tR(this,ey,"f"));for(let e of(tS(this,ey,t,"f"),tR(this,e_,"f")[t.id]=t,r)){let r=t.content[e.index];r?.type=="text"&&this._emit("textCreated",r.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let r of e.data.delta.content){if("text"==r.type&&r.text){let e=r.text,n=t.content[r.index];if(n&&"text"==n.type)this._emit("textDelta",e,n.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(r.index!=tR(this,ev,"f")){if(tR(this,ew,"f"))switch(tR(this,ew,"f").type){case"text":this._emit("textDone",tR(this,ew,"f").text,tR(this,ey,"f"));break;case"image_file":this._emit("imageFileDone",tR(this,ew,"f").image_file,tR(this,ey,"f"))}tS(this,ev,r.index,"f")}tS(this,ew,t.content[r.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==tR(this,ev,"f")){let t=e.data.content[tR(this,ev,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,tR(this,ey,"f"));break;case"text":this._emit("textDone",t.text,tR(this,ey,"f"))}}tR(this,ey,"f")&&this._emit("messageDone",e.data),tS(this,ey,void 0,"f")}},eN=function(e){let t=tR(this,ef,"m",eI).call(this,e);switch(tS(this,eT,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let r=e.data.delta;if(r.step_details&&"tool_calls"==r.step_details.type&&r.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(let e of r.step_details.tool_calls)e.index==tR(this,eE,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(tR(this,eS,"f")&&this._emit("toolCallDone",tR(this,eS,"f")),tS(this,eE,e.index,"f"),tS(this,eS,t.step_details.tool_calls[e.index],"f"),tR(this,eS,"f")&&this._emit("toolCallCreated",tR(this,eS,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":tS(this,eT,void 0,"f"),"tool_calls"==e.data.step_details.type&&tR(this,eS,"f")&&(this._emit("toolCallDone",tR(this,eS,"f")),tS(this,eS,void 0,"f")),this._emit("runStepDone",e.data,t)}},eP=function(e){tR(this,em,"f").push(e),this._emit("event",e)},eI=function(e){switch(e.event){case"thread.run.step.created":return tR(this,eg,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=tR(this,eg,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){let n=ep.accumulateDelta(t,r.delta);tR(this,eg,"f")[e.data.id]=n}return tR(this,eg,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":tR(this,eg,"f")[e.data.id]=e.data}if(tR(this,eg,"f")[e.data.id])return tR(this,eg,"f")[e.data.id];throw Error("No snapshot available")},e$=function(e,t){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let n=e.data;if(n.delta.content)for(let e of n.delta.content)if(e.index in t.content){let r=t.content[e.index];t.content[e.index]=tR(this,ef,"m",eD).call(this,e,r)}else t.content[e.index]=e,r.push(e);return[t,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},eD=function(e,t){return ep.accumulateDelta(t,e)},eM=function(e){switch(tS(this,eO,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":tS(this,eb,e.data,"f"),tR(this,eS,"f")&&(this._emit("toolCallDone",tR(this,eS,"f")),tS(this,eS,void 0,"f"))}};class nE extends rU{constructor(){super(...arguments),this.steps=new nb(this._client)}create(e,t,r){let{include:n,...s}=t;return this._client.post(rG`/threads/${e}/runs`,{query:{include:n},body:s,...r,headers:na([{"OpenAI-Beta":"assistants=v2"},r?.headers]),stream:t.stream??!1})}retrieve(e,t,r){let{thread_id:n}=t;return this._client.get(rG`/threads/${n}/runs/${e}`,{...r,headers:na([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,t,r){let{thread_id:n,...s}=t;return this._client.post(rG`/threads/${n}/runs/${e}`,{body:s,...r,headers:na([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e,t={},r){return this._client.getAPIList(rG`/threads/${e}/runs`,rO,{query:t,...r,headers:na([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}cancel(e,t,r){let{thread_id:n}=t;return this._client.post(rG`/threads/${n}/runs/${e}/cancel`,{...r,headers:na([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}async createAndPoll(e,t,r){let n=await this.create(e,t,r);return await this.poll(n.id,{thread_id:e},r)}createAndStream(e,t,r){return nw.createAssistantStream(e,this._client.beta.threads.runs,t,r)}async poll(e,t,r){let n=na([r?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":r?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:s,response:a}=await this.retrieve(e,t,{...r,headers:{...r?.headers,...n}}).withResponse();switch(s.status){case"queued":case"in_progress":case"cancelling":let i=5e3;if(r?.pollIntervalMs)i=r.pollIntervalMs;else{let e=a.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(i=t)}}await tJ(i);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return s}}}stream(e,t,r){return nw.createAssistantStream(e,this._client.beta.threads.runs,t,r)}submitToolOutputs(e,t,r){let{thread_id:n,...s}=t;return this._client.post(rG`/threads/${n}/runs/${e}/submit_tool_outputs`,{body:s,...r,headers:na([{"OpenAI-Beta":"assistants=v2"},r?.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,r){let n=await this.submitToolOutputs(e,t,r);return await this.poll(n.id,t,r)}submitToolOutputsStream(e,t,r){return nw.createToolAssistantStream(e,this._client.beta.threads.runs,t,r)}}nE.Steps=nb;class nS extends rU{constructor(){super(...arguments),this.runs=new nE(this._client),this.messages=new ny(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:na([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(rG`/threads/${e}`,{...t,headers:na([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,r){return this._client.post(rG`/threads/${e}`,{body:t,...r,headers:na([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,t){return this._client.delete(rG`/threads/${e}`,{...t,headers:na([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:na([{"OpenAI-Beta":"assistants=v2"},t?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){let r=await this.createAndRun(e,t);return await this.runs.poll(r.id,{thread_id:r.thread_id},t)}createAndRunStream(e,t){return nw.createThreadAssistantStream(e,this._client.beta.threads,t)}}nS.Runs=nE,nS.Messages=ny;class nR extends rU{constructor(){super(...arguments),this.realtime=new np(this._client),this.chatkit=new n_(this._client),this.assistants=new nd(this._client),this.threads=new nS(this._client)}}nR.Realtime=np,nR.ChatKit=n_,nR.Assistants=nd,nR.Threads=nS;class nO extends rU{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class nT extends rU{retrieve(e,t,r){let{container_id:n}=t;return this._client.get(rG`/containers/${n}/files/${e}/content`,{...r,headers:na([{Accept:"application/binary"},r?.headers]),__binaryResponse:!0})}}class nA extends rU{constructor(){super(...arguments),this.content=new nT(this._client)}create(e,t,r){return this._client.post(rG`/containers/${e}/files`,rI({body:t,...r},this._client))}retrieve(e,t,r){let{container_id:n}=t;return this._client.get(rG`/containers/${n}/files/${e}`,r)}list(e,t={},r){return this._client.getAPIList(rG`/containers/${e}/files`,rO,{query:t,...r})}delete(e,t,r){let{container_id:n}=t;return this._client.delete(rG`/containers/${n}/files/${e}`,{...r,headers:na([{Accept:"*/*"},r?.headers])})}}nA.Content=nT;class nC extends rU{constructor(){super(...arguments),this.files=new nA(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(rG`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",rO,{query:e,...t})}delete(e,t){return this._client.delete(rG`/containers/${e}`,{...t,headers:na([{Accept:"*/*"},t?.headers])})}}nC.Files=nA;class nx extends rU{create(e,t,r){let{include:n,...s}=t;return this._client.post(rG`/conversations/${e}/items`,{query:{include:n},body:s,...r})}retrieve(e,t,r){let{conversation_id:n,...s}=t;return this._client.get(rG`/conversations/${n}/items/${e}`,{query:s,...r})}list(e,t={},r){return this._client.getAPIList(rG`/conversations/${e}/items`,rT,{query:t,...r})}delete(e,t,r){let{conversation_id:n}=t;return this._client.delete(rG`/conversations/${n}/items/${e}`,r)}}class nN extends rU{constructor(){super(...arguments),this.items=new nx(this._client)}create(e={},t){return this._client.post("/conversations",{body:e,...t})}retrieve(e,t){return this._client.get(rG`/conversations/${e}`,t)}update(e,t,r){return this._client.post(rG`/conversations/${e}`,{body:t,...r})}delete(e,t){return this._client.delete(rG`/conversations/${e}`,t)}}nN.Items=nx;class nP extends rU{create(e,t){let r=!!e.encoding_format,n=r?e.encoding_format:"base64";r&&rf(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);let s=this._client.post("/embeddings",{body:{...e,encoding_format:n},...t});return r?s:(rf(this._client).debug("embeddings/decoding base64 embeddings from base64"),s._thenUnwrap(e=>(e&&e.data&&e.data.forEach(e=>{let t=e.embedding;e.embedding=(e=>{if("undefined"!=typeof Buffer){let t=Buffer.from(e,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}{let t=atob(e),r=t.length,n=new Uint8Array(r);for(let e=0;e<r;e++)n[e]=t.charCodeAt(e);return Array.from(new Float32Array(n.buffer))}})(t)}),e)))}}class nI extends rU{retrieve(e,t,r){let{eval_id:n,run_id:s}=t;return this._client.get(rG`/evals/${n}/runs/${s}/output_items/${e}`,r)}list(e,t,r){let{eval_id:n,...s}=t;return this._client.getAPIList(rG`/evals/${n}/runs/${e}/output_items`,rO,{query:s,...r})}}class n$ extends rU{constructor(){super(...arguments),this.outputItems=new nI(this._client)}create(e,t,r){return this._client.post(rG`/evals/${e}/runs`,{body:t,...r})}retrieve(e,t,r){let{eval_id:n}=t;return this._client.get(rG`/evals/${n}/runs/${e}`,r)}list(e,t={},r){return this._client.getAPIList(rG`/evals/${e}/runs`,rO,{query:t,...r})}delete(e,t,r){let{eval_id:n}=t;return this._client.delete(rG`/evals/${n}/runs/${e}`,r)}cancel(e,t,r){let{eval_id:n}=t;return this._client.post(rG`/evals/${n}/runs/${e}`,r)}}n$.OutputItems=nI;class nD extends rU{constructor(){super(...arguments),this.runs=new n$(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(rG`/evals/${e}`,t)}update(e,t,r){return this._client.post(rG`/evals/${e}`,{body:t,...r})}list(e={},t){return this._client.getAPIList("/evals",rO,{query:e,...t})}delete(e,t){return this._client.delete(rG`/evals/${e}`,t)}}nD.Runs=n$;class nM extends rU{create(e,t){return this._client.post("/files",rI({body:e,...t},this._client))}retrieve(e,t){return this._client.get(rG`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",rO,{query:e,...t})}delete(e,t){return this._client.delete(rG`/files/${e}`,t)}content(e,t){return this._client.get(rG`/files/${e}/content`,{...t,headers:na([{Accept:"application/binary"},t?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=18e5}={}){let n=new Set(["processed","error","deleted"]),s=Date.now(),a=await this.retrieve(e);for(;!a.status||!n.has(a.status);)if(await tJ(t),a=await this.retrieve(e),Date.now()-s>r)throw new tI({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return a}}class nj extends rU{}class nk extends rU{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}}class nL extends rU{constructor(){super(...arguments),this.graders=new nk(this._client)}}nL.Graders=nk;class nH extends rU{create(e,t,r){return this._client.getAPIList(rG`/fine_tuning/checkpoints/${e}/permissions`,rR,{body:t,method:"post",...r})}retrieve(e,t={},r){return this._client.get(rG`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...r})}delete(e,t,r){let{fine_tuned_model_checkpoint:n}=t;return this._client.delete(rG`/fine_tuning/checkpoints/${n}/permissions/${e}`,r)}}class nF extends rU{constructor(){super(...arguments),this.permissions=new nH(this._client)}}nF.Permissions=nH;class nU extends rU{list(e,t={},r){return this._client.getAPIList(rG`/fine_tuning/jobs/${e}/checkpoints`,rO,{query:t,...r})}}class nB extends rU{constructor(){super(...arguments),this.checkpoints=new nU(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(rG`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",rO,{query:e,...t})}cancel(e,t){return this._client.post(rG`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return this._client.getAPIList(rG`/fine_tuning/jobs/${e}/events`,rO,{query:t,...r})}pause(e,t){return this._client.post(rG`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(rG`/fine_tuning/jobs/${e}/resume`,t)}}nB.Checkpoints=nU;class nq extends rU{constructor(){super(...arguments),this.methods=new nj(this._client),this.jobs=new nB(this._client),this.checkpoints=new nF(this._client),this.alpha=new nL(this._client)}}nq.Methods=nj,nq.Jobs=nB,nq.Checkpoints=nF,nq.Alpha=nL;class nG extends rU{}class nX extends rU{constructor(){super(...arguments),this.graderModels=new nG(this._client)}}nX.GraderModels=nG;class nW extends rU{createVariation(e,t){return this._client.post("/images/variations",rI({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",rI({body:e,...t,stream:e.stream??!1},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t,stream:e.stream??!1})}}class nK extends rU{retrieve(e,t){return this._client.get(rG`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",rR,e)}delete(e,t){return this._client.delete(rG`/models/${e}`,t)}}class nY extends rU{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class nJ extends rU{accept(e,t,r){return this._client.post(rG`/realtime/calls/${e}/accept`,{body:t,...r,headers:na([{Accept:"*/*"},r?.headers])})}hangup(e,t){return this._client.post(rG`/realtime/calls/${e}/hangup`,{...t,headers:na([{Accept:"*/*"},t?.headers])})}refer(e,t,r){return this._client.post(rG`/realtime/calls/${e}/refer`,{body:t,...r,headers:na([{Accept:"*/*"},r?.headers])})}reject(e,t={},r){return this._client.post(rG`/realtime/calls/${e}/reject`,{body:t,...r,headers:na([{Accept:"*/*"},r?.headers])})}}class nV extends rU{create(e,t){return this._client.post("/realtime/client_secrets",{body:e,...t})}}class nz extends rU{constructor(){super(...arguments),this.clientSecrets=new nV(this._client),this.calls=new nJ(this._client)}}function nQ(e,t){let r=e.output.map(e=>{if("function_call"===e.type)return{...e,parsed_arguments:function(e,t){var r,n;let s=(r=e.tools??[],n=t.name,r.find(e=>"function"===e.type&&e.name===n));return{...t,...t,parsed_arguments:s?.$brand==="auto-parseable-tool"?s.$parseRaw(t.arguments):s?.strict?JSON.parse(t.arguments):null}}(t,e)};if("message"===e.type){let r=e.content.map(e=>{var r,n;return"output_text"===e.type?{...e,parsed:(r=t,n=e.text,r.text?.format?.type!=="json_schema"?null:"$parseRaw"in r.text?.format?(r.text?.format).$parseRaw(n):JSON.parse(n))}:e});return{...e,content:r}}return e}),n=Object.assign({},e,{output:r});return Object.getOwnPropertyDescriptor(e,"output_text")||nZ(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(let e of n.output)if("message"===e.type){for(let t of e.content)if("output_text"===t.type&&null!==t.parsed)return t.parsed}return null}}),n}function nZ(e){let t=[];for(let r of e.output)if("message"===r.type)for(let e of r.content)"output_text"===e.type&&t.push(e.text);e.output_text=t.join("")}nz.ClientSecrets=nV,nz.Calls=nJ;class n0 extends r0{constructor(e){super(),ej.add(this),ek.set(this,void 0),eL.set(this,void 0),eH.set(this,void 0),tS(this,ek,e,"f")}static createResponse(e,t,r){let n=new n0(t);return n._run(()=>n._createOrRetrieveResponse(e,t,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createOrRetrieveResponse(e,t,r){let n,s=r?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),tR(this,ej,"m",eF).call(this);let a=null;for await(let s of("response_id"in t?(n=await e.responses.retrieve(t.response_id,{stream:!0},{...r,signal:this.controller.signal,stream:!0}),a=t.starting_after??null):n=await e.responses.create({...t,stream:!0},{...r,signal:this.controller.signal}),this._connected(),n))tR(this,ej,"m",eU).call(this,s,a);if(n.controller.signal?.aborted)throw new tN;return tR(this,ej,"m",eB).call(this)}[(ek=new WeakMap,eL=new WeakMap,eH=new WeakMap,ej=new WeakSet,eF=function(){this.ended||tS(this,eL,void 0,"f")},eU=function(e,t){if(this.ended)return;let r=(e,r)=>{(null==t||r.sequence_number>t)&&this._emit(e,r)},n=tR(this,ej,"m",eq).call(this,e);switch(r("event",e),e.type){case"response.output_text.delta":{let t=n.output[e.output_index];if(!t)throw new tC(`missing output at index ${e.output_index}`);if("message"===t.type){let n=t.content[e.content_index];if(!n)throw new tC(`missing content at index ${e.content_index}`);if("output_text"!==n.type)throw new tC(`expected content to be 'output_text', got ${n.type}`);r("response.output_text.delta",{...e,snapshot:n.text})}break}case"response.function_call_arguments.delta":{let t=n.output[e.output_index];if(!t)throw new tC(`missing output at index ${e.output_index}`);"function_call"===t.type&&r("response.function_call_arguments.delta",{...e,snapshot:t.arguments});break}default:r(e.type,e)}},eB=function(){if(this.ended)throw new tC("stream has ended, this shouldn't happen");let e=tR(this,eL,"f");if(!e)throw new tC("request ended without sending any events");tS(this,eL,void 0,"f");let t=function(e,t){var r;return t&&(r=t,rK(r.text?.format))?nQ(e,t):{...e,output_parsed:null,output:e.output.map(e=>"function_call"===e.type?{...e,parsed_arguments:null}:"message"===e.type?{...e,content:e.content.map(e=>({...e,parsed:null}))}:e)}}(e,tR(this,ek,"f"));return tS(this,eH,t,"f"),t},eq=function(e){let t=tR(this,eL,"f");if(!t){if("response.created"!==e.type)throw new tC(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return tS(this,eL,e.response,"f")}switch(e.type){case"response.output_item.added":t.output.push(e.item);break;case"response.content_part.added":{let r=t.output[e.output_index];if(!r)throw new tC(`missing output at index ${e.output_index}`);let n=r.type,s=e.part;"message"===n&&"reasoning_text"!==s.type?r.content.push(s):"reasoning"===n&&"reasoning_text"===s.type&&(r.content||(r.content=[]),r.content.push(s));break}case"response.output_text.delta":{let r=t.output[e.output_index];if(!r)throw new tC(`missing output at index ${e.output_index}`);if("message"===r.type){let t=r.content[e.content_index];if(!t)throw new tC(`missing content at index ${e.content_index}`);if("output_text"!==t.type)throw new tC(`expected content to be 'output_text', got ${t.type}`);t.text+=e.delta}break}case"response.function_call_arguments.delta":{let r=t.output[e.output_index];if(!r)throw new tC(`missing output at index ${e.output_index}`);"function_call"===r.type&&(r.arguments+=e.delta);break}case"response.reasoning_text.delta":{let r=t.output[e.output_index];if(!r)throw new tC(`missing output at index ${e.output_index}`);if("reasoning"===r.type){let t=r.content?.[e.content_index];if(!t)throw new tC(`missing content at index ${e.content_index}`);if("reasoning_text"!==t.type)throw new tC(`expected content to be 'reasoning_text', got ${t.type}`);t.text+=e.delta}break}case"response.completed":tS(this,eL,e.response,"f")}return t},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("event",r=>{let n=t.shift();n?n.resolve(r):e.push(r)}),this.on("end",()=>{for(let e of(r=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(r=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(r=!0,t))n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((e,r)=>t.push({resolve:e,reject:r})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=tR(this,eH,"f");if(!e)throw new tC("stream ended without producing a ChatCompletion");return e}}class n1 extends rU{list(e,t={},r){return this._client.getAPIList(rG`/responses/${e}/input_items`,rO,{query:t,...r})}}class n2 extends rU{count(e={},t){return this._client.post("/responses/input_tokens",{body:e,...t})}}class n4 extends rU{constructor(){super(...arguments),this.inputItems=new n1(this._client),this.inputTokens=new n2(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&nZ(e),e))}retrieve(e,t={},r){return this._client.get(rG`/responses/${e}`,{query:t,...r,stream:t?.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&nZ(e),e))}delete(e,t){return this._client.delete(rG`/responses/${e}`,{...t,headers:na([{Accept:"*/*"},t?.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(t=>nQ(t,e))}stream(e,t){return n0.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(rG`/responses/${e}/cancel`,t)}}n4.InputItems=n1,n4.InputTokens=n2;class n6 extends rU{create(e,t,r){return this._client.post(rG`/uploads/${e}/parts`,rI({body:t,...r},this._client))}}class n8 extends rU{constructor(){super(...arguments),this.parts=new n6(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(rG`/uploads/${e}/cancel`,t)}complete(e,t,r){return this._client.post(rG`/uploads/${e}/complete`,{body:t,...r})}}n8.Parts=n6;let n3=async e=>{let t=await Promise.allSettled(e),r=t.filter(e=>"rejected"===e.status);if(r.length){for(let e of r)console.error(e.reason);throw Error(`${r.length} promise(s) failed - see the above errors`)}let n=[];for(let e of t)"fulfilled"===e.status&&n.push(e.value);return n};class n5 extends rU{create(e,t,r){return this._client.post(rG`/vector_stores/${e}/file_batches`,{body:t,...r,headers:na([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,t,r){let{vector_store_id:n}=t;return this._client.get(rG`/vector_stores/${n}/file_batches/${e}`,{...r,headers:na([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}cancel(e,t,r){let{vector_store_id:n}=t;return this._client.post(rG`/vector_stores/${n}/file_batches/${e}/cancel`,{...r,headers:na([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}async createAndPoll(e,t,r){let n=await this.create(e,t);return await this.poll(e,n.id,r)}listFiles(e,t,r){let{vector_store_id:n,...s}=t;return this._client.getAPIList(rG`/vector_stores/${n}/file_batches/${e}/files`,rO,{query:s,...r,headers:na([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}async poll(e,t,r){let n=na([r?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":r?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:s,response:a}=await this.retrieve(t,{vector_store_id:e},{...r,headers:n}).withResponse();switch(s.status){case"in_progress":let i=5e3;if(r?.pollIntervalMs)i=r.pollIntervalMs;else{let e=a.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(i=t)}}await tJ(i);break;case"failed":case"cancelled":case"completed":return s}}}async uploadAndPoll(e,{files:t,fileIds:r=[]},n){if(null==t||0==t.length)throw Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let s=Math.min(n?.maxConcurrency??5,t.length),a=this._client,i=t.values(),o=[...r];async function l(e){for(let t of e){let e=await a.files.create({file:t,purpose:"assistants"},n);o.push(e.id)}}let c=Array(s).fill(i).map(l);return await n3(c),await this.createAndPoll(e,{file_ids:o})}}class n9 extends rU{create(e,t,r){return this._client.post(rG`/vector_stores/${e}/files`,{body:t,...r,headers:na([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,t,r){let{vector_store_id:n}=t;return this._client.get(rG`/vector_stores/${n}/files/${e}`,{...r,headers:na([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,t,r){let{vector_store_id:n,...s}=t;return this._client.post(rG`/vector_stores/${n}/files/${e}`,{body:s,...r,headers:na([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e,t={},r){return this._client.getAPIList(rG`/vector_stores/${e}/files`,rO,{query:t,...r,headers:na([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,t,r){let{vector_store_id:n}=t;return this._client.delete(rG`/vector_stores/${n}/files/${e}`,{...r,headers:na([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}async createAndPoll(e,t,r){let n=await this.create(e,t,r);return await this.poll(e,n.id,r)}async poll(e,t,r){let n=na([r?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":r?.pollIntervalMs?.toString()??void 0}]);for(;;){let s=await this.retrieve(t,{vector_store_id:e},{...r,headers:n}).withResponse(),a=s.data;switch(a.status){case"in_progress":let i=5e3;if(r?.pollIntervalMs)i=r.pollIntervalMs;else{let e=s.response.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(i=t)}}await tJ(i);break;case"failed":case"completed":return a}}}async upload(e,t,r){let n=await this._client.files.create({file:t,purpose:"assistants"},r);return this.create(e,{file_id:n.id},r)}async uploadAndPoll(e,t,r){let n=await this.upload(e,t,r);return await this.poll(e,n.id,r)}content(e,t,r){let{vector_store_id:n}=t;return this._client.getAPIList(rG`/vector_stores/${n}/files/${e}/content`,rR,{...r,headers:na([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}}class n7 extends rU{constructor(){super(...arguments),this.files=new n9(this._client),this.fileBatches=new n5(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:na([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(rG`/vector_stores/${e}`,{...t,headers:na([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,r){return this._client.post(rG`/vector_stores/${e}`,{body:t,...r,headers:na([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",rO,{query:e,...t,headers:na([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(rG`/vector_stores/${e}`,{...t,headers:na([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}search(e,t,r){return this._client.getAPIList(rG`/vector_stores/${e}/search`,rR,{body:t,method:"post",...r,headers:na([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}}n7.Files=n9,n7.FileBatches=n5;class se extends rU{create(e,t){return this._client.post("/videos",rP({body:e,...t},this._client))}retrieve(e,t){return this._client.get(rG`/videos/${e}`,t)}list(e={},t){return this._client.getAPIList("/videos",rT,{query:e,...t})}delete(e,t){return this._client.delete(rG`/videos/${e}`,t)}downloadContent(e,t={},r){return this._client.get(rG`/videos/${e}/content`,{query:t,...r,headers:na([{Accept:"application/binary"},r?.headers]),__binaryResponse:!0})}remix(e,t,r){return this._client.post(rG`/videos/${e}/remix`,rP({body:t,...r},this._client))}}class st extends rU{constructor(){super(...arguments),eG.add(this)}async unwrap(e,t,r=this._client.webhookSecret,n=300){return await this.verifySignature(e,t,r,n),JSON.parse(e)}async verifySignature(e,t,r=this._client.webhookSecret,n=300){if("undefined"==typeof crypto||"function"!=typeof crypto.subtle.importKey||"function"!=typeof crypto.subtle.verify)throw Error("Webhook signature verification is only supported when the `crypto` global is defined");tR(this,eG,"m",eX).call(this,r);let s=na([t]).values,a=tR(this,eG,"m",eW).call(this,s,"webhook-signature"),i=tR(this,eG,"m",eW).call(this,s,"webhook-timestamp"),o=tR(this,eG,"m",eW).call(this,s,"webhook-id"),l=parseInt(i,10);if(isNaN(l))throw new tq("Invalid webhook timestamp format");let c=Math.floor(Date.now()/1e3);if(c-l>n)throw new tq("Webhook timestamp is too old");if(l>c+n)throw new tq("Webhook timestamp is too new");let u=a.split(" ").map(e=>e.startsWith("v1,")?e.substring(3):e),d=r.startsWith("whsec_")?Buffer.from(r.replace("whsec_",""),"base64"):Buffer.from(r,"utf-8"),h=o?`${o}.${i}.${e}`:`${i}.${e}`,f=await crypto.subtle.importKey("raw",d,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(let e of u)try{let t=Buffer.from(e,"base64");if(await crypto.subtle.verify("HMAC",f,t,new TextEncoder().encode(h)))return}catch{continue}throw new tq("The given webhook signature does not match the expected signature")}}eG=new WeakSet,eX=function(e){if("string"!=typeof e||0===e.length)throw Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},eW=function(e,t){if(!e)throw Error("Headers are required");let r=e.get(t);if(null==r)throw Error(`Missing required header: ${t}`);return r},e.i(98546);class sr{constructor({baseURL:e=nv("OPENAI_BASE_URL"),apiKey:t=nv("OPENAI_API_KEY"),organization:r=nv("OPENAI_ORG_ID")??null,project:n=nv("OPENAI_PROJECT_ID")??null,webhookSecret:s=nv("OPENAI_WEBHOOK_SECRET")??null,...a}={}){if(eK.add(this),eJ.set(this,void 0),this.completions=new nO(this),this.chat=new nn(this),this.embeddings=new nP(this),this.files=new nM(this),this.images=new nW(this),this.audio=new nc(this),this.moderations=new nY(this),this.models=new nK(this),this.fineTuning=new nq(this),this.graders=new nX(this),this.vectorStores=new n7(this),this.webhooks=new st(this),this.beta=new nR(this),this.batches=new nu(this),this.uploads=new n8(this),this.responses=new n4(this),this.realtime=new nz(this),this.conversations=new nN(this),this.evals=new nD(this),this.containers=new nC(this),this.videos=new se(this),void 0===t)throw new tC("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");const i={apiKey:t,organization:r,project:n,webhookSecret:s,...a,baseURL:e||"https://api.openai.com/v1"};i.dangerouslyAllowBrowser,this.baseURL=i.baseURL,this.timeout=i.timeout??eY.DEFAULT_TIMEOUT,this.logger=i.logger??console;const o="warn";this.logLevel=o,this.logLevel=rl(i.logLevel,"ClientOptions.logLevel",this)??rl(nv("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??o,this.fetchOptions=i.fetchOptions,this.maxRetries=i.maxRetries??2,this.fetch=i.fetch??function(){if("undefined"!=typeof fetch)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),tS(this,eJ,t4,"f"),this._options=i,this.apiKey="string"==typeof t?t:"Missing Key",this.organization=r,this.project=n,this.webhookSecret=s}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}async authHeaders(e){return na([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return function(e,t={}){let r,n=e,s=function(e=rr){let t;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw TypeError("Encoder has to be a function.");let r=e.charset||rr.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=t6;if(void 0!==e.format){if(!t5(t3,e.format))throw TypeError("Unknown format option provided.");n=e.format}let s=t3[n],a=rr.filter;if(("function"==typeof e.filter||tX(e.filter))&&(a=e.filter),t=e.arrayFormat&&e.arrayFormat in re?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":rr.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw TypeError("`commaRoundTrip` must be a boolean, or absent");let i=void 0===e.allowDots?!0==!!e.encodeDotInKeys||rr.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:rr.addQueryPrefix,allowDots:i,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:rr.allowEmptyArrays,arrayFormat:t,charset:r,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:rr.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?rr.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:rr.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:rr.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:rr.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:rr.encodeValuesOnly,filter:a,format:n,formatter:s,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:rr.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:rr.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:rr.strictNullHandling}}(t);"function"==typeof s.filter?n=(0,s.filter)("",n):tX(s.filter)&&(r=s.filter);let a=[];if("object"!=typeof n||null===n)return"";let i=re[s.arrayFormat],o="comma"===i&&s.commaRoundTrip;r||(r=Object.keys(n)),s.sort&&r.sort(s.sort);let l=new WeakMap;for(let e=0;e<r.length;++e){let t=r[e];s.skipNulls&&null===n[t]||rt(a,function e(t,r,n,s,a,i,o,l,c,u,d,h,f,p,m,g,_,y){var b,v;let w,E=t,S=y,R=0,O=!1;for(;void 0!==(S=S.get(rn))&&!O;){let e=S.get(t);if(R+=1,void 0!==e)if(e===R)throw RangeError("Cyclic object value");else O=!0;void 0===S.get(rn)&&(R=0)}if("function"==typeof u?E=u(r,E):E instanceof Date?E=f?.(E):"comma"===n&&tX(E)&&(E=t7(E,function(e){return e instanceof Date?f?.(e):e})),null===E){if(i)return c&&!g?c(r,rr.encoder,_,"key",p):r;E=""}if("string"==typeof(b=E)||"number"==typeof b||"boolean"==typeof b||"symbol"==typeof b||"bigint"==typeof b||(v=E)&&"object"==typeof v&&v.constructor&&v.constructor.isBuffer&&v.constructor.isBuffer(v)){if(c){let e=g?r:c(r,rr.encoder,_,"key",p);return[m?.(e)+"="+m?.(c(E,rr.encoder,_,"value",p))]}return[m?.(r)+"="+m?.(String(E))]}let T=[];if(void 0===E)return T;if("comma"===n&&tX(E))g&&c&&(E=t7(E,c)),w=[{value:E.length>0?E.join(",")||null:void 0}];else if(tX(u))w=u;else{let e=Object.keys(E);w=d?e.sort(d):e}let A=l?String(r).replace(/\./g,"%2E"):String(r),C=s&&tX(E)&&1===E.length?A+"[]":A;if(a&&tX(E)&&0===E.length)return C+"[]";for(let r=0;r<w.length;++r){let b=w[r],v="object"==typeof b&&void 0!==b.value?b.value:E[b];if(o&&null===v)continue;let S=h&&l?b.replace(/\./g,"%2E"):b,O=tX(E)?"function"==typeof n?n(C,S):C:C+(h?"."+S:"["+S+"]");y.set(t,R);let A=new WeakMap;A.set(rn,y),rt(T,e(v,O,n,s,a,i,o,l,"comma"===n&&g&&tX(E)?null:c,u,d,h,f,p,m,g,_,A))}return T}(n[t],t,i,o,s.allowEmptyArrays,s.strictNullHandling,s.skipNulls,s.encodeDotInKeys,s.encode?s.encoder:null,s.filter,s.sort,s.allowDots,s.serializeDate,s.format,s.formatter,s.encodeValuesOnly,s.charset,l))}let c=a.join(s.delimiter),u=!0===s.addQueryPrefix?"?":"";return s.charsetSentinel&&("iso-8859-1"===s.charset?u+="utf8=%26%2310003%3B&":u+="utf8=%E2%9C%93&"),c.length>0?u+c:""}(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${tV}`}defaultIdempotencyKey(){return`stainless-node-retry-${tO()}`}makeStatusError(e,t,r,n){return tx.generate(e,t,r,n)}async _callApiKey(){let e,t=this._options.apiKey;if("function"!=typeof t)return!1;try{e=await t()}catch(e){if(e instanceof tC)throw e;throw new tC(`Failed to get token from 'apiKey' function: ${e.message}`,{cause:e})}if("string"!=typeof e||!e)throw new tC(`Expected 'apiKey' function argument to return a string but it returned ${e}`);return this.apiKey=e,!0}buildURL(e,t,r){let n=!tR(this,eK,"m",eV).call(this)&&r||this.baseURL,s=new URL(tG.test(e)?e:n+(n.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),a=this.defaultQuery();return!function(e){if(!e)return!0;for(let t in e)return!1;return!0}(a)&&(t={...a,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(s.search=this.stringifyQuery(t)),s.toString()}async prepareOptions(e){await this._callApiKey()}async prepareRequest(e,{url:t,options:r}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(r=>({method:e,path:t,...r})))}request(e,t=null){return new rw(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,r){let n=await e,s=n.maxRetries??this.maxRetries;null==t&&(t=s),await this.prepareOptions(n);let{req:a,url:i,timeout:o}=await this.buildRequest(n,{retryCount:s-t});await this.prepareRequest(a,{url:i,options:n});let l="log_"+(0x1000000*Math.random()|0).toString(16).padStart(6,"0"),c=void 0===r?"":`, retryOf: ${r}`,u=Date.now();if(rf(this).debug(`[${l}] sending request`,rp({retryOfRequestLogID:r,method:n.method,url:i,options:n,headers:a.headers})),n.signal?.aborted)throw new tN;let d=new AbortController,h=await this.fetchWithTimeout(i,a,o,d).catch(tA),f=Date.now();if(h instanceof globalThis.Error){let e=`retrying, ${t} attempts remaining`;if(n.signal?.aborted)throw new tN;let s=tT(h)||/timed? ?out/i.test(String(h)+("cause"in h?String(h.cause):""));if(t)return rf(this).info(`[${l}] connection ${s?"timed out":"failed"} - ${e}`),rf(this).debug(`[${l}] connection ${s?"timed out":"failed"} (${e})`,rp({retryOfRequestLogID:r,url:i,durationMs:f-u,message:h.message})),this.retryRequest(n,t,r??l);if(rf(this).info(`[${l}] connection ${s?"timed out":"failed"} - error; no more retries left`),rf(this).debug(`[${l}] connection ${s?"timed out":"failed"} (error; no more retries left)`,rp({retryOfRequestLogID:r,url:i,durationMs:f-u,message:h.message})),s)throw new tI;throw new tP({cause:h})}let p=[...h.headers.entries()].filter(([e])=>"x-request-id"===e).map(([e,t])=>", "+e+": "+JSON.stringify(t)).join(""),m=`[${l}${c}${p}] ${a.method} ${i} ${h.ok?"succeeded":"failed"} with status ${h.status} in ${f-u}ms`;if(!h.ok){let e=await this.shouldRetry(h);if(t&&e){let e=`retrying, ${t} attempts remaining`;return await t2(h.body),rf(this).info(`${m} - ${e}`),rf(this).debug(`[${l}] response error (${e})`,rp({retryOfRequestLogID:r,url:h.url,status:h.status,headers:h.headers,durationMs:f-u})),this.retryRequest(n,t,r??l,h.headers)}let s=e?"error; no more retries left":"error; not retryable";rf(this).info(`${m} - ${s}`);let a=await h.text().catch(e=>tA(e).message),i=(e=>{try{return JSON.parse(e)}catch(e){return}})(a),o=i?void 0:a;throw rf(this).debug(`[${l}] response error (${s})`,rp({retryOfRequestLogID:r,url:h.url,status:h.status,headers:h.headers,message:o,durationMs:Date.now()-u})),this.makeStatusError(h.status,i,o,h.headers)}return rf(this).info(m),rf(this).debug(`[${l}] response start`,rp({retryOfRequestLogID:r,url:h.url,status:h.status,headers:h.headers,durationMs:f-u})),{response:h,options:n,controller:d,requestLogID:l,retryOfRequestLogID:r,startTime:u}}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}requestAPIList(e,t){return new rS(this,this.makeRequest(t,null,void 0),e)}async fetchWithTimeout(e,t,r,n){let{signal:s,method:a,...i}=t||{};s&&s.addEventListener("abort",()=>n.abort());let o=setTimeout(()=>n.abort(),r),l=globalThis.ReadableStream&&i.body instanceof globalThis.ReadableStream||"object"==typeof i.body&&null!==i.body&&Symbol.asyncIterator in i.body,c={signal:n.signal,...l?{duplex:"half"}:{},method:"GET",...i};a&&(c.method=a.toUpperCase());try{return await this.fetch.call(void 0,e,c)}finally{clearTimeout(o)}}async shouldRetry(e){let t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||!!(e.status>=500))}async retryRequest(e,t,r,n){let s,a=n?.get("retry-after-ms");if(a){let e=parseFloat(a);Number.isNaN(e)||(s=e)}let i=n?.get("retry-after");if(i&&!s){let e=parseFloat(i);s=Number.isNaN(e)?Date.parse(i)-Date.now():1e3*e}if(!(s&&0<=s&&s<6e4)){let r=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,r)}return await tJ(s),this.makeRequest(e,t-1,r)}calculateDefaultRetryTimeoutMillis(e,t){return Math.min(.5*Math.pow(2,t-e),8)*(1-.25*Math.random())*1e3}async buildRequest(e,{retryCount:t=0}={}){let r={...e},{method:n,path:s,query:a,defaultBaseURL:i}=r,o=this.buildURL(s,a,i);"timeout"in r&&((e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new tC(`${e} must be an integer`);if(t<0)throw new tC(`${e} must be a positive integer`)})("timeout",r.timeout),r.timeout=r.timeout??this.timeout;let{bodyHeaders:l,body:c}=this.buildBody({options:r}),u=await this.buildHeaders({options:e,method:n,bodyHeaders:l,retryCount:t});return{req:{method:n,headers:u,...r.signal&&{signal:r.signal},...globalThis.ReadableStream&&c instanceof globalThis.ReadableStream&&{duplex:"half"},...c&&{body:c},...this.fetchOptions??{},...r.fetchOptions??{}},url:o,timeout:r.timeout}}async buildHeaders({options:e,method:r,bodyHeaders:n,retryCount:s}){let a={};this.idempotencyHeader&&"get"!==r&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);let i=na([a,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(s),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...t??(t=(()=>{let e="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":tV,"X-Stainless-OS":tQ(Deno.build.os),"X-Stainless-Arch":tz(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":tV,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":tV,"X-Stainless-OS":tQ(globalThis.process.platform??"unknown"),"X-Stainless-Arch":tz(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let t=function(){if("undefined"==typeof navigator||!navigator)return null;for(let{key:e,pattern:t}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let r=t.exec(navigator.userAgent);if(r){let t=r[1]||0,n=r[2]||0,s=r[3]||0;return{browser:e,version:`${t}.${n}.${s}`}}}return null}();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":tV,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":tV,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}})()),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(e),this._options.defaultHeaders,n,e.headers]);return this.validateHeaders(i),i.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let r=na([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||"string"==typeof e&&r.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:"object"==typeof e&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&"function"==typeof e.next)?{bodyHeaders:void 0,body:t0(e)}:tR(this,eJ,"f").call(this,{body:e,headers:r})}}eY=sr,eJ=new WeakMap,eK=new WeakSet,eV=function(){return"https://api.openai.com/v1"!==this.baseURL},sr.OpenAI=eY,sr.DEFAULT_TIMEOUT=6e5,sr.OpenAIError=tC,sr.APIError=tx,sr.APIConnectionError=tP,sr.APIConnectionTimeoutError=tI,sr.APIUserAbortError=tN,sr.NotFoundError=tj,sr.ConflictError=tk,sr.RateLimitError=tH,sr.BadRequestError=t$,sr.AuthenticationError=tD,sr.InternalServerError=tF,sr.PermissionDeniedError=tM,sr.UnprocessableEntityError=tL,sr.InvalidWebhookSignatureError=tq,sr.toFile=rH,sr.Completions=nO,sr.Chat=nn,sr.Embeddings=nP,sr.Files=nM,sr.Images=nW,sr.Audio=nc,sr.Moderations=nY,sr.Models=nK,sr.FineTuning=nq,sr.Graders=nX,sr.VectorStores=n7,sr.Webhooks=st,sr.Beta=nR,sr.Batches=nu,sr.Uploads=n8,sr.Responses=n4,sr.Realtime=nz,sr.Conversations=nN,sr.Evals=nD,sr.Containers=nC,sr.Videos=se;var sn=e.i(76590);process.env.GEMINI_API_KEY?console.log(" [GeminiService] GEMINI_API_KEY detectada com sucesso."):console.error(" [GeminiService] Varivel de ambiente GEMINI_API_KEY no configurada!"),process.env.OPENAI_API_KEY?console.log(" [OpenAIService] OPENAI_API_KEY detectada com sucesso."):console.error(" [OpenAIService] Varivel de ambiente OPENAI_API_KEY no configurada!");let ss=new class{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new e0("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new tE(this.apiKey,e,t)}getGenerativeModelFromCachedContent(e,t,r){if(!e.name)throw new e4("Cached content must contain a `name` field.");if(!e.model)throw new e4("Cached content must contain a `model` field.");for(let r of["model","systemInstruction"])if((null==t?void 0:t[r])&&e[r]&&(null==t?void 0:t[r])!==e[r]){if("model"===r&&(t.model.startsWith("models/")?t.model.replace("models/",""):t.model)===(e.model.startsWith("models/")?e.model.replace("models/",""):e.model))continue;throw new e4(`Different value for "${r}" specified in modelParams (${t[r]}) and cachedContent (${e[r]})`)}let n=Object.assign(Object.assign({},t),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new tE(this.apiKey,n,r)}}(process.env.GEMINI_API_KEY),sa=new sr({apiKey:process.env.OPENAI_API_KEY});async function si(){let e=await (0,sn.getSettings)();if(!e)throw Error("Configuraes de IA no encontradas no banco.");return e}let so=async(e,t,r)=>{console.log(" [writeNewsArticle] Gerando artigo com OpenAI (GPT-4o-mini)");let n=(await si()).writer_instructions+`
Tema: "${e}"  
Idioma: ${t}  
Palavras-chave foco: ${r}

`;try{let e=await sa.chat.completions.create({model:"gpt-4o-mini",messages:[{role:"user",content:n}],temperature:.8}),t=e.choices[0]?.message?.content||"";return console.log(" [writeNewsArticle] Artigo gerado com sucesso."),t.trim()}catch(e){throw console.error(" [writeNewsArticle] Erro:",e),Error("Falha ao gerar o artigo de notcia pela OpenAI.")}},sl=async e=>{console.log(" [formatArticleToHtml] Iniciando formatao com Gemini 1.5 Flash");let t=await si(),r=t.formatter_instructions+`

Texto para formatar:
${e}

`;try{let e=ss.getGenerativeModel({model:t.formatter_model||"gemini-1.5-flash"}),n=(await e.generateContent(r)).response.text()||"";return n.startsWith("```html")&&(n=n.slice(7)),n.endsWith("```")&&(n=n.slice(0,-3)),console.log(" [formatArticleToHtml] HTML gerado com sucesso. Tamanho:",n.length),n.trim()}catch(e){throw console.error(" [formatArticleToHtml] Erro ao gerar HTML:",e),Error("Falha ao formatar o artigo para HTML.")}},sc=async(e,t)=>{console.log(" [analyzeSeoAndExtractMetadata] Iniciando anlise SEO com Gemini");let r=await si(),n=r.seo_instructions+`

Texto:
${e}
Palavras-chave foco: ${t}`;try{let e=ss.getGenerativeModel({model:r.seo_model||"gemini-1.5-flash"}),t=(await e.generateContent(n)).response.text(),s=t.indexOf("{"),a=t.lastIndexOf("}")+1,i=-1!==s&&-1!==a?JSON.parse(t.slice(s,a)):{keywords:[],metaDescription:""};return console.log(" [analyzeSeoAndExtractMetadata] SEO extrado:",i),{keywords:i.keywords||[],metaDescription:i.metaDescription||""}}catch(e){return console.error(" [analyzeSeoAndExtractMetadata] Erro SEO:",e),{keywords:[],metaDescription:"No foi possvel gerar a meta descrio."}}};e.s(["analyzeSeoAndExtractMetadata",0,sc,"formatArticleToHtml",0,sl,"writeNewsArticle",0,so],94943);var su=e.i(98323);if(su.neonConfig.fetchConnectionCache=!0,!process.env.POSTGRES_URL)throw Error("Varivel de ambiente POSTGRES_URL no definida.");let sd=(0,su.neon)(process.env.POSTGRES_URL),sh=e=>({id:String(e.id),generationDate:e.generation_date,title:e.title,rawContent:e.raw_content,formattedContent:e.formatted_content||"",published:e.published,keywords:Array.isArray(e.keywords)?e.keywords:"string"==typeof e.keywords?e.keywords.split(",").map(e=>e.trim()):[],metaDescription:e.meta_description||""});async function sf(){try{await sd`
      CREATE TABLE IF NOT EXISTS articles (
        id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
        generation_date TIMESTAMPTZ NOT NULL,
        title TEXT NOT NULL,
        raw_content TEXT NOT NULL,
        formatted_content TEXT,
        published BOOLEAN NOT NULL DEFAULT false,
        keywords TEXT[],
        meta_description TEXT
      );
    `,console.log(" Tabela 'articles' verificada/criada com sucesso.")}catch(e){throw console.error(" Falha na configurao do banco de dados:",e),Error("Falha ao configurar a tabela do banco de dados.")}}async function sp(e){try{let t=await sd`
      INSERT INTO articles (
        generation_date, title, raw_content, formatted_content, published, keywords, meta_description
      )
      VALUES (
        ${e.generationDate},
        ${e.title},
        ${e.rawContent},
        ${e.formattedContent||""},
        ${e.published??!1},
        ${Array.isArray(e.keywords)?e.keywords:[e.keywords]},
        ${e.metaDescription||""}
      )
      RETURNING *;
    `,r=Array.isArray(t)?t[0]:t;return console.log(` Artigo salvo com sucesso (ID: ${r.id})`),sh(r)}catch(e){throw console.error(" Erro ao salvar artigo:",e),Error("Falha ao salvar o artigo.")}}async function sm(e){try{let t=await sd`SELECT * FROM articles WHERE id = ${e} LIMIT 1;`,r=Array.isArray(t)?t[0]:t;if(!r)return null;return console.log("## retorno do select"),console.log(r),sh(r)}catch(e){throw console.error(" Erro ao buscar artigo:",e),Error("Falha ao buscar o artigo por ID.")}}async function sg(e,t){try{let r=Object.keys(t);if(0===r.length)return;let n=r.map((e,t)=>`${e.replace(/([A-Z])/g,"_$1").toLowerCase()} = $${t+1}`).join(", "),s=Object.values(t),a=`
      UPDATE articles
      SET ${n}
      WHERE id = $${r.length+1};
    `;await sd(a,[...s,e]),console.log(` Artigo ${e} atualizado (${r.join(", ")})`)}catch(e){throw console.error(" Erro ao atualizar artigo:",e),Error("Falha ao atualizar o artigo.")}}async function s_(){try{let e=await sd`SELECT * FROM articles ORDER BY generation_date DESC;`;return(Array.isArray(e)?e:e?[e]:[]).map(sh)}catch(e){throw console.error(" Erro ao buscar artigos:",e),Error("Falha ao buscar os artigos.")}}async function sy(e,t,r){try{let n=await so(e,t,r),s=await sl(n),{keywords:a,metaDescription:i}=await sc(n,r),o={title:e,rawContent:n,formattedContent:s,generationDate:new Date().toISOString(),published:!1,keywords:a,metaDescription:i},l=await sp(o);return(0,eQ.revalidatePath)("/dashboard/history"),{...l,published:!0}}catch(e){throw console.error(" Erro em generateAndSaveArticleAction:",e),Error(`Falha ao gerar e salvar o artigo: ${e instanceof Error?e.message:String(e)}`)}}async function sb(e){try{let t={title:e.title,rawContent:e.content,formattedContent:"",generationDate:new Date().toISOString(),published:!1,keywords:[""],metaDescription:""},r=await sp(t);return console.log(` Rascunho salvo com ID: ${r.id}`),(0,eQ.revalidatePath)("/dashboard/history"),r}catch(e){throw console.error(" Erro ao salvar rascunho:",e),Error("Falha ao salvar rascunho.")}}async function sv(e){try{return await sm(e)}catch(e){return console.error(" Erro ao buscar artigo:",e),null}}async function sw(e,t){try{await sg(e,{formattedContent:t}),console.log(` HTML atualizado com sucesso para o artigo ${e}`),(0,eQ.revalidatePath)("/dashboard/history")}catch(e){throw console.error(" Erro ao atualizar HTML:",e),Error("Falha ao atualizar o HTML do artigo.")}}async function sE(e,t){try{let r;r=Array.isArray(t.keywords)?t.keywords:"string"==typeof t.keywords?t.keywords.split(",").map(e=>e.trim()):[];let n=t.metaDescription||"";await sg(e,{keywords:r,metaDescription:n,published:!0,generationDate:new Date().toISOString()}),console.log(` SEO atualizado e artigo ${e} publicado com sucesso.`),(0,eQ.revalidatePath)("/dashboard/history")}catch(e){throw console.error(" Erro ao atualizar SEO:",e),Error(e?.message||"Falha ao atualizar os dados de SEO do artigo.")}}async function sS(){try{return await sf(),await s_()}catch(e){return console.error(" Erro em getArticlesAction:",e),[]}}(0,e.i(95975).ensureServerEntryExports)([sy,sb,sv,sw,sE,sS]),(0,ez.registerServerReference)(sy,"70f12876fc0e134895d97a7ded794efaca2a696c9b",null),(0,ez.registerServerReference)(sb,"40beaf35ecbbfb8886c6be979c13bf3516a379c0e5",null),(0,ez.registerServerReference)(sv,"400e61989097eb8b9f68c780e0d03ac63cfdf09c02",null),(0,ez.registerServerReference)(sw,"600f1d6fd2e8bc63d9f50ada752da9b53c4faada57",null),(0,ez.registerServerReference)(sE,"60b3884135d67f03b04d28d68149fff07fc9729e4b",null),(0,ez.registerServerReference)(sS,"00fe0019f97a45ff59a91728708b782e5fa671df37",null),e.s(["generateAndSaveArticleAction",()=>sy,"getArticleById",()=>sv,"saveArticleDraft",()=>sb,"updateArticleHtml",()=>sw,"updateArticleSeo",()=>sE],7312)}];

//# sourceMappingURL=_6eacb713._.js.map